<!doctype html><html lang=zh-TW class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is my technical blog. For taking learning notes and sharing my experience."><meta name=author content="Hans Tsai"><link href=https://hans-tsai.github.io/hans_blog/programming_language/nodejs/ rel=canonical><link rel=prev href=../..><link href=../java/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.33"><title>Node.js - Hans' blog</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Poppins";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config",""),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../assets/stylesheets/custom.f7ec4df2.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#nodejs-learn class=md-skip> 跳轉到 </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label=不再顯示此訊息> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> For updates follow <strong>@squidfunk</strong> on <a rel=me href=https://fosstodon.org/@squidfunk> <span class="twemoji mastodon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </span> <strong>Fosstodon</strong> </a> and <a href=https://twitter.com/squidfunk> <span class="twemoji twitter"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </span> <strong>Twitter</strong> </a> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=頁首> <a href=../.. title="Hans' blog" class="md-header__button md-logo" aria-label="Hans' blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Hans' blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Node.js </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=cyan aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=cyan data-md-color-accent=cyan aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜尋 placeholder=搜尋 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=搜尋> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清除 aria-label=清除 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜尋引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Hans-Tsai/hans_blog title=前往倉庫 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> hans-tsai/hans_blog </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=導覽列 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Hans' blog" class="md-nav__button md-logo" aria-label="Hans' blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Hans' blog </label> <div class=md-nav__source> <a href=https://github.com/Hans-Tsai/hans_blog title=前往倉庫 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> hans-tsai/hans_blog </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Programming language </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Programming language </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Node.js </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Node.js </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目錄> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目錄 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 安裝方式 </span> </a> <nav class=md-nav aria-label=安裝方式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#windows class=md-nav__link> <span class=md-ellipsis> Windows 系統 </span> </a> </li> <li class=md-nav__item> <a href=#macos class=md-nav__link> <span class=md-ellipsis> MacOS 系統 </span> </a> </li> <li class=md-nav__item> <a href=#linux-ubuntu class=md-nav__link> <span class=md-ellipsis> Linux 系統 (以 Ubuntu 為例) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nodejs class=md-nav__link> <span class=md-ellipsis> Node.js 核心觀念 </span> </a> <nav class=md-nav aria-label="Node.js 核心觀念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#introduction-to-nodejs class=md-nav__link> <span class=md-ellipsis> Introduction to Node.js </span> </a> </li> <li class=md-nav__item> <a href=#a-brief-history-of-nodejs class=md-nav__link> <span class=md-ellipsis> A brief history of Node.js </span> </a> </li> <li class=md-nav__item> <a href=#how-to-install-nodejs class=md-nav__link> <span class=md-ellipsis> How to install Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#how-much-javascript-do-you-need-to-know-to-use-nodejs class=md-nav__link> <span class=md-ellipsis> How much JavaScript do you need to know to use Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#differences-between-nodejs-and-the-browser class=md-nav__link> <span class=md-ellipsis> Differences between Node.js and the Browser </span> </a> </li> <li class=md-nav__item> <a href=#the-v8-javascript-engine class=md-nav__link> <span class=md-ellipsis> The V8 JavaScript Engine </span> </a> </li> <li class=md-nav__item> <a href=#run-nodejs-scripts-from-the-command-line class=md-nav__link> <span class=md-ellipsis> Run Node.js scripts from the command line </span> </a> </li> <li class=md-nav__item> <a href=#how-to-exit-from-a-nodejs-program class=md-nav__link> <span class=md-ellipsis> How to exit from a Node.js program? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-read-environment-variables-from-nodejs class=md-nav__link> <span class=md-ellipsis> How to read environment variables from Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-the-nodejs-repl class=md-nav__link> <span class=md-ellipsis> How to use the Node.js REPL? </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-accept-arguments-from-the-command-line class=md-nav__link> <span class=md-ellipsis> Node.js, accept arguments from the command line </span> </a> </li> <li class=md-nav__item> <a href=#output-to-the-command-line-using-nodejs class=md-nav__link> <span class=md-ellipsis> Output to the command line using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#accept-input-from-the-command-line-in-nodejs class=md-nav__link> <span class=md-ellipsis> Accept input from the command line in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#expose-functionality-from-a-nodejs-file-using-exports class=md-nav__link> <span class=md-ellipsis> Expose functionality from a Node.js file using exports </span> </a> </li> <li class=md-nav__item> <a href=#an-introduction-to-the-npm-package-manager class=md-nav__link> <span class=md-ellipsis> An introduction to the npm package manager </span> </a> </li> <li class=md-nav__item> <a href=#where-does-npm-install-the-packages class=md-nav__link> <span class=md-ellipsis> Where does npm install the packages? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-or-execute-a-package-installed-using-npm class=md-nav__link> <span class=md-ellipsis> How to use or execute a package installed using npm? </span> </a> </li> <li class=md-nav__item> <a href=#the-packagejson-guide class=md-nav__link> <span class=md-ellipsis> The package.json guide </span> </a> </li> <li class=md-nav__item> <a href=#the-package-lockjson-file class=md-nav__link> <span class=md-ellipsis> The package-lock.json file </span> </a> </li> <li class=md-nav__item> <a href=#find-the-installed-version-of-an-npm-package class=md-nav__link> <span class=md-ellipsis> Find the installed version of an npm package </span> </a> </li> <li class=md-nav__item> <a href=#install-an-older-version-of-an-npm-package class=md-nav__link> <span class=md-ellipsis> Install an older version of an npm package </span> </a> </li> <li class=md-nav__item> <a href=#update-all-the-nodejs-dependencies-to-their-latest-version class=md-nav__link> <span class=md-ellipsis> Update all the Node.js dependencies to their latest version </span> </a> </li> <li class=md-nav__item> <a href=#semantic-versioning-using-npm class=md-nav__link> <span class=md-ellipsis> Semantic Versioning using npm </span> </a> </li> <li class=md-nav__item> <a href=#uninstalling-npm-packages class=md-nav__link> <span class=md-ellipsis> Uninstalling npm packages </span> </a> </li> <li class=md-nav__item> <a href=#npm-global-or-local-packages class=md-nav__link> <span class=md-ellipsis> npm global or local packages </span> </a> </li> <li class=md-nav__item> <a href=#npm-dependencies-and-devdependencies class=md-nav__link> <span class=md-ellipsis> npm dependencies and devDependencies </span> </a> </li> <li class=md-nav__item> <a href=#the-npx-nodejs-package-runner class=md-nav__link> <span class=md-ellipsis> The npx Node.js Package Runner </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-event-loop class=md-nav__link> <span class=md-ellipsis> The Node.js Event Loop </span> </a> </li> <li class=md-nav__item> <a href=#understanding-processnexttick class=md-nav__link> <span class=md-ellipsis> Understanding process.nextTick() </span> </a> </li> <li class=md-nav__item> <a href=#understanding-setimmediate class=md-nav__link> <span class=md-ellipsis> Understanding setImmediate() </span> </a> </li> <li class=md-nav__item> <a href=#discover-javascript-timers class=md-nav__link> <span class=md-ellipsis> Discover JavaScript Timers </span> </a> </li> <li class=md-nav__item> <a href=#javascript-asynchronous-programming-and-callbacks class=md-nav__link> <span class=md-ellipsis> JavaScript Asynchronous Programming and Callbacks </span> </a> </li> <li class=md-nav__item> <a href=#understanding-javascript-promises class=md-nav__link> <span class=md-ellipsis> Understanding JavaScript Promises </span> </a> </li> <li class=md-nav__item> <a href=#modern-asynchronous-javascript-with-async-and-await class=md-nav__link> <span class=md-ellipsis> Modern Asynchronous JavaScript with Async and Await </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-event-emitter class=md-nav__link> <span class=md-ellipsis> The Node.js Event emitter </span> </a> </li> <li class=md-nav__item> <a href=#build-an-http-server class=md-nav__link> <span class=md-ellipsis> Build an HTTP Server </span> </a> </li> <li class=md-nav__item> <a href=#making-http-requests-with-nodejs class=md-nav__link> <span class=md-ellipsis> Making HTTP requests with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#make-an-http-post-request-using-nodejs class=md-nav__link> <span class=md-ellipsis> Make an HTTP POST request using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#get-http-request-body-data-using-nodejs class=md-nav__link> <span class=md-ellipsis> Get HTTP request body data using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#working-with-file-descriptors-in-nodejs class=md-nav__link> <span class=md-ellipsis> Working with file descriptors in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-file-stats class=md-nav__link> <span class=md-ellipsis> Node.js file stats </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-file-paths class=md-nav__link> <span class=md-ellipsis> Node.js File Paths </span> </a> </li> <li class=md-nav__item> <a href=#reading-files-with-nodejs class=md-nav__link> <span class=md-ellipsis> Reading files with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#writing-files-with-nodejs class=md-nav__link> <span class=md-ellipsis> Writing files with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#working-with-folders-in-nodejs class=md-nav__link> <span class=md-ellipsis> Working with folders in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-fs-module class=md-nav__link> <span class=md-ellipsis> The Node.js fs module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-path-module class=md-nav__link> <span class=md-ellipsis> The Node.js path module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-os-module class=md-nav__link> <span class=md-ellipsis> The Node.js os module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-events-module class=md-nav__link> <span class=md-ellipsis> The Node.js events module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-http-module class=md-nav__link> <span class=md-ellipsis> The Node.js http module </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-buffers class=md-nav__link> <span class=md-ellipsis> Node.js Buffers </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-streams class=md-nav__link> <span class=md-ellipsis> Node.js Streams </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-the-difference-between-development-and-production class=md-nav__link> <span class=md-ellipsis> Node.js, the difference between development and production </span> </a> </li> <li class=md-nav__item> <a href=#error-handling-in-nodejs class=md-nav__link> <span class=md-ellipsis> Error handling in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#how-to-log-an-object-in-nodejs class=md-nav__link> <span class=md-ellipsis> How to log an object in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-with-typescript class=md-nav__link> <span class=md-ellipsis> Node.js with TypeScript </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nodejs_1 class=md-nav__link> <span class=md-ellipsis> Node.js 核心模組 </span> </a> <nav class=md-nav aria-label="Node.js 核心模組"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#http class=md-nav__link> <span class=md-ellipsis> HTTP </span> </a> </li> <li class=md-nav__item> <a href=#process class=md-nav__link> <span class=md-ellipsis> Process </span> </a> </li> <li class=md-nav__item> <a href=#console class=md-nav__link> <span class=md-ellipsis> Console </span> </a> </li> <li class=md-nav__item> <a href=#readline class=md-nav__link> <span class=md-ellipsis> Readline </span> </a> </li> <li class=md-nav__item> <a href=#commonjs-modules class=md-nav__link> <span class=md-ellipsis> CommonJS modules </span> </a> </li> <li class=md-nav__item> <a href=#timers class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=#events class=md-nav__link> <span class=md-ellipsis> Events </span> </a> </li> <li class=md-nav__item> <a href=#buffers class=md-nav__link> <span class=md-ellipsis> Buffers </span> </a> </li> <li class=md-nav__item> <a href=#stream class=md-nav__link> <span class=md-ellipsis> Stream </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 參考資料來源 </span> </a> <nav class=md-nav aria-label=參考資料來源> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 官方文件 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 網路文章 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 網路影片 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../java/ class=md-nav__link> <span class=md-ellipsis> Java </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Backend </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Backend </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Framework </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Framework </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../backend/framework/spring_boot/ class=md-nav__link> <span class=md-ellipsis> Spring Boot </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> System Design </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> System Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../backend/system_design/ddd/ class=md-nav__link> <span class=md-ellipsis> DDD </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Cloud </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/aws/saa/ class=md-nav__link> <span class=md-ellipsis> SAA </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../cloud/k8s/cka/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Networking </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Networking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../networking/networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Version Control </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Version Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../version_control/git/ class=md-nav__link> <span class=md-ellipsis> Git </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Coding Interview </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Coding Interview </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Geeks for Geeks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Geeks for Geeks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding_interview/geeks_for_geeks/dsa_tutorial/ class=md-nav__link> <span class=md-ellipsis> DSA Tutorial </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Tech interview handbook </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Tech interview handbook </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding_interview/tech_interview_handbook/coding_interview_prepararion/ class=md-nav__link> <span class=md-ellipsis> Coding interview preparation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Others </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Others </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../others/others/ class=md-nav__link> <span class=md-ellipsis> Others </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex> <span class=md-ellipsis> MkDocs Info </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> MkDocs Info </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mkdocs_info/mkdocs/ class=md-nav__link> <span class=md-ellipsis> MkDocs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目錄> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目錄 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 安裝方式 </span> </a> <nav class=md-nav aria-label=安裝方式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#windows class=md-nav__link> <span class=md-ellipsis> Windows 系統 </span> </a> </li> <li class=md-nav__item> <a href=#macos class=md-nav__link> <span class=md-ellipsis> MacOS 系統 </span> </a> </li> <li class=md-nav__item> <a href=#linux-ubuntu class=md-nav__link> <span class=md-ellipsis> Linux 系統 (以 Ubuntu 為例) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nodejs class=md-nav__link> <span class=md-ellipsis> Node.js 核心觀念 </span> </a> <nav class=md-nav aria-label="Node.js 核心觀念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#introduction-to-nodejs class=md-nav__link> <span class=md-ellipsis> Introduction to Node.js </span> </a> </li> <li class=md-nav__item> <a href=#a-brief-history-of-nodejs class=md-nav__link> <span class=md-ellipsis> A brief history of Node.js </span> </a> </li> <li class=md-nav__item> <a href=#how-to-install-nodejs class=md-nav__link> <span class=md-ellipsis> How to install Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#how-much-javascript-do-you-need-to-know-to-use-nodejs class=md-nav__link> <span class=md-ellipsis> How much JavaScript do you need to know to use Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#differences-between-nodejs-and-the-browser class=md-nav__link> <span class=md-ellipsis> Differences between Node.js and the Browser </span> </a> </li> <li class=md-nav__item> <a href=#the-v8-javascript-engine class=md-nav__link> <span class=md-ellipsis> The V8 JavaScript Engine </span> </a> </li> <li class=md-nav__item> <a href=#run-nodejs-scripts-from-the-command-line class=md-nav__link> <span class=md-ellipsis> Run Node.js scripts from the command line </span> </a> </li> <li class=md-nav__item> <a href=#how-to-exit-from-a-nodejs-program class=md-nav__link> <span class=md-ellipsis> How to exit from a Node.js program? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-read-environment-variables-from-nodejs class=md-nav__link> <span class=md-ellipsis> How to read environment variables from Node.js? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-the-nodejs-repl class=md-nav__link> <span class=md-ellipsis> How to use the Node.js REPL? </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-accept-arguments-from-the-command-line class=md-nav__link> <span class=md-ellipsis> Node.js, accept arguments from the command line </span> </a> </li> <li class=md-nav__item> <a href=#output-to-the-command-line-using-nodejs class=md-nav__link> <span class=md-ellipsis> Output to the command line using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#accept-input-from-the-command-line-in-nodejs class=md-nav__link> <span class=md-ellipsis> Accept input from the command line in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#expose-functionality-from-a-nodejs-file-using-exports class=md-nav__link> <span class=md-ellipsis> Expose functionality from a Node.js file using exports </span> </a> </li> <li class=md-nav__item> <a href=#an-introduction-to-the-npm-package-manager class=md-nav__link> <span class=md-ellipsis> An introduction to the npm package manager </span> </a> </li> <li class=md-nav__item> <a href=#where-does-npm-install-the-packages class=md-nav__link> <span class=md-ellipsis> Where does npm install the packages? </span> </a> </li> <li class=md-nav__item> <a href=#how-to-use-or-execute-a-package-installed-using-npm class=md-nav__link> <span class=md-ellipsis> How to use or execute a package installed using npm? </span> </a> </li> <li class=md-nav__item> <a href=#the-packagejson-guide class=md-nav__link> <span class=md-ellipsis> The package.json guide </span> </a> </li> <li class=md-nav__item> <a href=#the-package-lockjson-file class=md-nav__link> <span class=md-ellipsis> The package-lock.json file </span> </a> </li> <li class=md-nav__item> <a href=#find-the-installed-version-of-an-npm-package class=md-nav__link> <span class=md-ellipsis> Find the installed version of an npm package </span> </a> </li> <li class=md-nav__item> <a href=#install-an-older-version-of-an-npm-package class=md-nav__link> <span class=md-ellipsis> Install an older version of an npm package </span> </a> </li> <li class=md-nav__item> <a href=#update-all-the-nodejs-dependencies-to-their-latest-version class=md-nav__link> <span class=md-ellipsis> Update all the Node.js dependencies to their latest version </span> </a> </li> <li class=md-nav__item> <a href=#semantic-versioning-using-npm class=md-nav__link> <span class=md-ellipsis> Semantic Versioning using npm </span> </a> </li> <li class=md-nav__item> <a href=#uninstalling-npm-packages class=md-nav__link> <span class=md-ellipsis> Uninstalling npm packages </span> </a> </li> <li class=md-nav__item> <a href=#npm-global-or-local-packages class=md-nav__link> <span class=md-ellipsis> npm global or local packages </span> </a> </li> <li class=md-nav__item> <a href=#npm-dependencies-and-devdependencies class=md-nav__link> <span class=md-ellipsis> npm dependencies and devDependencies </span> </a> </li> <li class=md-nav__item> <a href=#the-npx-nodejs-package-runner class=md-nav__link> <span class=md-ellipsis> The npx Node.js Package Runner </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-event-loop class=md-nav__link> <span class=md-ellipsis> The Node.js Event Loop </span> </a> </li> <li class=md-nav__item> <a href=#understanding-processnexttick class=md-nav__link> <span class=md-ellipsis> Understanding process.nextTick() </span> </a> </li> <li class=md-nav__item> <a href=#understanding-setimmediate class=md-nav__link> <span class=md-ellipsis> Understanding setImmediate() </span> </a> </li> <li class=md-nav__item> <a href=#discover-javascript-timers class=md-nav__link> <span class=md-ellipsis> Discover JavaScript Timers </span> </a> </li> <li class=md-nav__item> <a href=#javascript-asynchronous-programming-and-callbacks class=md-nav__link> <span class=md-ellipsis> JavaScript Asynchronous Programming and Callbacks </span> </a> </li> <li class=md-nav__item> <a href=#understanding-javascript-promises class=md-nav__link> <span class=md-ellipsis> Understanding JavaScript Promises </span> </a> </li> <li class=md-nav__item> <a href=#modern-asynchronous-javascript-with-async-and-await class=md-nav__link> <span class=md-ellipsis> Modern Asynchronous JavaScript with Async and Await </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-event-emitter class=md-nav__link> <span class=md-ellipsis> The Node.js Event emitter </span> </a> </li> <li class=md-nav__item> <a href=#build-an-http-server class=md-nav__link> <span class=md-ellipsis> Build an HTTP Server </span> </a> </li> <li class=md-nav__item> <a href=#making-http-requests-with-nodejs class=md-nav__link> <span class=md-ellipsis> Making HTTP requests with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#make-an-http-post-request-using-nodejs class=md-nav__link> <span class=md-ellipsis> Make an HTTP POST request using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#get-http-request-body-data-using-nodejs class=md-nav__link> <span class=md-ellipsis> Get HTTP request body data using Node.js </span> </a> </li> <li class=md-nav__item> <a href=#working-with-file-descriptors-in-nodejs class=md-nav__link> <span class=md-ellipsis> Working with file descriptors in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-file-stats class=md-nav__link> <span class=md-ellipsis> Node.js file stats </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-file-paths class=md-nav__link> <span class=md-ellipsis> Node.js File Paths </span> </a> </li> <li class=md-nav__item> <a href=#reading-files-with-nodejs class=md-nav__link> <span class=md-ellipsis> Reading files with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#writing-files-with-nodejs class=md-nav__link> <span class=md-ellipsis> Writing files with Node.js </span> </a> </li> <li class=md-nav__item> <a href=#working-with-folders-in-nodejs class=md-nav__link> <span class=md-ellipsis> Working with folders in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-fs-module class=md-nav__link> <span class=md-ellipsis> The Node.js fs module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-path-module class=md-nav__link> <span class=md-ellipsis> The Node.js path module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-os-module class=md-nav__link> <span class=md-ellipsis> The Node.js os module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-events-module class=md-nav__link> <span class=md-ellipsis> The Node.js events module </span> </a> </li> <li class=md-nav__item> <a href=#the-nodejs-http-module class=md-nav__link> <span class=md-ellipsis> The Node.js http module </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-buffers class=md-nav__link> <span class=md-ellipsis> Node.js Buffers </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-streams class=md-nav__link> <span class=md-ellipsis> Node.js Streams </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-the-difference-between-development-and-production class=md-nav__link> <span class=md-ellipsis> Node.js, the difference between development and production </span> </a> </li> <li class=md-nav__item> <a href=#error-handling-in-nodejs class=md-nav__link> <span class=md-ellipsis> Error handling in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#how-to-log-an-object-in-nodejs class=md-nav__link> <span class=md-ellipsis> How to log an object in Node.js </span> </a> </li> <li class=md-nav__item> <a href=#nodejs-with-typescript class=md-nav__link> <span class=md-ellipsis> Node.js with TypeScript </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nodejs_1 class=md-nav__link> <span class=md-ellipsis> Node.js 核心模組 </span> </a> <nav class=md-nav aria-label="Node.js 核心模組"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#http class=md-nav__link> <span class=md-ellipsis> HTTP </span> </a> </li> <li class=md-nav__item> <a href=#process class=md-nav__link> <span class=md-ellipsis> Process </span> </a> </li> <li class=md-nav__item> <a href=#console class=md-nav__link> <span class=md-ellipsis> Console </span> </a> </li> <li class=md-nav__item> <a href=#readline class=md-nav__link> <span class=md-ellipsis> Readline </span> </a> </li> <li class=md-nav__item> <a href=#commonjs-modules class=md-nav__link> <span class=md-ellipsis> CommonJS modules </span> </a> </li> <li class=md-nav__item> <a href=#timers class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=#events class=md-nav__link> <span class=md-ellipsis> Events </span> </a> </li> <li class=md-nav__item> <a href=#buffers class=md-nav__link> <span class=md-ellipsis> Buffers </span> </a> </li> <li class=md-nav__item> <a href=#stream class=md-nav__link> <span class=md-ellipsis> Stream </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 參考資料來源 </span> </a> <nav class=md-nav aria-label=參考資料來源> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 官方文件 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 網路文章 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 網路影片 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=nodejs-learn>Node.js Learn<a class=headerlink href=#nodejs-learn title="Permanent link">&para;</a></h1> <p>自主學習 Node.js 的觀念和指令後做的統整 &amp; 學習筆記</p> <div class=toc><span class=toctitle>目錄</span><ul> <li><a href=#nodejs-learn>Node.js Learn</a><ul> <li><a href=#_1>安裝方式</a><ul> <li><a href=#windows>Windows 系統</a></li> <li><a href=#macos>MacOS 系統</a></li> <li><a href=#linux-ubuntu>Linux 系統 (以 Ubuntu 為例)</a></li> </ul> </li> <li><a href=#nodejs>Node.js 核心觀念</a><ul> <li><a href=#introduction-to-nodejs>Introduction to Node.js</a></li> <li><a href=#a-brief-history-of-nodejs>A brief history of Node.js</a></li> <li><a href=#how-to-install-nodejs>How to install Node.js?</a></li> <li><a href=#how-much-javascript-do-you-need-to-know-to-use-nodejs>How much JavaScript do you need to know to use Node.js?</a></li> <li><a href=#differences-between-nodejs-and-the-browser>Differences between Node.js and the Browser</a></li> <li><a href=#the-v8-javascript-engine>The V8 JavaScript Engine</a></li> <li><a href=#run-nodejs-scripts-from-the-command-line>Run Node.js scripts from the command line</a></li> <li><a href=#how-to-exit-from-a-nodejs-program>How to exit from a Node.js program?</a></li> <li><a href=#how-to-read-environment-variables-from-nodejs>How to read environment variables from Node.js?</a></li> <li><a href=#how-to-use-the-nodejs-repl>How to use the Node.js REPL?</a></li> <li><a href=#nodejs-accept-arguments-from-the-command-line>Node.js, accept arguments from the command line</a></li> <li><a href=#output-to-the-command-line-using-nodejs>Output to the command line using Node.js</a></li> <li><a href=#accept-input-from-the-command-line-in-nodejs>Accept input from the command line in Node.js</a></li> <li><a href=#expose-functionality-from-a-nodejs-file-using-exports>Expose functionality from a Node.js file using exports</a></li> <li><a href=#an-introduction-to-the-npm-package-manager>An introduction to the npm package manager</a></li> <li><a href=#where-does-npm-install-the-packages>Where does npm install the packages?</a></li> <li><a href=#how-to-use-or-execute-a-package-installed-using-npm>How to use or execute a package installed using npm?</a></li> <li><a href=#the-packagejson-guide>The package.json guide</a></li> <li><a href=#the-package-lockjson-file>The package-lock.json file</a></li> <li><a href=#find-the-installed-version-of-an-npm-package>Find the installed version of an npm package</a></li> <li><a href=#install-an-older-version-of-an-npm-package>Install an older version of an npm package</a></li> <li><a href=#update-all-the-nodejs-dependencies-to-their-latest-version>Update all the Node.js dependencies to their latest version</a></li> <li><a href=#semantic-versioning-using-npm>Semantic Versioning using npm</a></li> <li><a href=#uninstalling-npm-packages>Uninstalling npm packages</a></li> <li><a href=#npm-global-or-local-packages>npm global or local packages</a></li> <li><a href=#npm-dependencies-and-devdependencies>npm dependencies and devDependencies</a></li> <li><a href=#the-npx-nodejs-package-runner>The npx Node.js Package Runner</a></li> <li><a href=#the-nodejs-event-loop>The Node.js Event Loop</a></li> <li><a href=#understanding-processnexttick>Understanding process.nextTick()</a></li> <li><a href=#understanding-setimmediate>Understanding setImmediate()</a></li> <li><a href=#discover-javascript-timers>Discover JavaScript Timers</a></li> <li><a href=#javascript-asynchronous-programming-and-callbacks>JavaScript Asynchronous Programming and Callbacks</a></li> <li><a href=#understanding-javascript-promises>Understanding JavaScript Promises</a></li> <li><a href=#modern-asynchronous-javascript-with-async-and-await>Modern Asynchronous JavaScript with Async and Await</a></li> <li><a href=#the-nodejs-event-emitter>The Node.js Event emitter</a></li> <li><a href=#build-an-http-server>Build an HTTP Server</a></li> <li><a href=#making-http-requests-with-nodejs>Making HTTP requests with Node.js</a></li> <li><a href=#make-an-http-post-request-using-nodejs>Make an HTTP POST request using Node.js</a></li> <li><a href=#get-http-request-body-data-using-nodejs>Get HTTP request body data using Node.js</a></li> <li><a href=#working-with-file-descriptors-in-nodejs>Working with file descriptors in Node.js</a></li> <li><a href=#nodejs-file-stats>Node.js file stats</a></li> <li><a href=#nodejs-file-paths>Node.js File Paths</a></li> <li><a href=#reading-files-with-nodejs>Reading files with Node.js</a></li> <li><a href=#writing-files-with-nodejs>Writing files with Node.js</a></li> <li><a href=#working-with-folders-in-nodejs>Working with folders in Node.js</a></li> <li><a href=#the-nodejs-fs-module>The Node.js fs module</a></li> <li><a href=#the-nodejs-path-module>The Node.js path module</a></li> <li><a href=#the-nodejs-os-module>The Node.js os module</a></li> <li><a href=#the-nodejs-events-module>The Node.js events module</a></li> <li><a href=#the-nodejs-http-module>The Node.js http module</a></li> <li><a href=#nodejs-buffers>Node.js Buffers</a></li> <li><a href=#nodejs-streams>Node.js Streams</a></li> <li><a href=#nodejs-the-difference-between-development-and-production>Node.js, the difference between development and production</a></li> <li><a href=#error-handling-in-nodejs>Error handling in Node.js</a></li> <li><a href=#how-to-log-an-object-in-nodejs>How to log an object in Node.js</a></li> <li><a href=#nodejs-with-typescript>Node.js with TypeScript</a></li> </ul> </li> <li><a href=#nodejs_1>Node.js 核心模組</a><ul> <li><a href=#http>HTTP</a></li> <li><a href=#process>Process</a></li> <li><a href=#console>Console</a></li> <li><a href=#readline>Readline</a></li> <li><a href=#commonjs-modules>CommonJS modules</a></li> <li><a href=#timers>Timers</a></li> <li><a href=#events>Events</a></li> <li><a href=#buffers>Buffers</a></li> <li><a href=#stream>Stream</a></li> </ul> </li> <li><a href=#_2>參考資料來源</a><ul> <li><a href=#_3>官方文件</a></li> <li><a href=#_4>網路文章</a></li> <li><a href=#_5>網路影片</a></li> </ul> </li> </ul> </li> </ul> </div> <h2 id=_1>安裝方式<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <ul> <li>官方網站會先分成LTS.Current兩個版本</li> <li><code>LTS</code>(Long-term support): Recommended for most users</li> <li><code>Current</code>: Latest features</li> <li>安裝Node.js之後,也會自動安裝NPM</li> <li>若想要安裝指定版本的Node.js,可以輸入以下指令</li> <li>$ <code>brew install node@&lt;specific version&gt;</code><ul> <li>例: <code>brew install node@10</code></li> </ul> </li> <li>可參考<a href=https://medium.com/@katopz/how-to-install-specific-nodejs-version-c6e1cec8aa11>How to install specific NodeJS version</a></li> <li>若想要安裝指定版本的NPM(Node Package Manager),可以輸入以下指令</li> <li>升級到Latest version: <code>npm install -g npm@latest</code></li> <li>升級到Most recent release version: <code>npm install -g npm@next</code></li> <li>可參考<a href=https://docs.npmjs.com/try-the-latest-stable-version-of-npm>Try the latest stable version of npm</a></li> <li>如果想要在同一台電腦上面,切換Node的版本,可以安裝NVM(Node Version Manager)</li> <li><strong>MacOS</strong><ul> <li>$ <code>brew install nvm</code></li> </ul> </li> <li><strong>Linux</strong><ul> <li>$ <code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash</code></li> </ul> </li> <li>接下來要到(~/.bash_profile, ~/.zshrc, ~/.profile, or ~/.bashrc)的其中一個檔案,新增以下3行指令 <strong>到該檔案的最下面</strong><ul> <li><code>export NVM_DIR="$HOME/.nvm"</code><br> <code>[ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh"</code> # This loads nvm<br> <code>[ -s "$NVM_DIR/bash_completion" ] &amp;&amp; \. "$NVM_DIR/bash_completion"</code> # This loads nvm bash_completion<br></li> </ul> </li> <li>檢查是否正常安裝NVM<ul> <li>$ <code>command -v nvm</code>: 如果有成功安裝NVM的話,應該要回傳<code>nvm</code></li> </ul> </li> <li>檢查安裝的NVM版本<ul> <li>$ <code>nvm --version</code> </li> </ul> </li> <li>可參考<a href=https://github.com/nvm-sh/nvm#troubleshooting-on-macos>Node Version Manager</a></li> </ul> <h3 id=windows>Windows 系統<a class=headerlink href=#windows title="Permanent link">&para;</a></h3> <ul> <li>連結: <a href=https://nodejs.org/en/download/ >https://nodejs.org/en/download/</a></li> <li>安裝完成後,可以用CLI指令檢查 <strong>Node</strong> &amp; <strong>NPM</strong> 的版本<ul> <li>$ <code>node --version</code> </li> <li>$ <code>npm --version</code></li> </ul> </li> </ul> <h3 id=macos>MacOS 系統<a class=headerlink href=#macos title="Permanent link">&para;</a></h3> <ul> <li>連結: <a href=https://nodejs.org/en/download/package-manager/#macos>https://nodejs.org/en/download/package-manager/#macos</a><ul> <li>指令: <code>brew install node</code></li> </ul> </li> <li>安裝完成後,可以用CLI指令檢查 <strong>Node</strong> &amp; <strong>NPM</strong> 的版本<ul> <li>$ <code>node --version</code> </li> <li>$ <code>npm --version</code></li> </ul> </li> </ul> <h3 id=linux-ubuntu>Linux 系統 (以 Ubuntu 為例)<a class=headerlink href=#linux-ubuntu title="Permanent link">&para;</a></h3> <ul> <li>連結: <a href=https://github.com/nodesource/distributions/blob/master/README.md>https://github.com/nodesource/distributions/blob/master/README.md</a></li> <li>指令: <ul> <li>$ <code>sudo apt-get install -y nodejs</code></li> </ul> </li> </ul> <hr> <h2 id=nodejs>Node.js 核心觀念<a class=headerlink href=#nodejs title="Permanent link">&para;</a></h2> <h3 id=introduction-to-nodejs>Introduction to Node.js<a class=headerlink href=#introduction-to-nodejs title="Permanent link">&para;</a></h3> <p><code>先備知識</code></p> <blockquote> <p><code>One process</code>: 一個全域的Object,可以在任何地方被執行,並保有執行時的資料<br> <code>One thread</code>: single-thread,在一個<code>process</code>中只能執行一件事<br> <code>One event loop</code>: 一個事件迴圈,因為它使Node可以是非同步(asynchronous) &amp; 非阻塞I/O(non-blocking I/O); 因為Node是single-thread的,透過callback.Promise.async/await能將工作分散給system kernel<br> <code>One JS Engine Instance</code>: 一個Javascript實例,用來執行Javascript的程式碼<br> <code>One Node.js Instance</code>: 一個Node實例,用來執行Node的程式碼<br></p> </blockquote> <ul> <li>Node是一個免費.開源.跨平台的Javascript執行環境,讓開發者可以在瀏覽器以外也能使用Javascript</li> <li>也因此讓廣大的前端開發者們,可以加入後端開發的行列,並且不用因此需要多學一門程式語言 </li> <li>Node是基於Chrome瀏覽器的V8引擎來建立出的執行環境,因此能有非常好的效能</li> <li>Node是由開源社群來共同維護,並且能使用最新的ECMAScript標準</li> <li>因此不必等待所有用戶更新他們的瀏覽器,就可以選擇要使用的Node版本來達到來決定要使用哪個ECMAScript版本</li> <li>可參考官方文件<a href=https://nodejs.org/en/docs/es6/ >ECMAScript 2015 (ES6) and beyond</a> </li> <li>Node應用程式在單個進程(single process)中運行,無需為每個請求建立新線程(thread),能處理數千個併發連接(concurrent connections),也不會因此而增加管理線程(thread)上的負擔</li> <li>同時Node也在其標準函式庫中提供了一組非同步I/O原語(asynchronous I/O primitives)來防止Javascript的程式碼被阻塞住,因此在Node中使用非阻塞式語法(non-blocking paradigms)來開發是正常且普遍的</li> <li>當Node執行會有I/O的操作(e.g. 從網路上讀取資料.存取資料庫or檔案系統)時,Node會自動在response回傳時才恢復操作,而不是無效地阻擋住線程和浪費CPU週期等待時間</li> <li>受惠於npm的簡單結構,其促使Node生態系可以蓬勃地發展,目前在npm上已經有超過1,000,000個開源軟體&amp;工具可供使用</li> <li>Node.js算是一個低階的平台,然而在社群(community)上有數千個函式庫與好用的框架建構於Node.js之上</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kd>const</span><span class=w> </span><span class=nx>hostname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kd>const</span><span class=w> </span><span class=nx>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span><span class=p>;</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>200</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;text/plain&#39;</span><span class=p>)</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;Hello World!\n&#39;</span><span class=p>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=p>});</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span><span class=w> </span><span class=nx>hostname</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Server running at http://</span><span class=si>${</span><span class=nx>hostname</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>/`</span><span class=p>)</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=p>});</span>
</span></code></pre></div></li> <li>以上程式碼會建立一個新的http server並回傳,同時這個server也會監聽指定的port &amp; host name</li> <li>當server準備就緒時,將執行callback function,在這時也會通知我們server正在運行中</li> <li>每當收到一個新的request時,都會呼叫該request event,並提供兩個物件(objects)<ul> <li>請求物件(request): <code>http.IncomingMessage</code></li> <li>它會提供request details </li> <li>回應物件(response): <code>http.ServerResponse</code></li> <li>它會用來將data回傳給呼叫request event的那方</li> </ul> </li> <li>在這種狀況下, 我們會將狀態碼設定為200,以表示該request成功<br> =&gt; <code>res.statusCode = 200</code></li> <li>並設定Content-Type標頭<br> =&gt; <code>res.setHeader('Content-Type', 'text/plain')</code></li> <li>最後,會關閉response,並將內容作為參數添加到res.end()中<br> =&gt; <code>res.end('Hello World\n')</code></li> </ul> <h3 id=a-brief-history-of-nodejs>A brief history of Node.js<a class=headerlink href=#a-brief-history-of-nodejs title="Permanent link">&para;</a></h3> <ul> <li>Node.js最初是由Ryan Lienhart Dahl,於2010/05月初次發表,相比於Javascript(1995/12月)與網際網路的誕生(1989年)來說,在技術領域中,並不算是很長的時間,但目前看來Node會持續存在下去</li> <li><img alt src=../../assets/pics/nodejs/NodeJS%20logo.png></li> <li><img alt src=../../assets/pics/nodejs/NodeJS%E4%BD%9C%E8%80%85%20Ryan%20Lienhart%20Dahl.jpg></li> <li>受惠於<a href=https://zh.wikipedia.org/wiki/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%A7%E6%88%98#Google_Chrome%E7%9A%84%E5%B4%9B%E8%B5%B7%E8%88%87Internet_Explorer%E7%9A%84%E8%A1%B0%E8%90%BD>瀏覽器的效能競爭戰</a>(2003~2008年)後的結果,各家瀏覽器供應商爭相為用戶提供最佳性能,Javscript engine的運行效能也越來越好,而Node使用的Chrome瀏覽器的Javascript engine---V8,在性能上也有卓越的提升</li> <li>另一個使Node快速崛起的關鍵因素是<a href=https://zh.wikipedia.org/wiki/Web_2.0>Web2.0</a>的誕生,例如Flickr.Gmail等,讓Javascript開始被視為一個更為重要的程式語言</li> <li>Node恰巧是在正確的時間和正確的時間構建的,它為JavaScript服務器端開發引入了許多創新思維和方法,這些方法和方法已經為許多開發人員提供了幫助,這就是為什麼它開始流行的原因</li> <li>Node.js 簡史(Change log)</li> <li>西元2009年<ul> <li><a href=https://nodejs.org/en/ >Node.js</a>誕生</li> <li>最初版<a href=https://www.npmjs.com/ >npm</a>問世</li> </ul> </li> <li>西元2010年<ul> <li><a href=https://expressjs.com/ >Express.js</a>框架 誕生</li> <li><a href=https://socket.io/ >socket.io</a> 誕生</li> </ul> </li> <li>西元2011年<ul> <li>npm 發布1.0版本</li> <li>許多大型公司開始採用Node.js,例:LinkedIn.Uber等</li> </ul> </li> <li>西元2012年<ul> <li>越來越多人開始採用Node.js</li> </ul> </li> <li>西元2013年<ul> <li>第一個使用Node.js的大型部落格平台: <a href=https://ghost.org/ >Ghost</a></li> <li><a href=https://koajs.com/ >koa</a>框架 誕生</li> </ul> </li> <li>西元2014年<ul> <li>重大事件: <a href=https://socket.io/ >io.js</a>誕生,是Node.js的主要Fork出來的專案,目的是為了加入Javascript的ES6語法支援並提升了效能 </li> </ul> </li> <li>西元2015年<ul> <li><a href=https://openjsf.org/ >Node.js基金會</a>誕生 (目前隸屬於OpenJS Foundation旗下的其中一個專案)</li> <li>io.js合併回Node.js專案中</li> <li>npm開始推出私有模組(private modules)</li> <li>Node.js 4發布(直接跳過Node.js 1,2,3)</li> <li>可參考<a href=https://github.com/nodejs/node/blob/master/CHANGELOG.md>Node_changelog</a></li> </ul> </li> <li>西元2016年<ul> <li>kik模組的left-pad事件爆發,引起開源社群的一陣騷動</li> <li><a href=https://classic.yarnpkg.com/en/ >Yarn</a>套件管理包工具 誕生</li> <li>Node.js 6發布</li> </ul> </li> <li>西元2017年<ul> <li>npm開始更加注重安全性</li> <li>Node.js 8發布</li> <li><a href=https://nodejs.org/api/http2.html>HTTP/2 核心模組</a> 發布</li> <li>V8將Node加入它的測試套件中,使Node成為繼Chrome之後的Javascript engine正式目標</li> <li>達成30億次/週的下載流量紀錄</li> </ul> </li> <li>西元2018年<ul> <li>Node.js 10發布</li> <li><a href=https://nodejs.org/api/esm.html>ES modules.mjs</a>開始加入實驗性支援(experimental support)</li> <li>Node.js 11發布</li> </ul> </li> <li>西元2019年<ul> <li>Node.js 12發布 </li> <li>Node.js 13發布</li> </ul> </li> <li>西元2020年<ul> <li>Node.js 14發布</li> <li>Node.js 15發布</li> </ul> </li> </ul> <h3 id=how-to-install-nodejs>How to install Node.js?<a class=headerlink href=#how-to-install-nodejs title="Permanent link">&para;</a></h3> <ul> <li>Node有很多種安裝方式,最常見的方式是透過套件管理包(package manager)下載,在這種情況下,每個作業系統有自己的安裝方式</li> <li>可參考 <strong>安裝方式</strong> 的章節</li> <li>NVM(Node Version Manager)是一種執行Node.js的流行方法</li> <li>nvm讓我們可以輕鬆切換Node版本</li> <li>假如碰到錯誤時,可以安裝新版本以嘗試輕鬆地回滾(rollback)</li> <li>nvm也是個有效的工具讓我們可以輕鬆地使用Node的舊版本來測試我們的程式碼</li> <li>可參考<a href=https://github.com/nvm-sh/nvm>Node Version Manager(nvm)</a></li> <li>如果使用macOS,推薦使用<a href=https://brew.sh/ >Homebrew</a>來安裝Node</li> <li>當安裝完Node之後,就可以使用<code>$ node xxx.js</code>在CLI中執行Node程式</li> </ul> <h3 id=how-much-javascript-do-you-need-to-know-to-use-nodejs>How much JavaScript do you need to know to use Node.js?<a class=headerlink href=#how-much-javascript-do-you-need-to-know-to-use-nodejs title="Permanent link">&para;</a></h3> <ul> <li>身為一個初學者,我們常常難以判斷要到什麼樣的程度才是對程式設計的能力足夠有自信的</li> <li>當我們剛開始學習Javascript,我們可能會對Javascript的結束位置,以及Node的起始位置與結束位置感到很困惑</li> <li>建議先理解Javascript的主要觀念後,在開始投入於Node的研究中</li> <li>以下是Javascript目前的主要觀念</li> <li>詞彙結構(Lexcial Structure)</li> <li>運算式(Expressions)</li> <li>型別(Types)</li> <li>變數(Variables)</li> <li>函式(Functions)</li> <li><code>this</code> 關鍵字</li> <li>箭頭函式(Arrow Functions)</li> <li>迴圈(Loops)</li> <li>範圍(Scopes)</li> <li>陣列(Arrays)</li> <li>模板文字(Template Literals)</li> <li>分號(Semicolons)</li> <li>嚴謹模式(Strict Mode)</li> <li>ECMAScript 6,7,8 (手稿語言規範)</li> <li>如果能將以上的Javascript主要觀念都掌握到的話,無論是在瀏覽器還是在Node中,您都將成為一名熟練的JavaScript開發人員</li> <li>以下是理解 <strong>非同步程式設計</strong> 的(asynchronous programming),這也是Node.js的基本觀念之一</li> <li><a href=https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous>非同步程式設計</a>與<a href=https://developer.mozilla.org/zh-TW/docs/Glossary/Callback_function>回呼</a> (Asynchronous programming and callbacks)</li> <li><a href=https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Timeouts_and_intervals>計時器</a> (Timers)</li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise>Promise物件</a> (ES6以後開始加入的語法)</li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Learn/JavaScript/Asynchronous/Async_await>Async &amp; Await</a></li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Closures>閉包</a>(Closures)</li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/EventLoop>事件迴圈</a> (The Event Loop)</li> </ul> <h3 id=differences-between-nodejs-and-the-browser>Differences between Node.js and the Browser<a class=headerlink href=#differences-between-nodejs-and-the-browser title="Permanent link">&para;</a></h3> <ul> <li>瀏覽器與Node.js都是使用Javascript程式語言來開發的</li> <li>建構出一個運行在瀏覽器的應用程式與建構出一個運行在Node的應用程式完全不同; 儘管都是使用Javascript程式語言來開發,卻仍存在一些關鍵差異,使體驗完全不同</li> <li>Node改變的是整個生態系統(ecosystem),因為它讓我們可以使用一種程式語言-Javascript,就可以完成我們所有的網頁開發工作(包含前端 &amp; 後端),這是一個獨特的優勢地位</li> <li>在瀏覽器中,我們花費大多數的時間在與<a href=https://developer.mozilla.org/zh-TW/docs/Glossary/DOM>DOM</a>或是其他網頁平台的APIs(例: Cookies)。 當然,這些東西並不存在於Node之中。Node也不會有<a href=https://developer.mozilla.org/zh-TW/docs/Web/API/document>Document物件</a>與<a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Window>Window物件</a>以及其他所有透過瀏覽器提供的物件們</li> <li>在瀏覽器中,我們沒有那些Node透過其內建模組所提供的實用APIs(例: <a href=https://nodejs.org/api/fs.html>文件系統訪問功能</a> (filesystem access functionality))</li> <li>另一個比較大的差異是在Node中,我們控制的是 <strong>環境</strong>,除非您構建一個任何人都可以在任何地方部署的開源應用程式,否則我們通常會知道應該在哪個版本的Node上運行該應用程式; 但是在瀏覽器的環境中,我們無法選擇使用者會使用的瀏覽器,這點非常不方便</li> <li>這也意味著我們可以使用該Node版本可支援的所有ECMAScript 6-7-8-9的現代化Javascript語法</li> <li>由於Javascript的變化如此之快,但是瀏覽器與使用者所使用的瀏覽器並沒有這麼迅速的升級,因此我們不得不使用較舊的JavaScript/ECMAScript版本</li> <li>這時我們可以使用<a href=https://babeljs.io/ >Babel</a>來將程式碼轉換成可與ES5可相容的語法,然後再交給瀏覽器</li> <li>然而在Node中,我們並不需要這樣做</li> <li>還有一個重大的差異是在Node中,我們使用的是CommonJS模組系統; 但是在瀏覽器中,我們會依照ECMAScript的模組標準來實作Javascipt語法</li> <li>實際上,這代表我們會分別使用<ul> <li>require() =&gt; 在Node.js中</li> <li>import =&gt; 在瀏覽器中</li> </ul> </li> </ul> <h3 id=the-v8-javascript-engine>The V8 JavaScript Engine<a class=headerlink href=#the-v8-javascript-engine title="Permanent link">&para;</a></h3> <ul> <li><a href=https://v8.dev/ >V8</a>是用來支持Google Chrome瀏覽器的Javascript engine。當我們使用Chrome瀏覽器時,它需要我們的Javascript程式碼並執行它們 </li> <li>V8負責提供Javascript執行時所需要的執行環境(runtime)。<code>DOM</code>和其他的Web APIs則由瀏覽器負責提供</li> <li>Javascript engine是能獨立運作的,並不一定需要跟隨著託管(hosted)它的瀏覽器,這也促使Node的興起</li> <li>西元2009年時,V8被選為用來作為Node.js的Javascript engine,並且隨者Node的爆炸性成長,V8成為了現在為大量使用Javascript編寫伺服器端程式碼(server-side code)的engine</li> <li>Node生態系非常龐大,受惠於此,V8也支援桌面應用程式(例: <a href=https://www.electronjs.org/ >Electron</a>)</li> <li>其他瀏覽器使用的Javascript engine</li> <li>Firefox: <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey>SpiderMonkey</a></li> <li>Safari: <a href=https://developer.apple.com/documentation/javascriptcore>JavaScriptCore(也被稱為Nitro)</a></li> <li>Microsoft Edge: 最初是基於<a href=https://github.com/Microsoft/ChakraCore>ChakraCore</a>開發的,後來轉由基於<a href=https://www.chromium.org/ >Chromium</a> &amp; V8 engine來重構<ul> <li>可參考<a href=https://support.microsoft.com/en-us/microsoft-edge/download-the-new-microsoft-edge-based-on-chromium-0f4a3dd7-55df-60f5-739f-00010dba52cf>Download the new Microsoft Edge based on Chromium</a> </li> </ul> </li> <li>V8引擎是由C++程式語言所編寫。它是可攜帶式的(portable),可提供跨平台支援(on macOS &amp;Windows &amp; Linux ...等等)</li> <li>V8也與其他的Javascript engine一樣,V8也在持續改進中,也加速了Web和Node生態系的快速發展; 多年來,在網路上有很多關於性能調校的競賽,身為開發者和使用者的我們也受惠於此,讓我們能擁有更快.效能更好的機器(machines)可以使用</li> <li>Javascript通常被認為是一種直譯式語言(interpreted language),但是在現代化的Javascript engine中,已不再只是直譯Javascript,它們也編譯Javascript</li> <li>從西元2009年開始,當SpiderMonkey JavaScript compiler被加入到Firefox瀏覽器 v3.5之中以後,每個人都開始追隨這種做法</li> <li>Javascript會被V8 engine進行內部即時編譯(just-in-time compilation, JIT)以加快執行速度; 這可能是一種違反直覺的方式,但是從2004年引入Google Maps以來,Javascript已經從一種通常用來執行幾十行程式碼的小型應用程式的程式語言,逐漸發展成可以在瀏覽器中執行成千上萬行的大型.完整的應用程式的程式語言</li> <li>演變至今,我們的應用程式已經可以在瀏覽器持續執行數小時,而這也不僅限於單純的表單驗證規則(a few form validation rules)或是簡單的程式碼(simple scripts)</li> <li>在現代的新世界中,"編譯"Javascript是非常有意義的,因為雖然編寫Javascript仍然需要花費很多時間,但是一旦開發完成後,它將比起純直譯程式碼來的擁有更好的效能</li> </ul> <h3 id=run-nodejs-scripts-from-the-command-line>Run Node.js scripts from the command line<a class=headerlink href=#run-nodejs-scripts-from-the-command-line title="Permanent link">&para;</a></h3> <ul> <li>當我們安裝好Node.js後,通常我們會用可在全域執行的<code>node</code>指令,接著傳遞要執行的檔名作為參數到CLI上</li> <li>假設我們的主要Node應用程式的檔名叫做<code>app.js</code> </li> <li>例: $ <code>node app.js</code></li> <li>提醒: 要在包含<code>app.js</code>的檔案路徑下執行該指令才行</li> </ul> <h3 id=how-to-exit-from-a-nodejs-program>How to exit from a Node.js program?<a class=headerlink href=#how-to-exit-from-a-nodejs-program title="Permanent link">&para;</a></h3> <ul> <li>有多種方法可以終止Node應用程式</li> <li>CLI: $ <code>ctrl-C</code></li> <li>程式碼: <code>process.exit()</code></li> <li>程式碼: <code>process.on('SIGTERM', callback function)</code></li> <li>Node的核心模組-<a href=https://nodejs.org/api/process.html>Process</a>提供了一個簡便的方法,讓我們可以從一個Node應用程式退出,可執行以下的command</li> <li>$ <code>process.exit()</code></li> <li>當Node執行到這邊時,該進程(process)就會被立即強制終止。這代表任何處於<code>pending狀態</code>的<code>callback function</code>與任何網路請求(network request)仍然會被傳送出去; 然而任何訪問文件系統(<code>filesystem</code>)或是進程(<code>process</code>),例如: <a href=https://nodejs.org/api/process.html#process_process_stdout>process.stdout()</a> 或是 <a href=https://nodejs.org/api/process.html#process_process_stderr>process.stderr</a>都將立刻被不正常地終止(ungracefully terminated right away.)</li> <li>如果這樣是我們想要的結果,那我們可以傳遞一個整數,以此作為像作業系統發出的退出碼(exit code)<ul> <li>例: $ <code>process.exit(1)</code></li> <li>補充: 退出碼(exit code)</li> <li>預設值: <code>0</code> (代表成功) </li> <li>當<code>exit code</code> &lt;= 0 時,表示指令執行成功</li> <li>當<code>exit code</code> &gt; 0 時,表示指令執行失敗</li> <li>不同的退出碼具有不同的意義,我們可以利用這些退出碼來讓我們系統中的"程式與程式"之間能互相溝通</li> <li>可參考<a href=https://nodejs.org/api/process.html#process_exit_codes>Node核心模組-Process的 Exit codes 章節</a></li> </ul> </li> <li>我們也可以設定process.exitCode屬性來指定當Node應用程式退出時,要回傳什麼退出碼<ul> <li>使用process.exitCode的情境,需滿足以下條件</li> <li>當使用process.exit([code]) -&gt; 且未指定退出碼時</li> <li>進程(process)正常地終止(exits gracefully)時</li> <li>例: $ <code>process.exitCode = 1</code></li> <li>當Node應用程式終止時,將會return該退出碼,在完成處理所有進程(process)後,Node應用程式將會正常地退出</li> <li>可以利用<code>process.exit([code])</code>來推翻掉(override)先前的<code>process.exitCode</code>的設定值</li> </ul> </li> <li>另一種常見的情況是當我們啟動一個伺服器,例如: HTTP server <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kd>const</span><span class=w> </span><span class=nx>express</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kd>const</span><span class=w> </span><span class=nx>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>express</span><span class=p>()</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Hi!&#39;</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=p>})</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mf>3000</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server ready&#39;</span><span class=p>))</span>
</span></code></pre></div><ul> <li>以上的程式永遠不會終止! 如果我們呼叫<code>process.exit()</code>,這時正在處理的pending與running request都將被終止,而這不是一個好的做法</li> <li>這時候比較好的解決方法是對該command發出<code>SIGTERM</code>信號(signal),並使用process模組的signal handler來進行處理</li> <li>可參考<a href=https://nodejs.org/api/process.html#process_signal_events>Signal events</a> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kd>const</span><span class=w> </span><span class=nx>express</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kd>const</span><span class=w> </span><span class=nx>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>express</span><span class=p>()</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Hi!&#39;</span><span class=p>)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=p>})</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mf>3000</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server ready&#39;</span><span class=p>))</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>  </span><span class=nx>server</span><span class=p>.</span><span class=nx>close</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Process terminated&#39;</span><span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=p>})</span>
</span></code></pre></div><blockquote> <p>Q: 什麼是信號(signals)?<br> A: 信號是<a href=https://zh.wikipedia.org/wiki/%E5%8F%AF%E7%A7%BB%E6%A4%8D%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3>POSIX</a>的相互通訊系統: 當通知(notification)被發送到一個進程(process),以便將發生的事件(event)通知給進程(process)</p> </blockquote> </li> <li><code>SIGKILL</code>是告訴進程(process)立即中止的信號</li> <li><code>SIGTERM</code>是告訴進程(process)正常終止的信號。這是從例如<a href=http://upstart.ubuntu.com/ >upstart</a> &amp; <a href=http://supervisord.org/ >supervisored</a>等其他流程管理工具發出的信號</li> <li>我們也可以在應用程式中的另一個函式中,發出這個信號</li> <li>$ <code>process.kill(process.pid, 'SIGTERM')</code></li> <li>也可以從其他執行中的Node應用程式or其他在我們的作業系統中正在執行的應用程式,來得知我們想要終止的應用程式的ID(process ID, pid)</li> </ul> </li> </ul> <h3 id=how-to-read-environment-variables-from-nodejs>How to read environment variables from Node.js?<a class=headerlink href=#how-to-read-environment-variables-from-nodejs title="Permanent link">&para;</a></h3> <ul> <li><code>process</code>核心模組提供了<code>env</code>屬性,<code>process.env</code>屬性會託管當啟動Node進程(process)的時候的所有Node環境變數</li> <li>以下是一個預設在<code>development</code>環境下,存取<code>NODE_ENV</code>這個環境變數的範例</li> <li>提醒: 因為它是Node的核心模組,所以<code>process</code>模組不需要事先匯入(<code>require()</code>),可以直接開始使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=c1>// &quot;development&quot;</span>
</span></code></pre></div></li> <li>當在腳本(script)執行之前,可以先將該屬性設定為<code>production</code>,來告訴Node這是一個<code>production</code>的生產環境 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=c1>// &quot;production&quot;</span>
</span></code></pre></div></li> <li>當然我們也可以利用上述的方式再設定我們需要的自定義環境變數</li> </ul> <h3 id=how-to-use-the-nodejs-repl>How to use the Node.js REPL?<a class=headerlink href=#how-to-use-the-nodejs-repl title="Permanent link">&para;</a></h3> <ul> <li>我們可以利用$ <code>node</code>指令來執行我們寫好的Node腳本(script)</li> <li>例: $ <code>node script.js</code></li> <li>如果我們省略要執行的腳本名稱這個參數的話,就會進入<code>REPL模式</code><blockquote> <p>補充: <code>REPL</code>又被稱為Read Evaluate Print Loop(讀取-求值-輸出循環的互動式介面, REPL),是一種程式語言的環境(主要是在CLI console畫面中)。他會使用單個表達式作為使用者輸入,並在執行後將結果回傳到CLI console畫面上<br> 補充: <code>REPL模式</code>因為是互動式介面,所以支援可利用<code>Tab</code>鍵做自動補全(autocomplete)的功能,它會嘗試自動完成所寫的內容,以匹配已定義的變量或預定義的變量</p> </blockquote> </li> <li>node <code>REPL模式</code>範例情境 <div class="language-console highlight"><span class=filename>Bash Session</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=go>❯ node</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=go>&gt;</span>
</span></code></pre></div><ul> <li>該指令會停留在閒置模式(idle mode),並等待我們輸入些什麼東西。更精確地說是<code>REPL模式</code>正在等待我們輸入一些Javascript的程式碼</li> </ul> </li> <li>我們從簡單的範例開始看看 <div class="language-console highlight"><span class=filename>Bash Session</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=go>&gt; console.log(&#39;test&#39;)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=go>test</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=go>undefined</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=go>&gt;</span>
</span></code></pre></div><ul> <li>第一個值<code>test</code>是要告訴CLI console要打印(print)出什麼值,接著我們收到<code>undefined</code>,它是執行中(running)的<code>console.log()</code></li> <li>接著我們可以開始輸入一行新的Javascript的程式碼</li> </ul> </li> <li>探索Javascript物件(Objects)</li> <li>我們可以試著輸入Javascript的類別(Class),像是<code>Number</code>,並在後面加上一個<code>.</code> ,再接著按下<code>Tab</code>按鈕來自動補全</li> <li><img alt="node REPL模式-探索Number類別" src=../../assets/pics/nodejs/node%20REPL%E6%A8%A1%E5%BC%8F-%E6%8E%A2%E7%B4%A2Number%E9%A1%9E%E5%88%A5.png></li> <li>探索Javascript的全域物件(global)</li> <li>我們可以試著輸入Javascript的類別(Class),像是<code>global</code>,並在後面加上一個<code>.</code> ,再接著按下<code>Tab</code>按鈕來自動補全</li> <li><img alt="node REPL模式-探索全域物件(global)" src=../../assets/pics/nodejs/node%20REPL%E6%A8%A1%E5%BC%8F-%E6%8E%A2%E7%B4%A2%E5%85%A8%E5%9F%9F%E7%89%A9%E4%BB%B6%28global%29.png></li> <li>探索特殊變數(<code>_</code>)</li> <li>如果在某些程式碼後面輸入<code>_</code>,則將回傳上一個操作的結果</li> <li>探索點命令(Dot commands)</li> <li>REPL模式有一些特別的指令,這些指令都是由<code>.</code>為開頭的</li> <li>舉例來說<ul> <li><code>.help</code>: 顯示所有的點命令(dot commands)的幫助(help)</li> <li><code>.editor</code>: 啟用編輯模式,可以輕鬆地開始寫多行Javascript程式碼。一旦進入這個模式,我們將要使用<code>ctrl-D</code>的組合鍵來執行我們寫的Javascript多行程式碼</li> <li><code>.break</code>: 當輸入多行表達式(multi-line expression)時,輸入<code>.break</code>指令將終止進一步的輸入(abort further input)。與<code>ctrl-C</code>組合鍵的功能是一樣的</li> <li><code>.clear</code>: 將<code>REPL</code>模式的內文重新設定(reset)為一個空物件,並清除當前正在輸入的任何多行表達式</li> <li><code>.load</code>: 讀取當前工作目錄路徑下的Javascript檔案</li> <li><code>.save</code>: 將我們在<code>REPL連線</code>(session)中的所有對指定檔案的輸入儲存起來</li> <li><code>.exit</code>: 退出<code>REPL模式</code>。與連續按下<code>ctrl-C</code>組合鍵 <strong>兩次</strong> 的功能是一樣的</li> </ul> </li> <li>其實<code>REPL模式</code>會知道什麼時候要輸入多行表達式,而不需要呼叫<code>.editor</code><ul> <li>以下是範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=w>  </span><span class=p>[</span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>].</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>num</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span></code></pre></div></li> <li>這時候當我們按下<code>enter</code>鍵時,<code>REPL模式</code>會到新的下一行,並以<code>...</code>作為開頭,表示我們現在可以繼續在該區塊(block)工作</li> <li>情境說明 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=p>...</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=p>...</span><span class=w> </span><span class=p>})</span>
</span></code></pre></div></li> <li>如果我們這時候在一行的句尾加上<code>.break</code>時,該多行表達式的模式將會停止並不會被執行</li> </ul> </li> </ul> <h3 id=nodejs-accept-arguments-from-the-command-line>Node.js, accept arguments from the command line<a class=headerlink href=#nodejs-accept-arguments-from-the-command-line title="Permanent link">&para;</a></h3> <ul> <li>我們可以將不限制數量的參數(arguments)傳遞給Node應用程式,參數的形式可以使用以下2種形式</li> <li>獨立的參數值(standalone)<ul> <li>$ <code>node app.js joe</code></li> </ul> </li> <li>鍵-&gt;值形式的參數值(key and value)<ul> <li>$ <code>node app.js name=joe</code></li> </ul> </li> <li>這也將改變我們在Node應用程式的程式碼中,如何得到此值的方式,我們可以透過Node內建的核心模組<code>process</code>來得到此值,該模組的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_argv>process.argv</a>屬性會公開(exposes)出一個陣列(array),其中包含當啟動Node應用程式的進程的時候,整個命令列(command-line)要傳遞的所有參數</li> <li>第1個元素是node指令的完整路徑(= <a href=https://nodejs.org/api/process.html#process_process_execpath>process.execPath</a>)</li> <li>第2個元素會是正在被執行的Javascript檔案的路徑位置</li> <li>剩下的元素就是任何其他的命令列參數(command-line arguments)</li> <li>範例程式碼</li> <li>以下的範例程式碼會利用一個迴圈來遍歷(iterate over)所有的參數們(也包括node指令的完整路徑與正在被執行的Javascript檔案的路徑位置) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>val</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>index</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>val</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>我們可以透過建立一個新的陣列並切片(<code>array.slice()</code>方法)來獲得額外的參數(不包含前兩個參數) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kd>const</span><span class=w> </span><span class=nx>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>2</span><span class=p>)</span>
</span></code></pre></div></li> <li>如果我們的參數沒有索引名稱的話(without index name)</li> <li>例: $ <code>node app.js joe</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kd>const</span><span class=w> </span><span class=nx>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>2</span><span class=p>)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>args</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span>
</span></code></pre></div><ul> <li>我們可以透過以上的範例程式碼來存取命令列參數(command-line arguments)</li> </ul> </li> <li>另一種情況是,我們會以鍵值(key-value)形式來傳遞命令列參數</li> <li>例: $ <code>node app.js name=joe</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kd>const</span><span class=w> </span><span class=nx>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;minimist&#39;</span><span class=p>)(</span><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>2</span><span class=p>))</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nx>args</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=w> </span><span class=c1>//joe</span>
</span></code></pre></div><ul> <li>以上述範例程式碼為例,<code>args[0]</code>是<code>name=joe</code>,這種情況我們就會需要來解析(parse)它,最佳的做法是,我們可以利用npm上面的<a href=https://www.npmjs.com/package/minimist>minimist</a>套件來處理這些 <strong>鍵值形式的參數</strong></li> </ul> </li> <li>這次我們就要在每個參數的鍵(key)之前使用雙破折號(double dashes)<ul> <li>例: $ <code>node app.js --name=joe</code></li> </ul> </li> </ul> <h3 id=output-to-the-command-line-using-nodejs>Output to the command line using Node.js<a class=headerlink href=#output-to-the-command-line-using-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>npm的 chalk 套件---可設定終端機輸出文字的樣式與顏色<br> npm的<a href=https://www.npmjs.com/package/progress>progress</a>套件---可以在<code>CLI console</code>畫面上創造進度條的套件<br></p> </blockquote> <ul> <li>利用<a href=https://nodejs.org/api/console.html#console_console>console</a>核心模組的基本輸出(basic output)</li> <li>Node有一個<code>console</code>核心模組,該模組提供了許多與<code>CLI</code>有用的互動方法</li> <li>它基本上跟我們在瀏覽器上看到的<code>console</code>物件是一樣的</li> <li>最基本與最有用的方法是<a href=https://nodejs.org/api/console.html#console_console_log_data_args>console.log([data][, ...args])</a>,這個方法會打印出(print)我們傳遞給console的字串<ul> <li>如果我們傳遞物件,該方法會自動幫我們轉換成字串</li> <li>我們也可以傳遞多個變數給<code>console.log()</code></li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kd>const</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;x&#39;</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=kd>const</span><span class=w> </span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;y&#39;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=p>)</span>
</span></code></pre></div></li> <li>以上的程式碼,Node會將兩個變數都打印出來(print)</li> <li>我們也可以傳遞變數給模板字串</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;My %s has %d years&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;cat&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>)</span>
</span></code></pre></div></li> <li><code>%s</code>: 將變數格式化為字串</li> <li><code>%d</code>: 將變數格式化為數字</li> <li><code>%i</code>: 將變數格式化為其整數部分</li> <li><code>%o</code>: 將變數格式化為物件</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;%o&#39;</span><span class=p>,</span><span class=w> </span><span class=nb>Number</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>清除後台(console)-<a href=https://nodejs.org/api/console.html#console_console_clear>console.clear()</a></li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>clear</span><span class=p>()</span>
</span></code></pre></div></li> <li>該方法會將後台清空(註: 該方法的行為也會取決於我們是使用哪種後台)</li> <li>計算元素數量-<a href=https://nodejs.org/api/console.html#console_console_count_label>console.count([label])</a></li> <li><code>console.count()</code>是一個方便的方法</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=kd>const</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=kd>const</span><span class=w> </span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>2</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=kd>const</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>3</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>count</span><span class=p>(</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>  </span><span class=s1>&#39;The value of x is &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>+</span><span class=w> </span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>  </span><span class=s1>&#39; and has been checked .. how many times?&#39;</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=p>)</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>count</span><span class=p>(</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>  </span><span class=s1>&#39;The value of x is &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>+</span><span class=w> </span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>  </span><span class=s1>&#39; and has been checked .. how many times?&#39;</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=p>)</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=nx>console</span><span class=p>.</span><span class=nx>count</span><span class=p>(</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>  </span><span class=s1>&#39;The value of y is &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>y</span><span class=w> </span><span class=o>+</span><span class=w> </span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>  </span><span class=s1>&#39; and has been checked .. how many times?&#39;</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=p>)</span>
</span></code></pre></div><ul> <li>以上的程式碼會計算該字串被打印出(print)幾次了,並將其次打印在旁邊</li> </ul> </li> <li>範例程式碼<ul> <li>我們也可以只計算蘋果和橘子的數量 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kd>const</span><span class=w> </span><span class=nx>oranges</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;orange&#39;</span><span class=p>]</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=kd>const</span><span class=w> </span><span class=nx>apples</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;just one apple&#39;</span><span class=p>]</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=nx>oranges</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>fruit</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>count</span><span class=p>(</span><span class=nx>fruit</span><span class=p>)</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=p>})</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=nx>apples</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>fruit</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>count</span><span class=p>(</span><span class=nx>fruit</span><span class=p>)</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li>打印出堆棧追蹤(print stack trace)-<a href=https://nodejs.org/dist/latest-v15.x/docs/api/console.html#console_console_trace_message_args>console.trace([message][, ...args])</a></li> <li>在某些情況下,打印出函數的堆棧調用情況是很有用的,這也許就能回答我們的一個問題---我們該如何到達程式碼的其中一個部分?</li> <li>我們可以利用<code>console.trace()</code>方法來完成</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=kd>const</span><span class=w> </span><span class=nx>function2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>trace</span><span class=p>()</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=kd>const</span><span class=w> </span><span class=nx>function1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>function2</span><span class=p>()</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=nx>function1</span><span class=p>()</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會打印出堆棧追蹤(stack trace)</li> <li>如果我們在Node的<code>REPL模式</code>中嘗試以上的範例程式碼,會得到以下的回傳資訊 <div class="language-console highlight"><span class=filename>Bash Session</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=go>Trace</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=go>  at function2 (repl:1:33)</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=go>  at function1 (repl:1:25)</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=go>  at repl:1:1</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>  at ContextifyScript.Script.runInThisContext (vm.js:44:33)</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>  at REPLServer.defaultEval (repl.js:239:29)</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=go>  at bound (domain.js:301:14)</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=go>  at REPLServer.runBound [as eval] (domain.js:314:12)</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=go>  at REPLServer.onLine (repl.js:440:10)</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=go>  at emitOne (events.js:120:20)</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=go>  at REPLServer.emit (events.js:210:7)</span>
</span></code></pre></div></li> </ul> </li> <li>計算執行Node程式碼所花費的時間-<a href=https://nodejs.org/dist/latest-v15.x/docs/api/console.html#console_console_time_label>console.time([label])</a> &amp; <a href=https://nodejs.org/dist/latest-v15.x/docs/api/console.html#console_console_timeend_label>console.timeEnd([label])</a></li> <li>我們可以使用<code>console.time()</code> &amp; <code>console.timeEnd()</code></li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=kd>const</span><span class=w> </span><span class=nx>measureDoingSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>time</span><span class=p>(</span><span class=s1>&#39;doSomething()&#39;</span><span class=p>)</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>  </span><span class=c1>//do something, and measure the time it takes</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>  </span><span class=nx>doSomething</span><span class=p>()</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>timeEnd</span><span class=p>(</span><span class=s1>&#39;doSomething()&#39;</span><span class=p>)</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=p>}</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=nx>measureDoingSomething</span><span class=p>()</span>
</span></code></pre></div></li> <li>標準輸出 &amp; 標準錯誤-<a href=https://nodejs.org/dist/latest-v15.x/docs/api/console.html#console_console_log_data_args>console.log([data][, ...args])</a> &amp; <a href=https://nodejs.org/dist/latest-v15.x/docs/api/console.html#console_console_error_data_args>console.error([data][, ...args])</a></li> <li>如我們所見,<code>console.log()</code>非常適合在後台(Console)打印出訊息,這也就是所謂的標準輸出(standard output, <code>stdout</code>)</li> <li>反之,<code>console.error()</code>則會將訊息打印到標準錯誤(standard error, <code>stderr</code>)流(stream)上面<ul> <li><code>stderr</code>流不會出現在後台(Console)上,但是它會出現在錯誤日誌上(error log)</li> </ul> </li> <li>為文字輸出上色-<a href=https://gist.github.com/iamnewton/8754917>跳脫序列(escape sequences)</a> &amp; npm的 chalk package</li> <li>我們可以利用跳脫序列(escape sequence)將文字輸出上色</li> <li>跳脫序列是一組字符代表一種顏色</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\x1b[33m%s\x1b[0m&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hi!&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>在<code>CLI</code>上進入Node的<code>REPL模式</code>中,執行以上的程式碼會看到<code>hi</code>變成黃色的字體</li> <li><img alt="利用Node REPL模式下的跳脫序列來為文字輸出上色" src=../../assets/pics/nodejs/%E5%88%A9%E7%94%A8Node%20REPL%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E8%B7%B3%E8%84%AB%E5%BA%8F%E5%88%97%E4%BE%86%E7%82%BA%E6%96%87%E5%AD%97%E8%BC%B8%E5%87%BA%E4%B8%8A%E8%89%B2.png></li> <li>然而這樣做其實是一種低階(low-level)方法,最簡單的做法是利用套件(library)來將文字輸出上色</li> </ul> </li> <li>我們可以利用npm上面的<code>chalk</code>套件,該套件不僅可以為文字輸出上色,也可以將文字輸出的字體變成 <strong>粗體</strong> or <em>斜體</em> or 帶有下劃線<ul> <li>我們可以透過<code>CLI</code>指令來安裝<code>chalk</code>這個套件,安裝完後就可以立即使用它</li> <li>$ <code>npm install chalk</code></li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=kd>const</span><span class=w> </span><span class=nx>chalk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;chalk&#39;</span><span class=p>)</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chalk</span><span class=p>.</span><span class=nx>yellow</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>))</span>
</span></code></pre></div></li> <li>從上面的範例程式碼可以看出我們可以使用<code>chalk.yellow()</code>這個方法會比起跳脫序列(escape sequences)來得更好記與更好閱讀</li> <li>更多相關功能可以參考 npm 的 chalk 套件</li> </ul> </li> <li>建立進度條-npm的<a href=https://www.npmjs.com/package/progress>progress</a> package</li> <li><code>progress</code>是一個非常棒的套件在CLI console畫面上創造 <strong>進度條</strong> 的套件</li> <li>可以先利用npm來安裝<code>progress</code>這個套件<ul> <li>$ <code>npm install progress</code></li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=kd>const</span><span class=w> </span><span class=nx>ProgressBar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;progress&#39;</span><span class=p>)</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=kd>const</span><span class=w> </span><span class=nx>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>ProgressBar</span><span class=p>(</span><span class=s1>&#39;:bar&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>total</span><span class=o>:</span><span class=w> </span><span class=mf>10</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=kd>const</span><span class=w> </span><span class=nx>timer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>  </span><span class=nx>bar</span><span class=p>.</span><span class=nx>tick</span><span class=p>()</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>bar</span><span class=p>.</span><span class=nx>complete</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timer</span><span class=p>)</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=p>},</span><span class=w> </span><span class=mf>100</span><span class=p>)</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會建立一個含有10個步驟(steps)的進度條(progress bar),每100毫秒就會執行一次</li> <li>當進度條完成時,就會清除這個間隔(clear the interval)</li> </ul> </li> </ul> <h3 id=accept-input-from-the-command-line-in-nodejs>Accept input from the command line in Node.js<a class=headerlink href=#accept-input-from-the-command-line-in-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>npm的<a href=https://www.npmjs.com/package/readline-sync>readline-sync</a>套件---提供一個能透過console(TTY)與使用者進行對話的互動式執行地同步讀取行(synchronous readline for interactively running)<br> npm的<a href=https://www.npmjs.com/package/inquirer>inquirer</a>---收集了常見的<code>CLI</code>指令<br></p> </blockquote> <ul> <li>如何讓Node應用程式的<code>CLI console</code>成為互動性(interactive)的控制台</li> <li>自從Node<code>v7.0.0</code>版本之後,Node提供了<code>readline</code>這個內建核心模組來確切地執行以下這件事情</li> <li>從一個可讀取的流(readable stream),例如: <code>process.stdin</code>流(stream)獲得輸入(get input)</li> <li>補充: <code>process.stdin</code>是在執行Node.js應用程式期間時,終端機輸入的流,一次僅一行</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readline</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;readline&#39;</span><span class=p>).</span><span class=nx>createInterface</span><span class=p>({</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>  </span><span class=nx>input</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>,</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>  </span><span class=nx>output</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=p>})</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=nx>readline</span><span class=p>.</span><span class=nx>question</span><span class=p>(</span><span class=sb>`What&#39;s your name?`</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Hi </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span><span class=p>)</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>  </span><span class=nx>readline</span><span class=p>.</span><span class=nx>close</span><span class=p>()</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=p>})</span>
</span></code></pre></div><ul> <li>以上片段(piece)的程式碼會詢問使用者名稱,一旦使用者輸入文字並按下<code>enter</code>鍵後,我們就會發送一個問候(greeting)</li> <li>說明: <a href=https://nodejs.org/api/readline.html#readline_rl_question_query_callback>readline.question()</a>方法顯示第一個參數(例: 一個問句),並等待使用者輸入。一旦使用者輸入文字並按下<code>enter</code>鍵後,就會呼叫該方法的第二個參數---回呼函式(callback function)</li> <li>在上述的範例程式碼中,我們的回呼函式會關閉讀取行介面(readline interface)---(<a href=https://nodejs.org/api/readline.html#readline_rl_close>readline.close()</a>)</li> </ul> </li> <li><code>readline</code>模組提供了許多其他的方法,接下來將會在套件的名稱上設定超連結來讓我們可以去查看該套件的文件</li> <li>如果我們要求輸入密碼,我們會希望最好不要以明碼顯示回傳的密碼,而是使用<code>*</code>符號來替換顯示使用者輸入的密碼<ul> <li>這時最簡單的方式是使用就API而言非常類似的,npm上的<a href=https://www.npmjs.com/package/readline-sync>readline-sync</a>套件,並立即對其進行處理</li> </ul> </li> <li>npm的<a href=https://www.npmjs.com/package/inquirer>inquirer</a>套件提供了一個更完整且更抽象的解決方案<ul> <li>我們需要先透過npm安裝<code>inquirer</code>套件</li> <li>$ <code>npm install inquirer</code></li> </ul> </li> <li>情境說明 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kd>const</span><span class=w> </span><span class=nx>inquirer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;inquirer&#39;</span><span class=p>)</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=kd>var</span><span class=w> </span><span class=nx>questions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;input&#39;</span><span class=p>,</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;name&#39;</span><span class=p>,</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>    </span><span class=nx>message</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;What&#39;s your name?&quot;</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=p>]</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=nx>inquirer</span><span class=p>.</span><span class=nx>prompt</span><span class=p>(</span><span class=nx>questions</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>answers</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Hi </span><span class=si>${</span><span class=nx>answers</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=si>}</span><span class=sb>!`</span><span class=p>)</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=p>})</span>
</span></code></pre></div><ul> <li><code>inquirer</code>這個套件讓我們可以做許多事情像是詢問選擇題(multiple choices),提供單選按鈕(radio button),確認(confirmation),...等等</li> <li>值得一提的是所有的替代方案(alternatives),尤其是那些Node提供的內建替代方案還不錯。但如果我們想要將<code>CLI</code>互動式輸入提供到另一個更高的水平上時,<code>inquirer.js</code>是一個最理想(optimal)的選擇</li> </ul> </li> </ul> <h3 id=expose-functionality-from-a-nodejs-file-using-exports>Expose functionality from a Node.js file using exports<a class=headerlink href=#expose-functionality-from-a-nodejs-file-using-exports title="Permanent link">&para;</a></h3> <ul> <li>Node擁有內建的模組系統,並能透過匯入(import)來使用由其它Node.js的檔案公開(exposed)出來的功能</li> <li>假如我們想要匯入某些我們想使用的東西</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=kd>const</span><span class=w> </span><span class=nx>library</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./library&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>可以利用以上的程式碼來匯入存在於(resides)當前檔案目錄下的<code>library.js</code>所公開(exposed)出來的功能</li> <li>在<code>library.js</code>檔案的程式碼中的最下面,需要事先公開(exposed)=&gt; (使用<code>module.exports</code>物件的API)出來該檔案的功能,才能在其他需要使用時,直接匯入<code>library.js</code>就可以使用</li> <li>因為在預設情況下,所有在<code>library.js</code>中定義的物件or變數都是私有的(private)並且沒有對外(to outer world)公開(exposed)</li> <li>而這也就是<a href=https://nodejs.org/api/modules.html#modules_modules_commonjs_modules>CommonJS modules</a>模組提供的<a href=https://nodejs.org/api/modules.html#modules_module_exports>module.exports</a> API,所允許我們這麼做的</li> </ul> </li> <li>當我們指派(assign)一個物件或是一個函式成為<code>exports</code>的新屬性時,而這就是我們要公開(exposed)的東西,因此我們就可以在我們的Node應用程式中的其它部分中或甚至是在其它的Node應用程式中也可以使用</li> <li>我們可以透過以下2種方式來操作</li> <li>方法一: 指派(assign)一個物件給<code>module.exports</code>,也就是指派給由Node的<code>CommonJS modules</code>核心模組所提供的物件,如此就能將我們的檔案僅對外匯出(export)那個物件<ul> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=kd>const</span><span class=w> </span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=w>  </span><span class=nx>brand</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>  </span><span class=nx>model</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Fiesta&#39;</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=p>}</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>car</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=c1>//..in the other file</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=kd>const</span><span class=w> </span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./car&#39;</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>方法二: 將想要匯出(exported)物件新增(add)為<a href=https://nodejs.org/api/modules.html#modules_exports>exports</a>的屬性(property),這個方法讓我們能夠匯出多個物件(objects),函式(functions),資料(data)<ul> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=kd>const</span><span class=w> </span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>  </span><span class=nx>brand</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>  </span><span class=nx>model</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Fiesta&#39;</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=p>}</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=nx>exports</span><span class=p>.</span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>car</span>
</span></code></pre></div></li> <li>或是也可以直接這樣匯出(export)</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nx>exports</span><span class=p>.</span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=w>  </span><span class=nx>brand</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>  </span><span class=nx>model</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Fiesta&#39;</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=p>}</span>
</span></code></pre></div></li> <li>接著,我們在另一個檔案中就可以匯入(import)並引用(referencing)這個屬性</li> <li>我們可以透過以下2種方式來引用它</li> <li>方法一: <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=kd>const</span><span class=w> </span><span class=nx>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./items&#39;</span><span class=p>)</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nx>items</span><span class=p>.</span><span class=nx>car</span>
</span></code></pre></div></li> <li>方法二: <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=kd>const</span><span class=w> </span><span class=nx>car</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./items&#39;</span><span class=p>).</span><span class=nx>car</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/modules.html#modules_module_exports>module.exports</a>與<a href=https://nodejs.org/api/modules.html#modules_exports>exports</a>之間有什麼區別呢?</li> <li><code>module.exports</code>會公開(exposes)它指向(points to)的對象(object)</li> <li><code>exports</code>會公開(exposes)它所指向(points to)的對象(object)的屬性(properties)</li> </ul> <h3 id=an-introduction-to-the-npm-package-manager>An introduction to the npm package manager<a class=headerlink href=#an-introduction-to-the-npm-package-manager title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://docs.npmjs.com/cli/v7/commands/npm-install>npm install</a> - Install a package<br></p> </blockquote> <ul> <li><code>npm</code>介紹</li> <li><a href=https://www.npmjs.com/ >npm</a>是Node標準的套件管理工具(standard package manager)</li> <li>在2017年1月,根據報告顯示<code>npm registry</code>列表上已有超過350,000個套件(packages),也使其成為地球上單一語言程式碼儲存庫,並且我們可以確定在<code>npm</code>上有幾乎所有的東西</li> <li><code>npm</code>起初是用來下載和管理Node套件(package)的相依性(dependencies)的方式,但它此後已經成為前端(frontend) Javascript的工具</li> <li><code>npm</code>幫助我們完成很多事情,另外<code>Yarn</code>是一個<code>npm</code>的替代方案(alternative),可以到<a href=https://classic.yarnpkg.com/en/ >Yarn</a>的官方網站去瞧瞧</li> <li>下載</li> <li><code>npm</code>會管理我們專案的套件相依性(dependencies)</li> <li>安裝所有該專案的套件與其相依的套件(all dependencies)<ul> <li>如果我們的專案有一個<code>package.json</code>檔案的話,只要在終端機執行以下指令</li> <li>$ <code>npm install</code></li> <li>如果我們的專案中不存在<code>node_modules/</code>這個資料夾的話,該指令就會安裝所有這個專案會需要的套件,並將這些東西放在<code>node_modules/</code>的資料夾</li> </ul> </li> <li>安裝單一個套件(package)<ul> <li>我們只想安裝指定的套件的話,可以執行以下指令</li> <li>$ <code>npm install &lt;package-name&gt;</code></li> <li>通常,我們會看到關於這個指令的更多選項,例如以下兩種選項<ul> <li><a href=https://docs.npmjs.com/cli/v7/configuring-npm/package-json#dependencies>--save</a>: 安裝該套件並新增到<code>package.json</code>的<code>dependencies</code>鍵中</li> <li><a href=https://docs.npmjs.com/cli/v7/configuring-npm/package-json#devdependencies>--save-dev</a>: 安裝該套件並新增到<code>package.json</code>的<code>devDependencies</code>鍵中</li> </ul> </li> <li>以上兩種安裝選項的區別主要是<code>devDependencies</code>通常是開發工具(development tools),像是測試套件(testing library); 而<code>dependencies</code>在生產環境中與應用程式本身綁定在一起</li> </ul> </li> <li>更新套件(Updating packages)<ul> <li>使用<code>npm</code>也讓更新套件更容易,可以透過執行以下指令</li> <li><code>npm update</code></li> <li><code>npm</code>將檢查所有套件是否有能滿足我們專案中的<code>package.json</code>檔案版本限制(constraints)的最新版本</li> <li>我們也可以指定要更新單一個套件</li> <li>$ <code>npm update &lt;package-name&gt;</code></li> </ul> </li> <li>套件的版本控制</li> <li>除了單純的下載之外,<code>npm</code>也能管理套件的版本,因此我們可以在我們專案中的<code>package.json</code>檔案中,對套件指定任何一個特定的版本,或是要求安裝的版本需要高於 or 低於我們所需要的特定版本</li> <li>很多時候會發現一個函式庫(library)僅與另一個函式庫的主要版本(major release)所相容(compatible); 或是最新發布的函式庫的版本之中有<code>bug</code>,仍然未修復,並造成了一些問題(issue)</li> <li>指定一個明確的函式庫(library)版本也可以幫助每個人都使用確定相同的套件(package)版本,因此整個團隊都使用相同的版本來運行程式,直到<code>package.json</code>檔案被更新為止</li> <li>在以上的情況中,套件的版本管理都非常有用,<code>npm</code>也遵循了語意化版本控制的標準(semantic versioning (semver) standard)<ul> <li><a href=https://docs.npmjs.com/cli/v7/using-npm/semver>npm Docs---semver</a>: <code>npm</code>的語意化版本控制工具</li> <li><a href=https://semver.org/ >Semantic Versioning 2.0.0</a>: 語意化版本的官方網站</li> </ul> </li> <li>執行任務(Running Tasks)</li> <li><code>package.json</code>支援透過指定格式的命令來執行Node應用程式,可以透過以下指令<ul> <li>$ <code>npm run &lt;task-name&gt;</code></li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=p>{</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=w>  </span><span class=s2>&quot;scripts&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>    </span><span class=s2>&quot;start-dev&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;node lib/server-development&quot;</span><span class=p>,</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=s2>&quot;start&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;node lib/server-production&quot;</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>}</span>
</span></code></pre></div></li> <li>以下範例程式碼是利用此功能執行 <strong>Webpack</strong> 常見的方式 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=p>{</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=w>  </span><span class=s2>&quot;scripts&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>    </span><span class=s2>&quot;watch&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;webpack --watch --progress --colors --config webpack.conf.js&quot;</span><span class=p>,</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=w>    </span><span class=s2>&quot;dev&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;webpack --progress --colors --config webpack.conf.js&quot;</span><span class=p>,</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=s2>&quot;prod&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;NODE_ENV=production webpack -p --config webpack.conf.js&quot;</span><span class=p>,</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> <li>因此,我們不用再去記那些容易忘記or輸入錯誤的長指令,而可以像是如下簡潔的方式來執行Node應用程式<ul> <li>$ <code>npm run watch</code></li> <li>$ <code>npm run dev</code></li> <li>$ <code>npm run prod</code></li> </ul> </li> </ul> <h3 id=where-does-npm-install-the-packages>Where does npm install the packages?<a class=headerlink href=#where-does-npm-install-the-packages title="Permanent link">&para;</a></h3> <ul> <li>當我們利用<code>npm</code>套件管理工具來安裝一個套件時,可以選擇執行以下2種類型的安裝方式</li> <li>本地端安裝(a local install)</li> <li>全域安裝(a global install)</li> <li>在預設情況下,我們可以輸入以下指令來安裝套件(=&gt; 本地端安裝)</li> <li>例: $ <code>npm install lodash</code></li> <li>這樣<code>npm</code>就會在當前專案的目錄裡面的<code>node_modules/</code>資料夾中安裝該套件</li> <li>這時,<code>npm</code>也會新增<code>lodash</code>這個項目(entry)到當前專案目錄裡的<code>package.json</code>檔案中的<code>dependencies</code>屬性中</li> <li>我們也可以使用<code>-g</code>選項來執行全域安裝</li> <li>例: $ <code>npm install -g lodash</code></li> <li>這時,<code>npm</code>就不會在當前的資料夾安裝該套件,而是會安裝到一個全域的位置上(global location)</li> <li>具體來說,全域安裝的路徑位置在哪裡呢? A: 會依據本地端電腦的作業系統不同而定<ul> <li>在Windows作業系統中會是<code>C:\Users\YOU\AppData\Roaming\npm\node_modules</code></li> <li>在macOS &amp; Linux作業系統中會是<code>/usr/local/lib/node_modules</code></li> <li><img alt="npm 全域安裝的路徑位置" src=../../assets/pics/nodejs/npm%20%E5%85%A8%E5%9F%9F%E5%AE%89%E8%A3%9D%E7%9A%84%E8%B7%AF%E5%BE%91%E4%BD%8D%E7%BD%AE.png></li> </ul> </li> <li>然而,如果我們使用<code>nvm</code>來管理Node版本的話,全域安裝的路徑位置就會有所不同</li> <li>以我使用<code>nvm</code>的情況來說,我的套件會被全域安裝在<code>/Users/joe/.nvm/versions/node/v8.9.0/lib/node_modules</code></li> </ul> <h3 id=how-to-use-or-execute-a-package-installed-using-npm>How to use or execute a package installed using npm?<a class=headerlink href=#how-to-use-or-execute-a-package-installed-using-npm title="Permanent link">&para;</a></h3> <blockquote> <p>npm的<a href=https://www.npmjs.com/package/cowsay>cowsay</a>套件---是一個由<code>Perl</code>語言所開發的套件,能提供一個終端機介面的程式,並以母牛(cow)的方式說話<br></p> </blockquote> <ul> <li>當我們透過<code>npm</code>安裝套件到<code>node_modules/</code>資料夾時,或是全域安裝時,我們可以透過<code>require('&lt;package name&gt;')</code>的語法來引用該套件(package)</li> <li>假設我們安裝了<code>lodash</code>這個Javascript世界中流行且實用的函式庫(library)<ul> <li>例: $ <code>npm install lodash</code></li> </ul> </li> <li>這樣<code>npm</code>將會把<code>lodash</code>函式庫安裝到當前專案目錄中的<code>node_modules/</code>資料夾中</li> <li>當我們想要使用<code>lodash</code>函式庫在我們的程式碼時,可以利用以下的指令<ul> <li>例: $ <code>const _ = require('lodash')</code></li> <li>以這個範例為例 <strong>會將可執行的檔案(executable file)放在<code>node_modules/.bin/</code>資料夾下面</strong></li> </ul> </li> <li>以上的觀念,我們可以利用<code>npm</code>上的<a href=https://www.npmjs.com/package/cowsay>cowsay</a>套件來做個展示</li> <li><a href=https://www.npmjs.com/package/cowsay>cowsay</a>套件能提供一個終端機介面的程式,並以母牛(cow)的方式說話</li> <li>當我們透過<code>npm</code>安裝<code>cowsay</code>套件時, <strong>該套件就會安裝它自己本身</strong> &amp; <strong>其所有相依的套件(dependencies)在<code>node_modules/</code>資料夾中</strong><ul> <li><img alt=node_modules-content src=../../assets/pics/nodejs/node_modules-content.png></li> </ul> </li> <li>在<code>node_modules/</code>資料夾中會有一個隱藏目錄<code>.bin/</code>,裡面包含指向<code>cowsay</code>套件的二進制文件(binaries)<ul> <li><img alt=binary-files src=../../assets/pics/nodejs/binary-files.png></li> </ul> </li> <li>我們可以透過<code>npx</code>來執行<code>cowsay</code>套件來試試看,<code>npx</code>會自動去找到該套件的路徑位置<ul> <li>例: $ <code>npx cowsay</code></li> <li><img alt=cow-say src=../../assets/pics/nodejs/cow-say.png></li> </ul> </li> </ul> <h3 id=the-packagejson-guide>The package.json guide<a class=headerlink href=#the-packagejson-guide title="Permanent link">&para;</a></h3> <ul> <li>如果您有使用過Javascript,或是曾經有和Javascript專案互動(interacted)過,或是您是一位Node.js後端開發人員,或是前端開發人員,您肯定認識<code>package.json</code>這個檔案</li> <li>接下來我們會討論<code>package.json</code>這個檔案的</li> <li>有什麼用途呢?</li> <li>我們應該要對於這個檔案有什麼認知呢?</li> <li>我們能用它做什麼特別的事情呢?</li> <li><code>package.json</code>有點像是我們專案的清單(manifest),它可以用來做很多事情。它是安裝工具(configuration for tools)的一個中央儲存庫(central repository)</li> <li>例如: <code>npm</code> &amp; <code>yarn</code>都會將套件(package)的名稱(names)與對應版本(versions)都儲存在這裡</li> <li><code>package.json</code>的檔案結構(file structure)</li> <li>以下是一個<code>package.json</code>檔案的範例<ul> <li><code>{}</code></li> </ul> </li> <li>我們可以看到原始的<code>package.json</code>檔案內容是空的,對於應用程式來說,它沒有什麼固定的要求,唯一的要求就是需要是<code>JSON</code>的資料格式; 否則程式將無法透過程式的方式(programmatically)來讀取它</li> <li>如果我們在建構(build)一個Node套件,並透過<code>npm</code>來分發(distribute over)它,將發生根本性的變化(things change radically),並且必須有一組屬性來幫助其他人來使用這個套件<ul> <li>這是另一個<code>package.json</code>檔案的範例 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=p>{</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=w>  </span><span class=s2>&quot;name&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-project&quot;</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=p>}</span>
</span></code></pre></div></li> <li>它定義了一個<code>name</code>屬性(property),該屬性會告訴應用程式(application)或是套件(package),其屬性也會包含於該<code>package.json</code>檔案所屬的專案目錄中</li> </ul> </li> <li>以下是一個更複雜的範例,這個範例是從Vue.js的應用程式所提取出來的一部分 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=p>{</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=w>  </span><span class=s2>&quot;name&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-project&quot;</span><span class=p>,</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=w>  </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>  </span><span class=s2>&quot;description&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;A Vue.js project&quot;</span><span class=p>,</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w>  </span><span class=s2>&quot;main&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;src/main.js&quot;</span><span class=p>,</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>  </span><span class=s2>&quot;private&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=w>  </span><span class=s2>&quot;scripts&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>    </span><span class=s2>&quot;dev&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;webpack-dev-server --inline --progress --config build/webpack.dev.conf.js&quot;</span><span class=p>,</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>    </span><span class=s2>&quot;start&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;npm run dev&quot;</span><span class=p>,</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>    </span><span class=s2>&quot;unit&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;jest --config test/unit/jest.conf.js --coverage&quot;</span><span class=p>,</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>    </span><span class=s2>&quot;test&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;npm run unit&quot;</span><span class=p>,</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>    </span><span class=s2>&quot;lint&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;eslint --ext .js,.vue src test/unit&quot;</span><span class=p>,</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>    </span><span class=s2>&quot;build&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;node build/build.js&quot;</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=w>  </span><span class=s2>&quot;dependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>    </span><span class=s2>&quot;vue&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.5.2&quot;</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>  </span><span class=s2>&quot;devDependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=w>    </span><span class=s2>&quot;autoprefixer&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^7.1.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-20><a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=w>    </span><span class=s2>&quot;babel-core&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.22.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-21><a id=__codelineno-36-21 name=__codelineno-36-21 href=#__codelineno-36-21></a><span class=w>    </span><span class=s2>&quot;babel-eslint&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^8.2.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-22><a id=__codelineno-36-22 name=__codelineno-36-22 href=#__codelineno-36-22></a><span class=w>    </span><span class=s2>&quot;babel-helper-vue-jsx-merge-props&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.0.3&quot;</span><span class=p>,</span>
</span><span id=__span-36-23><a id=__codelineno-36-23 name=__codelineno-36-23 href=#__codelineno-36-23></a><span class=w>    </span><span class=s2>&quot;babel-jest&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^21.0.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-24><a id=__codelineno-36-24 name=__codelineno-36-24 href=#__codelineno-36-24></a><span class=w>    </span><span class=s2>&quot;babel-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^7.1.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-25><a id=__codelineno-36-25 name=__codelineno-36-25 href=#__codelineno-36-25></a><span class=w>    </span><span class=s2>&quot;babel-plugin-dynamic-import-node&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.2.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-26><a id=__codelineno-36-26 name=__codelineno-36-26 href=#__codelineno-36-26></a><span class=w>    </span><span class=s2>&quot;babel-plugin-syntax-jsx&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.18.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-27><a id=__codelineno-36-27 name=__codelineno-36-27 href=#__codelineno-36-27></a><span class=w>    </span><span class=s2>&quot;babel-plugin-transform-es2015-modules-commonjs&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.26.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-28><a id=__codelineno-36-28 name=__codelineno-36-28 href=#__codelineno-36-28></a><span class=w>    </span><span class=s2>&quot;babel-plugin-transform-runtime&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.22.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-29><a id=__codelineno-36-29 name=__codelineno-36-29 href=#__codelineno-36-29></a><span class=w>    </span><span class=s2>&quot;babel-plugin-transform-vue-jsx&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.5.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-30><a id=__codelineno-36-30 name=__codelineno-36-30 href=#__codelineno-36-30></a><span class=w>    </span><span class=s2>&quot;babel-preset-env&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.3.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-31><a id=__codelineno-36-31 name=__codelineno-36-31 href=#__codelineno-36-31></a><span class=w>    </span><span class=s2>&quot;babel-preset-stage-2&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.22.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-32><a id=__codelineno-36-32 name=__codelineno-36-32 href=#__codelineno-36-32></a><span class=w>    </span><span class=s2>&quot;chalk&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-33><a id=__codelineno-36-33 name=__codelineno-36-33 href=#__codelineno-36-33></a><span class=w>    </span><span class=s2>&quot;copy-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^4.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-34><a id=__codelineno-36-34 name=__codelineno-36-34 href=#__codelineno-36-34></a><span class=w>    </span><span class=s2>&quot;css-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.28.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-35><a id=__codelineno-36-35 name=__codelineno-36-35 href=#__codelineno-36-35></a><span class=w>    </span><span class=s2>&quot;eslint&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^4.15.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-36><a id=__codelineno-36-36 name=__codelineno-36-36 href=#__codelineno-36-36></a><span class=w>    </span><span class=s2>&quot;eslint-config-airbnb-base&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^11.3.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-37><a id=__codelineno-36-37 name=__codelineno-36-37 href=#__codelineno-36-37></a><span class=w>    </span><span class=s2>&quot;eslint-friendly-formatter&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-38><a id=__codelineno-36-38 name=__codelineno-36-38 href=#__codelineno-36-38></a><span class=w>    </span><span class=s2>&quot;eslint-import-resolver-webpack&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.8.3&quot;</span><span class=p>,</span>
</span><span id=__span-36-39><a id=__codelineno-36-39 name=__codelineno-36-39 href=#__codelineno-36-39></a><span class=w>    </span><span class=s2>&quot;eslint-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.7.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-40><a id=__codelineno-36-40 name=__codelineno-36-40 href=#__codelineno-36-40></a><span class=w>    </span><span class=s2>&quot;eslint-plugin-import&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.7.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-41><a id=__codelineno-36-41 name=__codelineno-36-41 href=#__codelineno-36-41></a><span class=w>    </span><span class=s2>&quot;eslint-plugin-vue&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^4.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-42><a id=__codelineno-36-42 name=__codelineno-36-42 href=#__codelineno-36-42></a><span class=w>    </span><span class=s2>&quot;extract-text-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-43><a id=__codelineno-36-43 name=__codelineno-36-43 href=#__codelineno-36-43></a><span class=w>    </span><span class=s2>&quot;file-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.1.4&quot;</span><span class=p>,</span>
</span><span id=__span-36-44><a id=__codelineno-36-44 name=__codelineno-36-44 href=#__codelineno-36-44></a><span class=w>    </span><span class=s2>&quot;friendly-errors-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.6.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-45><a id=__codelineno-36-45 name=__codelineno-36-45 href=#__codelineno-36-45></a><span class=w>    </span><span class=s2>&quot;html-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.30.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-46><a id=__codelineno-36-46 name=__codelineno-36-46 href=#__codelineno-36-46></a><span class=w>    </span><span class=s2>&quot;jest&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^22.0.4&quot;</span><span class=p>,</span>
</span><span id=__span-36-47><a id=__codelineno-36-47 name=__codelineno-36-47 href=#__codelineno-36-47></a><span class=w>    </span><span class=s2>&quot;jest-serializer-vue&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.3.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-48><a id=__codelineno-36-48 name=__codelineno-36-48 href=#__codelineno-36-48></a><span class=w>    </span><span class=s2>&quot;node-notifier&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^5.1.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-49><a id=__codelineno-36-49 name=__codelineno-36-49 href=#__codelineno-36-49></a><span class=w>    </span><span class=s2>&quot;optimize-css-assets-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.2.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-50><a id=__codelineno-36-50 name=__codelineno-36-50 href=#__codelineno-36-50></a><span class=w>    </span><span class=s2>&quot;ora&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.2.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-51><a id=__codelineno-36-51 name=__codelineno-36-51 href=#__codelineno-36-51></a><span class=w>    </span><span class=s2>&quot;portfinder&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.0.13&quot;</span><span class=p>,</span>
</span><span id=__span-36-52><a id=__codelineno-36-52 name=__codelineno-36-52 href=#__codelineno-36-52></a><span class=w>    </span><span class=s2>&quot;postcss-import&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^11.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-53><a id=__codelineno-36-53 name=__codelineno-36-53 href=#__codelineno-36-53></a><span class=w>    </span><span class=s2>&quot;postcss-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.0.8&quot;</span><span class=p>,</span>
</span><span id=__span-36-54><a id=__codelineno-36-54 name=__codelineno-36-54 href=#__codelineno-36-54></a><span class=w>    </span><span class=s2>&quot;postcss-url&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^7.2.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-55><a id=__codelineno-36-55 name=__codelineno-36-55 href=#__codelineno-36-55></a><span class=w>    </span><span class=s2>&quot;rimraf&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.6.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-56><a id=__codelineno-36-56 name=__codelineno-36-56 href=#__codelineno-36-56></a><span class=w>    </span><span class=s2>&quot;semver&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^5.3.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-57><a id=__codelineno-36-57 name=__codelineno-36-57 href=#__codelineno-36-57></a><span class=w>    </span><span class=s2>&quot;shelljs&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.7.6&quot;</span><span class=p>,</span>
</span><span id=__span-36-58><a id=__codelineno-36-58 name=__codelineno-36-58 href=#__codelineno-36-58></a><span class=w>    </span><span class=s2>&quot;uglifyjs-webpack-plugin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.1.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-59><a id=__codelineno-36-59 name=__codelineno-36-59 href=#__codelineno-36-59></a><span class=w>    </span><span class=s2>&quot;url-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.5.8&quot;</span><span class=p>,</span>
</span><span id=__span-36-60><a id=__codelineno-36-60 name=__codelineno-36-60 href=#__codelineno-36-60></a><span class=w>    </span><span class=s2>&quot;vue-jest&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.0.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-61><a id=__codelineno-36-61 name=__codelineno-36-61 href=#__codelineno-36-61></a><span class=w>    </span><span class=s2>&quot;vue-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^13.3.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-62><a id=__codelineno-36-62 name=__codelineno-36-62 href=#__codelineno-36-62></a><span class=w>    </span><span class=s2>&quot;vue-style-loader&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-63><a id=__codelineno-36-63 name=__codelineno-36-63 href=#__codelineno-36-63></a><span class=w>    </span><span class=s2>&quot;vue-template-compiler&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.5.2&quot;</span><span class=p>,</span>
</span><span id=__span-36-64><a id=__codelineno-36-64 name=__codelineno-36-64 href=#__codelineno-36-64></a><span class=w>    </span><span class=s2>&quot;webpack&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.6.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-65><a id=__codelineno-36-65 name=__codelineno-36-65 href=#__codelineno-36-65></a><span class=w>    </span><span class=s2>&quot;webpack-bundle-analyzer&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.9.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-66><a id=__codelineno-36-66 name=__codelineno-36-66 href=#__codelineno-36-66></a><span class=w>    </span><span class=s2>&quot;webpack-dev-server&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.9.1&quot;</span><span class=p>,</span>
</span><span id=__span-36-67><a id=__codelineno-36-67 name=__codelineno-36-67 href=#__codelineno-36-67></a><span class=w>    </span><span class=s2>&quot;webpack-merge&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^4.1.0&quot;</span>
</span><span id=__span-36-68><a id=__codelineno-36-68 name=__codelineno-36-68 href=#__codelineno-36-68></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-36-69><a id=__codelineno-36-69 name=__codelineno-36-69 href=#__codelineno-36-69></a><span class=w>  </span><span class=s2>&quot;engines&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-70><a id=__codelineno-36-70 name=__codelineno-36-70 href=#__codelineno-36-70></a><span class=w>    </span><span class=s2>&quot;node&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&gt;= 6.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-36-71><a id=__codelineno-36-71 name=__codelineno-36-71 href=#__codelineno-36-71></a><span class=w>    </span><span class=s2>&quot;npm&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&gt;= 3.0.0&quot;</span>
</span><span id=__span-36-72><a id=__codelineno-36-72 name=__codelineno-36-72 href=#__codelineno-36-72></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-36-73><a id=__codelineno-36-73 name=__codelineno-36-73 href=#__codelineno-36-73></a><span class=w>  </span><span class=s2>&quot;browserslist&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;&gt; 1%&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;last 2 versions&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;not ie &lt;= 8&quot;</span><span class=p>]</span>
</span><span id=__span-36-74><a id=__codelineno-36-74 name=__codelineno-36-74 href=#__codelineno-36-74></a><span class=p>}</span>
</span></code></pre></div><ul> <li>這裡有幾個重要的屬性要說明</li> <li><code>version</code>: 表示目前的版本號</li> <li><code>name</code>: 設定應用程式(application)/套件(package)的名稱</li> <li><code>description</code>: 簡單的描述該應用程式(application)/套件(package)</li> <li><code>main</code>: 設定應用程式的入口點(entry point)</li> <li><code>private</code>: 如果設定為<code>true</code>,<code>npm</code>就會拒絕發布該應用程式(application)/套件(package),此屬性是用來防止我們不小心公開地發布這個應用程式(application)/套件(package)</li> <li><code>scripts</code>: 定義一組<code>node</code>的<code>CLI</code>腳本(scripts)指令</li> <li><code>dependencies</code>: 設定一個<code>npm</code>需要安裝的相依性套件清單(list)</li> <li><code>devDependencies</code>: 設定一個在開發環境(development)中<code>npm</code>需要安裝的相依性套件清單(list)</li> <li><code>engines</code>: 設定要用哪個Node的版本來運行該應用程式(application)/套件(package)</li> <li><code>browserslist</code>: 用來聲明該應用程式(application)/套件(package)有支援哪些瀏覽器 &amp; 其瀏覽器的版本</li> <li>以上的所有屬性,都可以被<code>npm</code>或是其他可以讀取<code>package.json</code>的檔案所使用</li> </ul> </li> <li><code>package.json</code>的屬性分類(properties breakdown)</li> <li>本章節會開始詳細描述我們可以使用的<code>package.json</code>檔案的屬性細節。在這裡我們主要討論的是套件(package),但是同樣的道理也適用於我們本地端(local)的應用程式</li> <li>這些屬性大多數僅會在<a href=https://www.npmjs.com/ >npm</a>官網上所用到。另外,其他屬性則會與我們的程式碼(code)互動(interact with),像是<code>npm</code>或是其他的套件管理包工具</li> <li>以下列舉<code>package.json</code>中的幾個常用且重要的屬性<ul> <li><code>name</code>: 設定套件(package)名稱 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=s2>&quot;name&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;test-project&quot;</span>
</span></code></pre></div></li> <li><code>name</code>屬性的命名規則有以下幾項<ul> <li>必須小於214字元(characters)的長度限制</li> <li>不能含有空格(spaces)</li> <li>僅能使用 <strong>小寫</strong> 英文字母</li> <li>可以使用連字號(hyphens) &amp; 底線(underscores)</li> </ul> </li> <li>這是因為當該套件(package)被發布(publish)到<code>npm</code>上時,它會基於<code>name</code>屬性的值來取得一段自己的(own) URL</li> <li>如果我們要發布一個套件(package)到<code>GitHub</code>上時,此<code>name</code>屬性就是一個作為GitHub上儲存庫(repository)的名稱</li> <li><code>author</code>: 列出該套件的作者的相關資訊,可以用以下2種形式來表示(直接列舉 or 物件(object)) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=p>{</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>  </span><span class=s2>&quot;author&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Joe &lt;joe@whatever.com&gt; (https://whatever.com)&quot;</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=p>}</span>
</span></code></pre></div> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=p>{</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=w>  </span><span class=s2>&quot;author&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>    </span><span class=s2>&quot;name&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Joe&quot;</span><span class=p>,</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=s2>&quot;email&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;joe@whatever.com&quot;</span><span class=p>,</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=s2>&quot;url&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://whatever.com&quot;</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=p>}</span>
</span></code></pre></div></li> <li>作者(author)為一個人,可以用物件(object)的形式來表示,會有一個<code>name</code>的鍵(key)值(value),並且通常會有<code>url</code>與<code>email</code>的鍵值</li> <li><code>contributors</code>: 除了作者(author)以外,該應用程式(application)/套件(package)可以另外有1~多個貢獻者(contributors),可以用陣列(array)的形式來表示 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=p>{</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=w>  </span><span class=s2>&quot;contributors&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;Joe &lt;joe@whatever.com&gt; (https://whatever.com)&quot;</span><span class=p>]</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=p>}</span>
</span></code></pre></div> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=p>{</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=w>  </span><span class=s2>&quot;contributors&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>      </span><span class=s2>&quot;name&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Joe&quot;</span><span class=p>,</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>      </span><span class=s2>&quot;email&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;joe@whatever.com&quot;</span><span class=p>,</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>      </span><span class=s2>&quot;url&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://whatever.com&quot;</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=p>}</span>
</span></code></pre></div></li> <li><code>bug</code>: 連結到該套件(package)的問題追蹤區,大多數情況下會是一個<code>GitHub</code>的問題討論頁面(issue page) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=w>    </span><span class=s2>&quot;bugs&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://github.com/whatever/package/issues&quot;</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>  </span><span class=p>}</span>
</span></code></pre></div></li> <li><code>homepage</code>: 設定一個該套件(package)的主頁(homepage)畫面連結 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=p>{</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=w>  </span><span class=s2>&quot;homepage&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://whatever.com/package&quot;</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=p>}</span>
</span></code></pre></div></li> <li><code>version</code>: 表示當前的(current)套件版本號 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.0.0&quot;</span>
</span></code></pre></div></li> <li>該屬性會遵從語意化版本標記(semantic versioning notation)規則,也就是所有<code>npm</code>上的套件版本號都會是 <strong>x.x.x</strong> 的數字形式</li> <li>語意化版本標記(semantic versioning notation)規則<ul> <li>第一個數字代表主要版本號(major version)</li> <li><code>使用情境</code>: 當您進行不兼容的API更改時的主要版本 =&gt; 也就是當該套件版本 <strong>含有重大更改</strong> 時</li> <li>第二個數字代表次要版本號(minor version)</li> <li><code>使用情境</code>: 以向下兼容的方式添加功能時的MINOR版本 =&gt; 也就是 <strong>僅引入(introduces)與過去相容的套件功能</strong> 時</li> <li>第三個數字代表修補版本號(patch version)</li> <li>向後兼容的bug修復程序時的PATCH版本 =&gt; 也就是 <strong>僅修改錯誤</strong> (only fixes bugs)時</li> <li>可參考<code>npm</code>上的<a href=https://www.npmjs.com/package/semver>semver</a>套件(package)</li> <li>另外,也可以<a href=https://semver.org/ >Semantic Versioning 2.0.0</a>的官方網站</li> </ul> </li> <li><code>license</code>: 表示一個套件的授權(license)範圍 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=s2>&quot;license&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;MIT&quot;</span>
</span></code></pre></div></li> <li>可參考<a href=https://noob.tw/open-source-licenses/ >常見的五個開源專案授權條款,使用軟體更自由</a></li> <li><code>keywords</code>: 包含與該套件(package)相關的關鍵字的陣列(array) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=s2>&quot;keywords&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=w>  </span><span class=s2>&quot;email&quot;</span><span class=p>,</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>  </span><span class=s2>&quot;machine learning&quot;</span><span class=p>,</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>  </span><span class=s2>&quot;ai&quot;</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=p>]</span>
</span></code></pre></div></li> <li>該屬性是用來幫助其他人在瀏覽<a href=https://www.npmjs.com/ >npm</a>官網上其他相似的套件時,能透過這些關鍵字更快導向(navigating)到我們的套件</li> <li><code>description</code>: 包含一段對該套件(package)的簡潔的描述</li> <li>該屬性是當我們在<code>npm</code>上公開發布(publish)我們的套件(package)時,能讓其他人了解這個套件的用途與使用方法,這是特別有用的 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=s2>&quot;description&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;A package to work with strings&quot;</span>
</span></code></pre></div></li> <li><code>repository</code>: 指定這個套件(package)的程式碼儲存庫在哪裡 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=s2>&quot;repository&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;github:whatever/testing&quot;</span><span class=p>,</span>
</span></code></pre></div></li> <li> <p>注意<code>github</code>前綴(prefix)字樣,我們也可以使用其它流行的程式碼儲存庫,像是<code>gitlab</code> or <code>bitbucket</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=s2>&quot;repository&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;gitlab:whatever/testing&quot;</span><span class=p>,</span>
</span></code></pre></div></p> <p><div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=s2>&quot;repository&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;bitbucket:whatever/testing&quot;</span><span class=p>,</span>
</span></code></pre></div> * 我們也可以明確地設定一個版本控制系統(version control system) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=s2>&quot;repository&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=w>  </span><span class=s2>&quot;type&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;git&quot;</span><span class=p>,</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=w>  </span><span class=s2>&quot;url&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://github.com/whatever/testing.git&quot;</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=p>}</span>
</span></code></pre></div> * 也可以指定其它的版本控制系統,像是<code>svn</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=s2>&quot;repository&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=w>  </span><span class=s2>&quot;type&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;svn&quot;</span><span class=p>,</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>  </span><span class=s2>&quot;url&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=p>}</span>
</span></code></pre></div> * <code>main</code>: 設定一個此套件的進入點(entry point) * 當我們在應用程式中匯入(import)此套件時,該屬性就會從我們應用程式的這個進入點(entry point)路徑裡面,搜尋(search)並匯出(export)模組 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=s2>&quot;main&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;src/main.js&quot;</span>
</span></code></pre></div> * <code>private</code>: 用來防止我們將此套件不小心公開地發布到<code>npm</code>上 * 可以將該屬性值設定為<code>true</code>,來防止我們將此套件不小心公開地發布到<code>npm</code>上 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=s2>&quot;private&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>true</span>
</span></code></pre></div> * <code>scripts</code>: 可用來定義一組可以給Node執行的腳本(scripts)指令 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=s2>&quot;scripts&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=w>  </span><span class=s2>&quot;dev&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;webpack-dev-server --inline --progress --config build/webpack.dev.conf.js&quot;</span><span class=p>,</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=w>  </span><span class=s2>&quot;start&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;npm run dev&quot;</span><span class=p>,</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>  </span><span class=s2>&quot;unit&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;jest --config test/unit/jest.conf.js --coverage&quot;</span><span class=p>,</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>  </span><span class=s2>&quot;test&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;npm run unit&quot;</span><span class=p>,</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>  </span><span class=s2>&quot;lint&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;eslint --ext .js,.vue src test/unit&quot;</span><span class=p>,</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>  </span><span class=s2>&quot;build&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;node build/build.js&quot;</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=p>}</span>
</span></code></pre></div> * 這些腳本(scripts)指令是用來在<code>CLI</code>終端機上執行的,我們可以透過以下指令的形式來執行 * $ <code>npm run &lt;script name&gt;</code> * 例: $ <code>npm run dev</code> 或是 <code>yarn dev</code> * <code>dependencies</code>: 設定一個清單來表示該套件的相依套件名稱與其分別的版本號之間的對應關係 * 可以用物件(object)的形式來表示,鍵=相依套件的名稱,值=對應的版本號 * 我們可以使用<code>npm</code>或是<code>yarn</code>來安裝所有這些相依套件 * 例: $ <code>npm install &lt;PACKAGENAME&gt;</code> * 例: $ <code>yarn add &lt;PACKAGENAME&gt;</code> * 當透過<code>npm</code>或是<code>yarn</code>來安裝這些相依套件後,<code>package.json</code>檔案的<code>dependencies</code>屬性就會自動地新增一條該套件(package)的相依套件(dependencies)的鍵值 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=s2>&quot;dependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=w>  </span><span class=s2>&quot;vue&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.5.2&quot;</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=p>}</span>
</span></code></pre></div> * <code>devDependencies</code>: 設定一個清單來表示 <strong>在開發環境(development)中</strong> 該套件的相依套件名稱與其分別的版本號之間的對應關係 * 該屬性與前一個<code>dependencies</code>屬性的差別是,<code>devDependencies</code>屬性中所列出的相依套件需要 <strong>在開發環境(development)中</strong> 才會被安裝,並不會在生產環境(production)中被安裝 * 我們可以使用<code>npm</code>或是<code>yarn</code>來安裝所有這些相依套件 * 例: $ <code>npm install --save-dev &lt;PACKAGENAME&gt;</code> * 例: $ <code>yarn add --dev &lt;PACKAGENAME&gt;</code> * 當透過<code>npm</code>或是<code>yarn</code>來安裝這些相依套件後,<code>package.json</code>檔案的<code>dependencies</code>屬性就會自動地新增一條 <strong>在開發環境(development)中</strong> 該套件(package)的相依套件(devDependencies)的鍵值 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=s2>&quot;devDependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=w>  </span><span class=s2>&quot;autoprefixer&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^7.1.2&quot;</span><span class=p>,</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=w>  </span><span class=s2>&quot;babel-core&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^6.22.1&quot;</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=p>}</span>
</span></code></pre></div> * <code>engines</code>: 可設定此應用程式(application)/套件(package)想要用什麼版本的<code>Node</code>, <code>npm</code>, <code>yarn</code>來執行 or 安裝 * 可指定一個明確的版本,或是給定一個版本區間的範圍 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=s2>&quot;engines&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=w>  </span><span class=s2>&quot;node&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&gt;= 6.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=w>  </span><span class=s2>&quot;npm&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&gt;= 3.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=w>  </span><span class=s2>&quot;yarn&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^0.13.0&quot;</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=p>}</span>
</span></code></pre></div> * <code>browserslist</code>: 用來聲明這個套件(package)能支援哪些瀏覽器以及其瀏覽器的對應版本號 * 該屬性通常是給<a href=https://babeljs.io/ >Babel</a>, <a href=https://www.npmjs.com/package/autoprefixer>Autoprefixer</a>以及其他的工具來讀取的 * 僅會將<code>polyfills</code>與<code>fallbacks</code>新增到目標瀏覽器中 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=s2>&quot;browserslist&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=w>  </span><span class=s2>&quot;&gt; 1%&quot;</span><span class=p>,</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=w>  </span><span class=s2>&quot;last 2 versions&quot;</span><span class=p>,</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>  </span><span class=s2>&quot;not ie &lt;= 8&quot;</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=p>]</span>
</span></code></pre></div> * 以上的範例設定表示我們想要支援過去所有瀏覽器最新的2個主要版本,並且至少要有使用1%的使用率(依據<a href=https://caniuse.com/ >CanIUse.com</a>的統計數據為準)。另外,不支援IE8以及其更舊的版本 * 可參考<code>npm</code>上的<a href=https://www.npmjs.com/package/browserslist>browserslist</a>套件 * 特殊命令的屬性(Command-specific properties) * 其實<code>package.json</code>檔案還可以託管(host)特殊命令(command-specific)的設定(configuration),像是<a href=https://eslint.org/docs/user-guide/configuring>eslintConfig</a>, <a href=https://babeljs.io/docs/en/configuration>babel</a>...等等其它的設定 * 這些都是特殊命令的屬性設定,我們可以到它們分別的官方文件中查詢該如何設定它們(例: <code>ESlint</code>, <code>Babel</code>) - 套件的版本號(Package versions) + 我們可以從上面的<code>package.json</code>範例中看到像是<code>~3.0.0</code>或是<code>^0.13.0</code>的版本表示方式,這些前綴符號(symbol)代表該套件(package)的這些相依套件(dependencies)可以被更新(update)到哪個版本 + 其版本號規則可參考<a href=https://nodejs.dev/learn/semantic-versioning-using-npm>Semantic Versioning using npm</a>章節的說明 + 我們可以使用組合範圍的版本表達方式 * 例: <code>1.0.0 || &gt;=1.1.0 &lt;1.2.0</code> * 以上的組合範圍的版本表達方式就代表我們可以使用<code>1.0.0</code>以上 or 從<code>1.1.0</code>起,但低於<code>1.2.0</code>的版本</p> </li> </ul> </li> </ul> <h3 id=the-package-lockjson-file>The package-lock.json file<a class=headerlink href=#the-package-lockjson-file title="Permanent link">&para;</a></h3> <ul> <li>從<code>npm</code> v5.0.0開始, 就開始引進(introduced)<code>package-lock.json</code>檔案</li> <li><code>package-lock.json</code>檔案主要是用來追蹤(track)每個套件已安裝的確切(exact)版本,以便可以利用相同的方式來達到100%的複製出同樣的軟體產品,因此也不會受到套件維護者(maintainers)更新這些套件時而影響</li> <li>這解決了一個<code>package.json</code>檔案尚未解決的一個具體的問題。在<code>package.json</code>中,我們可以利用<a href=https://docs.npmjs.com/cli/v6/using-npm/semver>semver</a>來設定(set)我們要升級(upgrade)到的版本,像是次要(minor)或是修補(patch)版本</li> <li>範例說明</li> <li><code>~0.13.0</code>: 表示只想更新(update)修補版本,例如<code>0.13.1</code>可以,但是<code>0.14.0</code>就不行</li> <li><code>^0.13.0</code>: 表示只想更新次要(minor)以及修補(patch)版本,例如<code>0.13.0</code>和<code>0.14.0</code>...等等都是可以的</li> <li><code>0.13.0</code>: 表示我們將始終使用這個確切的版本號</li> <li>正常來說,我們 <strong>不會提交</strong> (commit)<code>node_modules/</code>資料夾,因為它通常很大。當我們想要複製出一份相同的專案,可以透過 $ <code>npm install</code> 指令,該指令就會參考<code>~</code>與<code>^</code>語法(syntax)來下載相應的版本號</li> <li>當然,我們有可以指定確切的版本號,像是<code>0.13.0</code></li> <li>因此,我們的原始專案與新初始化的專案實際上是不同的。即使次要(minor)或是修補(patch)版本不應該引入(introduce)重大更改(breaking changes),但是我們都知道仍然可能有<code>bug</code>埋藏在其中</li> <li><code>package-lock.json</code>檔案會設定目前已安裝的套件的 <strong>確切版本號</strong> ,<code>npm</code>就會透過 $ <code>npm install</code> 指令來安裝; 其實這不是一個一個新觀念,如同<code>PHP</code>的<code>Composer</code>套件管理包工具就已經使用類似的系統很多年了</li> <li>如果該專案是公開的,或是我們有其他協作者(collaborators),或者我們有使用Git作為用來部署的資源,<code>package-lock.json</code>檔案都需要被提交(commit)到<code>Git</code>的儲存庫中,使它能夠被其他人下載</li> <li>所有的相依套件都會被<code>package-lock.json</code>更新(updated),當我們執行以下指令時</li> <li>$ <code>npm update</code></li> <li>以下是在一個空資料夾,執行 $ <code>npm install cowsay</code> 來安裝<code>package-lock.json</code>所得到的範例檔案結構 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=p>{</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=w>  </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=w>  </span><span class=s2>&quot;lockfileVersion&quot;</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=w>  </span><span class=s2>&quot;dependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>    </span><span class=s2>&quot;ansi-regex&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;3.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/ansi-regex/-/ansi-regex-3.</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=s2>0.0.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-7QMXwyIGT3lGbAKWa922Bas32Zg=&quot;</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=w>    </span><span class=s2>&quot;cowsay&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/cowsay/-/cowsay-1.3.1.tgz&quot;</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=p>,</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha512-3PVFe6FePVtPj1HTeLin9v8WyLl+VmM1l1H/5P+BTTDkM</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=s2>Ajufp+0F9eLjzRnOHzVAYeIYFF5po5NjRrgefnRMQ==&quot;</span><span class=p>,</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=w>      </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=w>        </span><span class=s2>&quot;get-stdin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^5.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-19><a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a><span class=w>        </span><span class=s2>&quot;optimist&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~0.6.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-20><a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=w>        </span><span class=s2>&quot;string-width&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~2.1.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-21><a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a><span class=w>        </span><span class=s2>&quot;strip-eof&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.0.0&quot;</span>
</span><span id=__span-60-22><a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-60-23><a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-24><a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a><span class=w>    </span><span class=s2>&quot;get-stdin&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-25><a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;5.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-26><a id=__codelineno-60-26 name=__codelineno-60-26 href=#__codelineno-60-26></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/get-stdin/-/get-stdin-5.0.</span>
</span><span id=__span-60-27><a id=__codelineno-60-27 name=__codelineno-60-27 href=#__codelineno-60-27></a><span class=s2>1.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-28><a id=__codelineno-60-28 name=__codelineno-60-28 href=#__codelineno-60-28></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-Ei4WFZHiH/TFJTAwVpPyDmOTo5g=&quot;</span>
</span><span id=__span-60-29><a id=__codelineno-60-29 name=__codelineno-60-29 href=#__codelineno-60-29></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-30><a id=__codelineno-60-30 name=__codelineno-60-30 href=#__codelineno-60-30></a><span class=w>    </span><span class=s2>&quot;is-fullwidth-code-point&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-31><a id=__codelineno-60-31 name=__codelineno-60-31 href=#__codelineno-60-31></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-60-32><a id=__codelineno-60-32 name=__codelineno-60-32 href=#__codelineno-60-32></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/is-fullwidth-code-point/-/</span>
</span><span id=__span-60-33><a id=__codelineno-60-33 name=__codelineno-60-33 href=#__codelineno-60-33></a><span class=s2>is-fullwidth-code-point-2.0.0.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-34><a id=__codelineno-60-34 name=__codelineno-60-34 href=#__codelineno-60-34></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-o7MKXE8ZkYMWeqq5O+764937ZU8=&quot;</span>
</span><span id=__span-60-35><a id=__codelineno-60-35 name=__codelineno-60-35 href=#__codelineno-60-35></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-36><a id=__codelineno-60-36 name=__codelineno-60-36 href=#__codelineno-60-36></a><span class=w>    </span><span class=s2>&quot;minimist&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-37><a id=__codelineno-60-37 name=__codelineno-60-37 href=#__codelineno-60-37></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;0.0.10&quot;</span><span class=p>,</span>
</span><span id=__span-60-38><a id=__codelineno-60-38 name=__codelineno-60-38 href=#__codelineno-60-38></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/minimist/-/minimist-0.0.10</span>
</span><span id=__span-60-39><a id=__codelineno-60-39 name=__codelineno-60-39 href=#__codelineno-60-39></a><span class=s2>.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-40><a id=__codelineno-60-40 name=__codelineno-60-40 href=#__codelineno-60-40></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-3j+YVD2/lggr5IrRoMfNqDYwHc8=&quot;</span>
</span><span id=__span-60-41><a id=__codelineno-60-41 name=__codelineno-60-41 href=#__codelineno-60-41></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-42><a id=__codelineno-60-42 name=__codelineno-60-42 href=#__codelineno-60-42></a><span class=w>    </span><span class=s2>&quot;optimist&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-43><a id=__codelineno-60-43 name=__codelineno-60-43 href=#__codelineno-60-43></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;0.6.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-44><a id=__codelineno-60-44 name=__codelineno-60-44 href=#__codelineno-60-44></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/optimist/-/optimist-0.6.1.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-45><a id=__codelineno-60-45 name=__codelineno-60-45 href=#__codelineno-60-45></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-2j6nRob6IaGaERwybpDrFaAZZoY=&quot;</span><span class=p>,</span>
</span><span id=__span-60-46><a id=__codelineno-60-46 name=__codelineno-60-46 href=#__codelineno-60-46></a>
</span><span id=__span-60-47><a id=__codelineno-60-47 name=__codelineno-60-47 href=#__codelineno-60-47></a><span class=w>      </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-48><a id=__codelineno-60-48 name=__codelineno-60-48 href=#__codelineno-60-48></a><span class=w>        </span><span class=s2>&quot;minimist&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~0.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-49><a id=__codelineno-60-49 name=__codelineno-60-49 href=#__codelineno-60-49></a><span class=w>        </span><span class=s2>&quot;wordwrap&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~0.0.2&quot;</span>
</span><span id=__span-60-50><a id=__codelineno-60-50 name=__codelineno-60-50 href=#__codelineno-60-50></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-60-51><a id=__codelineno-60-51 name=__codelineno-60-51 href=#__codelineno-60-51></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-52><a id=__codelineno-60-52 name=__codelineno-60-52 href=#__codelineno-60-52></a><span class=w>    </span><span class=s2>&quot;string-width&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-53><a id=__codelineno-60-53 name=__codelineno-60-53 href=#__codelineno-60-53></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2.1.1&quot;</span><span class=p>,</span>
</span><span id=__span-60-54><a id=__codelineno-60-54 name=__codelineno-60-54 href=#__codelineno-60-54></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/string-width/-/string-width-2.1.1.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-55><a id=__codelineno-60-55 name=__codelineno-60-55 href=#__codelineno-60-55></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha512-nOqH59deCq9SRHlxq1Aw85Jnt4w6KvLKqWVik6oA9ZklXLNIOlqg4F2yrT1MVaTjAqvVwdfeZ7w7aCvJD7ugkw==&quot;</span><span class=p>,</span>
</span><span id=__span-60-56><a id=__codelineno-60-56 name=__codelineno-60-56 href=#__codelineno-60-56></a><span class=w>      </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-57><a id=__codelineno-60-57 name=__codelineno-60-57 href=#__codelineno-60-57></a><span class=w>        </span><span class=s2>&quot;is-fullwidth-code-point&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^2.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-60-58><a id=__codelineno-60-58 name=__codelineno-60-58 href=#__codelineno-60-58></a><span class=w>        </span><span class=s2>&quot;strip-ansi&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^4.0.0&quot;</span>
</span><span id=__span-60-59><a id=__codelineno-60-59 name=__codelineno-60-59 href=#__codelineno-60-59></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-60-60><a id=__codelineno-60-60 name=__codelineno-60-60 href=#__codelineno-60-60></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-61><a id=__codelineno-60-61 name=__codelineno-60-61 href=#__codelineno-60-61></a><span class=w>    </span><span class=s2>&quot;strip-ansi&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-62><a id=__codelineno-60-62 name=__codelineno-60-62 href=#__codelineno-60-62></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;4.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-60-63><a id=__codelineno-60-63 name=__codelineno-60-63 href=#__codelineno-60-63></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/strip-ansi/-/strip-ansi-4.0.0.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-64><a id=__codelineno-60-64 name=__codelineno-60-64 href=#__codelineno-60-64></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-qEeQIusaw2iocTibY1JixQXuNo8=&quot;</span><span class=p>,</span>
</span><span id=__span-60-65><a id=__codelineno-60-65 name=__codelineno-60-65 href=#__codelineno-60-65></a><span class=w>      </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-66><a id=__codelineno-60-66 name=__codelineno-60-66 href=#__codelineno-60-66></a><span class=w>        </span><span class=s2>&quot;ansi-regex&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^3.0.0&quot;</span>
</span><span id=__span-60-67><a id=__codelineno-60-67 name=__codelineno-60-67 href=#__codelineno-60-67></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-60-68><a id=__codelineno-60-68 name=__codelineno-60-68 href=#__codelineno-60-68></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-69><a id=__codelineno-60-69 name=__codelineno-60-69 href=#__codelineno-60-69></a><span class=w>    </span><span class=s2>&quot;strip-eof&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-70><a id=__codelineno-60-70 name=__codelineno-60-70 href=#__codelineno-60-70></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.0.0&quot;</span><span class=p>,</span>
</span><span id=__span-60-71><a id=__codelineno-60-71 name=__codelineno-60-71 href=#__codelineno-60-71></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/strip-eof/-/strip-eof-1.0.0.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-72><a id=__codelineno-60-72 name=__codelineno-60-72 href=#__codelineno-60-72></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-u0P/VZim6wXYm1n80SnJgzE2Br8=&quot;</span>
</span><span id=__span-60-73><a id=__codelineno-60-73 name=__codelineno-60-73 href=#__codelineno-60-73></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-60-74><a id=__codelineno-60-74 name=__codelineno-60-74 href=#__codelineno-60-74></a><span class=w>    </span><span class=s2>&quot;wordwrap&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-75><a id=__codelineno-60-75 name=__codelineno-60-75 href=#__codelineno-60-75></a><span class=w>      </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;0.0.3&quot;</span><span class=p>,</span>
</span><span id=__span-60-76><a id=__codelineno-60-76 name=__codelineno-60-76 href=#__codelineno-60-76></a><span class=w>      </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/wordwrap/-/wordwrap-0.0.3.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-60-77><a id=__codelineno-60-77 name=__codelineno-60-77 href=#__codelineno-60-77></a><span class=w>      </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha1-o9XabNXAvAAI03I0u68b7WMFkQc=&quot;</span>
</span><span id=__span-60-78><a id=__codelineno-60-78 name=__codelineno-60-78 href=#__codelineno-60-78></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-60-79><a id=__codelineno-60-79 name=__codelineno-60-79 href=#__codelineno-60-79></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-60-80><a id=__codelineno-60-80 name=__codelineno-60-80 href=#__codelineno-60-80></a><span class=p>}</span>
</span></code></pre></div></li> <li><code>npm</code>會依據以下4點來安裝<code>cowsay</code><ul> <li>get-stdin</li> <li>optimist</li> <li>string-width</li> <li>strip-eof</li> </ul> </li> <li>反過來說,以上那些套件也需要其它套件(packages),正如我們從<code>requires</code>屬性所看到的<ul> <li>ansi-regex</li> <li>is-fullwidth-code-point</li> <li>minimist</li> <li>wordwrap</li> <li>strip-eof</li> </ul> </li> <li>它們都是按照英文字母順序來加入到<code>package-lock.json</code>檔案中的,每個套件都會有以下幾種欄位<ul> <li><code>version</code>: 版本號</li> <li><code>resolved</code>: 指向該套件(package)的下載位置</li> <li><code>integrity</code>: 可以用來驗證(verify)該套件的一段文字(通常會是<code>SHA512</code>形式的值)</li> </ul> </li> </ul> <h3 id=find-the-installed-version-of-an-npm-package>Find the installed version of an npm package<a class=headerlink href=#find-the-installed-version-of-an-npm-package title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://docs.npmjs.com/cli/v7/commands/npm-ls>npm list</a> - List installed packages<br> <a href=https://docs.npmjs.com/cli/v7/commands/npm-view>npm view</a> - View registry info<br></p> </blockquote> <ul> <li>如果我們想要檢視所有已經安裝的套件的最新版本的話(也包含它們所相依的套件們),可以使用以下指令</li> <li>$ <code>npm list</code><ul> <li><code>-g</code>: 列出所有已經安裝的全域套件的最新版本</li> </ul> </li> <li><img alt="npm list example" src=../../assets/pics/nodejs/npm%20list%20example.png></li> <li>我們也可以打開<code>package-lock.json</code>檔案來做一些視覺上的掃描(visual scanning)</li> <li>如果我們只想要列出第一(最高)階層的套件(基本上就是我們利用<code>npm</code>來安裝<code>package.json</code>中列出的那些套件們),我們可以使用以下指令<ul> <li>$ <code>npm list --depth=0</code></li> <li><code>--depth</code>: 想要展示出的套件相依性樹狀圖的最大深度</li> <li><img alt="npm list --depth=0" src=../../assets/pics/nodejs/npm%20list%20--depth%3D0.png></li> </ul> </li> <li>我們有可以透過指定套件名稱來得到其版本號<ul> <li>$ <code>npm list &lt;package&gt;</code></li> <li><img alt="npm list <package>" src=../../assets/pics/nodejs/npm%20list%20%3Cpackage%3E.png></li> </ul> </li> <li>這也適用於我們安裝的套件(package)的相依套件(dependencies)<ul> <li><img alt="npm list <dependencies>" src=../../assets/pics/nodejs/npm%20list%20%3Cdependencies%3E.png></li> </ul> </li> <li>我們也可以查看該套件在<code>npm</code>儲存庫(repository)上的 <strong>最新版本</strong><ul> <li>$ <code>npm view &lt;package_name&gt; version</code></li> <li><img alt="npm view <package_name> version" src=../../assets/pics/nodejs/npm%20view%20%3Cpackage_name%3E%20version.png></li> </ul> </li> </ul> <h3 id=install-an-older-version-of-an-npm-package>Install an older version of an npm package<a class=headerlink href=#install-an-older-version-of-an-npm-package title="Permanent link">&para;</a></h3> <ul> <li>我們可以透過<code>@</code>語法(syntax)來安裝較舊版本的<code>npm</code>套件(package)</li> <li>$ <code>npm install &lt;package&gt;@&lt;version&gt;</code></li> <li>例: $ <code>npm install cowsay@1.2.0</code></li> <li>例: $ <code>npm install -g webpack@4.16.4</code></li> <li>我們可能會對某個套件的 <strong>所有版本</strong> 有興趣,我們可以透過以下指令來檢視</li> <li>$ <code>npm view &lt;package&gt; versions</code></li> <li>例: $ <code>npm view cowsay versions</code><ul> <li><img alt="npm view <package> versions" src=../../assets/pics/nodejs/npm%20view%20%3Cpackage%3E%20versions.png></li> </ul> </li> </ul> <h3 id=update-all-the-nodejs-dependencies-to-their-latest-version>Update all the Node.js dependencies to their latest version<a class=headerlink href=#update-all-the-nodejs-dependencies-to-their-latest-version title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://docs.npmjs.com/cli/v7/commands/npm-update>npm update</a> - Update a package<br> <a href=https://docs.npmjs.com/cli/v7/commands/npm-outdated>npm outdated</a> - Check for outdated packages<br> npm的<a href=https://www.npmjs.com/package/npm-check-updates>check updates</a>套件---upgrades your package.json dependencies to the latest versions, ignoring specified versions.<br></p> </blockquote> <ul> <li>當我們透過$ <code>npm install &lt;package-name&gt;</code>來安裝時,該套件的最新(latest)可用(available)版本就會被下載到<code>node_modules/</code>資料夾中,並且將相對應的(corresponding)項目(entry)新增到當前資料夾裡面的<code>package.json</code>檔案 &amp; <code>package-lock.json</code>檔案中</li> <li><code>npm</code>會自動計算(calculates)該套件的相依套件們(dependencies),並安裝最新可用的相依套件們</li> <li>比如說,當我們安裝<code>cowsay</code>這個套件,它是一個可<code>CLI</code>介面的工具可以讓一隻牛說些話</li> <li>當我們使用$ <code>npm install</code>指令時,該項目(entry)就會被新增到<code>package.json</code>檔案中 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=w>    </span><span class=s2>&quot;dependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>      </span><span class=s2>&quot;cowsay&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.3.1&quot;</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>  </span><span class=p>}</span>
</span></code></pre></div></li> <li>以下是從<code>package-lock.json</code>檔案中,提取(extract)出的片段。為了清楚起見,我們移除了巢狀相依套件的內容 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=w>    </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=w>    </span><span class=s2>&quot;lockfileVersion&quot;</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=w>    </span><span class=s2>&quot;dependencies&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=w>      </span><span class=s2>&quot;cowsay&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=w>        </span><span class=s2>&quot;version&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=w>        </span><span class=s2>&quot;resolved&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://registry.npmjs.org/cowsay/-/cowsay-1.3.1.tgz&quot;</span><span class=p>,</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=w>        </span><span class=s2>&quot;integrity&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;sha512-3PVFe6FePVtPj1HTeLin9v8WyLl+VmM1l1H/5P+BTTDkMAjufp+0F9eLjzRnOHzVAYeIYFF5po5NjRrgefnRMQ==&quot;</span><span class=p>,</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=w>        </span><span class=s2>&quot;requires&quot;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=w>          </span><span class=s2>&quot;get-stdin&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^5.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=w>          </span><span class=s2>&quot;optimist&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~0.6.1&quot;</span><span class=p>,</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=w>          </span><span class=s2>&quot;string-width&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;~2.1.1&quot;</span><span class=p>,</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=w>          </span><span class=s2>&quot;strip-eof&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;^1.0.0&quot;</span>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-62-16><a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-62-17><a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=w>  </span><span class=p>}</span>
</span></code></pre></div></li> <li>以上兩個檔案告訴我們要安裝<code>cowsay</code>套件的<code>v1.3.1</code>版本,並且我們的更新(updates規則是<code>^1.3.1</code>,這代表<code>npm</code>可以更新次要(minor)與修補(patch)版本,像是<code>v1.3.2</code>,<code>v1.4.0</code>, ...等等<ul> <li>也就是說,當有次要(minor)與修補(patch)版本發布時,我們可以透過$ <code>npm update</code>來更新套件版本。這樣一來,我們已安裝的套件就會是最新版本</li> <li>同時<code>package-lock.json</code>檔案也會勤奮地(diligently)填上(filled with)新版本; 而<code>package.json</code>檔案維持不變</li> </ul> </li> <li>可以透過以下指令,發現(discover)是否有套件有發布新版本</li> <li>$ <code>npm oudated</code><ul> <li><img alt="npm outdated" src=../../assets/pics/nodejs/npm%20outdated.png></li> <li>上述的部分套件需要更新主要版本(major),這時候如果我們執行$ <code>npm update</code>就 <strong>不會</strong> 更新到這些套件。若要更新套件的主要(major)版本,絕不會用這種方式,因為依據語意化版本規則的定義,主要版本的更新代表有重大更改(breaking changes),而<code>npm</code>想要幫我們省下麻煩</li> </ul> </li> <li>如果我們確定想要更新套件的 <strong>主要(major)版本</strong> 的話,可以先 <strong>全域</strong> 安裝<code>check-updates</code>這個套件<ul> <li>$ <code>npm install -g npm-check-updates</code></li> <li>接著執行它(該套件)</li> <li>$ <code>ncu -u</code></li> <li>這樣它就會升級(upgrade)所有在<code>package.json</code>檔案中<code>dependencies</code>與<code>devDependencies</code>的版本提示(version hints),因此<code>npm</code>就可以安裝套件新的主要版本</li> </ul> </li> <li>如果我們只是下載遠端儲存庫上的專案,而不包含其<code>node_modules/</code>資料夾中的相依套件的話,我們可以透過以下指令,來安裝最新的套件版本</li> <li>$ <code>npm install</code></li> </ul> <h3 id=semantic-versioning-using-npm>Semantic Versioning using npm<a class=headerlink href=#semantic-versioning-using-npm title="Permanent link">&para;</a></h3> <blockquote> <p>npm的<a href=https://docs.npmjs.com/cli/v7/using-npm/semver>semver</a>套件---The semantic versioner for npm<br></p> </blockquote> <ul> <li>在Node.js套件的世界中,有一件很棒的事情,那就是它們皆同意使用語意化版本規則(using Semantic Versionin)來作為他們的版本編號</li> <li>語意化版本規則的觀念其實很簡單---&gt;所有的都由三個數字(digits)組合而成</li> <li>範例: <code>x.y.z</code><ul> <li>第1個數字<code>x</code>是主要版本(major)</li> <li>第2個數字<code>y</code>是次要版本(minor)</li> <li>第3個數字<code>z</code>是修補版本(patch)</li> </ul> </li> <li>當我們發布一個新的套件(package)版本時,我們不僅可以自己選擇要增加的數字之外,也仍須遵守以下規則</li> <li><code>major</code>: 當我們進行不兼容(incompatible)的API修改(changes)時,可以提升(up)主要版本號</li> <li><code>minor</code>: 當我們新增一個能向後兼容(backward-compatible, =&gt; 也就是能與過去相容)的功能時,可以提升(up)次要版本號</li> <li><code>patch</code>: 當我們修復(fix)一個能向後兼容(backward-compatible bug fixes)的錯誤(bug)時,可以提升(up)修補版本號</li> <li>這樣的版本號慣例(convention)也被所有的程式語言所採用(adopted),而<code>npm</code>的每個套件(package)有都會遵守(adheres to)此版本號規範,所以此一版本號規範是非常重要的</li> <li>因為<code>npm</code>設定了一些規則,讓我們可以透過<code>package.json</code>檔案來選擇當我們利用$ <code>npm update</code>指令來更新我們的套件時,要更新到的哪個版本號</li> <li>以下是<code>npm</code>設定給<code>package.json</code>檔案的版本號規範語法<ul> <li><code>^</code>(Tilde Ranges)</li> <li>只會更新(updates),但不會更改最左邊(leftmost)非零(non-zero)的數字</li> <li>舉例來說,當我們執行$ <code>npm update</code>指令時<ul> <li>例1: <code>^0.13.0</code> =&gt; 可以更新(update)到<code>0.13.1</code>或<code>0.13.2</code>...等等</li> <li>例2: <code>^1.13.0</code> =&gt; 可以更新(update)到<code>1.13.1</code>或<code>1.14.0</code>,但是 <strong>不能</strong> 更新到<code>2.0.0</code>或是再其更之上的版本</li> </ul> </li> <li><code>~</code> (Caret Ranges)</li> <li>如果次要版本在<code>package.json</code>中已經指定了的話,允許修補層級的更改(patch-level changes); 若不允許修補層級的修改的話,則允許次要版本層級的修改(minor-level changes)</li> <li>舉例來說,當我們執行$ <code>npm update</code>指令時<ul> <li>例1: <code>~0.13.0</code> =&gt; 可以更新到<code>0.13.1</code>,但是 <strong>不能</strong> 更新到<code>0.14.0</code></li> </ul> </li> <li><code>&gt;</code></li> <li>可以接受比我們指定的版本還要高的任何一個版本</li> <li><code>&gt;=</code></li> <li>可以接受與我們指定的版本相同or還要高的任何一個版本</li> <li><code>&lt;</code></li> <li>可以接受比我們指定的版本還要低的任何一個版本</li> <li><code>&lt;=</code></li> <li>可以接受與我們指定的版本相同or還要低的任何一個版本</li> <li><code>=</code></li> <li>可以接受與我們指定的確切版本 <strong>完全相同</strong> 的版本</li> <li><code>-</code> (Hyphen Ranges)</li> <li>可以接受一個指定範圍內的所有版本號</li> <li>舉例來說,當我們執行$ <code>npm update</code>指令時<ul> <li>例1: <code>1.2.3 - 2.3.4</code> =&gt; 表示可以更新到 <code>&gt;=1.2.3 &amp;&amp; &lt;=2.3.4</code>的版本號</li> </ul> </li> <li><code>||</code> (combine sets)</li> <li>可以接受一個組合的指定範圍內的所有版本號</li> <li>舉例來說,當我們執行$ <code>npm update</code>指令時<ul> <li>例1: <code>1.0.0 || &gt;=1.1.0 &lt;1.2.0</code> =&gt; 可以更新為<code>1.0.0</code>的這個確切版本,或是也可以更新到<code>1.1.0</code>或是再其更之上的版本,但是 <strong>不能</strong> 更新為<code>1.2.0</code>或是再其更之上的版本</li> <li>例2: <code>1.2.7 || &gt;=1.2.9 &lt;2.0.0</code> =&gt; 可以更新為<code>1.2.7</code>的這個確切版本,或是也可以更新到<code>1.2.9</code>或是再其更之上的版本,但是 <strong>不能</strong> 更新為<code>1.2.8</code>或是<code>2.0.0</code>的版本</li> </ul> </li> </ul> </li> <li>語意化版本規則也有其他特殊規則</li> <li>無任何符號(no symbol): 只能接受指定的該明確版本<ul> <li>例: <code>1.2.1</code></li> </ul> </li> <li><code>latest</code>: 直接指定可用(available)且最新(latest)的該套件版本號</li> </ul> <h3 id=uninstalling-npm-packages>Uninstalling npm packages<a class=headerlink href=#uninstalling-npm-packages title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://docs.npmjs.com/cli/v7/commands/npm-uninstall>npm uninstall</a> - Remove a package<br></p> </blockquote> <ul> <li>要在本地環境(locally)解除安裝(uninstall)之前已安裝過,並且儲存在<code>node_modules/</code>資料夾中的套件(packages)。可以在該專案的根目錄(project root folder, =&gt; 也就是包含<code>node_modules/</code>資料夾的專案根目錄),並透過以下指令</li> <li>$ <code>npm uninstall &lt;package-name&gt;</code></li> <li>若想要連同<code>package.json</code>檔案中的參考(reference)也刪除掉的話,可以使用<code>-S</code>或是<code>--save</code>選項</li> <li>$ <code>npm uninstall --save &lt;package-name&gt;</code><ul> <li><code>--save</code>(=&gt; <code>-S</code>): <code>npm</code>會將該套件(package)從<code>package.json</code>檔案中的<code>dependencies</code>鍵之中移除</li> </ul> </li> <li>若此套件(package)為開發環境所使用的套件的話,可以使用<code>-D</code>或是<code>--save-dev</code>選項</li> <li>$ <code>npm uninstall --save-dev &lt;package-name&gt;</code><ul> <li><code>--save-dev</code>(=&gt; <code>-D</code>): <code>npm</code>會將該套件(package)從<code>package.json</code>檔案中的<code>devDependencies</code>鍵之中移除</li> </ul> </li> <li>若此套件(package)是在全域環境安裝的話,可以使用<code>-g</code>或是<code>--global</code>選項</li> <li>$ <code>npm uninstall -g &lt;package-name&gt;</code><ul> <li><code>--global</code>(=&gt; <code>-g</code>): <code>npm</code>會將該套件(package)從全域環境移除掉,而這時候也無需在意我們是在系統上的哪個目錄下執行該指令,因為我們是要 <strong>全域</strong> 解除安裝此套件</li> </ul> </li> <li>例: $ <code>npm uninstall -g webpack</code></li> </ul> <h3 id=npm-global-or-local-packages>npm global or local packages<a class=headerlink href=#npm-global-or-local-packages title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://docs.npmjs.com/cli/v7/commands/npx>npx</a> - Run a command from a local or remote npm package<br></p> </blockquote> <ul> <li>本地(local)與全域(global)套件(package)的主要差別是</li> <li>本地(local)套件會安裝在我們執行$ <code>npm install &lt;package-name&gt;</code>指令時的那個目錄下,並將<code>node_modules/</code>資料夾放在這個資料夾的裡面</li> <li>全域(global)套件則會安裝在作業系統中的單一個路徑下(確切來說要視各作業系統而定),這時就不會管我們是在哪裡執行$ <code>npm install -g &lt;package-name&gt;</code>指令了</li> <li>在我們的程式碼中,我們 <strong>僅能引入(require)本地(local)安裝的套件(package)</strong></li> <li>例: <code>require('package-name')</code></li> <li>所以什麼時候需要本地安裝,而什麼時候需要全域安裝套件呢?</li> <li>一般來說,所有的套件都應該要用 <strong>本地安裝</strong> (locally)<ul> <li>這樣可以確保在我們的電腦中有許多的(dozens of)應用程式(application),而這些套件也分別需要用到不同版本的相依套件時,不會混亂掉</li> </ul> </li> <li>更新全域安裝的套件會讓我們整台電腦的所有專案都被迫需要用最新版本的套件。而這也讓我們可以想像到,對於維運面來說,這會是多大的一場惡夢。因為某些套件可能會破壞(break)與其他相依套件(dependencies)之間的相容性(compatibility)</li> <li>所有的專案都有它們自己的本地安裝(local)的套件版本,即使這樣可能看似是一種浪費資源的行為,但與其可能造成的負面影響(negative consequences)相比,這樣算是非常小的"浪費"</li> <li>只有在我們需要一個可執行(executable)在<code>CLI</code>介面上的指令(command),並且這個可執行命令是能跨專案之間(across project)能被重複使用的(reused),那這時候就會需要 <strong>全域安裝套件</strong> (global)</li> <li>我們也可以本地(locally)安裝可執行命令(executable commands),並透過<code>npx</code>來執行。但是有些特定的套件(package),還是會建議用全域(globally)的方式來安裝<ul> <li>以下是一些流行且建議需要全域安裝的套件</li> <li>npm</li> <li>create-react-app</li> <li>vue-cli</li> <li>grunt-cli</li> <li>mocha</li> <li>react-native-cli</li> <li>gatsby-cli</li> <li>forever</li> <li>nodemon</li> </ul> </li> <li>可參考官方文件---<a href=https://docs.npmjs.com/cli/v7/commands/npx#npx-vs-npm-exec>npx VS npm exec</a>章節的說明</li> <li>如果我們想知道目前在我們系統中已經全域安裝的套件有哪些的話,可以透過執行以下的指令<ul> <li>$ <code>npm list -g --depth 0</code></li> <li><img alt="npm list -g --depth 0" src=../../assets/pics/nodejs/npm%20list%20-g%20--depth%200.png></li> </ul> </li> </ul> <h3 id=npm-dependencies-and-devdependencies>npm dependencies and devDependencies<a class=headerlink href=#npm-dependencies-and-devdependencies title="Permanent link">&para;</a></h3> <ul> <li>當我們透過$ <code>npm install &lt;package-name&gt;</code>指令來安裝一個<code>npm</code>上的套件時,這就是將其安裝為相依套件(dependency)</li> <li>這個被安裝的相依套件會自動地被列出在<code>package.json</code>檔案中</li> <li>如果我們加上<code>-D</code>或是<code>--save-dev</code>選項的話,<code>npm</code>就會視為要安裝作為開發環境使用的相依套件(development dependency),同時也會自動地新增到<code>package.json</code>檔案中的<code>devDependencies</code>鍵中</li> <li>開發環境的相依套件(development dependency)旨在僅用在開發環境所使用的套件(development-only packages),而這些套件也不會在生產環境(production)中所使用</li> <li>例: <code>testing packages</code> or <code>webpack</code> or <code>Babel</code></li> <li>當我們在生產環境(production)中,如果我們輸入$ <code>npm install</code>指令,並且在該目錄中已經有一個<code>package.json</code>檔案的話,則會安裝<code>package.json</code>檔案中<code>dependencies</code>屬性裡面的所有套件,因為<code>npm</code>預設會假定這是一個開發部署(development deploy)</li> <li>這時就必須要加上<code>--production</code>選項來避免安裝到那些開發環境的相依套件(development dependencies)<ul> <li>$ <code>npm install --production &lt;package-name&gt;</code></li> </ul> </li> </ul> <h3 id=the-npx-nodejs-package-runner>The npx Node.js Package Runner<a class=headerlink href=#the-npx-nodejs-package-runner title="Permanent link">&para;</a></h3> <blockquote> <p>npm的<a href=https://www.npmjs.com/package/npx>npx</a>套件---execute npm package binaries<br> <a href=https://github.com/nvm-sh/nvm>nvm</a>---nvm is a version manager for node.js, designed to be installed per-user, and invoked per-shell<br></p> </blockquote> <ul> <li><code>npx</code>是一個強大的工具,是從<code>npm</code>的<code>v5.2.0</code>(約於2017/06月)發布以後,就已經開始可以使用</li> <li>如果我們不想下載<code>npm</code>,可以透過<a href=https://www.npmjs.com/package/npx>install npx as a standalone package</a></li> <li><code>npx</code>讓我們可以在Node環境中執行程式碼,並透過<code>npm registry</code>來發布</li> <li>輕鬆地執行本地指令(local commands)</li> <li>過去,Node的開發者們通常將可執行命令(executable commands)發布為一個全域套件(global package),以使它們立即位於路徑(path)中,並且是立即可以被執行的<ul> <li>這樣其實很痛苦,因為我們確實無法在同一個指令中安裝不同的版本</li> </ul> </li> <li>執行$ <code>npx &lt;command-name&gt;</code>指令會自動地找出在該專案目錄中的<code>node_modules/</code>資料夾中的此指令的確切參考位置(correct reference of the command),而無需知道確切的路徑,也不需要在全域(global)路徑和用戶路徑中(user's path)安裝套件</li> <li>無需先安裝,就能直接執行的指令</li> <li><code>npx</code>套件的的另一個重要的功能是我們能直接執行指令(run commands),而不需要事先安裝它們<ul> <li>這個功能是非常有用的,主要是因為</li> <li>我們不需要事先安裝該套件</li> <li>我們可以透過<code>syntax @version</code>的方式來執行同一個指令的不同版本</li> </ul> </li> <li>我們用<code>npm</code>的<code>cowsay</code>套件來做個展示透過<code>npx</code>來呼叫<code>cowsay</code>套件的指令。該套件會打印(print)出一隻牛並說出我們在<code>CLI</code>介面上輸入的指令<ul> <li>舉例來說,當我們在<code>CLI</code>介面上輸入$ <code>cowsay "Hello"</code></li> <li><img alt='cowsay "Hello"' src=../../assets/pics/nodejs/cowsay%20%22Hello%22.png></li> <li>以上的方式,僅會在我們有透過<code>npm</code>全域(globally)安裝<code>cowsay</code>套件時才能使用,否則當我們執行該指令時,會得到錯誤(error)</li> <li><code>npx</code>可以使我們不必事先本地(locally)安裝,就能執行該指令</li> <li>例: $ <code>npx cowsay "Hello"</code></li> </ul> </li> <li>然而,這是一個有趣但沒有用的範,其他情境包括<ul> <li>執行<code>vue CLI</code>工具</li> <li>例: $ <code>npx @vue/cli create my-vue-app</code></li> <li>透過<code>npm</code>的<code>create-react-app</code>來建立一個新的React app</li> <li>例: $ <code>npx create-react-app my-react-app</code></li> </ul> </li> <li>透過不同的Node版本來執行程式碼</li> <li>我們可以透過<code>@</code>語法來指定一個特定的Node版本,並與<code>npm</code>的<a href=https://www.npmjs.com/package/node>node</a>套件一起搭配來使用<ul> <li>例: $ <code>npx node@10 -v</code> #v10.18.1</li> <li>例: $ <code>npx node@12 -v</code> #v12.14.1</li> </ul> </li> <li>這麼做能讓我們能不用特別去使用像是<code>nvm</code>或是其他Node的版本管理工具(Node.js version management tools)</li> <li>可以直接從<code>URL</code>上執行一段程式碼的片段(snippets)</li> <li><code>npx</code>並不會限制我們使用<code>npm</code>上面發布的套件</li> <li>我們可以利用以下的方式來直接執行<code>GitHub gist</code>上的程式碼片段<ul> <li>例: $ <code>npx https://gist.github.com/zkat/4bc19503fe9e9309e2bfaa2c58074d32</code></li> <li>當我們需要執行我們無法控制的程式碼時,需要更小心地使用<code>npx</code>工具。因為越強大的功能,帶來越大的責任</li> </ul> </li> </ul> <h3 id=the-nodejs-event-loop>The Node.js Event Loop<a class=headerlink href=#the-nodejs-event-loop title="Permanent link">&para;</a></h3> <ul> <li>事件迴圈(Event loop)是要理解Node的其中一個最重要的層面</li> <li>事件迴圈(Event loop)能解釋Node如何達到 <strong>非同步(=&gt; asynchronous)</strong> 與 <strong>非阻塞I/O(=&gt; non-blocking I/O)</strong> 。這也是讓Node能成為殺手級應用程式(killer app),並且能如此成功的原因</li> <li>Node是用 <strong>單執行緒(single thread)</strong> 在執行Javascript的程式碼,在同一個時間只會發生一件事</li> <li>這個限制其實是很有用的,因為它能大大地簡化我們在開發程式的心力,而不用去擔心併發(concurrency)的問題(issues)</li> <li>我們只要專注在如何寫程式碼,並避免任何可能阻塞(block)線程(thread)的事情,像是以下2種情況<ul> <li>同步網路呼叫(synchronous network calls)</li> <li>無限迴圈(infinite loops)</li> </ul> </li> <li>通常在大多數瀏覽器中,每個瀏覽器頁籤(browser tab)都會有一個事件循環,以使每個進程(process)都被隔離開,並避免網頁畫面落入無限迴圈(infinite loops)或是繁重的處理工作,以至於阻塞(block)整個瀏覽器</li> <li>該環境管理多個併發事件迴圈(multiple concurrent event loops),以處理像是<code>API</code>呼叫的工作。網頁工作(Web Workers)也會在其自己的事件迴圈(event loops)中執行</li> <li>我們最需要關心的是我們的程式碼會在單一事件迴圈(single event loop)上被執行,並且要牢記這一點在心中,以避免造成阻塞(blocking)</li> <li>阻擋事件迴圈(Blocking the event loop)</li> <li>任何花費太多時間才將控制權交還(return back control )給事件迴圈(event loop)的Javascript程式碼,都將阻擋(block)任何該頁面上執行的Javascript程式碼,甚至是阻塞UI線程(UI thread),並且用戶無法點擊按鈕.滑動頁面...等等</li> <li>在Javascript中,幾乎所有的 <strong>I/O原語(=&gt; I/O primitives)</strong> 都是 <strong>非阻塞I/O(=&gt; non-blocking I/O)</strong> 的,例如以下2種情境<ul> <li>網路請求(Network requests)</li> <li>檔案系統操作(filesystem operations)</li> <li>...等等</li> </ul> </li> <li>被阻塞是一種例外,這也就是為什麼Javascript會有這麼多基於回呼函式(<code>callbacks</code>)的東西,而近年來也開始有<code>Promise</code>與<code>async/await</code></li> <li>呼叫堆疊(The call stack)</li> <li>呼叫堆疊是一種<code>LIFO</code>隊列(queue),也就是後進-&gt;先出(Last in, First out)的模式</li> <li>事件迴圈(event loop)會持續地檢查是否在呼叫堆疊(call stack)中仍有任何函式(function)需要被執行</li> <li>這樣做時,它會將任何所有能找到的函式都加入到呼叫堆疊(call stack)中,並依序執行每個函式</li> <li>我們會知道自己對於除錯器(debugger)或是瀏覽器控制台(browser console)中,會比較熟悉用哪個方式來追蹤錯誤堆疊(error stack trace)<ul> <li>瀏覽器會在呼叫堆疊(call stack)中查詢函式(function)的名稱,以通知我們是哪個函式產生(originates)了當前的呼叫(current call)</li> <li><img alt=exception-call-stack src=../../assets/pics/nodejs/exception-call-stack.png></li> </ul> </li> <li>一個簡單的事件迴圈說明範例 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=kd>const</span><span class=w> </span><span class=nx>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=kd>const</span><span class=w> </span><span class=nx>baz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;baz&#39;</span><span class=p>)</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=kd>const</span><span class=w> </span><span class=nx>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=w>  </span><span class=nx>bar</span><span class=p>()</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=w>  </span><span class=nx>baz</span><span class=p>()</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=p>}</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=nx>foo</span><span class=p>()</span>
</span></code></pre></div></li> <li>當以上的程式碼被執行時<ul> <li>首先,是<code>foo()</code>被呼叫</li> <li>接著,在<code>foo()</code>中,會呼叫<code>bar()</code></li> <li>最後,會呼叫<code>baz()</code></li> </ul> </li> <li>此時,呼叫堆疊(call stack)會看起來如下圖所示<ul> <li><img alt=call-stack-first-example src=../../assets/pics/nodejs/call-stack-first-example.png></li> </ul> </li> <li>每次迭代中的事件迴圈都會查看在呼叫堆疊(call stack)中是否有東西,並執行它,直到呼叫堆疊(call stack)變成空的(empty)為止<ul> <li><img alt=execution-order-first-example src=../../assets/pics/nodejs/execution-order-first-example.png></li> </ul> </li> <li>函式執行隊列(Queuing function execution)</li> <li>以上的範例看起來很正常,並沒有什麼特別之處。Javascript會尋找要執行的東西,並且依序執行它們</li> <li>讓我們來看看另一個範例,如何將函式(function)推遲(defer)到堆疊(stack)被清除掉之前 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>baz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;baz&#39;</span><span class=p>)</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>bar</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>)</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=w>    </span><span class=nx>baz</span><span class=p>()</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=w>  </span><span class=nx>foo</span><span class=p>()</span>
</span></code></pre></div><ul> <li>以上的範例程式碼中的<code>setTimeout(() =&gt; {}, 0)</code>會去呼叫一個函式(function),一旦這段程式碼中的每個其它函式執行一次,便會執行一次該函式</li> <li>這個範例打印(print)出來的結果也許會令我們非常驚訝 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=w>  </span><span class=nx>foo</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=w>  </span><span class=nx>baz</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>  </span><span class=nx>bar</span>
</span></code></pre></div></li> <li>說明: 當這段程式碼被執行時</li> <li>首先,是<code>foo()</code>被呼叫</li> <li>接著,在<code>foo()</code>內部會先呼叫<code>setTimeout()</code>,並將<code>bar</code>作為參數(argument),並指示(instruct)它盡快地執行,並傳遞<code>0</code>作為計時器(timer)</li> <li>最後,會呼叫<code>baz()</code></li> <li>此時,呼叫堆疊(call stack)會看起來如下圖所示</li> <li><img alt=call-stack-second-example src=../../assets/pics/nodejs/call-stack-second-example.png></li> <li>以下是程式(program)中的所有函式的執行順序</li> <li><img alt=execution-order-second-example src=../../assets/pics/nodejs/execution-order-second-example.png></li> </ul> </li> <li>為什麼會這樣呢? 我們接著看下去</li> <li>訊息隊列(Message Queue)</li> <li>當<code>setTimeout()</code>函式被呼叫時,瀏覽器與Node會啟動一個計時器。當計時器到期時,也就是說在這個情況下,我們將延遲(delay)參數設定為<code>0</code>,此時"延遲(delay)"就會立即到期,也會將回呼函式(callback function)放入訊息隊列(Message Queue)中</li> <li>在訊息隊列(Message Queue)中,使用者初始化的事件(user-initiated events)像是滑鼠點擊(click),鍵盤事件(keyboard events),獲取回應(fetch responses)都將在此排隊(queued)。然後我們才有機會對其做出反應(react),或像是<code>DOM事件</code>---&gt;<code>window.onLoad</code></li> <li><strong>事件迴圈(event loop)將會優先處理呼叫堆疊(call stack),並首先處理(processes)在呼叫堆疊中找到的所有內容。一旦呼叫堆疊中沒有任何內容了,它就會開始到訊息隊列(message queue)中處理內容</strong><ul> <li>我們不必等待像是<code>setTimeout()</code>函式,抓取資料(fetch),或是其它函式來完成它們自己的工作,因為它們是由瀏覽器所提供的,而且它們都位於自己的線程中(threads)</li> <li>舉例來說,如果將<code>setTimeout(function[, delay])</code>函式的<code>delay</code>(延遲)-&gt;這個參數設定為<code>2</code>秒,我們不需要真的去等待2秒,它會在其它地方發生</li> </ul> </li> <li>ES6工作隊列(ES6 Job Queue)</li> <li>ES6(= ECMAScript 2015)引進(introduced)了工作隊列(job queue)的觀念,並且透過<code>Promise</code>物件來使用工作隊列(job queue)<ul> <li>補充: <a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise>Promise</a>物件也是從ES6開始引進的</li> <li><strong>Promise物件</strong> 是一種盡快地執行 <strong>非同步函式(async function)</strong> 的一種方式,而不是(rather than)放在呼叫堆疊(call stack)的最後面</li> <li>那些在當前函式結束之前已經解決(resolve)的<code>Promise</code>物件, <strong>將在當前函式之後立即被執行</strong></li> <li>我發現可以用遊樂園的過山車設施來做個比喻會更好,訊息隊列(message queue)會將我們放在隊列(queue)的後面,在所有其他人的後面,而我們會因此需要等到輪到我們為止。然而,工作隊列(job queue)就是快速通關券讓我們能夠搭乘完一個遊樂設施之後 <strong>緊接著</strong> 再搭乘下一個遊樂設施</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=kd>const</span><span class=w> </span><span class=nx>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=kd>const</span><span class=w> </span><span class=nx>baz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;baz&#39;</span><span class=p>)</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=kd>const</span><span class=w> </span><span class=nx>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>bar</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>)</span>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=w>  </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=w>    </span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;should be right after baz, before bar&#39;</span><span class=p>)</span>
</span><span id=__span-66-10><a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a><span class=w>  </span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>resolve</span><span class=p>))</span>
</span><span id=__span-66-11><a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a><span class=w>  </span><span class=nx>baz</span><span class=p>()</span>
</span><span id=__span-66-12><a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a><span class=p>}</span>
</span><span id=__span-66-13><a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a>
</span><span id=__span-66-14><a id=__codelineno-66-14 name=__codelineno-66-14 href=#__codelineno-66-14></a><span class=nx>foo</span><span class=p>()</span>
</span></code></pre></div></li> <li>以上的範例程式碼將會回傳 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=nx>foo</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=nx>baz</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=nx>should</span><span class=w> </span><span class=nx>be</span><span class=w> </span><span class=nx>right</span><span class=w> </span><span class=nx>after</span><span class=w> </span><span class=nx>baz</span><span class=p>,</span><span class=w> </span><span class=nx>before</span><span class=w> </span><span class=nx>bar</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=nx>bar</span>
</span></code></pre></div></li> </ul> </li> <li>這是<code>Promises</code>(和基於<code>Promise</code>建構的<code>Async/ await</code>)&harr;與透過<code>setTimeout()</code>或其它平台API的普通,舊的非同步函數(asynchronous functions)之間的巨大區別</li> </ul> <h3 id=understanding-processnexttick>Understanding process.nextTick()<a class=headerlink href=#understanding-processnexttick title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<code>Process</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_nexttick_callback_args>process.nextTick(callback[, ...args])</a>---process.nextTick() adds callback to the "next tick queue". This queue is fully drained after the current operation on the JavaScript stack runs to completion and before the event loop is allowed to continue. It's possible to create an infinite loop if one were to recursively call process.nextTick()<br></p> </blockquote> <ul> <li>當我們嘗試理解Node的事件迴圈(event loop)時,<code>process.nextTick()</code>方法就是它一個重要的部分</li> <li>每次事件迴圈經過完整的一趟(full trip)時,我們稱其為<code>tick</code></li> <li>當我們傳遞一個函式(function)給<code>process.nextTick()</code>方法時,會指示(instruct)引擎(engine)於當前操作結束之後,並且於下一個事件迴圈(event loop)<code>tick</code>開始之前,呼叫(invoke)此方法(<code>process.nextTick()</code>)</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=w>  </span><span class=c1>//do something</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=p>})</span>
</span></code></pre></div><ul> <li>該事件迴圈(event loop)正忙於處理當前的程式碼</li> <li>當該操作結束後,Javascript引擎(engine)會以非同步(asynchronouly)的方式來處理函式(function)</li> </ul> </li> <li>呼叫<code>setTimeout(() =&gt; {}, 0)</code>方法會在下一個<code>tick</code>結束之後才執行函式,比起使用<code>nextTick()</code>方法需要在下一個<code>tick</code>開始之前,優先呼叫和執行它,相對慢很多</li> <li>建議使用<code>process.nextTick()</code>方法來確保在下一次事件迴圈(event loop)迭代(iteration)中,已經執行了程式碼</li> </ul> <h3 id=understanding-setimmediate>Understanding setImmediate()<a class=headerlink href=#understanding-setimmediate title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/api/timers.html#timers_setimmediate_callback_args>setImmediate(callback[, ...args])</a>---Schedules the "immediate" execution of the callback after I/O events' callbacks.<br> Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/api/timers.html#timers_settimeout_callback_delay_args>setTimeout(callback[, delay[, ...args]])</a>---Schedules execution of a one-time callback after delay milliseconds.<br></p> </blockquote> <ul> <li>當我們想要讓某個片段的程式碼立即被執行時,其中一個選擇是可以使用Node提供的<code>setImmediate()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=nx>setImmediate</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=w>  </span><span class=c1>//run something</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=p>})</span>
</span></code></pre></div><ul> <li>任何函式作為參數傳遞給<code>setImmediate()</code>方法,都會在下一次事件迴圈(event loop)迭代(iteration)被當作回呼函式(callback)執行</li> </ul> </li> <li><code>setImmediate()</code>與<code>setTimeout(() =&gt; {}, 0)</code>與<code>process.nextTick()</code>三者有什麼不同呢?<ul> <li>當傳遞一個函式(function)給<code>process.nextTick()</code>方法時,該函式會在當前操作(current operation)之後,並於當前事件迴圈(event loop)的迭代中(current iteration)被執行</li> <li>這也意味著<code>process.nextTick()</code>方法總是會在<code>setTimeout()</code>方法 &amp; <code>setImmediate()</code>方法之前被執行</li> <li>當設定<code>setTimeout(callback[, delay[, ...args]])</code>方法的延遲(<code>delay</code>)參數為<code>0</code>毫秒時,這時該方法會非常類似於<code>setImmediate()</code>方法。執行順序將取決於不同的因素所影響,但它們都會在下一次事件迴圈(event loop)的迭代中(current iteration)被執行</li> </ul> </li> </ul> <h3 id=discover-javascript-timers>Discover JavaScript Timers<a class=headerlink href=#discover-javascript-timers title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_settimeout_callback_delay_args>setTimeout(callback[, delay[, ...args]])</a>---Schedules execution of a one-time callback after delay milliseconds.<br> Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_setinterval_callback_delay_args>setInterval(callback[, delay[, ...args]])</a>---Schedules repeated execution of callback every delay milliseconds.<br> Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_cleartimeout_timeout>clearTimeout(timeout)</a>---Cancels a Timeout object created by setTimeout().<br> Node內建核心模組<code>Timers</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_setimmediate_callback_args>setImmediate(callback[, ...args])</a>---Schedules the "immediate" execution of the callback after I/O events' callbacks.<br></p> </blockquote> <ul> <li><code>setTimeout()</code>方法</li> <li>當我們在撰寫Javascript程式碼時,有時我們會希望延遲(delay)某些函式的執行</li> <li>這就是<code>setTimeout()</code>方法在做的事情。我們可以指定一個要延遲執行的回呼函式(callback function),並且指定一個想要延遲執行的時間(以毫秒為單位) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=w>  </span><span class=c1>// runs after 2 seconds</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=w>  </span><span class=c1>// runs after 50 milliseconds</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=p>},</span><span class=w> </span><span class=mf>50</span><span class=p>)</span>
</span></code></pre></div><ul> <li>這個語法定義了一個新的函式,讓我們可以撰寫任何我們想要執行的函式,或是填入我們想要呼叫的函式並給一組參數(a set of parameters) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myFunction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>firstParam</span><span class=p>,</span><span class=w> </span><span class=nx>secondParam</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=w>  </span><span class=c1>// do something</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=p>}</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=c1>// runs after 2 seconds</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>myFunction</span><span class=p>,</span><span class=w> </span><span class=mf>2000</span><span class=p>,</span><span class=w> </span><span class=nx>firstParam</span><span class=p>,</span><span class=w> </span><span class=nx>secondParam</span><span class=p>)</span>
</span></code></pre></div></li> <li><code>setTimeout()</code>方法會回傳一個計時器ID(Timer ID),通常我們不會用到這個計時器ID,但是我們仍然可以將這個計時器ID記下來 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=kd>const</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=w>  </span><span class=c1>// should run after 2 seconds</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=c1>// I changed my mind</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></code></pre></div></li> <li>當我們想要將這個排定要執行的函式取消時,就會需要用到這個計時器ID</li> </ul> </li> <li>零延遲執行(Zero delay)<ul> <li>當我們指定要延遲的時間為<code>0</code>毫秒時,該回呼函式就會盡快地立即被執行,並且在當前的回呼函式(callback function)執行完後 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;after &#39;</span><span class=p>)</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=p>},</span><span class=w> </span><span class=mf>0</span><span class=p>)</span>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a>
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39; before &#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>以上的範例會打印(print)出<code>before after</code></li> <li>這個做法( <strong>將函式加入調度器(scheduler)的排隊(queuing)中</strong> )對於在密集任務時,用來避免CPU資源的阻塞 or 對於要執行繁重的計算時,能讓其他函式先被執行是非常有用的</li> </ul> </li> <li>有些瀏覽器(例如: <code>IE</code>或是<code>Edge</code>)會實作<code>setImmediate()</code>方法也能達到相同的功能,但那樣做不算是標準的,而且也無法在其它瀏覽器中使用。但是這算是Node的標準功能之一<ul> <li>關於<code>setImmediate()</code>方法對於各瀏覽器的支援,可參考<a href=https://caniuse.com/setimmediate>Efficient Script Yielding: setImmediate()</a></li> </ul> </li> <li><code>setInterval()</code>方法</li> <li><code>setInterval()</code>方法與<code>setTimeout()</code>方法很類似,兩者的差別是<ul> <li><code>setInterval()</code>方法會永遠執行下去,而不是只執行一次,並且我們可以指定想要的間隔執行時間(以毫秒為單位) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=w>  </span><span class=c1>// runs every 2 seconds</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span></code></pre></div></li> <li>以上的範例程式碼,會持續每2秒執行一次,直到我們利用<code>clearInterval()</code>方法來停止(stop)它 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=kd>const</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=w>  </span><span class=c1>// runs every 2 seconds</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></code></pre></div></li> <li>而要停止<code>clearInterval()</code>方法,需要傳遞給該方法間隔器ID(interval ID, =&gt; 由<code>setInterval()</code>方法所回傳的)</li> <li>常見的做法會是在<code>setInterval()</code>回呼函式中呼叫<code>clearInterval()</code>方法,來讓<code>setInterval()</code>方法自己自動地決定是否要再執行一次(again)或是停止(stop) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=kd>const</span><span class=w> </span><span class=nx>interval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>App</span><span class=p>.</span><span class=nx>somethingIWait</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;arrived&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=w>    </span><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>interval</span><span class=p>)</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=w>  </span><span class=c1>// otherwise do things</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=p>},</span><span class=w> </span><span class=mf>100</span><span class=p>)</span>
</span></code></pre></div></li> <li>以上的範例程式碼,會在執行某些東西後,直到<code>App.somethingIWait</code>這個屬性的值等於<code>'arrived'</code>字串時,才會停止</li> </ul> </li> <li>遞迴計時器(Recursive Timeout)<ul> <li><code>setInterval()</code>方法會啟動一個每<code>n</code>豪秒執行一次的函式,而無須考慮該函式何時會執行完畢</li> <li>如果有一個函式,每次都會花相同的時間才會執行完畢,那就不會有問題</li> <li><img alt=setinterval-ok src=../../assets/pics/nodejs/setinterval-ok.png></li> <li>也有可能該函式每次會因為網路速度的情況(network conditions),花費不同的時間才會執行完畢</li> <li><img alt=setinterval-varying-duration src=../../assets/pics/nodejs/setinterval-varying-duration.png></li> <li>也因此只要任何一次需要花費比較長的時間才會執行完畢的回呼函式就會與下一次要執行的時間 <strong>重疊</strong> (overlaps)</li> <li><img alt=setinterval-overlapping src=../../assets/pics/nodejs/setinterval-overlapping.png></li> <li>為了避免上述 <strong>重疊</strong> 的情況,我們可以在回呼函式(callback function)執行完畢後,再安排一個遞迴計時器(recursive timeout) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myFunction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=w>  </span><span class=c1>// do something</span>
</span><span id=__span-77-3><a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a>
</span><span id=__span-77-4><a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>myFunction</span><span class=p>,</span><span class=w> </span><span class=mf>1000</span><span class=p>)</span>
</span><span id=__span-77-5><a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=p>}</span>
</span><span id=__span-77-6><a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a>
</span><span id=__span-77-7><a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>myFunction</span><span class=p>,</span><span class=w> </span><span class=mf>1000</span><span class=p>)</span>
</span></code></pre></div></li> <li>當達成(achieve)這個遞迴計時器(recursive timeout)的情境(scenario),會如下圖所示<ul> <li><img alt=recursive-settimeout src=../../assets/pics/nodejs/recursive-settimeout.png></li> </ul> </li> </ul> </li> <li><code>setTimeout()</code>與<code>setInterval()</code>皆為Node的內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_timers>Timers</a>的方法</li> <li>Node也提供<code>setImmediate()</code>方法,這個方法就相當於使用<code>setTimeout(() =&gt; {}, 0)</code>,主要用來搭配Node的事件迴圈(event loop)使用</li> </ul> <h3 id=javascript-asynchronous-programming-and-callbacks>JavaScript Asynchronous Programming and Callbacks<a class=headerlink href=#javascript-asynchronous-programming-and-callbacks title="Permanent link">&para;</a></h3> <ul> <li>程式語言的非同步性(asynchronicity)</li> <li>電腦都是設計可以非同步的,非同步(asynchronous)意味著事件可以獨立於(independently)主程式流(the main program flow)發生(happen)</li> <li>在當前的消費者電腦(consumer computers)中,每個程式都會運行一個特定的時間段(time slot)後,然後停止運行,以讓其它程式可以繼續執行。這個循環運行得很快,以至於我們通常不會注意到,我們會以為是我們的電腦能同時(simultaneously)執行多個程式,事實上這只是一個幻覺(illusion)</li> <li>我們這邊不會深入探討這個觀念,但是我們必須要把這個觀念視為一個正常的情況,也就是程式可以是非同步(asynchronous)執行的,直到他們需要被注意時才會停止(halt),這也能讓電腦能同時(in the meantime)執行其它事情<ul> <li>當程式正在等待來自網路的回應(response from the network)時,該程式是無法在請求完成之前停止(halt)處理器(processor)的</li> </ul> </li> <li>正常來說,程式語言是同步的(synchronous),其中有些程式語言有提供方法來管理非同步性(asynchronicity)或是透過函式庫(library)來處理<ul> <li>預設情況下,<code>C</code>、<code>Java</code>、<code>C#</code>、<code>PHP</code>、<code>Go</code>、<code>Ruby</code>、<code>Swift</code>、<code>Python</code>都是非同步(asynchronous)的</li> <li>其中一些程式語言 <strong>透過線程(thread)來處理非同步(async)行為,從而產生(spawning)一個新的進程(process)</strong></li> </ul> </li> <li>Javascript</li> <li><strong>Javascript程式語言,預設是同步(synchronous)且單執行緒(single threaded)的</strong> 。這意味著程式碼不能創造新的線程(threads),並平行(parallel)執行 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=kd>const</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span>
</span><span id=__span-78-2><a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=kd>const</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>2</span>
</span><span id=__span-78-3><a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a><span class=kd>const</span><span class=w> </span><span class=nx>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>b</span>
</span><span id=__span-78-4><a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>
</span><span id=__span-78-5><a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a><span class=nx>doSomething</span><span class=p>()</span>
</span></code></pre></div><ul> <li>雖然以上的範例程式碼"看起來"是依序執行的,但是Javascript這個程式語言,起初是誕生於瀏覽器(browser)的,它一開始的工作是用來回應(response)使用者的行為(user actions),像是<code>onClick</code>、<code>onMouseOver</code>、<code>OnChange</code>、<code>OnSubmit</code>...等等。該如何使用同步程式設計模型(synchronous programming model)來做到這些事情呢?</li> <li>答案是它的"環境"(environment)。瀏覽器(browser)會透過提供一組能夠處理這種功能的APIs來完成這一點</li> <li>最近,Node引進(introduced)了一個非阻塞I/O環境(non-blocking I/O environment)來將該概念(concept)延伸(extend)到文件存取(file access)、網路呼叫(network calls)...等等</li> </ul> </li> <li>回呼函式(Callbacks)</li> <li>因為我們無法得知使用者何時會點擊按鈕,所以我們可以對該點擊事件(click event)定義(define)一個事件處理器(event handler)。這個事件處理器(event handler)會接受(accepts)一個函式(function),而這個函式會在該事件被觸發(triggered)時呼叫 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;button&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=w>  </span><span class=c1>//item clicked</span>
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=p>})</span>
</span></code></pre></div><ul> <li>而這也就是所謂的"回呼函式"(callback)</li> </ul> </li> <li><strong>回呼函式(callback function)是一個簡單的函式,能夠作為值傳遞給另一個函式,並且僅在事件被觸發時才會執行</strong><ul> <li>我們可以這樣做的原因是,在Javascript這個程式語言中,有一級函式(first-class functions)這種東西,也就是函式能作為值並指派給變數,再傳遞給其他函式(=&gt; 這種函式被稱作"高階函式", (higher-order functions))</li> <li>常見的做法是將客戶端的程式碼包裝在<code>window</code>物件的<code>load</code>事件監聽器(event listener),它只會在頁面準備好時才會執行回呼函式 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-80-2><a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a><span class=w>  </span><span class=c1>//window loaded</span>
</span><span id=__span-80-3><a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a><span class=w>  </span><span class=c1>//do what you want</span>
</span><span id=__span-80-4><a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a><span class=p>})</span>
</span></code></pre></div></li> <li>回呼函式(Callbacks)還有用在很多地方,而不只是在<code>DOM</code>事件中</li> <li>另一個常見的做法是使用計時器(timers) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a><span class=w>  </span><span class=c1>// runs after 2 seconds</span>
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span></code></pre></div></li> <li>另外,<code>XHR</code>請求(requests)也能接受回呼函式(callback function),在以下的範例程式碼中,透過指定一個函式給當一個特定的事件(particular event)發生(occur)時會呼叫的屬性(property)</li> <li>在這次的範例中,所謂特定的事件就是代表請求的狀態發生改變時(the state of the request changes) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a><span class=kd>const</span><span class=w> </span><span class=nx>xhr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>XMLHttpRequest</span><span class=p>()</span>
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a><span class=nx>xhr</span><span class=p>.</span><span class=nx>onreadystatechange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-82-3><a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>xhr</span><span class=p>.</span><span class=nx>readyState</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>4</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-82-4><a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a><span class=w>    </span><span class=nx>xhr</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>xhr</span><span class=p>.</span><span class=nx>responseText</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span><span id=__span-82-5><a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-82-6><a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a><span class=p>}</span>
</span><span id=__span-82-7><a id=__codelineno-82-7 name=__codelineno-82-7 href=#__codelineno-82-7></a><span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;https://yoursite.com&#39;</span><span class=p>)</span>
</span><span id=__span-82-8><a id=__codelineno-82-8 name=__codelineno-82-8 href=#__codelineno-82-8></a><span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>()</span>
</span></code></pre></div></li> </ul> </li> <li>在回呼函式中處理錯誤(Handling errors in callbacks)</li> <li>我們平常會如何處理(handle)回呼函式(callbacks)的錯誤(errors)呢?<ul> <li>一個很常見的策略(strategy)是利用Node所採取的方法,也就是在任何一個回呼函式中的第一個參數(first parameter)就是錯誤(<code>error</code>)物件: <strong>error-first callbacks</strong></li> <li>如果沒有發生錯誤(<code>error</code>)的話,該物件的值就是<code>null</code>; 而如果有發生錯誤(<code>error</code>)的話,該錯誤(<code>error</code>)物件就會包括關於這個錯誤(<code>error</code>)的一些描述(description)以及其他資訊(information) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;/file.json&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-2><a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-3><a id=__codelineno-83-3 name=__codelineno-83-3 href=#__codelineno-83-3></a><span class=w>    </span><span class=c1>//handle error</span>
</span><span id=__span-83-4><a id=__codelineno-83-4 name=__codelineno-83-4 href=#__codelineno-83-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-83-5><a id=__codelineno-83-5 name=__codelineno-83-5 href=#__codelineno-83-5></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-83-6><a id=__codelineno-83-6 name=__codelineno-83-6 href=#__codelineno-83-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-83-7><a id=__codelineno-83-7 name=__codelineno-83-7 href=#__codelineno-83-7></a>
</span><span id=__span-83-8><a id=__codelineno-83-8 name=__codelineno-83-8 href=#__codelineno-83-8></a><span class=w>  </span><span class=c1>//no errors, process data</span>
</span><span id=__span-83-9><a id=__codelineno-83-9 name=__codelineno-83-9 href=#__codelineno-83-9></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-83-10><a id=__codelineno-83-10 name=__codelineno-83-10 href=#__codelineno-83-10></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li>回呼函式的問題(The problem with callbacks)</li> <li>回呼函式(Callbacks)很適合用於簡單的情境中</li> <li>然而每一個回呼函式都會增加一層巢狀(nesting),這時候如果我們有很多的回呼函式(callbacks),程式碼很快地就會開始變得複雜 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a><span class=w>  </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;button&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-84-3><a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-84-4><a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a><span class=w>      </span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>item</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-84-5><a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a><span class=w>        </span><span class=c1>//your code here</span>
</span><span id=__span-84-6><a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a><span class=w>      </span><span class=p>})</span>
</span><span id=__span-84-7><a id=__codelineno-84-7 name=__codelineno-84-7 href=#__codelineno-84-7></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span><span id=__span-84-8><a id=__codelineno-84-8 name=__codelineno-84-8 href=#__codelineno-84-8></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-84-9><a id=__codelineno-84-9 name=__codelineno-84-9 href=#__codelineno-84-9></a><span class=p>})</span>
</span></code></pre></div><ul> <li>以上的範例程式碼只是4層的程式碼,但是可能會有更多層的程式碼,這樣就不好玩了</li> <li>那我們該怎麼解決這個問題呢?</li> </ul> </li> <li>回呼函式的替代方案(Alternatives to callbacks)</li> <li><strong>從ES6開始</strong> ,Javascript程式語言開始引進(introduced)了許多能夠不涉及(do not involve)使用回呼函式(callbacks)來處理非同步(asynchronous)程式碼的功能,例如以下2種功能<ul> <li><code>Promise</code>物件 (ES6)</li> <li><code>Async/Await</code>語法 (ES8)</li> </ul> </li> </ul> <h3 id=understanding-javascript-promises>Understanding JavaScript Promises<a class=headerlink href=#understanding-javascript-promises title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise>Promise物件 (by MDN官方文件)</a> --- The Promise object represents the eventual completion (or failure) of an asynchronous operation and its resulting value.<br> <a href=https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Using_promises>如何使用Promise物件 (by MDN官方文件)</a><br> <a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API>Fetch API (by MDN官方文件)</a> --- The Fetch API provides an interface for fetching resources (including across the network). It will seem familiar to anyone who has used XMLHttpRequest, but the new API provides a more powerful and flexible feature set.<br></p> </blockquote> <ul> <li>Promise物件的介紹 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=kd>let</span><span class=w> </span><span class=nx>done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-85-2><a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a>
</span><span id=__span-85-3><a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=kd>const</span><span class=w> </span><span class=nx>isItDoneYet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-4><a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>done</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-5><a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>workDone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Here is the thing I built&#39;</span>
</span><span id=__span-85-6><a id=__codelineno-85-6 name=__codelineno-85-6 href=#__codelineno-85-6></a><span class=w>    </span><span class=nx>resolve</span><span class=p>(</span><span class=nx>workDone</span><span class=p>)</span>
</span><span id=__span-85-7><a id=__codelineno-85-7 name=__codelineno-85-7 href=#__codelineno-85-7></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-8><a id=__codelineno-85-8 name=__codelineno-85-8 href=#__codelineno-85-8></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>why</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Still working on something else&#39;</span>
</span><span id=__span-85-9><a id=__codelineno-85-9 name=__codelineno-85-9 href=#__codelineno-85-9></a><span class=w>    </span><span class=nx>reject</span><span class=p>(</span><span class=nx>why</span><span class=p>)</span>
</span><span id=__span-85-10><a id=__codelineno-85-10 name=__codelineno-85-10 href=#__codelineno-85-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-85-11><a id=__codelineno-85-11 name=__codelineno-85-11 href=#__codelineno-85-11></a><span class=p>})</span>
</span><span id=__span-85-12><a id=__codelineno-85-12 name=__codelineno-85-12 href=#__codelineno-85-12></a>
</span><span id=__span-85-13><a id=__codelineno-85-13 name=__codelineno-85-13 href=#__codelineno-85-13></a><span class=kd>const</span><span class=w> </span><span class=nx>checkIfItsDone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-14><a id=__codelineno-85-14 name=__codelineno-85-14 href=#__codelineno-85-14></a><span class=w>  </span><span class=nx>isItDoneYet</span>
</span><span id=__span-85-15><a id=__codelineno-85-15 name=__codelineno-85-15 href=#__codelineno-85-15></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>ok</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-16><a id=__codelineno-85-16 name=__codelineno-85-16 href=#__codelineno-85-16></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>ok</span><span class=p>)</span>
</span><span id=__span-85-17><a id=__codelineno-85-17 name=__codelineno-85-17 href=#__codelineno-85-17></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-85-18><a id=__codelineno-85-18 name=__codelineno-85-18 href=#__codelineno-85-18></a><span class=w>    </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-85-19><a id=__codelineno-85-19 name=__codelineno-85-19 href=#__codelineno-85-19></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-85-20><a id=__codelineno-85-20 name=__codelineno-85-20 href=#__codelineno-85-20></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-85-21><a id=__codelineno-85-21 name=__codelineno-85-21 href=#__codelineno-85-21></a><span class=p>}</span>
</span><span id=__span-85-22><a id=__codelineno-85-22 name=__codelineno-85-22 href=#__codelineno-85-22></a>
</span><span id=__span-85-23><a id=__codelineno-85-23 name=__codelineno-85-23 href=#__codelineno-85-23></a><span class=nx>checkIfItsDone</span><span class=p>()</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會打印出<code>Here is the thing I built</code></li> </ul> </li> <li><strong><code>Promise</code>物件通常會被定義為一個最終(eventually)將會變成一個可用的(available)代理值(a proxy for a value)</strong></li> <li><code>Promise</code>物件是一種能處理非同步(asynchronous)程式碼的方法,而不用陷入回呼地獄(callback hell)<ul> <li>可參考<a href=http://callbackhell.com/ >callback hell</a></li> </ul> </li> <li>自從2015年(ES6的標準化與引入)開始後,<code>Promise</code>物件已經成為Javascript程式語言的一部分了,並且在近年來更與ES8的<code>Async/Await</code>語法整合得更好<ul> <li>非同步函式(Async functions)會在背景中(behind the scenes)使用<code>Promise</code>物件,所以了解<code>Promise</code>物件運作的原理 &amp; 理解<code>Async/Await</code>語法是如何作用的是非常重要的</li> </ul> </li> <li><code>Promise</code>物件簡單來說是如何運作的呢?<ul> <li>一旦<code>Promise</code>物件被呼叫後,它將會以待處理狀態(pending state)開始。這意味著被呼叫的函式(calling function)將會繼續執行,然而<code>Promise</code>物件仍然處於待處理狀態(<code>pending</code>),直到被解決(<code>resolves</code>)為止,進而將所請求到的任何數據傳遞給其呼叫的函式(calling function)</li> <li>建立出來的<code>Promise</code>物件最終(eventually)將會 <strong>已解決的狀態(resolved state)</strong> 或是 <strong>被拒絕的狀態(rejected state)</strong> 結束(end in),並呼叫各自對應的(respective)回呼函式(callback functions),再傳遞給<code>then()</code>與<code>catch()</code>之後就會立即結束(upon finishing)</li> </ul> </li> <li>有哪些Javascript的APIs會使用到<code>Promise</code>物件呢?<ul> <li>在我們自己的程式碼或是函式庫(library)的程式碼中,標準的現代化Web APIs也會使用到<code>Promise</code>物件,像是以下3種Web APIs</li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Battery_Status_API>the Battery API</a></li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API/Using_Fetch>the Fetch API</a></li> <li><a href=https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker>Service Workers</a></li> <li>在現代化的Javascript中,我們不太可能會發現自己沒有在使用<code>Promise</code>物件,所以讓我們開始深入鑽研它吧!</li> </ul> </li> <li>創造一個承諾物件</li> <li><code>Promise</code>物件API會公開(exposes)一個建構子(constructor),我們可以使用<code>new Promise()</code>的語法來初始化一個<code>Promise</code>物件 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=kd>let</span><span class=w> </span><span class=nx>done</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a>
</span><span id=__span-86-3><a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a><span class=kd>const</span><span class=w> </span><span class=nx>isItDoneYet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-86-4><a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>done</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-86-5><a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>workDone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Here is the thing I built&#39;</span>
</span><span id=__span-86-6><a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a><span class=w>    </span><span class=nx>resolve</span><span class=p>(</span><span class=nx>workDone</span><span class=p>)</span>
</span><span id=__span-86-7><a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-86-8><a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>why</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Still working on something else&#39;</span>
</span><span id=__span-86-9><a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a><span class=w>    </span><span class=nx>reject</span><span class=p>(</span><span class=nx>why</span><span class=p>)</span>
</span><span id=__span-86-10><a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-86-11><a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a><span class=p>})</span>
</span></code></pre></div><ul> <li>如我們所見,這個<code>Promise</code>物件會檢查全域的<code>done</code>常數(global constant),而如果<code>done</code>這個全域常數的值為<code>true</code>的話,則<code>Promise</code>物件就會進入已解決的狀態(resolved state) (由於<code>resolve</code>回呼函式已經被呼叫); 否則,<code>reject</code>回呼函式就會被執行,並將<code>Promise</code>物件變成被拒絕的狀態(rejected state)<ul> <li>而如果上述的2種函式(<code>resolve</code> callback function &amp; <code>reject</code> callback function)都沒有被呼叫的話,<code>Promise</code>物件就會維持為待處理狀態(<code>pending</code> state)</li> </ul> </li> <li>我們可以利用<code>resolve</code>與<code>reject</code>兩個語法來將<code>Promise</code>物件的結果狀態(resulting state) &amp; 將如何處理的方法 回傳給呼叫方(caller)。在上述的範例程式碼中,我們僅回傳一個字串(string),但其實也可以回傳一個物件(object)或甚至是<code>null</code></li> <li>因為我們已經在上述的範例程式碼摘錄(snippet)中,建立了一個<code>Promise</code>物件,<strong>因此它已經開始執行了</strong>。這將會有助於我們了解以下的"如何使用<code>Promise</code>物件"章節</li> </ul> </li> <li>另一個我們可能會碰到的更常見做法是一種被稱為 <strong>Promisifying</strong> 的技術。這種技術是一個能夠使用古典的Javascript函式來接收(takes)一個回呼函式(callback),並使其回傳一個<code>Promise</code>物件 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-87-1><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-87-2><a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a>
</span><span id=__span-87-3><a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a><span class=kd>const</span><span class=w> </span><span class=nx>getFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>fileName</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-87-4><a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-87-5><a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a><span class=w>    </span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=nx>fileName</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-87-6><a id=__codelineno-87-6 name=__codelineno-87-6 href=#__codelineno-87-6></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-87-7><a id=__codelineno-87-7 name=__codelineno-87-7 href=#__codelineno-87-7></a><span class=w>        </span><span class=nx>reject</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w>  </span><span class=c1>// calling `reject` will cause the promise to fail with or without the error passed as an argument</span>
</span><span id=__span-87-8><a id=__codelineno-87-8 name=__codelineno-87-8 href=#__codelineno-87-8></a><span class=w>        </span><span class=k>return</span><span class=w>        </span><span class=c1>// and we don&#39;t want to go any further</span>
</span><span id=__span-87-9><a id=__codelineno-87-9 name=__codelineno-87-9 href=#__codelineno-87-9></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-87-10><a id=__codelineno-87-10 name=__codelineno-87-10 href=#__codelineno-87-10></a><span class=w>      </span><span class=nx>resolve</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-87-11><a id=__codelineno-87-11 name=__codelineno-87-11 href=#__codelineno-87-11></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-87-12><a id=__codelineno-87-12 name=__codelineno-87-12 href=#__codelineno-87-12></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-87-13><a id=__codelineno-87-13 name=__codelineno-87-13 href=#__codelineno-87-13></a><span class=p>}</span>
</span><span id=__span-87-14><a id=__codelineno-87-14 name=__codelineno-87-14 href=#__codelineno-87-14></a>
</span><span id=__span-87-15><a id=__codelineno-87-15 name=__codelineno-87-15 href=#__codelineno-87-15></a><span class=nx>getFile</span><span class=p>(</span><span class=s1>&#39;/etc/passwd&#39;</span><span class=p>)</span>
</span><span id=__span-87-16><a id=__codelineno-87-16 name=__codelineno-87-16 href=#__codelineno-87-16></a><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>))</span>
</span><span id=__span-87-17><a id=__codelineno-87-17 name=__codelineno-87-17 href=#__codelineno-87-17></a><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></code></pre></div></li> <li>補充: 在最近的Node版本中,我們不需要為許多的API進行手動轉換(manual conversion)。假設我們要使用的 <strong>Promisifying</strong> 技術有正確的簽名(correct signature)的話,在Node的內建核心模組<code>Util</code>中有一個方法叫做<a href=https://nodejs.org/docs/latest-v11.x/api/util.html#util_util_promisify_original>util.promisify(original)</a>可以使用,來幫助我們實現 <strong>Promisifying</strong> 技術</li> <li>使用<code>Promise</code>物件</li> <li>在上一個章節中,我們介紹了一個<code>Promise</code>物件是如何被建立的?</li> <li>現在,我們要來看一個<code>Promise</code>物件是如何被使用的(used) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-88-1><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a><span class=kd>const</span><span class=w> </span><span class=nx>isItDoneYet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=cm>/* ... as above ... */</span><span class=p>)</span>
</span><span id=__span-88-2><a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a><span class=c1>//...</span>
</span><span id=__span-88-3><a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a>
</span><span id=__span-88-4><a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a><span class=c1>//no errors, process data</span>
</span><span id=__span-88-5><a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></code></pre></div></li> <li>回呼函式的問題(The problem with callbacks)</li> <li>回呼函式(Callbacks)很適合用於簡單的情境中</li> <li>然而每一個回呼函式都會增加一層巢狀(nesting),這時候如果我們有很多的回呼函式(callbacks),程式碼很快地就會開始變得複雜 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-89-1><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-2><a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a><span class=w>  </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;button&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-3><a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-4><a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=w>      </span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>item</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-5><a id=__codelineno-89-5 name=__codelineno-89-5 href=#__codelineno-89-5></a><span class=w>        </span><span class=c1>//your code here</span>
</span><span id=__span-89-6><a id=__codelineno-89-6 name=__codelineno-89-6 href=#__codelineno-89-6></a><span class=w>      </span><span class=p>})</span>
</span><span id=__span-89-7><a id=__codelineno-89-7 name=__codelineno-89-7 href=#__codelineno-89-7></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=mf>2000</span><span class=p>)</span>
</span><span id=__span-89-8><a id=__codelineno-89-8 name=__codelineno-89-8 href=#__codelineno-89-8></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-89-9><a id=__codelineno-89-9 name=__codelineno-89-9 href=#__codelineno-89-9></a><span class=p>})</span>
</span></code></pre></div><ul> <li>以上的範例程式碼只是4層的程式碼,但是可能會有更多層的程式碼,這樣就不好玩了</li> <li>那我們該怎麼解決這個問題呢?</li> </ul> </li> <li>回呼函式的替代方案(Alternatives to callbacks)</li> <li><strong>從ES6開始</strong> ,Javascript程式語言開始引進(introduced)了許多能夠不涉及(do not involve)使用回呼函式(callbacks)來處理非同步(asynchronous)程式碼的功能,例如以下2種功能<ul> <li><code>Promise</code>物件 (ES6)</li> <li><code>Async/Await</code>語法 (ES8) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-90-1><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a><span class=kd>const</span><span class=w> </span><span class=nx>checkIfItsDone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-90-2><a id=__codelineno-90-2 name=__codelineno-90-2 href=#__codelineno-90-2></a><span class=w>  </span><span class=nx>isItDoneYet</span>
</span><span id=__span-90-3><a id=__codelineno-90-3 name=__codelineno-90-3 href=#__codelineno-90-3></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>ok</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-90-4><a id=__codelineno-90-4 name=__codelineno-90-4 href=#__codelineno-90-4></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>ok</span><span class=p>)</span>
</span><span id=__span-90-5><a id=__codelineno-90-5 name=__codelineno-90-5 href=#__codelineno-90-5></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-90-6><a id=__codelineno-90-6 name=__codelineno-90-6 href=#__codelineno-90-6></a><span class=w>    </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-90-7><a id=__codelineno-90-7 name=__codelineno-90-7 href=#__codelineno-90-7></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-90-8><a id=__codelineno-90-8 name=__codelineno-90-8 href=#__codelineno-90-8></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-90-9><a id=__codelineno-90-9 name=__codelineno-90-9 href=#__codelineno-90-9></a><span class=p>}</span>
</span></code></pre></div></li> <li>執行<code>checkIfItsDone()</code>方法將會指定(specify),當<code>isItDoneYet</code>這個<code>Promise</code>物件在</li> <li>已解決的狀態(resolves)時,會執行<code>then()</code>方法裡面的函式</li> <li>或是</li> <li>被拒絕的狀態(rejects)時,會執行<code>catch()</code>方法裡面的函式</li> </ul> </li> <li>連鎖<code>Promise</code>物件(Chaining promises)</li> <li>一個<code>Promise</code>物件可以被回傳給另一個<code>Promise</code>物件,來創造出一串連鎖<code>Promise</code>物件(a chain of promises)</li> <li><a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API>Fetch API</a>就是一個很好的連鎖<code>Promise</code>物件的例子。<code>Fetch API</code>能讓我們獲取資源(get a resource)並且當資源被獲取(fetched)時,將連鎖<code>Promise</code>物件(a chain of promises)排隊(queue)後執行(execute)<ul> <li><code>Fetch API</code>是一個基於<code>Promise</code>物件的機制(mechanism),呼叫<code>fetch()</code>方法相當於透過<code>new Promise()</code>建構子來建立出一個屬於我們自定義的<code>Promise</code>物件 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-91-1><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a><span class=kd>const</span><span class=w> </span><span class=nx>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-91-2><a id=__codelineno-91-2 name=__codelineno-91-2 href=#__codelineno-91-2></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>300</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-91-3><a id=__codelineno-91-3 name=__codelineno-91-3 href=#__codelineno-91-3></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span>
</span><span id=__span-91-4><a id=__codelineno-91-4 name=__codelineno-91-4 href=#__codelineno-91-4></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-91-5><a id=__codelineno-91-5 name=__codelineno-91-5 href=#__codelineno-91-5></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>statusText</span><span class=p>))</span>
</span><span id=__span-91-6><a id=__codelineno-91-6 name=__codelineno-91-6 href=#__codelineno-91-6></a><span class=p>}</span>
</span><span id=__span-91-7><a id=__codelineno-91-7 name=__codelineno-91-7 href=#__codelineno-91-7></a>
</span><span id=__span-91-8><a id=__codelineno-91-8 name=__codelineno-91-8 href=#__codelineno-91-8></a><span class=kd>const</span><span class=w> </span><span class=nx>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span>
</span><span id=__span-91-9><a id=__codelineno-91-9 name=__codelineno-91-9 href=#__codelineno-91-9></a>
</span><span id=__span-91-10><a id=__codelineno-91-10 name=__codelineno-91-10 href=#__codelineno-91-10></a><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/todos.json&#39;</span><span class=p>)</span>
</span><span id=__span-91-11><a id=__codelineno-91-11 name=__codelineno-91-11 href=#__codelineno-91-11></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>status</span><span class=p>)</span><span class=w>    </span><span class=c1>// note that the `status` function is actually **called** here, and that it **returns a promise**</span>
</span><span id=__span-91-12><a id=__codelineno-91-12 name=__codelineno-91-12 href=#__codelineno-91-12></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>json</span><span class=p>)</span><span class=w>      </span><span class=c1>// likewise, the only difference here is that the `json` function here returns a promise that resolves with `data`</span>
</span><span id=__span-91-13><a id=__codelineno-91-13 name=__codelineno-91-13 href=#__codelineno-91-13></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// ... which is why `data` shows up here as the first parameter to the anonymous function</span>
</span><span id=__span-91-14><a id=__codelineno-91-14 name=__codelineno-91-14 href=#__codelineno-91-14></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Request succeeded with JSON response&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-91-15><a id=__codelineno-91-15 name=__codelineno-91-15 href=#__codelineno-91-15></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-91-16><a id=__codelineno-91-16 name=__codelineno-91-16 href=#__codelineno-91-16></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-91-17><a id=__codelineno-91-17 name=__codelineno-91-17 href=#__codelineno-91-17></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Request failed&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-91-18><a id=__codelineno-91-18 name=__codelineno-91-18 href=#__codelineno-91-18></a><span class=w>  </span><span class=p>})</span>
</span></code></pre></div></li> <li>在以上的範例程式碼中,我們呼叫了<code>fetch()</code>方法,從根目錄中的<code>todos.json</code>這個檔案中來獲得一個待辦清單(a list of TODO items),接著我們就建立出一串連鎖<code>Promise</code>物件(a chain of promises)</li> <li>執行<code>fetch()</code>方法會回傳一個<a href=https://fetch.spec.whatwg.org/#concept-response>response</a>物件,它具有許多屬性(properties),我們有參考(reference)的屬性有以下2種<ul> <li><code>reponse.status</code>: 一個代表HTTP狀態碼(status code)的數值(numeric value)</li> <li><code>response.statusText</code>: 一個狀態訊息,如果是<code>'OK'</code>則表示該請求成功(request succeeded)</li> </ul> </li> <li>自定義的: <code>response</code>物件也有<code>response.json()</code>方法,可以回傳一個<code>Promise</code>物件,這個方法可以用來處理內文(the content of the body),並轉換成<code>JSON</code>格式</li> <li>所以考慮到這些前提(premises),就會發生這種情況,一串連鎖<code>Promise</code>物件中的第一個<code>Promise</code>物件是我們定義的<code>status()</code>函式,該函式用來檢查回應的狀態(reponse status),若這個回應狀態碼不是成功的(= <code>200</code>~<code>299</code>),該函式就會拒絕(rejects)這個<code>Promise</code>物件<ul> <li>此操作(operation)將會導致整個該<code>Promise</code>物件會跳過列出的(listed)所有連鎖<code>Promise</code>物件鏈,並直接跳到下面的<code>catch()</code>陳述句,該函式會記錄請求失敗(<code>Request failed</code>)的文本(text) &amp; 錯誤訊息(error message)</li> </ul> </li> <li>如果我們自定義的<code>status()</code>函式回傳的回應狀態碼是成功的話,它會呼叫我們自定義的<code>repsonse.json()</code>函式。由於前一個(previous)<code>Promise</code>物件在請求成功(successful)後會回傳一個<code>response</code>物件,我們會將這個<code>response</code>物件作為下一個<code>Promise</code>物件的輸入(input)</li> <li>在以上的範例程式碼中,我們會回傳一個經過<code>response.json()</code>函式處理過(<code>JSON</code> processed)的資料(data),因此第三個<code>Promise</code>物件就能直接收到(receives)這個<code>JSON</code>物件<ul> <li><code>js .then((data) =&gt; { console.log('Request succeeded with JSON response', data) })</code></li> <li>接下來,我們只要將這個記錄到控制台(console)即可</li> </ul> </li> </ul> </li> <li>處理錯誤(Handling errors)</li> <li>在上一節的範例中,我們在連鎖<code>Promise</code>物件鏈中附加了<code>catch()</code>函式 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-92-1><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-92-2><a id=__codelineno-92-2 name=__codelineno-92-2 href=#__codelineno-92-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Request failed&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-92-3><a id=__codelineno-92-3 name=__codelineno-92-3 href=#__codelineno-92-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>如果在整個連鎖<code>Promise</code>物件鏈中有任何的失敗(fails)並引起(raises)一個錯誤(error)或是被拒絕的<code>Promise</code>物件,程式碼的流程控制權(control)將會轉移到整個連鎖<code>Promise</code>物件鏈下面且最近的(nearest)<code>catch()</code>陳述句 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-93-1><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-93-2><a id=__codelineno-93-2 name=__codelineno-93-2 href=#__codelineno-93-2></a><span class=w>  </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Error&#39;</span><span class=p>)</span>
</span><span id=__span-93-3><a id=__codelineno-93-3 name=__codelineno-93-3 href=#__codelineno-93-3></a><span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-93-4><a id=__codelineno-93-4 name=__codelineno-93-4 href=#__codelineno-93-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-93-5><a id=__codelineno-93-5 name=__codelineno-93-5 href=#__codelineno-93-5></a><span class=p>})</span>
</span><span id=__span-93-6><a id=__codelineno-93-6 name=__codelineno-93-6 href=#__codelineno-93-6></a>
</span><span id=__span-93-7><a id=__codelineno-93-7 name=__codelineno-93-7 href=#__codelineno-93-7></a><span class=c1>// or</span>
</span><span id=__span-93-8><a id=__codelineno-93-8 name=__codelineno-93-8 href=#__codelineno-93-8></a>
</span><span id=__span-93-9><a id=__codelineno-93-9 name=__codelineno-93-9 href=#__codelineno-93-9></a><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-93-10><a id=__codelineno-93-10 name=__codelineno-93-10 href=#__codelineno-93-10></a><span class=w>  </span><span class=nx>reject</span><span class=p>(</span><span class=s1>&#39;Error&#39;</span><span class=p>)</span>
</span><span id=__span-93-11><a id=__codelineno-93-11 name=__codelineno-93-11 href=#__codelineno-93-11></a><span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-93-12><a id=__codelineno-93-12 name=__codelineno-93-12 href=#__codelineno-93-12></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-93-13><a id=__codelineno-93-13 name=__codelineno-93-13 href=#__codelineno-93-13></a><span class=p>})</span>
</span></code></pre></div></li> <li>串鏈錯誤(Cascading errors)<ul> <li>如果在<code>catch()</code>陳述句裡面,又引起(raises)了一個錯誤(error),我們可以再附加第2個<code>catch()</code>函式來處理該錯誤(error),以此類推 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-94-1><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-94-2><a id=__codelineno-94-2 name=__codelineno-94-2 href=#__codelineno-94-2></a><span class=w>  </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Error&#39;</span><span class=p>)</span>
</span><span id=__span-94-3><a id=__codelineno-94-3 name=__codelineno-94-3 href=#__codelineno-94-3></a><span class=p>})</span>
</span><span id=__span-94-4><a id=__codelineno-94-4 name=__codelineno-94-4 href=#__codelineno-94-4></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-94-5><a id=__codelineno-94-5 name=__codelineno-94-5 href=#__codelineno-94-5></a><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Error&#39;</span><span class=p>)</span>
</span><span id=__span-94-6><a id=__codelineno-94-6 name=__codelineno-94-6 href=#__codelineno-94-6></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-94-7><a id=__codelineno-94-7 name=__codelineno-94-7 href=#__codelineno-94-7></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-94-8><a id=__codelineno-94-8 name=__codelineno-94-8 href=#__codelineno-94-8></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-94-9><a id=__codelineno-94-9 name=__codelineno-94-9 href=#__codelineno-94-9></a><span class=w>  </span><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li>編排<code>Promise</code>物件(Orchestrating promises)</li> <li><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all>Promise.all(iterable)</a><ul> <li><strong>如果我們想要同步化(synchronize)不同的<code>Promise</code>物件,<code>Promise.all()</code>方法可以定義一個<code>Promise</code>物件的清單(list),並在全部的<code>Promise</code>物件都被解決(all resolved)後,執行一些操作</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-95-1><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a><span class=kd>const</span><span class=w> </span><span class=nx>f1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/something.json&#39;</span><span class=p>)</span>
</span><span id=__span-95-2><a id=__codelineno-95-2 name=__codelineno-95-2 href=#__codelineno-95-2></a><span class=kd>const</span><span class=w> </span><span class=nx>f2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/something2.json&#39;</span><span class=p>)</span>
</span><span id=__span-95-3><a id=__codelineno-95-3 name=__codelineno-95-3 href=#__codelineno-95-3></a>
</span><span id=__span-95-4><a id=__codelineno-95-4 name=__codelineno-95-4 href=#__codelineno-95-4></a><span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>f1</span><span class=p>,</span><span class=w> </span><span class=nx>f2</span><span class=p>])</span>
</span><span id=__span-95-5><a id=__codelineno-95-5 name=__codelineno-95-5 href=#__codelineno-95-5></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-95-6><a id=__codelineno-95-6 name=__codelineno-95-6 href=#__codelineno-95-6></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Array of results&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span>
</span><span id=__span-95-7><a id=__codelineno-95-7 name=__codelineno-95-7 href=#__codelineno-95-7></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-95-8><a id=__codelineno-95-8 name=__codelineno-95-8 href=#__codelineno-95-8></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-95-9><a id=__codelineno-95-9 name=__codelineno-95-9 href=#__codelineno-95-9></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-95-10><a id=__codelineno-95-10 name=__codelineno-95-10 href=#__codelineno-95-10></a><span class=w>  </span><span class=p>})</span>
</span></code></pre></div></li> <li>我們可以使用ES6(= ES2015)引進的解構指派語法(destructuring assignment syntax)來這樣做 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-96-1><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a><span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>f1</span><span class=p>,</span><span class=w> </span><span class=nx>f2</span><span class=p>]).</span><span class=nx>then</span><span class=p>(([</span><span class=nx>res1</span><span class=p>,</span><span class=w> </span><span class=nx>res2</span><span class=p>])</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-96-2><a id=__codelineno-96-2 name=__codelineno-96-2 href=#__codelineno-96-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Results&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>res1</span><span class=p>,</span><span class=w> </span><span class=nx>res2</span><span class=p>)</span>
</span><span id=__span-96-3><a id=__codelineno-96-3 name=__codelineno-96-3 href=#__codelineno-96-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>當然,我們也可以使用<a href=https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API/Using_Fetch>fetch()</a> API來實作, <strong>任何<code>Promise</code>物件都可以使用<code>Promise.all()</code>方法</strong></li> </ul> </li> <li><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/race>Promise.race(iterable)</a><ul> <li><strong>當我們將傳遞給<code>Promise.race()</code>方法的第1個<code>Promise</code>物件被解決(resolved)時,會執行該方法,並且它只會執行其附加的回呼函式(attached callback)"一次",並解決第1個<code>Promise</code>物件的結果</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-97-1><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a><span class=kd>const</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-97-2><a id=__codelineno-97-2 name=__codelineno-97-2 href=#__codelineno-97-2></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=mf>500</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;first&#39;</span><span class=p>)</span>
</span><span id=__span-97-3><a id=__codelineno-97-3 name=__codelineno-97-3 href=#__codelineno-97-3></a><span class=p>})</span>
</span><span id=__span-97-4><a id=__codelineno-97-4 name=__codelineno-97-4 href=#__codelineno-97-4></a><span class=kd>const</span><span class=w> </span><span class=nx>second</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>reject</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-97-5><a id=__codelineno-97-5 name=__codelineno-97-5 href=#__codelineno-97-5></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=mf>100</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;second&#39;</span><span class=p>)</span>
</span><span id=__span-97-6><a id=__codelineno-97-6 name=__codelineno-97-6 href=#__codelineno-97-6></a><span class=p>})</span>
</span><span id=__span-97-7><a id=__codelineno-97-7 name=__codelineno-97-7 href=#__codelineno-97-7></a>
</span><span id=__span-97-8><a id=__codelineno-97-8 name=__codelineno-97-8 href=#__codelineno-97-8></a><span class=nb>Promise</span><span class=p>.</span><span class=nx>race</span><span class=p>([</span><span class=nx>first</span><span class=p>,</span><span class=w> </span><span class=nx>second</span><span class=p>]).</span><span class=nx>then</span><span class=p>(</span><span class=nx>result</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-97-9><a id=__codelineno-97-9 name=__codelineno-97-9 href=#__codelineno-97-9></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>result</span><span class=p>)</span><span class=w> </span><span class=c1>// second</span>
</span><span id=__span-97-10><a id=__codelineno-97-10 name=__codelineno-97-10 href=#__codelineno-97-10></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li>常見的錯誤(Common errors)</li> <li>未捕獲的型別錯誤: <code>undefined</code>不是一個<code>Promise</code>物件(Uncaught TypeError: undefined is not a promise)<ul> <li>如果在控制台(console)得到此錯誤(error)時,可以去確認一下我們是使用<code>new Promise()</code>語法來建立一個新的<code>Promise</code>物件,而"不是"使用<code>Promise()</code>語法</li> </ul> </li> <li>未處理的被拒絕的<code>Promise</code>物件警告(UnhandledPromiseRejectionWarning)<ul> <li>這個錯誤表示我們呼叫的<code>Promise</code>物件被拒絕(rejected)了,但這時候找不到任何一個<code>catch()</code>陳述式來處理這個錯誤(error)。這時,我們可以新增一個<code>catch()</code>陳述式在引起問題(offending)的<code>then()</code>方法的後面來適當地(properly)處理這個錯誤(error)</li> </ul> </li> </ul> <h3 id=modern-asynchronous-javascript-with-async-and-await>Modern Asynchronous JavaScript with Async and Await<a class=headerlink href=#modern-asynchronous-javascript-with-async-and-await title="Permanent link">&para;</a></h3> <ul> <li>介紹</li> <li>Javascript在很短的時間內從回呼函式(callbacks)發展成<code>Promise</code>物件(=&gt; 從ES6引入的),再演變成<code>async/await</code>語法(=&gt; 從ES8引入的),來使Javascript的非同步(asynchronous)語法更簡化了</li> <li>非同步函式(Async functions)是由<code>Promise</code>物件們 &amp; 生成器(generators)的結合(combination)。基本上,它們算是一種更高階的<code>Promise</code>物件的抽象(abstraction)</li> <li>讓我再重複一次,<strong><code>async/await</code>語法是建立在<code>Promise</code>物件的基礎之上的</strong></li> <li>為什麼<code>async/await</code>語法會被引進(introduced)呢?</li> <li><code>async/await</code>語法能減少關於<code>Promise</code>物件的樣板(boilerplate),並且可以打破(break) "不能破壞<code>Promise</code>物件鏈" 的這個限制(limitation)</li> <li>當<code>Promise</code>物件在ES6開始引入(introduced)時,它們旨在解決非同步程式碼(asynchronous code)的問題,當然<code>Promise</code>物件有完成這個目標了。但是在接下來的2年內(=&gt; ES6~ES8),<code>Promise</code>物件很明顯地,不能作為最後的解決方案(final solution)</li> <li><code>Promise</code>物件的引入(introduced)是用來解決(solve)著名的回呼地獄(callback hell)問題。但是<code>Promise</code>物件自己本身也引入了複雜性與語法複雜性(syntax complexity)<ul> <li>它們是很好的原語(primitives),可以向開發人員公開更好的語法。因此,當時機合適時,我們就能開始使用<code>async/await</code>語法</li> </ul> </li> <li><code>async/await</code>語法能讓程式碼"看起來"是同步的(synchronous), <strong>但是在背景中(behind the scenes)它們是非同步的(asynchronous)且非阻塞的(non-blocking)</strong></li> <li>這是如何運作的呢?</li> <li>一個非同步函式(async function)會回傳一個<code>Promise</code>物件,如同以下的範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-98-1><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomethingAsync</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-98-2><a id=__codelineno-98-2 name=__codelineno-98-2 href=#__codelineno-98-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-98-3><a id=__codelineno-98-3 name=__codelineno-98-3 href=#__codelineno-98-3></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;I did something&#39;</span><span class=p>),</span><span class=w> </span><span class=mf>3000</span><span class=p>)</span>
</span><span id=__span-98-4><a id=__codelineno-98-4 name=__codelineno-98-4 href=#__codelineno-98-4></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-98-5><a id=__codelineno-98-5 name=__codelineno-98-5 href=#__codelineno-98-5></a><span class=p>}</span>
</span></code></pre></div><ul> <li>如果我們想要呼叫以上的範例函式的話,就要前置(prepend) <code>await</code>語法來呼叫,並且呼叫的程式碼會直到當該<code>Promise</code>物件被解決(resolved)或是被拒絕(rejected)後才會停止</li> </ul> </li> <li><strong>警告(caveat): 客戶端函式(client function)必須定義為(defined as)非同步函式(async function)</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-99-1><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-99-2><a id=__codelineno-99-2 name=__codelineno-99-2 href=#__codelineno-99-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>await</span><span class=w> </span><span class=nx>doSomethingAsync</span><span class=p>())</span>
</span><span id=__span-99-3><a id=__codelineno-99-3 name=__codelineno-99-3 href=#__codelineno-99-3></a><span class=p>}</span>
</span></code></pre></div></li> <li>一個快速的範例</li> <li>以下是一個關於<code>async/await</code>語法的快速範例,以非同步(asynchronous)的方式來執行函式(function) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-100-1><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomethingAsync</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-100-2><a id=__codelineno-100-2 name=__codelineno-100-2 href=#__codelineno-100-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-100-3><a id=__codelineno-100-3 name=__codelineno-100-3 href=#__codelineno-100-3></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;I did something&#39;</span><span class=p>),</span><span class=w> </span><span class=mf>3000</span><span class=p>)</span>
</span><span id=__span-100-4><a id=__codelineno-100-4 name=__codelineno-100-4 href=#__codelineno-100-4></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-100-5><a id=__codelineno-100-5 name=__codelineno-100-5 href=#__codelineno-100-5></a><span class=p>}</span>
</span><span id=__span-100-6><a id=__codelineno-100-6 name=__codelineno-100-6 href=#__codelineno-100-6></a>
</span><span id=__span-100-7><a id=__codelineno-100-7 name=__codelineno-100-7 href=#__codelineno-100-7></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-100-8><a id=__codelineno-100-8 name=__codelineno-100-8 href=#__codelineno-100-8></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>await</span><span class=w> </span><span class=nx>doSomethingAsync</span><span class=p>())</span>
</span><span id=__span-100-9><a id=__codelineno-100-9 name=__codelineno-100-9 href=#__codelineno-100-9></a><span class=p>}</span>
</span><span id=__span-100-10><a id=__codelineno-100-10 name=__codelineno-100-10 href=#__codelineno-100-10></a>
</span><span id=__span-100-11><a id=__codelineno-100-11 name=__codelineno-100-11 href=#__codelineno-100-11></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before&#39;</span><span class=p>)</span>
</span><span id=__span-100-12><a id=__codelineno-100-12 name=__codelineno-100-12 href=#__codelineno-100-12></a><span class=nx>doSomething</span><span class=p>()</span>
</span><span id=__span-100-13><a id=__codelineno-100-13 name=__codelineno-100-13 href=#__codelineno-100-13></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;After&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會"依序"回傳</li> <li>Before</li> <li>After</li> <li>I did something</li> </ul> </li> <li>Promise all the things</li> <li>在任何函式前置(prepending) <code>async</code>關鍵字(keyword)表示該函式(function)會回傳一個<code>Promise</code>物件<ul> <li>即使<code>async function</code>看起來沒有明確地這麼做,但是在其內部(internally)會回傳一個<code>Promise</code>物件</li> </ul> </li> <li>這也就是為什麼以下的這段範例程式碼是有效的(valid) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-101-1><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a><span class=kd>const</span><span class=w> </span><span class=nx>aFunction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-101-2><a id=__codelineno-101-2 name=__codelineno-101-2 href=#__codelineno-101-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=s1>&#39;test&#39;</span>
</span><span id=__span-101-3><a id=__codelineno-101-3 name=__codelineno-101-3 href=#__codelineno-101-3></a><span class=p>}</span>
</span><span id=__span-101-4><a id=__codelineno-101-4 name=__codelineno-101-4 href=#__codelineno-101-4></a>
</span><span id=__span-101-5><a id=__codelineno-101-5 name=__codelineno-101-5 href=#__codelineno-101-5></a><span class=nx>aFunction</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span><span class=w> </span><span class=c1>// This will alert &#39;test&#39;</span>
</span></code></pre></div><ul> <li>以上的範例程式碼也相當於下面這段範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-102-1><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a><span class=kd>const</span><span class=w> </span><span class=nx>aFunction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-102-2><a id=__codelineno-102-2 name=__codelineno-102-2 href=#__codelineno-102-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span><span id=__span-102-3><a id=__codelineno-102-3 name=__codelineno-102-3 href=#__codelineno-102-3></a><span class=p>}</span>
</span><span id=__span-102-4><a id=__codelineno-102-4 name=__codelineno-102-4 href=#__codelineno-102-4></a>
</span><span id=__span-102-5><a id=__codelineno-102-5 name=__codelineno-102-5 href=#__codelineno-102-5></a><span class=nx>aFunction</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>alert</span><span class=p>)</span><span class=w> </span><span class=c1>// This will alert &#39;test&#39;</span>
</span></code></pre></div></li> </ul> </li> <li>程式碼也會變得更容易閱讀</li> <li>如同上一個章節的範例程式碼,這次的範例程式碼看起來非常簡單。從程式碼的比較中可以看出,使用<code>Promise</code>物件,並搭配<code>Promise</code>物件鏈與回呼函式(callback functions)可以讓程式碼變得更簡潔</li> <li>以下是2個非常簡單的範例程式碼的比較,當程式碼開始變得複雜的時候,使用<code>async/await</code>語法能帶來很多好處<ul> <li>這是利用<code>Promise</code>物件獲得一個<code>JSON</code>資源,解析(parse)它 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-103-1><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a><span class=kd>const</span><span class=w> </span><span class=nx>getFirstUserData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-103-2><a id=__codelineno-103-2 name=__codelineno-103-2 href=#__codelineno-103-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/users.json&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// get users list</span>
</span><span id=__span-103-3><a id=__codelineno-103-3 name=__codelineno-103-3 href=#__codelineno-103-3></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span><span class=w> </span><span class=c1>// parse JSON</span>
</span><span id=__span-103-4><a id=__codelineno-103-4 name=__codelineno-103-4 href=#__codelineno-103-4></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>users</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>users</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=w> </span><span class=c1>// pick first user</span>
</span><span id=__span-103-5><a id=__codelineno-103-5 name=__codelineno-103-5 href=#__codelineno-103-5></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>user</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=sb>`/users/</span><span class=si>${</span><span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>))</span><span class=w> </span><span class=c1>// get user data</span>
</span><span id=__span-103-6><a id=__codelineno-103-6 name=__codelineno-103-6 href=#__codelineno-103-6></a><span class=w>    </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>userResponse</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>userResponse</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span><span class=w> </span><span class=c1>// parse JSON</span>
</span><span id=__span-103-7><a id=__codelineno-103-7 name=__codelineno-103-7 href=#__codelineno-103-7></a><span class=p>}</span>
</span><span id=__span-103-8><a id=__codelineno-103-8 name=__codelineno-103-8 href=#__codelineno-103-8></a>
</span><span id=__span-103-9><a id=__codelineno-103-9 name=__codelineno-103-9 href=#__codelineno-103-9></a><span class=nx>getFirstUserData</span><span class=p>()</span>
</span></code></pre></div></li> <li>這是利用<code>async/await</code>語法提供的相同功能 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-104-1><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a><span class=kd>const</span><span class=w> </span><span class=nx>getFirstUserData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-104-2><a id=__codelineno-104-2 name=__codelineno-104-2 href=#__codelineno-104-2></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/users.json&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// get users list</span>
</span><span id=__span-104-3><a id=__codelineno-104-3 name=__codelineno-104-3 href=#__codelineno-104-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span><span class=w> </span><span class=c1>// parse JSON</span>
</span><span id=__span-104-4><a id=__codelineno-104-4 name=__codelineno-104-4 href=#__codelineno-104-4></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>users</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span><span class=w> </span><span class=c1>// pick first user</span>
</span><span id=__span-104-5><a id=__codelineno-104-5 name=__codelineno-104-5 href=#__codelineno-104-5></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>userResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=sb>`/users/</span><span class=si>${</span><span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span><span class=w> </span><span class=c1>// get user data</span>
</span><span id=__span-104-6><a id=__codelineno-104-6 name=__codelineno-104-6 href=#__codelineno-104-6></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>userData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>userResponse</span><span class=p>.</span><span class=nx>json</span><span class=p>()</span><span class=w> </span><span class=c1>// parse JSON</span>
</span><span id=__span-104-7><a id=__codelineno-104-7 name=__codelineno-104-7 href=#__codelineno-104-7></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>userData</span>
</span><span id=__span-104-8><a id=__codelineno-104-8 name=__codelineno-104-8 href=#__codelineno-104-8></a><span class=p>}</span>
</span><span id=__span-104-9><a id=__codelineno-104-9 name=__codelineno-104-9 href=#__codelineno-104-9></a>
</span><span id=__span-104-10><a id=__codelineno-104-10 name=__codelineno-104-10 href=#__codelineno-104-10></a><span class=nx>getFirstUserData</span><span class=p>()</span>
</span></code></pre></div></li> </ul> </li> <li>多個非同步函式的串連(Multiple async functions in series)</li> <li>非同步函式(async function)可以很簡單地被串連,並且語法上比起單純的(plain)<code>Promise</code>物件的語法更容易閱讀(much more readable) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-105-1><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a><span class=kd>const</span><span class=w> </span><span class=nx>promiseToDoSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-105-2><a id=__codelineno-105-2 name=__codelineno-105-2 href=#__codelineno-105-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-105-3><a id=__codelineno-105-3 name=__codelineno-105-3 href=#__codelineno-105-3></a><span class=w>    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;I did something&#39;</span><span class=p>),</span><span class=w> </span><span class=mf>10000</span><span class=p>)</span>
</span><span id=__span-105-4><a id=__codelineno-105-4 name=__codelineno-105-4 href=#__codelineno-105-4></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-105-5><a id=__codelineno-105-5 name=__codelineno-105-5 href=#__codelineno-105-5></a><span class=p>}</span>
</span><span id=__span-105-6><a id=__codelineno-105-6 name=__codelineno-105-6 href=#__codelineno-105-6></a>
</span><span id=__span-105-7><a id=__codelineno-105-7 name=__codelineno-105-7 href=#__codelineno-105-7></a><span class=kd>const</span><span class=w> </span><span class=nx>watchOverSomeoneDoingSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-105-8><a id=__codelineno-105-8 name=__codelineno-105-8 href=#__codelineno-105-8></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>something</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>promiseToDoSomething</span><span class=p>()</span>
</span><span id=__span-105-9><a id=__codelineno-105-9 name=__codelineno-105-9 href=#__codelineno-105-9></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>something</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;\nand I watched&#39;</span>
</span><span id=__span-105-10><a id=__codelineno-105-10 name=__codelineno-105-10 href=#__codelineno-105-10></a><span class=p>}</span>
</span><span id=__span-105-11><a id=__codelineno-105-11 name=__codelineno-105-11 href=#__codelineno-105-11></a>
</span><span id=__span-105-12><a id=__codelineno-105-12 name=__codelineno-105-12 href=#__codelineno-105-12></a><span class=kd>const</span><span class=w> </span><span class=nx>watchOverSomeoneWatchingSomeoneDoingSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-105-13><a id=__codelineno-105-13 name=__codelineno-105-13 href=#__codelineno-105-13></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>something</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>watchOverSomeoneDoingSomething</span><span class=p>()</span>
</span><span id=__span-105-14><a id=__codelineno-105-14 name=__codelineno-105-14 href=#__codelineno-105-14></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>something</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;\nand I watched as well&#39;</span>
</span><span id=__span-105-15><a id=__codelineno-105-15 name=__codelineno-105-15 href=#__codelineno-105-15></a><span class=p>}</span>
</span><span id=__span-105-16><a id=__codelineno-105-16 name=__codelineno-105-16 href=#__codelineno-105-16></a>
</span><span id=__span-105-17><a id=__codelineno-105-17 name=__codelineno-105-17 href=#__codelineno-105-17></a><span class=nx>watchOverSomeoneWatchingSomeoneDoingSomething</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-105-18><a id=__codelineno-105-18 name=__codelineno-105-18 href=#__codelineno-105-18></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>
</span><span id=__span-105-19><a id=__codelineno-105-19 name=__codelineno-105-19 href=#__codelineno-105-19></a><span class=p>})</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會"依序"回傳</li> <li>I did something</li> <li>and I watched</li> <li>and I watched as well</li> </ul> </li> <li>更容易地除錯(Easier debugging)</li> <li>要除錯(debugging)<code>Promise</code>物件是困難的,因為除錯器(debugger)不會跳過(step over)非同步程式碼(asynchronous code)</li> <li><code>async/await</code>語法讓除錯(debug)變得更容易,因為對於編譯器(compiler)來說,這就像是同步程式碼(synchronous code)</li> </ul> <h3 id=the-nodejs-event-emitter>The Node.js Event emitter<a class=headerlink href=#the-nodejs-event-emitter title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/events.html#events_events>Events</a><br></p> </blockquote> <ul> <li>如果我們在瀏覽器使用Javascript工作,就會知道透過多少事件(through events)來跟使用者進行互動(interaction),像是<code>mouse click</code>, <code>keyboard button presses</code>, <code>reacting to mouse movements</code>, ...等等</li> <li>在後端(backend),Node為我們提供(offer)了利用<code>Events</code>內建核心模組來建構出一個類似的系統(similar system)的選項(option)</li> <li>特別的是,這個模組提供了一個<a href=https://nodejs.org/api/events.html#events_class_eventemitter>EventEmitter Class</a>類別,用來處理(handle)我們的事件(events)</li> <li>我們初始化可以這樣使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-106-1><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>)</span>
</span><span id=__span-106-2><a id=__codelineno-106-2 name=__codelineno-106-2 href=#__codelineno-106-2></a><span class=kd>const</span><span class=w> </span><span class=nx>eventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>()</span>
</span></code></pre></div><ul> <li>這樣做的話,該<code>EventEmitter</code>物件,除了其他的東西之外,我們先介紹<code>eventEmitter.on()</code>方法與<code>eventEmitter.emit()</code>方法</li> <li><a href=https://nodejs.org/api/events.html#events_emitter_emit_eventname_args>emitter.emit(eventName[, ...args])</a>方法: 可以被用來觸發(trigger)一個事件(event)</li> <li><a href=https://nodejs.org/api/events.html#events_emitter_on_eventname_listener>emitter.on(eventName, listener)</a>方法: 可以被用來新增作為,當事件(event)被觸發(triggered)時,要執行的回呼函式(callback function)</li> </ul> </li> <li>舉個例子來說,我們建立一個<code>start</code>事件(event),作為一個範例而言,我們對該事件的反應(react)就是把字串記錄(logging)到控制台(console)上 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-107-1><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-107-2><a id=__codelineno-107-2 name=__codelineno-107-2 href=#__codelineno-107-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;started&#39;</span><span class=p>)</span>
</span><span id=__span-107-3><a id=__codelineno-107-3 name=__codelineno-107-3 href=#__codelineno-107-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>這時,當我們執行 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-108-1><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>該事件的處理函式(the event handler function )就會被觸發(triggered),並且我們會得到控制台的記錄(console log)</li> <li>我們將以上的東西作為額外的參數(additional arguments),傳遞(passing)給事件處理器(event handler),也就是指傳遞給<code>emit()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-109-1><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>number</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-109-2><a id=__codelineno-109-2 name=__codelineno-109-2 href=#__codelineno-109-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`started </span><span class=si>${</span><span class=nx>number</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-109-3><a id=__codelineno-109-3 name=__codelineno-109-3 href=#__codelineno-109-3></a><span class=p>})</span>
</span><span id=__span-109-4><a id=__codelineno-109-4 name=__codelineno-109-4 href=#__codelineno-109-4></a>
</span><span id=__span-109-5><a id=__codelineno-109-5 name=__codelineno-109-5 href=#__codelineno-109-5></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>23</span><span class=p>)</span>
</span></code></pre></div></li> <li>多個參數(multiple arguments)的情況 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-110-1><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>start</span><span class=p>,</span><span class=w> </span><span class=nx>end</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-110-2><a id=__codelineno-110-2 name=__codelineno-110-2 href=#__codelineno-110-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`started from </span><span class=si>${</span><span class=nx>start</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>end</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-110-3><a id=__codelineno-110-3 name=__codelineno-110-3 href=#__codelineno-110-3></a><span class=p>})</span>
</span><span id=__span-110-4><a id=__codelineno-110-4 name=__codelineno-110-4 href=#__codelineno-110-4></a>
</span><span id=__span-110-5><a id=__codelineno-110-5 name=__codelineno-110-5 href=#__codelineno-110-5></a><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=mf>100</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li><code>EventEmitter</code>物件(object)也公開(exposes)了許多其它的方法(method),來跟事件(events)做互動(interact),像是以下3種方法</li> <li><a href=https://nodejs.org/api/events.html#events_emitter_once_eventname_listener>emitter.once(eventName, listener)</a>: 新增(add)一個一次性(one-time)的事件監聽器(listener)</li> <li><a href=https://nodejs.org/api/events.html#events_emitter_removelistener_eventname_listener>emitter.removeListener(eventName, listener)</a>: 從指定的事件中移除指定的事件監聽器(remove an event listener from an event)<ul> <li>等同於<a href=https://nodejs.org/api/events.html#events_emitter_off_eventname_listener>emitter.off(eventName, listener)</a></li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_removealllisteners_eventname>emitter.removeAllListeners([eventName])</a>: 刪除指定的事件中所有的事件監聽器(remove all listeners for an event)</li> </ul> <h3 id=build-an-http-server>Build an HTTP Server<a class=headerlink href=#build-an-http-server title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/http.html#http_http>HTTP</a><br></p> </blockquote> <ul> <li>這是一個Hello World範例的HTTP web server <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-111-1><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span><span id=__span-111-2><a id=__codelineno-111-2 name=__codelineno-111-2 href=#__codelineno-111-2></a>
</span><span id=__span-111-3><a id=__codelineno-111-3 name=__codelineno-111-3 href=#__codelineno-111-3></a><span class=kd>const</span><span class=w> </span><span class=nx>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span>
</span><span id=__span-111-4><a id=__codelineno-111-4 name=__codelineno-111-4 href=#__codelineno-111-4></a>
</span><span id=__span-111-5><a id=__codelineno-111-5 name=__codelineno-111-5 href=#__codelineno-111-5></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-111-6><a id=__codelineno-111-6 name=__codelineno-111-6 href=#__codelineno-111-6></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>200</span>
</span><span id=__span-111-7><a id=__codelineno-111-7 name=__codelineno-111-7 href=#__codelineno-111-7></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;text/html&#39;</span><span class=p>)</span>
</span><span id=__span-111-8><a id=__codelineno-111-8 name=__codelineno-111-8 href=#__codelineno-111-8></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;&lt;h1&gt;Hello, World!&lt;/h1&gt;&#39;</span><span class=p>)</span>
</span><span id=__span-111-9><a id=__codelineno-111-9 name=__codelineno-111-9 href=#__codelineno-111-9></a><span class=p>})</span>
</span><span id=__span-111-10><a id=__codelineno-111-10 name=__codelineno-111-10 href=#__codelineno-111-10></a>
</span><span id=__span-111-11><a id=__codelineno-111-11 name=__codelineno-111-11 href=#__codelineno-111-11></a><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-111-12><a id=__codelineno-111-12 name=__codelineno-111-12 href=#__codelineno-111-12></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Server running at port </span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-111-13><a id=__codelineno-111-13 name=__codelineno-111-13 href=#__codelineno-111-13></a><span class=p>})</span>
</span></code></pre></div><ul> <li>以上的範例程式碼會打印出<code>Hello, World!</code>字串</li> </ul> </li> <li>讓我們來簡單地分析一下這段範例程式碼,包括Node的<code>HTTP</code>內建核心模組<ul> <li>我們可以利用<code>HTTP</code>模組(module)來建立一個HTTP 伺服器(server)</li> <li>這個<code>HTTP server</code>被設定用來監聽指定的<code>3000</code> port。當伺服器準備好後,就會呼叫<a href=https://nodejs.org/api/http.html#http_server_listen>server.listen()</a>這個回呼函式(callback function)</li> <li>我們傳遞的回呼函式是將在收到每個請求(every request)時,立即(upon)要執行的回呼函式(callback function)</li> <li>每當(whenever)收到(received)一個新的請求(new request)時,就會呼叫<a href=https://nodejs.org/api/http.html#http_event_request>request事件(event)</a>,並提供2個物件(objects)</li> <li>請求物件(request): 會是一個<a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage>http.IncomingMessage</a>物件<ul> <li>該物件會提供關於請求的細節(request details)。透過這個物件,我們可以用來存取(access)請求標頭(request headers)與請求資料(request data)</li> </ul> </li> <li>回應物件(response): 會是一個<a href=https://nodejs.org/api/http.html#http_class_http_serverresponse>http.ServerResponse</a>物件<ul> <li>該物件是被用來產生(populate)出我們將要回傳給客戶端(client)的資料(data)</li> </ul> </li> <li>在這次的範例程式碼中,我們有設定了回應物件(response)的狀態碼(statusCode)的屬性(property)值為<code>200</code>,來表示這是一個成功的請求(successful response) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-112-1><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>200</span>
</span></code></pre></div></li> <li>在這次的範例程式碼中,我們也有設定了回應物件(response)的內文標題形式(<code>Content-Type header</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-113-1><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a><span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;text/plain&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>在這次範例程式碼的結尾,我們也關閉了回應物件(response),並將內容作為參數(argument)傳遞給<code>response.end()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-114-1><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;Hello World\n&#39;</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=making-http-requests-with-nodejs>Making HTTP requests with Node.js<a class=headerlink href=#making-http-requests-with-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/https.html#https_https>HTTPS</a><br></p> </blockquote> <ul> <li>完成一個<code>GET</code>請求(Perform a <code>GET</code> Request) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-115-1><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a><span class=kd>const</span><span class=w> </span><span class=nx>https</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;https&#39;</span><span class=p>)</span>
</span><span id=__span-115-2><a id=__codelineno-115-2 name=__codelineno-115-2 href=#__codelineno-115-2></a><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-115-3><a id=__codelineno-115-3 name=__codelineno-115-3 href=#__codelineno-115-3></a><span class=w>  </span><span class=nx>hostname</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;whatever.com&#39;</span><span class=p>,</span>
</span><span id=__span-115-4><a id=__codelineno-115-4 name=__codelineno-115-4 href=#__codelineno-115-4></a><span class=w>  </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=mf>443</span><span class=p>,</span>
</span><span id=__span-115-5><a id=__codelineno-115-5 name=__codelineno-115-5 href=#__codelineno-115-5></a><span class=w>  </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/todos&#39;</span><span class=p>,</span>
</span><span id=__span-115-6><a id=__codelineno-115-6 name=__codelineno-115-6 href=#__codelineno-115-6></a><span class=w>  </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;GET&#39;</span><span class=w>  </span><span class=c1>// 完成一個GET請求</span>
</span><span id=__span-115-7><a id=__codelineno-115-7 name=__codelineno-115-7 href=#__codelineno-115-7></a><span class=p>}</span>
</span><span id=__span-115-8><a id=__codelineno-115-8 name=__codelineno-115-8 href=#__codelineno-115-8></a>
</span><span id=__span-115-9><a id=__codelineno-115-9 name=__codelineno-115-9 href=#__codelineno-115-9></a><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>https</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-115-10><a id=__codelineno-115-10 name=__codelineno-115-10 href=#__codelineno-115-10></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`statusCode: </span><span class=si>${</span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-115-11><a id=__codelineno-115-11 name=__codelineno-115-11 href=#__codelineno-115-11></a>
</span><span id=__span-115-12><a id=__codelineno-115-12 name=__codelineno-115-12 href=#__codelineno-115-12></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-115-13><a id=__codelineno-115-13 name=__codelineno-115-13 href=#__codelineno-115-13></a><span class=w>    </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
</span><span id=__span-115-14><a id=__codelineno-115-14 name=__codelineno-115-14 href=#__codelineno-115-14></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-115-15><a id=__codelineno-115-15 name=__codelineno-115-15 href=#__codelineno-115-15></a><span class=p>})</span>
</span><span id=__span-115-16><a id=__codelineno-115-16 name=__codelineno-115-16 href=#__codelineno-115-16></a>
</span><span id=__span-115-17><a id=__codelineno-115-17 name=__codelineno-115-17 href=#__codelineno-115-17></a><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-115-18><a id=__codelineno-115-18 name=__codelineno-115-18 href=#__codelineno-115-18></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-115-19><a id=__codelineno-115-19 name=__codelineno-115-19 href=#__codelineno-115-19></a><span class=p>})</span>
</span><span id=__span-115-20><a id=__codelineno-115-20 name=__codelineno-115-20 href=#__codelineno-115-20></a>
</span><span id=__span-115-21><a id=__codelineno-115-21 name=__codelineno-115-21 href=#__codelineno-115-21></a><span class=nx>req</span><span class=p>.</span><span class=nx>end</span><span class=p>()</span>
</span></code></pre></div></li> <li>完成一個<code>POST</code>請求(Perform a <code>POST</code> Request) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-116-1><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a><span class=kd>const</span><span class=w> </span><span class=nx>https</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;https&#39;</span><span class=p>)</span>
</span><span id=__span-116-2><a id=__codelineno-116-2 name=__codelineno-116-2 href=#__codelineno-116-2></a>
</span><span id=__span-116-3><a id=__codelineno-116-3 name=__codelineno-116-3 href=#__codelineno-116-3></a><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-116-4><a id=__codelineno-116-4 name=__codelineno-116-4 href=#__codelineno-116-4></a><span class=w>  </span><span class=nx>todo</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Buy the milk&#39;</span>
</span><span id=__span-116-5><a id=__codelineno-116-5 name=__codelineno-116-5 href=#__codelineno-116-5></a><span class=p>})</span>
</span><span id=__span-116-6><a id=__codelineno-116-6 name=__codelineno-116-6 href=#__codelineno-116-6></a>
</span><span id=__span-116-7><a id=__codelineno-116-7 name=__codelineno-116-7 href=#__codelineno-116-7></a><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-8><a id=__codelineno-116-8 name=__codelineno-116-8 href=#__codelineno-116-8></a><span class=w>  </span><span class=nx>hostname</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;whatever.com&#39;</span><span class=p>,</span>
</span><span id=__span-116-9><a id=__codelineno-116-9 name=__codelineno-116-9 href=#__codelineno-116-9></a><span class=w>  </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=mf>443</span><span class=p>,</span>
</span><span id=__span-116-10><a id=__codelineno-116-10 name=__codelineno-116-10 href=#__codelineno-116-10></a><span class=w>  </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/todos&#39;</span><span class=p>,</span>
</span><span id=__span-116-11><a id=__codelineno-116-11 name=__codelineno-116-11 href=#__codelineno-116-11></a><span class=w>  </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span><span class=w>  </span><span class=c1>// 完成一個POST請求 </span>
</span><span id=__span-116-12><a id=__codelineno-116-12 name=__codelineno-116-12 href=#__codelineno-116-12></a><span class=w>  </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-13><a id=__codelineno-116-13 name=__codelineno-116-13 href=#__codelineno-116-13></a><span class=w>    </span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span><span id=__span-116-14><a id=__codelineno-116-14 name=__codelineno-116-14 href=#__codelineno-116-14></a><span class=w>    </span><span class=s1>&#39;Content-Length&#39;</span><span class=o>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>length</span>
</span><span id=__span-116-15><a id=__codelineno-116-15 name=__codelineno-116-15 href=#__codelineno-116-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-116-16><a id=__codelineno-116-16 name=__codelineno-116-16 href=#__codelineno-116-16></a><span class=p>}</span>
</span><span id=__span-116-17><a id=__codelineno-116-17 name=__codelineno-116-17 href=#__codelineno-116-17></a>
</span><span id=__span-116-18><a id=__codelineno-116-18 name=__codelineno-116-18 href=#__codelineno-116-18></a><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>https</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-19><a id=__codelineno-116-19 name=__codelineno-116-19 href=#__codelineno-116-19></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`statusCode: </span><span class=si>${</span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-116-20><a id=__codelineno-116-20 name=__codelineno-116-20 href=#__codelineno-116-20></a>
</span><span id=__span-116-21><a id=__codelineno-116-21 name=__codelineno-116-21 href=#__codelineno-116-21></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-22><a id=__codelineno-116-22 name=__codelineno-116-22 href=#__codelineno-116-22></a><span class=w>    </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
</span><span id=__span-116-23><a id=__codelineno-116-23 name=__codelineno-116-23 href=#__codelineno-116-23></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-116-24><a id=__codelineno-116-24 name=__codelineno-116-24 href=#__codelineno-116-24></a><span class=p>})</span>
</span><span id=__span-116-25><a id=__codelineno-116-25 name=__codelineno-116-25 href=#__codelineno-116-25></a>
</span><span id=__span-116-26><a id=__codelineno-116-26 name=__codelineno-116-26 href=#__codelineno-116-26></a><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-116-27><a id=__codelineno-116-27 name=__codelineno-116-27 href=#__codelineno-116-27></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-116-28><a id=__codelineno-116-28 name=__codelineno-116-28 href=#__codelineno-116-28></a><span class=p>})</span>
</span><span id=__span-116-29><a id=__codelineno-116-29 name=__codelineno-116-29 href=#__codelineno-116-29></a>
</span><span id=__span-116-30><a id=__codelineno-116-30 name=__codelineno-116-30 href=#__codelineno-116-30></a><span class=nx>req</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-116-31><a id=__codelineno-116-31 name=__codelineno-116-31 href=#__codelineno-116-31></a><span class=nx>req</span><span class=p>.</span><span class=nx>end</span><span class=p>()</span>
</span></code></pre></div></li> <li>完成一個<code>PUT</code>與<code>DELETE</code>請求(<code>PUT</code> and <code>DELETE</code>)</li> <li><code>PUT</code>與<code>DELETE</code>請求跟<code>POST</code>請求(request)的格式(format)相同,只要修改<code>options.method</code>這個屬性值就可以用了</li> </ul> <h3 id=make-an-http-post-request-using-nodejs>Make an HTTP POST request using Node.js<a class=headerlink href=#make-an-http-post-request-using-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/http.html#http_http>HTTP</a><br> <a href=https://github.com/axios/axios>Axios套件</a>-Make http requests from node.js<br></p> </blockquote> <ul> <li>根據(depending on)我們想要使用的抽象層級(abstraction level),有多種方法可以完成一個<code>HTTP</code>的<code>POST</code>請求(request)</li> <li>最簡單的方式來完成一個<code>HTTP</code>請求(request)就是利用Node來搭配使用<a href=https://github.com/axios/axios>Axios套件</a> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-117-1><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a><span class=kd>const</span><span class=w> </span><span class=nx>axios</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>)</span>
</span><span id=__span-117-2><a id=__codelineno-117-2 name=__codelineno-117-2 href=#__codelineno-117-2></a>
</span><span id=__span-117-3><a id=__codelineno-117-3 name=__codelineno-117-3 href=#__codelineno-117-3></a><span class=nx>axios</span>
</span><span id=__span-117-4><a id=__codelineno-117-4 name=__codelineno-117-4 href=#__codelineno-117-4></a><span class=w>  </span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;https://whatever.com/todos&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-117-5><a id=__codelineno-117-5 name=__codelineno-117-5 href=#__codelineno-117-5></a><span class=w>    </span><span class=nx>todo</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Buy the milk&#39;</span>
</span><span id=__span-117-6><a id=__codelineno-117-6 name=__codelineno-117-6 href=#__codelineno-117-6></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-117-7><a id=__codelineno-117-7 name=__codelineno-117-7 href=#__codelineno-117-7></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-117-8><a id=__codelineno-117-8 name=__codelineno-117-8 href=#__codelineno-117-8></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`statusCode: </span><span class=si>${</span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-117-9><a id=__codelineno-117-9 name=__codelineno-117-9 href=#__codelineno-117-9></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>
</span><span id=__span-117-10><a id=__codelineno-117-10 name=__codelineno-117-10 href=#__codelineno-117-10></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-117-11><a id=__codelineno-117-11 name=__codelineno-117-11 href=#__codelineno-117-11></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-117-12><a id=__codelineno-117-12 name=__codelineno-117-12 href=#__codelineno-117-12></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-117-13><a id=__codelineno-117-13 name=__codelineno-117-13 href=#__codelineno-117-13></a><span class=w>  </span><span class=p>})</span>
</span></code></pre></div></li> <li><code>axios</code>套件要求(require)使用第三方函式庫(3<sup>rd</sup> party library)</li> <li>其實一個<code>POST</code>請求(request)僅單純使用Node的內建標準函式庫(standard modules)是可行的,但會比先前(preceding)的2個選項(options)來的冗長(verbose) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-118-1><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a><span class=kd>const</span><span class=w> </span><span class=nx>https</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;https&#39;</span><span class=p>)</span>
</span><span id=__span-118-2><a id=__codelineno-118-2 name=__codelineno-118-2 href=#__codelineno-118-2></a>
</span><span id=__span-118-3><a id=__codelineno-118-3 name=__codelineno-118-3 href=#__codelineno-118-3></a><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-118-4><a id=__codelineno-118-4 name=__codelineno-118-4 href=#__codelineno-118-4></a><span class=w>  </span><span class=nx>todo</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Buy the milk&#39;</span>
</span><span id=__span-118-5><a id=__codelineno-118-5 name=__codelineno-118-5 href=#__codelineno-118-5></a><span class=p>})</span>
</span><span id=__span-118-6><a id=__codelineno-118-6 name=__codelineno-118-6 href=#__codelineno-118-6></a>
</span><span id=__span-118-7><a id=__codelineno-118-7 name=__codelineno-118-7 href=#__codelineno-118-7></a><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-118-8><a id=__codelineno-118-8 name=__codelineno-118-8 href=#__codelineno-118-8></a><span class=w>  </span><span class=nx>hostname</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;whatever.com&#39;</span><span class=p>,</span>
</span><span id=__span-118-9><a id=__codelineno-118-9 name=__codelineno-118-9 href=#__codelineno-118-9></a><span class=w>  </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=mf>443</span><span class=p>,</span>
</span><span id=__span-118-10><a id=__codelineno-118-10 name=__codelineno-118-10 href=#__codelineno-118-10></a><span class=w>  </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/todos&#39;</span><span class=p>,</span>
</span><span id=__span-118-11><a id=__codelineno-118-11 name=__codelineno-118-11 href=#__codelineno-118-11></a><span class=w>  </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span><span id=__span-118-12><a id=__codelineno-118-12 name=__codelineno-118-12 href=#__codelineno-118-12></a><span class=w>  </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-118-13><a id=__codelineno-118-13 name=__codelineno-118-13 href=#__codelineno-118-13></a><span class=w>    </span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span><span id=__span-118-14><a id=__codelineno-118-14 name=__codelineno-118-14 href=#__codelineno-118-14></a><span class=w>    </span><span class=s1>&#39;Content-Length&#39;</span><span class=o>:</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>length</span>
</span><span id=__span-118-15><a id=__codelineno-118-15 name=__codelineno-118-15 href=#__codelineno-118-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-118-16><a id=__codelineno-118-16 name=__codelineno-118-16 href=#__codelineno-118-16></a><span class=p>}</span>
</span><span id=__span-118-17><a id=__codelineno-118-17 name=__codelineno-118-17 href=#__codelineno-118-17></a>
</span><span id=__span-118-18><a id=__codelineno-118-18 name=__codelineno-118-18 href=#__codelineno-118-18></a><span class=kd>const</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>https</span><span class=p>.</span><span class=nx>request</span><span class=p>(</span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-118-19><a id=__codelineno-118-19 name=__codelineno-118-19 href=#__codelineno-118-19></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`statusCode: </span><span class=si>${</span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-118-20><a id=__codelineno-118-20 name=__codelineno-118-20 href=#__codelineno-118-20></a>
</span><span id=__span-118-21><a id=__codelineno-118-21 name=__codelineno-118-21 href=#__codelineno-118-21></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>d</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-118-22><a id=__codelineno-118-22 name=__codelineno-118-22 href=#__codelineno-118-22></a><span class=w>    </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>d</span><span class=p>)</span>
</span><span id=__span-118-23><a id=__codelineno-118-23 name=__codelineno-118-23 href=#__codelineno-118-23></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-118-24><a id=__codelineno-118-24 name=__codelineno-118-24 href=#__codelineno-118-24></a><span class=p>})</span>
</span><span id=__span-118-25><a id=__codelineno-118-25 name=__codelineno-118-25 href=#__codelineno-118-25></a>
</span><span id=__span-118-26><a id=__codelineno-118-26 name=__codelineno-118-26 href=#__codelineno-118-26></a><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-118-27><a id=__codelineno-118-27 name=__codelineno-118-27 href=#__codelineno-118-27></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span><span id=__span-118-28><a id=__codelineno-118-28 name=__codelineno-118-28 href=#__codelineno-118-28></a><span class=p>})</span>
</span><span id=__span-118-29><a id=__codelineno-118-29 name=__codelineno-118-29 href=#__codelineno-118-29></a>
</span><span id=__span-118-30><a id=__codelineno-118-30 name=__codelineno-118-30 href=#__codelineno-118-30></a><span class=nx>req</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-118-31><a id=__codelineno-118-31 name=__codelineno-118-31 href=#__codelineno-118-31></a><span class=nx>req</span><span class=p>.</span><span class=nx>end</span><span class=p>()</span>
</span></code></pre></div></li> </ul> <h3 id=get-http-request-body-data-using-nodejs>Get HTTP request body data using Node.js<a class=headerlink href=#get-http-request-body-data-using-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p><a href=https://expressjs.com/ >Express框架</a><br></p> </blockquote> <ul> <li>這是以<code>JSON</code>格式來提取(extract)請求內文(request body)的資料(data)的方式</li> <li>如果我們正在使用<a href=https://expressjs.com/ >Express框架</a>,那很簡單,只要使用Node的<code>body-parser</code>模組</li> <li>舉例來說,假如我們想要獲得請求的內文(request body) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-119-1><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a><span class=kd>const</span><span class=w> </span><span class=nx>axios</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;axios&#39;</span><span class=p>)</span>
</span><span id=__span-119-2><a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a>
</span><span id=__span-119-3><a id=__codelineno-119-3 name=__codelineno-119-3 href=#__codelineno-119-3></a><span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;https://whatever.com/todos&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-119-4><a id=__codelineno-119-4 name=__codelineno-119-4 href=#__codelineno-119-4></a><span class=w>  </span><span class=nx>todo</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Buy the milk&#39;</span>
</span><span id=__span-119-5><a id=__codelineno-119-5 name=__codelineno-119-5 href=#__codelineno-119-5></a><span class=p>})</span>
</span></code></pre></div></li> <li>這會與伺服器端的程式碼(server-side code)相對應(matching) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-120-1><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a><span class=kd>const</span><span class=w> </span><span class=nx>express</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span><span id=__span-120-2><a id=__codelineno-120-2 name=__codelineno-120-2 href=#__codelineno-120-2></a><span class=kd>const</span><span class=w> </span><span class=nx>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>express</span><span class=p>()</span>
</span><span id=__span-120-3><a id=__codelineno-120-3 name=__codelineno-120-3 href=#__codelineno-120-3></a>
</span><span id=__span-120-4><a id=__codelineno-120-4 name=__codelineno-120-4 href=#__codelineno-120-4></a><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span><span id=__span-120-5><a id=__codelineno-120-5 name=__codelineno-120-5 href=#__codelineno-120-5></a><span class=w>  </span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span>
</span><span id=__span-120-6><a id=__codelineno-120-6 name=__codelineno-120-6 href=#__codelineno-120-6></a><span class=w>    </span><span class=nx>extended</span><span class=o>:</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-120-7><a id=__codelineno-120-7 name=__codelineno-120-7 href=#__codelineno-120-7></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-120-8><a id=__codelineno-120-8 name=__codelineno-120-8 href=#__codelineno-120-8></a><span class=p>)</span>
</span><span id=__span-120-9><a id=__codelineno-120-9 name=__codelineno-120-9 href=#__codelineno-120-9></a>
</span><span id=__span-120-10><a id=__codelineno-120-10 name=__codelineno-120-10 href=#__codelineno-120-10></a><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span><span id=__span-120-11><a id=__codelineno-120-11 name=__codelineno-120-11 href=#__codelineno-120-11></a>
</span><span id=__span-120-12><a id=__codelineno-120-12 name=__codelineno-120-12 href=#__codelineno-120-12></a><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/todos&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-120-13><a id=__codelineno-120-13 name=__codelineno-120-13 href=#__codelineno-120-13></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>todo</span><span class=p>)</span>
</span><span id=__span-120-14><a id=__codelineno-120-14 name=__codelineno-120-14 href=#__codelineno-120-14></a><span class=p>})</span>
</span></code></pre></div></li> <li>如果我們沒有在使用<code>Express</code>框架,只想要使用普通的Node來完成此操作的話,那麼就會需要做更多的工作。當然,這是因為<code>Express</code>框架已經幫我們抽象(abstracts)了很多此類的東西了<ul> <li>要理解的關鍵是,當我們利用<code>http.creatServer()</code>方法來初始化一個<code>HTTP</code>伺服器(server)的話,這時當伺服器獲得(get)所有的<code>HTTP</code>請求標頭(request headers)時,而不是請求正文(request body)</li> <li>請求物件(request object)傳遞給回呼函式(callback)的關係(connection)是一種串流(stream)</li> <li>因此我們必須監聽(listen)要處理(processed)的請求正文的內容(body content),並且這個請求正文的內容是成塊處理的(processed in chunks)</li> <li>首先,我們會透過監聽(listening)<code>data</code>這個事件流(event stream),然後當<code>data</code>這個事件流結束(<code>data</code> ends)時,就會呼叫<code>end</code>這個事件流(event stream)一次(once) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-121-1><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-121-2><a id=__codelineno-121-2 name=__codelineno-121-2 href=#__codelineno-121-2></a><span class=w>  </span><span class=c1>// we can access HTTP headers</span>
</span><span id=__span-121-3><a id=__codelineno-121-3 name=__codelineno-121-3 href=#__codelineno-121-3></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>chunk</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-121-4><a id=__codelineno-121-4 name=__codelineno-121-4 href=#__codelineno-121-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Data chunk available: </span><span class=si>${</span><span class=nx>chunk</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-121-5><a id=__codelineno-121-5 name=__codelineno-121-5 href=#__codelineno-121-5></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-121-6><a id=__codelineno-121-6 name=__codelineno-121-6 href=#__codelineno-121-6></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-121-7><a id=__codelineno-121-7 name=__codelineno-121-7 href=#__codelineno-121-7></a><span class=w>    </span><span class=c1>//end of data</span>
</span><span id=__span-121-8><a id=__codelineno-121-8 name=__codelineno-121-8 href=#__codelineno-121-8></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-121-9><a id=__codelineno-121-9 name=__codelineno-121-9 href=#__codelineno-121-9></a><span class=p>})</span>
</span></code></pre></div></li> <li>因此,為了要存取資料(access data),假設我們預期(expect)會收到(receive)一個字串(string),我們必須將其放入(put into)陣列(array)中 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-122-1><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-122-2><a id=__codelineno-122-2 name=__codelineno-122-2 href=#__codelineno-122-2></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span>
</span><span id=__span-122-3><a id=__codelineno-122-3 name=__codelineno-122-3 href=#__codelineno-122-3></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>chunk</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-122-4><a id=__codelineno-122-4 name=__codelineno-122-4 href=#__codelineno-122-4></a><span class=w>    </span><span class=nx>data</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>chunk</span><span class=p>;</span>
</span><span id=__span-122-5><a id=__codelineno-122-5 name=__codelineno-122-5 href=#__codelineno-122-5></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-122-6><a id=__codelineno-122-6 name=__codelineno-122-6 href=#__codelineno-122-6></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-122-7><a id=__codelineno-122-7 name=__codelineno-122-7 href=#__codelineno-122-7></a><span class=w>    </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>data</span><span class=p>).</span><span class=nx>todo</span><span class=w> </span><span class=c1>// &#39;Buy the milk&#39;</span>
</span><span id=__span-122-8><a id=__codelineno-122-8 name=__codelineno-122-8 href=#__codelineno-122-8></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-122-9><a id=__codelineno-122-9 name=__codelineno-122-9 href=#__codelineno-122-9></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=working-with-file-descriptors-in-nodejs>Working with file descriptors in Node.js<a class=headerlink href=#working-with-file-descriptors-in-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_file_system>File system</a><br></p> </blockquote> <ul> <li>在我們能夠代理(sits in)檔案系統(file system)來與檔案(file)互動(interact)之前,我們必須先獲得一個檔案描述符號(file descriptor)</li> <li>一個檔案描述符號(file descriptor)就是透過Node內建的<code>File system</code>核心模組中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_open_path_flags_mode_callback>fs.open()</a>方法來開啟檔案(opening the file)時,所回傳(returned)的東西 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-123-1><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-123-2><a id=__codelineno-123-2 name=__codelineno-123-2 href=#__codelineno-123-2></a>
</span><span id=__span-123-3><a id=__codelineno-123-3 name=__codelineno-123-3 href=#__codelineno-123-3></a><span class=nx>fs</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>fd</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-123-4><a id=__codelineno-123-4 name=__codelineno-123-4 href=#__codelineno-123-4></a><span class=w>  </span><span class=c1>//fd is our file descriptor</span>
</span><span id=__span-123-5><a id=__codelineno-123-5 name=__codelineno-123-5 href=#__codelineno-123-5></a><span class=p>})</span>
</span></code></pre></div><ul> <li>注意到在<code>fs.open()</code>方法所使用的第2個參數,也就是<code>r</code>參數。這個旗幟(flag)意味著(means)我們是用讀取模式(reading)開啟(open)這個檔案(file),其它可能會常用到的旗幟(flags)會有以下幾種</li> <li><code>r+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案</li> <li><code>w+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最前面</strong>(beginning)。當該檔案不存在時,就會建立一份這個檔案</li> <li><code>a</code>: 以寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最後面</strong> (end)。當該檔案不存在時,就會建立一份這個檔案</li> <li><code>a+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最後面</strong>(end)。當該檔案不存在時,就會建立一份這個檔案</li> </ul> </li> <li>我們也可以透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_opensync_path_flags_mode>fs.openSync()</a>方法來開啟檔案,該方法會回傳(returns)一個檔案描述符號(file descriptor),而不是(instead of)提供(providing)一個回呼函式(callback) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-124-1><a id=__codelineno-124-1 name=__codelineno-124-1 href=#__codelineno-124-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-124-2><a id=__codelineno-124-2 name=__codelineno-124-2 href=#__codelineno-124-2></a>
</span><span id=__span-124-3><a id=__codelineno-124-3 name=__codelineno-124-3 href=#__codelineno-124-3></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-124-4><a id=__codelineno-124-4 name=__codelineno-124-4 href=#__codelineno-124-4></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>openSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span><span id=__span-124-5><a id=__codelineno-124-5 name=__codelineno-124-5 href=#__codelineno-124-5></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-124-6><a id=__codelineno-124-6 name=__codelineno-124-6 href=#__codelineno-124-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-124-7><a id=__codelineno-124-7 name=__codelineno-124-7 href=#__codelineno-124-7></a><span class=p>}</span>
</span></code></pre></div><ul> <li>一旦(once)獲得那個檔案描述符號(file descriptor),我們便能運用任何(whatever)我們選擇使用的方式(way)來完成(perform)所有(all)需要(require)檔案描述符號(file descriptor)的操作(operations),像是呼叫(calling)<code>fs.open()</code>方法,以及許多其它用來跟檔案系統(file system)互動(interact with)的操作</li> </ul> </li> </ul> <h3 id=nodejs-file-stats>Node.js file stats<a class=headerlink href=#nodejs-file-stats title="Permanent link">&para;</a></h3> <ul> <li>每個檔案(file)都會帶有(comes with)一組細節(a set of details),可提供給Node用來檢查(inspect)它們所使用</li> <li>特別是使用Node內建的<code>File system</code>核心模組中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_stat_path_options_callback>fs.stat(path[, options], callback)</a>方法。我們呼叫這個方法時,可以傳遞(pass)一個檔案路徑(file path)作為參數,之後一旦Node獲得(get)檔案資訊的細節(file details)後,該方法就會呼叫(call)我們指定的回呼函式(callback function, 也就是該方法的<code>callback</code>參數),並且再提供給這個回呼函式以下的2個參數(parameters)<ul> <li>一段錯誤訊息(an error message)</li> <li>檔案狀態(the file states) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-125-1><a id=__codelineno-125-1 name=__codelineno-125-1 href=#__codelineno-125-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-125-2><a id=__codelineno-125-2 name=__codelineno-125-2 href=#__codelineno-125-2></a><span class=nx>fs</span><span class=p>.</span><span class=nx>stat</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>stats</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-125-3><a id=__codelineno-125-3 name=__codelineno-125-3 href=#__codelineno-125-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-125-4><a id=__codelineno-125-4 name=__codelineno-125-4 href=#__codelineno-125-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-125-5><a id=__codelineno-125-5 name=__codelineno-125-5 href=#__codelineno-125-5></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-125-6><a id=__codelineno-125-6 name=__codelineno-125-6 href=#__codelineno-125-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-125-7><a id=__codelineno-125-7 name=__codelineno-125-7 href=#__codelineno-125-7></a><span class=w>  </span><span class=c1>//we have access to the file stats in `stats`</span>
</span><span id=__span-125-8><a id=__codelineno-125-8 name=__codelineno-125-8 href=#__codelineno-125-8></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li>Node也提供(provides)了一個同步地方法(sync method, 也就是<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_statsync_path_options>fs.statSync(path[, options])</a>方法),用來在直到(until)檔案狀態(file states)準備好(ready)之前,阻擋線程(block the thread) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-126-1><a id=__codelineno-126-1 name=__codelineno-126-1 href=#__codelineno-126-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-126-2><a id=__codelineno-126-2 name=__codelineno-126-2 href=#__codelineno-126-2></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-126-3><a id=__codelineno-126-3 name=__codelineno-126-3 href=#__codelineno-126-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>stats</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>statSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>)</span>
</span><span id=__span-126-4><a id=__codelineno-126-4 name=__codelineno-126-4 href=#__codelineno-126-4></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-126-5><a id=__codelineno-126-5 name=__codelineno-126-5 href=#__codelineno-126-5></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-126-6><a id=__codelineno-126-6 name=__codelineno-126-6 href=#__codelineno-126-6></a><span class=p>}</span>
</span></code></pre></div></li> <li>檔案資訊(file information)就會被包括(included in)在上述範例程式碼中的<code>stats</code>這個變數(variable)中。那麼,我們能從這個<code>stats</code>這個變數中提取(extract)出哪些資訊(information)呢?<ul> <li>答案是非常多(a lot),包括(including)了</li> <li>如果是一個資料夾或是檔案時,請使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_stats_isfile>stats.isFile()</a>方法 &amp; <a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_stats_isdirectory>stats.isDirectory()</a>方法</li> <li>如果是一個符號連結(symbolic link)時,請使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_stats_issymboliclink>stats.isSymbolicLink</a>方法</li> <li>如果是檔案大小(以<code>bytes</code>為單位)的話,請使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_stats_size>stats.size</a>屬性</li> <li>其實還有許多進階方法(advanced method),但是大部分(the bulk of)我們在日常(day-to-day)程式開發(programming)中只會使用到這些而已 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-127-1><a id=__codelineno-127-1 name=__codelineno-127-1 href=#__codelineno-127-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-127-2><a id=__codelineno-127-2 name=__codelineno-127-2 href=#__codelineno-127-2></a><span class=nx>fs</span><span class=p>.</span><span class=nx>stat</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>stats</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-127-3><a id=__codelineno-127-3 name=__codelineno-127-3 href=#__codelineno-127-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-127-4><a id=__codelineno-127-4 name=__codelineno-127-4 href=#__codelineno-127-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-127-5><a id=__codelineno-127-5 name=__codelineno-127-5 href=#__codelineno-127-5></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-127-6><a id=__codelineno-127-6 name=__codelineno-127-6 href=#__codelineno-127-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-127-7><a id=__codelineno-127-7 name=__codelineno-127-7 href=#__codelineno-127-7></a>
</span><span id=__span-127-8><a id=__codelineno-127-8 name=__codelineno-127-8 href=#__codelineno-127-8></a><span class=w>  </span><span class=nx>stats</span><span class=p>.</span><span class=nx>isFile</span><span class=p>()</span><span class=w> </span><span class=c1>//true</span>
</span><span id=__span-127-9><a id=__codelineno-127-9 name=__codelineno-127-9 href=#__codelineno-127-9></a><span class=w>  </span><span class=nx>stats</span><span class=p>.</span><span class=nx>isDirectory</span><span class=p>()</span><span class=w> </span><span class=c1>//false</span>
</span><span id=__span-127-10><a id=__codelineno-127-10 name=__codelineno-127-10 href=#__codelineno-127-10></a><span class=w>  </span><span class=nx>stats</span><span class=p>.</span><span class=nx>isSymbolicLink</span><span class=p>()</span><span class=w> </span><span class=c1>//false</span>
</span><span id=__span-127-11><a id=__codelineno-127-11 name=__codelineno-127-11 href=#__codelineno-127-11></a><span class=w>  </span><span class=nx>stats</span><span class=p>.</span><span class=nx>size</span><span class=w> </span><span class=c1>//1024000 //= 1MB</span>
</span><span id=__span-127-12><a id=__codelineno-127-12 name=__codelineno-127-12 href=#__codelineno-127-12></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=nodejs-file-paths>Node.js File Paths<a class=headerlink href=#nodejs-file-paths title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path>Path</a><br></p> </blockquote> <ul> <li>系統(system)中的每個檔案(every file)都有一個路徑(path)</li> <li>在<code>Linux</code>或是<code>macOS</code>作業系統(Unix-like operating system)時,檔案路徑看起來會像是以下這樣</li> <li><code>/users/joe/file.txt</code></li> <li>然而,<code>Windows</code>作業系統卻是不同的,它的檔案路徑結構(structure)會像是</li> <li><code>C:\users\joe\file.txt</code></li> <li>因此,我們會需要注意(pay attention),當我們在應用程式(application)中使用路徑(paths)時,需要將這個路徑結構的差異(difference)考慮進去(taken into account)</li> <li>我們可以將Node內建的<code>Path</code>這個核心模組,包括(include)到我們的檔案中,並且開始使用這個模組的相關方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-128-1><a id=__codelineno-128-1 name=__codelineno-128-1 href=#__codelineno-128-1></a><span class=kd>const</span><span class=w> </span><span class=nx>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>利用路徑來作為資訊(Getting information out of a path)</li> <li>假如(Given)給定一個路徑(path),我們能透過這個這個路徑來提取(extract)資訊,可以利用以下的幾種方法來完成<ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path_dirname_path>path.dirname(path)</a>: 獲得(get)父目錄(parent folder)的檔案(file)</li> <li><a href>path.basename(path[, ext])</a>: 獲得(get)該檔案名稱(filename part)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path_extname_path>path.extname(path)</a>: 獲得(get)該檔案的副檔名(file extension) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-129-1><a id=__codelineno-129-1 name=__codelineno-129-1 href=#__codelineno-129-1></a><span class=kd>const</span><span class=w> </span><span class=nx>notes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/users/joe/notes.txt&#39;</span>
</span><span id=__span-129-2><a id=__codelineno-129-2 name=__codelineno-129-2 href=#__codelineno-129-2></a>
</span><span id=__span-129-3><a id=__codelineno-129-3 name=__codelineno-129-3 href=#__codelineno-129-3></a><span class=nx>path</span><span class=p>.</span><span class=nx>dirname</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span><span class=w> </span><span class=c1>// /users/joe</span>
</span><span id=__span-129-4><a id=__codelineno-129-4 name=__codelineno-129-4 href=#__codelineno-129-4></a><span class=nx>path</span><span class=p>.</span><span class=nx>basename</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span><span class=w> </span><span class=c1>// notes.txt</span>
</span><span id=__span-129-5><a id=__codelineno-129-5 name=__codelineno-129-5 href=#__codelineno-129-5></a><span class=nx>path</span><span class=p>.</span><span class=nx>extname</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span><span class=w> </span><span class=c1>// .txt</span>
</span></code></pre></div></li> </ul> </li> <li>如果我們想要得到 <strong>不包含</strong> 副檔名(file extension)的檔案名稱(filename)的話,可以利用<code>path.basename()</code>方法,並給定這個方法的第二個參數<code>ext</code>的值,以過濾掉其副檔名 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-130-1><a id=__codelineno-130-1 name=__codelineno-130-1 href=#__codelineno-130-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>basename</span><span class=p>(</span><span class=nx>notes</span><span class=p>,</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>extname</span><span class=p>(</span><span class=nx>notes</span><span class=p>))</span><span class=w> </span><span class=c1>//notes</span>
</span></code></pre></div></li> <li>利用Node內建的<code>path</code>核心模組來完成工作(Working with paths)</li> <li>我們可以利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path_join_paths>path.join([...paths])</a>方法來將兩個或是多個路徑片段(parts of a path)組合起來 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-131-1><a id=__codelineno-131-1 name=__codelineno-131-1 href=#__codelineno-131-1></a><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;joe&#39;</span>
</span><span id=__span-131-2><a id=__codelineno-131-2 name=__codelineno-131-2 href=#__codelineno-131-2></a><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;users&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;notes.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/users/joe/notes.txt&#39;</span>
</span></code></pre></div></li> <li>我們可以利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path_resolve_paths>path.resolve([...paths])</a>方法來把相對路徑(relative path)計算(calculation)成為絕對路徑(absolute path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-132-1><a id=__codelineno-132-1 name=__codelineno-132-1 href=#__codelineno-132-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/Users/joe/joe.txt&#39; if run from my home folder</span>
</span></code></pre></div><ul> <li>在這種情況下(In this case),Node會簡單地(simply)將<code>/joe.txt</code>這個檔案附加(append)到當前的工作目錄中(current working directory)。這時,如果我們指定了第2個目錄參數(second parameter folder),<code>path.resolve()</code>方法會將第1個目錄(first)參數作為基底(as a base) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-133-1><a id=__codelineno-133-1 name=__codelineno-133-1 href=#__codelineno-133-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;tmp&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/Users/joe/tmp/joe.txt&#39; if run from my home folder</span>
</span></code></pre></div></li> <li>如果第1個參數是以斜線(slash, 也就是<code>/</code>)開頭(starts with)的話,那就代表該路徑是一個"絕對路徑"</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/path.html#path_path_normalize_path>path.normalize(path)</a>方法是另一種有用(useful)的函式(function)。當<code>path.normalize(path)</code>方法中的<code>path</code>參數值包含了<code>.</code>or<code>..</code>or<code>//</code>...等等時,該方法就會嘗試(try)去計算(calculate)出真實的路徑位置(actual path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-134-1><a id=__codelineno-134-1 name=__codelineno-134-1 href=#__codelineno-134-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>normalize</span><span class=p>(</span><span class=s1>&#39;/users/joe/..//test.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/users/test.txt&#39;</span>
</span></code></pre></div></li> <li>提醒! <code>path.resolve([...paths])</code>方法與<code>path.normalize(path)</code>方法皆不會檢查其各自的<code>path</code>參數值是否存在。它們僅會(just)根據(based on)它們各自獲得的路徑參數資訊(information)來做計算(calculate)出一個路徑(path)的值而已</li> </ul> <h3 id=reading-files-with-nodejs>Reading files with Node.js<a class=headerlink href=#reading-files-with-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_file_system>File system</a><br></p> </blockquote> <ul> <li>在Node中,要讀取一個檔案能使用的最簡單的方法是<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readfile_path_options_callback>fs.readFile(path[, options], callback)</a> ,並傳遞給這個方法</li> <li>一個指定要讀取檔案的路徑位置(file path)</li> <li>文字編碼規則(encoding)</li> <li>一個將會與檔案資料(file data)一起被呼叫(called with)的回呼函式(callback function)與錯誤(<code>error</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-135-1><a id=__codelineno-135-1 name=__codelineno-135-1 href=#__codelineno-135-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-135-2><a id=__codelineno-135-2 name=__codelineno-135-2 href=#__codelineno-135-2></a>
</span><span id=__span-135-3><a id=__codelineno-135-3 name=__codelineno-135-3 href=#__codelineno-135-3></a><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-135-4><a id=__codelineno-135-4 name=__codelineno-135-4 href=#__codelineno-135-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-135-5><a id=__codelineno-135-5 name=__codelineno-135-5 href=#__codelineno-135-5></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-135-6><a id=__codelineno-135-6 name=__codelineno-135-6 href=#__codelineno-135-6></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-135-7><a id=__codelineno-135-7 name=__codelineno-135-7 href=#__codelineno-135-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-135-8><a id=__codelineno-135-8 name=__codelineno-135-8 href=#__codelineno-135-8></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-135-9><a id=__codelineno-135-9 name=__codelineno-135-9 href=#__codelineno-135-9></a><span class=p>})</span>
</span></code></pre></div></li> <li>或者(Alternatively),我們也可以使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readfilesync_path_options>fs.readFileSync(path[, options])</a>這個同步化(synchronous)地讀取檔案的版本(version) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-136-1><a id=__codelineno-136-1 name=__codelineno-136-1 href=#__codelineno-136-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-136-2><a id=__codelineno-136-2 name=__codelineno-136-2 href=#__codelineno-136-2></a>
</span><span id=__span-136-3><a id=__codelineno-136-3 name=__codelineno-136-3 href=#__codelineno-136-3></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-136-4><a id=__codelineno-136-4 name=__codelineno-136-4 href=#__codelineno-136-4></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=p>)</span>
</span><span id=__span-136-5><a id=__codelineno-136-5 name=__codelineno-136-5 href=#__codelineno-136-5></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-136-6><a id=__codelineno-136-6 name=__codelineno-136-6 href=#__codelineno-136-6></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-136-7><a id=__codelineno-136-7 name=__codelineno-136-7 href=#__codelineno-136-7></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-136-8><a id=__codelineno-136-8 name=__codelineno-136-8 href=#__codelineno-136-8></a><span class=p>}</span>
</span></code></pre></div></li> <li>以上的兩種讀取檔案的方法(<code>fs.readFile()</code>與<code>fs.readFileSync()</code>)都會在回傳資料(returning the data)之前,將整個檔案內容(full content of the file)讀取(read)到記憶體之中(in memory)</li> <li>這也就意味(means)著,大檔案將會對我們的記憶體消耗(memory consumption)與程式的執行速度(speed of execution of the program)帶來重大的影響(major impact)<ul> <li>在這種情況下(In this case),更好的選擇(better option)是透過串流(<code>streams</code>)來讀取檔案內容(read the file content)</li> </ul> </li> </ul> <h3 id=writing-files-with-nodejs>Writing files with Node.js<a class=headerlink href=#writing-files-with-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_file_system>File system</a><br></p> </blockquote> <ul> <li>在Node中,要寫入檔案的最簡單的方法就是使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_writefile_file_data_options_callback>fs.writeFile(file, data[, options], callback)</a>這個API <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-137-1><a id=__codelineno-137-1 name=__codelineno-137-1 href=#__codelineno-137-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-137-2><a id=__codelineno-137-2 name=__codelineno-137-2 href=#__codelineno-137-2></a>
</span><span id=__span-137-3><a id=__codelineno-137-3 name=__codelineno-137-3 href=#__codelineno-137-3></a><span class=kd>const</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Some content!&#39;</span>
</span><span id=__span-137-4><a id=__codelineno-137-4 name=__codelineno-137-4 href=#__codelineno-137-4></a>
</span><span id=__span-137-5><a id=__codelineno-137-5 name=__codelineno-137-5 href=#__codelineno-137-5></a><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-137-6><a id=__codelineno-137-6 name=__codelineno-137-6 href=#__codelineno-137-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-137-7><a id=__codelineno-137-7 name=__codelineno-137-7 href=#__codelineno-137-7></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-137-8><a id=__codelineno-137-8 name=__codelineno-137-8 href=#__codelineno-137-8></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-137-9><a id=__codelineno-137-9 name=__codelineno-137-9 href=#__codelineno-137-9></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-137-10><a id=__codelineno-137-10 name=__codelineno-137-10 href=#__codelineno-137-10></a><span class=w>  </span><span class=c1>//file written successfully</span>
</span><span id=__span-137-11><a id=__codelineno-137-11 name=__codelineno-137-11 href=#__codelineno-137-11></a><span class=p>})</span>
</span></code></pre></div></li> <li>或者(Alternatively),我們也可以使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_writefilesync_file_data_options>fs.writeFileSync(file, data[, options])</a>這個同步化(synchronous)地寫入檔案的版本(version) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-138-1><a id=__codelineno-138-1 name=__codelineno-138-1 href=#__codelineno-138-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-138-2><a id=__codelineno-138-2 name=__codelineno-138-2 href=#__codelineno-138-2></a>
</span><span id=__span-138-3><a id=__codelineno-138-3 name=__codelineno-138-3 href=#__codelineno-138-3></a><span class=kd>const</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Some content!&#39;</span>
</span><span id=__span-138-4><a id=__codelineno-138-4 name=__codelineno-138-4 href=#__codelineno-138-4></a>
</span><span id=__span-138-5><a id=__codelineno-138-5 name=__codelineno-138-5 href=#__codelineno-138-5></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-138-6><a id=__codelineno-138-6 name=__codelineno-138-6 href=#__codelineno-138-6></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>)</span>
</span><span id=__span-138-7><a id=__codelineno-138-7 name=__codelineno-138-7 href=#__codelineno-138-7></a><span class=w>  </span><span class=c1>//file written successfully</span>
</span><span id=__span-138-8><a id=__codelineno-138-8 name=__codelineno-138-8 href=#__codelineno-138-8></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-138-9><a id=__codelineno-138-9 name=__codelineno-138-9 href=#__codelineno-138-9></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-138-10><a id=__codelineno-138-10 name=__codelineno-138-10 href=#__codelineno-138-10></a><span class=p>}</span>
</span></code></pre></div></li> <li>預設情況(By default),當給定的指定路徑下的檔案已經存在(already exist)時,這個API就會取代掉這個檔案的內容(replace the contents of the file)<ul> <li>我們可以透過指定(specifying)一個旗幟(flag)來修改(modify)這個預設模式(the default) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-139-1><a id=__codelineno-139-1 name=__codelineno-139-1 href=#__codelineno-139-1></a><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>flag</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;a+&#39;</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{})</span>
</span></code></pre></div></li> <li>以下是我們可能會用到的旗幟(flags)</li> <li><code>r+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案</li> <li><code>w+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最前面</strong>(beginning)。當該檔案不存在時,就會建立一份這個檔案</li> <li><code>a</code>: 以寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最後面</strong> (end)。當該檔案不存在時,就會建立一份這個檔案</li> <li><code>a+</code>: 以讀取(reading)+寫入(writing)模式來開啟這個檔案,並且將串流(stream)放在(positioning)檔案的 <strong>最後面</strong>(end)。當該檔案不存在時,就會建立一份這個檔案</li> <li>可參考<a href=https://nodejs.org/api/fs.html#fs_file_system_flags>File system flags</a></li> </ul> </li> <li>附加到檔案中(Append to a file)</li> <li>有一個便利(handy)的方法(method)能將內容(content)附加(append)到檔案(file)的最後面(end),就是利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_appendfile_path_data_options_callback>fs.appendFile(path, data[, options], callback)</a>以及它對應的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_appendfilesync_path_data_options>fs.appendFileSync(path, data[, options])</a>這兩種方法, <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-140-1><a id=__codelineno-140-1 name=__codelineno-140-1 href=#__codelineno-140-1></a><span class=kd>const</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Some content!&#39;</span>
</span><span id=__span-140-2><a id=__codelineno-140-2 name=__codelineno-140-2 href=#__codelineno-140-2></a>
</span><span id=__span-140-3><a id=__codelineno-140-3 name=__codelineno-140-3 href=#__codelineno-140-3></a><span class=nx>fs</span><span class=p>.</span><span class=nx>appendFile</span><span class=p>(</span><span class=s1>&#39;file.log&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-140-4><a id=__codelineno-140-4 name=__codelineno-140-4 href=#__codelineno-140-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-140-5><a id=__codelineno-140-5 name=__codelineno-140-5 href=#__codelineno-140-5></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-140-6><a id=__codelineno-140-6 name=__codelineno-140-6 href=#__codelineno-140-6></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-140-7><a id=__codelineno-140-7 name=__codelineno-140-7 href=#__codelineno-140-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-140-8><a id=__codelineno-140-8 name=__codelineno-140-8 href=#__codelineno-140-8></a><span class=w>  </span><span class=c1>//done!</span>
</span><span id=__span-140-9><a id=__codelineno-140-9 name=__codelineno-140-9 href=#__codelineno-140-9></a><span class=p>})</span>
</span></code></pre></div></li> <li>使用串流(Using streams)</li> <li>所有的這些方法們(methods)皆會先將所有的內容(full content)寫入(wrtie)到檔案(file)中,然後再將控制權(control back)交還(returning)給程式(program)<ul> <li>在非同步化版本(async version, 也就是指<code>fs.writeFile()</code>與<code>fs.appendFile()</code>這兩種方法)的方法中,這意味(means)著執行(executing)回呼函式(callback)</li> <li>在這種情況下(In this case),一個更好的選擇(better option)是透過 <strong>串流</strong> (streams)來寫入(write)到檔案內容(file content)中</li> </ul> </li> </ul> <h3 id=working-with-folders-in-nodejs>Working with folders in Node.js<a class=headerlink href=#working-with-folders-in-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_file_system>File system</a><br></p> </blockquote> <ul> <li>Node內建核心(core)的<code>File system</code>模組(module)有提供(provides)了許多便利(handy)的方法(methods),讓我們可以處理檔案目錄(folders)</li> <li>檢查檔案目錄是否存在(Check if a folder exists)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_access_path_mode_callback>fs.access(path[, mode], callback)</a>方法來檢查檔案目錄是否存在</li> <li>建立新的檔案目錄(Create a new folder)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_mkdir_path_options_callback>fs.mkdir(path[, options], callback)</a>與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_mkdirsync_path_options>fs.mkdirSync(path[, options])</a>2種方法來建立新的檔案目錄 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-141-1><a id=__codelineno-141-1 name=__codelineno-141-1 href=#__codelineno-141-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-141-2><a id=__codelineno-141-2 name=__codelineno-141-2 href=#__codelineno-141-2></a>
</span><span id=__span-141-3><a id=__codelineno-141-3 name=__codelineno-141-3 href=#__codelineno-141-3></a><span class=kd>const</span><span class=w> </span><span class=nx>folderName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/Users/joe/test&#39;</span>
</span><span id=__span-141-4><a id=__codelineno-141-4 name=__codelineno-141-4 href=#__codelineno-141-4></a>
</span><span id=__span-141-5><a id=__codelineno-141-5 name=__codelineno-141-5 href=#__codelineno-141-5></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-141-6><a id=__codelineno-141-6 name=__codelineno-141-6 href=#__codelineno-141-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>folderName</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-141-7><a id=__codelineno-141-7 name=__codelineno-141-7 href=#__codelineno-141-7></a><span class=w>    </span><span class=nx>fs</span><span class=p>.</span><span class=nx>mkdirSync</span><span class=p>(</span><span class=nx>folderName</span><span class=p>)</span>
</span><span id=__span-141-8><a id=__codelineno-141-8 name=__codelineno-141-8 href=#__codelineno-141-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-141-9><a id=__codelineno-141-9 name=__codelineno-141-9 href=#__codelineno-141-9></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-141-10><a id=__codelineno-141-10 name=__codelineno-141-10 href=#__codelineno-141-10></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-141-11><a id=__codelineno-141-11 name=__codelineno-141-11 href=#__codelineno-141-11></a><span class=p>}</span>
</span></code></pre></div></li> <li>讀取檔案目錄的內容(Read the content of a directory)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readdir_path_options_callback>fs.readdir(path[, options], callback)</a>與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readdirsync_path_options>fs.readdirSync(path[, options])</a>2種方法來讀取檔案目錄的內容</li> <li>以下這段程式碼會讀取檔案目錄的內容(包含其中的所有檔案(files)與子目錄(subfolders)) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-142-1><a id=__codelineno-142-1 name=__codelineno-142-1 href=#__codelineno-142-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-142-2><a id=__codelineno-142-2 name=__codelineno-142-2 href=#__codelineno-142-2></a><span class=kd>const</span><span class=w> </span><span class=nx>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>
</span><span id=__span-142-3><a id=__codelineno-142-3 name=__codelineno-142-3 href=#__codelineno-142-3></a>
</span><span id=__span-142-4><a id=__codelineno-142-4 name=__codelineno-142-4 href=#__codelineno-142-4></a><span class=kd>const</span><span class=w> </span><span class=nx>folderPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/Users/joe&#39;</span>
</span><span id=__span-142-5><a id=__codelineno-142-5 name=__codelineno-142-5 href=#__codelineno-142-5></a>
</span><span id=__span-142-6><a id=__codelineno-142-6 name=__codelineno-142-6 href=#__codelineno-142-6></a><span class=nx>fs</span><span class=p>.</span><span class=nx>readdirSync</span><span class=p>(</span><span class=nx>folderPath</span><span class=p>)</span>
</span></code></pre></div></li> <li>我們也可以獲得完整(full)的絕對路徑(path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-143-1><a id=__codelineno-143-1 name=__codelineno-143-1 href=#__codelineno-143-1></a><span class=nx>fs</span><span class=p>.</span><span class=nx>readdirSync</span><span class=p>(</span><span class=nx>folderPath</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>fileName</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-143-2><a id=__codelineno-143-2 name=__codelineno-143-2 href=#__codelineno-143-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>folderPath</span><span class=p>,</span><span class=w> </span><span class=nx>fileName</span><span class=p>)</span>
</span><span id=__span-143-3><a id=__codelineno-143-3 name=__codelineno-143-3 href=#__codelineno-143-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>我們也可以將結果(results)做過濾(filter),僅回傳(return)檔案(files)而不(exclude)回傳檔案目錄(folders) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-144-1><a id=__codelineno-144-1 name=__codelineno-144-1 href=#__codelineno-144-1></a><span class=kd>const</span><span class=w> </span><span class=nx>isFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fileName</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-144-2><a id=__codelineno-144-2 name=__codelineno-144-2 href=#__codelineno-144-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>lstatSync</span><span class=p>(</span><span class=nx>fileName</span><span class=p>).</span><span class=nx>isFile</span><span class=p>()</span>
</span><span id=__span-144-3><a id=__codelineno-144-3 name=__codelineno-144-3 href=#__codelineno-144-3></a><span class=p>}</span>
</span><span id=__span-144-4><a id=__codelineno-144-4 name=__codelineno-144-4 href=#__codelineno-144-4></a>
</span><span id=__span-144-5><a id=__codelineno-144-5 name=__codelineno-144-5 href=#__codelineno-144-5></a><span class=nx>fs</span><span class=p>.</span><span class=nx>readdirSync</span><span class=p>(</span><span class=nx>folderPath</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>fileName</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-144-6><a id=__codelineno-144-6 name=__codelineno-144-6 href=#__codelineno-144-6></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>folderPath</span><span class=p>,</span><span class=w> </span><span class=nx>fileName</span><span class=p>)</span>
</span><span id=__span-144-7><a id=__codelineno-144-7 name=__codelineno-144-7 href=#__codelineno-144-7></a><span class=p>})</span>
</span><span id=__span-144-8><a id=__codelineno-144-8 name=__codelineno-144-8 href=#__codelineno-144-8></a><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>isFile</span><span class=p>)</span>
</span></code></pre></div></li> <li>將檔案目錄重新命名(Rename a folder)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_rename_oldpath_newpath_callback>fs.rename(oldPath, newPath, callback)</a>與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_renamesync_oldpath_newpath>fs.renameSync(oldPath, newPath)</a>2種方法來將檔案目錄重新命名<ul> <li>這2個方法的第1個參數(first parameter)是當前的路徑(current path),而第2個參數(second parameter)是新的路徑 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-145-1><a id=__codelineno-145-1 name=__codelineno-145-1 href=#__codelineno-145-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-145-2><a id=__codelineno-145-2 name=__codelineno-145-2 href=#__codelineno-145-2></a>
</span><span id=__span-145-3><a id=__codelineno-145-3 name=__codelineno-145-3 href=#__codelineno-145-3></a><span class=nx>fs</span><span class=p>.</span><span class=nx>rename</span><span class=p>(</span><span class=s1>&#39;/Users/joe&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;/Users/roger&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-145-4><a id=__codelineno-145-4 name=__codelineno-145-4 href=#__codelineno-145-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-145-5><a id=__codelineno-145-5 name=__codelineno-145-5 href=#__codelineno-145-5></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-145-6><a id=__codelineno-145-6 name=__codelineno-145-6 href=#__codelineno-145-6></a><span class=w>    </span><span class=k>return</span>
</span><span id=__span-145-7><a id=__codelineno-145-7 name=__codelineno-145-7 href=#__codelineno-145-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-145-8><a id=__codelineno-145-8 name=__codelineno-145-8 href=#__codelineno-145-8></a><span class=w>  </span><span class=c1>//done</span>
</span><span id=__span-145-9><a id=__codelineno-145-9 name=__codelineno-145-9 href=#__codelineno-145-9></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li><code>fs.renameSync()</code>方法是同步化(synchronous)方法的版本(version) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-146-1><a id=__codelineno-146-1 name=__codelineno-146-1 href=#__codelineno-146-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-146-2><a id=__codelineno-146-2 name=__codelineno-146-2 href=#__codelineno-146-2></a>
</span><span id=__span-146-3><a id=__codelineno-146-3 name=__codelineno-146-3 href=#__codelineno-146-3></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-146-4><a id=__codelineno-146-4 name=__codelineno-146-4 href=#__codelineno-146-4></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>renameSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;/Users/roger&#39;</span><span class=p>)</span>
</span><span id=__span-146-5><a id=__codelineno-146-5 name=__codelineno-146-5 href=#__codelineno-146-5></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-146-6><a id=__codelineno-146-6 name=__codelineno-146-6 href=#__codelineno-146-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-146-7><a id=__codelineno-146-7 name=__codelineno-146-7 href=#__codelineno-146-7></a><span class=p>}</span>
</span></code></pre></div></li> <li>刪除檔案目錄(Remove a folder)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_rmdir_path_options_callback>fs.rmdir(path[, options], callback)</a>與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_rmdirsync_path_options>fs.rmdirSync(path[, options])</a>2種方法來刪除檔案目錄</li> <li>因為刪除一個含有檔案的目錄(a folder that has content)可能比我們需要的複雜(complicated)</li> <li>這時候,最佳的做法是安裝npm上的<a href=https://www.npmjs.com/package/fs-extra>fs-extra</a>套件,它是一個非常熱門且維護良好的套件。<code>fs-extra</code>套件是一個可用來臨時替換(drop-in replacement)Node內建的<code>File system</code>模組的套件,它能基於<code>File system</code>模組之上(on top of it)來提供更多的功能(features)<ul> <li>以這次的範例來說,我們想要使用的功能就是<code>remove()</code>方法。這時候,我們需要先安裝<code>fs-extra</code>套件</li> <li>安裝指令: $ <code>npm install fs-extra</code></li> <li>使用它的<code>remove()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-147-1><a id=__codelineno-147-1 name=__codelineno-147-1 href=#__codelineno-147-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs-extra&#39;</span><span class=p>)</span>
</span><span id=__span-147-2><a id=__codelineno-147-2 name=__codelineno-147-2 href=#__codelineno-147-2></a>
</span><span id=__span-147-3><a id=__codelineno-147-3 name=__codelineno-147-3 href=#__codelineno-147-3></a><span class=kd>const</span><span class=w> </span><span class=nx>folder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/Users/joe&#39;</span>
</span><span id=__span-147-4><a id=__codelineno-147-4 name=__codelineno-147-4 href=#__codelineno-147-4></a>
</span><span id=__span-147-5><a id=__codelineno-147-5 name=__codelineno-147-5 href=#__codelineno-147-5></a><span class=nx>fs</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=nx>folder</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-147-6><a id=__codelineno-147-6 name=__codelineno-147-6 href=#__codelineno-147-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-147-7><a id=__codelineno-147-7 name=__codelineno-147-7 href=#__codelineno-147-7></a><span class=p>})</span>
</span></code></pre></div></li> <li>它也能與<code>Promise</code>物件一起使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-148-1><a id=__codelineno-148-1 name=__codelineno-148-1 href=#__codelineno-148-1></a><span class=nx>fs</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=nx>folder</span><span class=p>)</span>
</span><span id=__span-148-2><a id=__codelineno-148-2 name=__codelineno-148-2 href=#__codelineno-148-2></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-148-3><a id=__codelineno-148-3 name=__codelineno-148-3 href=#__codelineno-148-3></a><span class=w>    </span><span class=c1>//done</span>
</span><span id=__span-148-4><a id=__codelineno-148-4 name=__codelineno-148-4 href=#__codelineno-148-4></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-148-5><a id=__codelineno-148-5 name=__codelineno-148-5 href=#__codelineno-148-5></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-148-6><a id=__codelineno-148-6 name=__codelineno-148-6 href=#__codelineno-148-6></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-148-7><a id=__codelineno-148-7 name=__codelineno-148-7 href=#__codelineno-148-7></a><span class=w>  </span><span class=p>})</span>
</span></code></pre></div></li> <li>或是搭配<code>async/await</code>語法來使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-149-1><a id=__codelineno-149-1 name=__codelineno-149-1 href=#__codelineno-149-1></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>removeFolder</span><span class=p>(</span><span class=nx>folder</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-149-2><a id=__codelineno-149-2 name=__codelineno-149-2 href=#__codelineno-149-2></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-149-3><a id=__codelineno-149-3 name=__codelineno-149-3 href=#__codelineno-149-3></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=nx>folder</span><span class=p>)</span>
</span><span id=__span-149-4><a id=__codelineno-149-4 name=__codelineno-149-4 href=#__codelineno-149-4></a><span class=w>    </span><span class=c1>//done</span>
</span><span id=__span-149-5><a id=__codelineno-149-5 name=__codelineno-149-5 href=#__codelineno-149-5></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-149-6><a id=__codelineno-149-6 name=__codelineno-149-6 href=#__codelineno-149-6></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-149-7><a id=__codelineno-149-7 name=__codelineno-149-7 href=#__codelineno-149-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-149-8><a id=__codelineno-149-8 name=__codelineno-149-8 href=#__codelineno-149-8></a><span class=p>}</span>
</span><span id=__span-149-9><a id=__codelineno-149-9 name=__codelineno-149-9 href=#__codelineno-149-9></a>
</span><span id=__span-149-10><a id=__codelineno-149-10 name=__codelineno-149-10 href=#__codelineno-149-10></a><span class=kd>const</span><span class=w> </span><span class=nx>folder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/Users/joe&#39;</span>
</span><span id=__span-149-11><a id=__codelineno-149-11 name=__codelineno-149-11 href=#__codelineno-149-11></a><span class=nx>removeFolder</span><span class=p>(</span><span class=nx>folder</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=the-nodejs-fs-module>The Node.js fs module<a class=headerlink href=#the-nodejs-fs-module title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_file_system>File system</a><br></p> </blockquote> <ul> <li><code>fs</code>模組提供(provides)了許多非常有用(useful)的功能(functionality)來存取(access) &amp; 與檔案系統(file system)互動(interact)</li> <li>因為<code>fs</code>模組是Node本身內建的核心模組,因此我們不用事先安裝它,我們可以透過以下的方法來簡單地引用它 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-150-1><a id=__codelineno-150-1 name=__codelineno-150-1 href=#__codelineno-150-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>一旦(Once)這樣做,我們就可以開始存取(access)<code>fs</code>模組的其它方法(methods)<ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_access_path_mode_callback>fs.access(path[, mode], callback)</a>: 會檢查(check)該路徑內的檔案是否存在(exists),並且Node有權限(permissions)來存取(access)它</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_appendfile_path_data_options_callback>fs.appendFile(path, data[, options], callback)</a>: 附加(append)資料(data)到檔案(file)中。若該路徑內的檔案不存在(exist)的話,就會建立(created)一個</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_chmod_path_mode_callback>fs.chmod(path, mode, callback)</a>: 更改(change)指定(specified)的檔案(file)的權限(permissions)設定(透過指定一個檔案名稱來完成的)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_lchmod_path_mode_callback>fs.lchmod(path, mode, callback)</a>: 僅<code>macOS</code>作業系統可以使用此方法</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_fchmod_fd_mode_callback>fs.fchmod(fd, mode, callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_chown_path_uid_gid_callback>fs.chown(path, uid, gid, callback)</a>: 更改(change)指定(specified)的檔案(file)的擁有者(owner) &amp; 群組(group)設定(透過指定一個檔案名稱來完成的)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_lchown_path_uid_gid_callback>fs.lchown(path, uid, gid, callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_fchown_fd_uid_gid_callback>fs.fchown(fd, uid, gid, callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_close_fd_callback>fs.close(fd, callback)</a>: 關閉一個檔案描述符號(file descriptor)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_copyfile_src_dest_mode_callback>fs.copyFile(src, dest[, mode], callback)</a>: 複製(copies)一個檔案(file)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createreadstream_path_options>fs.createReadStream(path[, options])</a>: 建立(create)一個可讀取(readable)的檔案串流(file stream)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createwritestream_path_options>fs.createWriteStream(path[, options])</a>: 建立(create)一個可寫入(writable)的檔案串流(file stream)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_link_existingpath_newpath_callback>fs.link(existingPath, newPath, callback)</a>: 建立(create)一個硬連結(hard link)給一個指定的檔案(file)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_mkdir_path_options_callback>fs.mkdir()</a>: 建立(create)一個新的檔案目錄(folder)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_mkdtemp_prefix_options_callback>fs.mkdtemp(prefix[, options], callback)</a>: 建立(create)一個臨時(temporary)的檔案目錄(directory)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_open_path_flags_mode_callback>fs.open(path[, flags[, mode]], callback)</a>: 設定(set)檔案模式(file mode)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readdir_path_options_callback>fs.readdir(path[, options], callback)</a>: 讀取(read)該檔案目錄(directory)的內容(contents)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readfile_path_options_callback>fs.readFile()</a>: 讀取(read)該檔案(file)的內容(content)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_read_fd_buffer_offset_length_position_callback>fs.read(fd, buffer, offset, length, position, callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readlink_path_options_callback>fs.readlink(path[, options], callback)</a>: 讀取(read)符號連結(symbolic link)的值(value)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_realpath_path_options_callback>fs.realpath(path[, options], callback)</a>: 將相對(relative)的檔案路徑(file path)解析(resolve)為完整路徑(full path)=&gt; 也就是將<code>./</code>, <code>../</code> 等等之類的處理掉</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_rename_oldpath_newpath_callback>fs.rename(oldPath, newPath, callback)</a>: 將檔案(file)或是檔案目錄(folder)重新命名(rename)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_rmdir_path_options_callback>fs.rmdir(path[, options], callback)</a>: 移除(remove)指定的檔案目錄(folder)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_stat_path_options_callback>fs.stat(path[, options], callback)</a>: 回傳(returns)檔案(file)的狀態(status)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_fstat_fd_options_callback>fs.fstat(fd[, options], callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_lstat_path_options_callback>fs.lstat(path[, options], callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_symlink_target_path_type_callback>fs.symlink(target, path[, type], callback)</a>: 建立(create)一個新的符號連結(symbolic link)給指定的檔案(file)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_truncate_path_len_callback>fs.truncate(path[, len], callback)</a>: 將指定的檔案名稱縮短為指定的長度( specified length)=&gt; (透過指定一個檔案名稱來完成的)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_ftruncate_fd_len_callback>fs.ftruncate(fd[, len], callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_unlink_path_callback>fs.unlink(path, callback)</a>: 移除一個檔案的符號連結(symbolic link)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_unwatchfile_filename_listener>fs.unwatchFile(filename[, listener])</a>: 停止(stop)查看(watching)一個檔案(file)的修改(changes)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_utimes_path_atime_mtime_callback>fs.utimes(path, atime, mtime, callback)</a>: 更改(change)一個檔案的時間戳記=&gt; (透過指定一個檔案名稱來完成的)(timestamp)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_futimes_fd_atime_mtime_callback>fs.futimes(fd, atime, mtime, callback)</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_watchfile_filename_options_listener>fs.watchFile(filename[, options], listener)</a>: 開始(start)查看(watching)一個檔案(file)的修改(changes)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_watch_filename_options_listener>fs.watch(filename[, options][, listener])</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_writefile_file_data_options_callback>fs.writeFile(file, data[, options], callback)</a>: 將資料(data)寫入(write)檔案(file)中</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_write_fd_buffer_offset_length_position_callback>fs.write(fd, buffer[, offset[, length[, position]]], callback)</a></li> </ul> </li> <li>關於<code>fs</code>模組有一件奇怪的事情是所有方法 <strong>預設</strong> 都是 <strong>非同步的</strong> (asynchronous),然而這些方法也都能同步化地(synchronously)使用(=&gt; 只要在各方法後面加上<code>Sync</code>語法就可以了)</li> <li>以下範例說明</li> <li><code>fs.rename()</code><ul> <li><code>fs.renameSync()</code></li> </ul> </li> <li><code>fs.write()</code><ul> <li><code>fs.writeSync()</code></li> </ul> </li> <li>這麼做會造成(makes)我們的應用程式(application)的工作流(flow)有極大(huge)的差異(difference) &gt; Node <code>v10.0.0</code>開始,<code>fs</code>模組開始引入了<a href=https://nodejs.org/api/fs.html#fs_fs_promises_api>fs Promises API</a><ul> <li>舉例來說,我們來檢查(check)一下<code>fs.rename()</code>方法,利用回呼函式(callback)的方法來使用非同步化(asynchronous)的API <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-151-1><a id=__codelineno-151-1 name=__codelineno-151-1 href=#__codelineno-151-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-151-2><a id=__codelineno-151-2 name=__codelineno-151-2 href=#__codelineno-151-2></a>
</span><span id=__span-151-3><a id=__codelineno-151-3 name=__codelineno-151-3 href=#__codelineno-151-3></a><span class=nx>fs</span><span class=p>.</span><span class=nx>rename</span><span class=p>(</span><span class=s1>&#39;before.json&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;after.json&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-151-4><a id=__codelineno-151-4 name=__codelineno-151-4 href=#__codelineno-151-4></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-151-5><a id=__codelineno-151-5 name=__codelineno-151-5 href=#__codelineno-151-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-151-6><a id=__codelineno-151-6 name=__codelineno-151-6 href=#__codelineno-151-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-151-7><a id=__codelineno-151-7 name=__codelineno-151-7 href=#__codelineno-151-7></a>
</span><span id=__span-151-8><a id=__codelineno-151-8 name=__codelineno-151-8 href=#__codelineno-151-8></a><span class=w>  </span><span class=c1>//done</span>
</span><span id=__span-151-9><a id=__codelineno-151-9 name=__codelineno-151-9 href=#__codelineno-151-9></a><span class=p>})</span>
</span></code></pre></div></li> <li>同步化(synchronous)的API可以這樣來使用,並搭配<code>try/catch</code>區塊(block)來處理(handle)錯誤(error) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-152-1><a id=__codelineno-152-1 name=__codelineno-152-1 href=#__codelineno-152-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-152-2><a id=__codelineno-152-2 name=__codelineno-152-2 href=#__codelineno-152-2></a>
</span><span id=__span-152-3><a id=__codelineno-152-3 name=__codelineno-152-3 href=#__codelineno-152-3></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-152-4><a id=__codelineno-152-4 name=__codelineno-152-4 href=#__codelineno-152-4></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>renameSync</span><span class=p>(</span><span class=s1>&#39;before.json&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;after.json&#39;</span><span class=p>)</span>
</span><span id=__span-152-5><a id=__codelineno-152-5 name=__codelineno-152-5 href=#__codelineno-152-5></a><span class=w>  </span><span class=c1>//done</span>
</span><span id=__span-152-6><a id=__codelineno-152-6 name=__codelineno-152-6 href=#__codelineno-152-6></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-152-7><a id=__codelineno-152-7 name=__codelineno-152-7 href=#__codelineno-152-7></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-152-8><a id=__codelineno-152-8 name=__codelineno-152-8 href=#__codelineno-152-8></a><span class=p>}</span>
</span></code></pre></div></li> <li>以上這兩種範例的主要(key)差別(difference)是, <strong>第2個範例</strong> 腳本(script)的 <strong>執行(execution)將會被阻塞(block)</strong> ,直到檔案(file)操作(operation)成功(succeeded)</li> </ul> </li> </ul> <h3 id=the-nodejs-path-module>The Node.js path module<a class=headerlink href=#the-nodejs-path-module title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/path.html#path_path>Path</a><br></p> </blockquote> <ul> <li>Node的<a href=https://nodejs.org/api/path.html#path_path>Path</a>內建核心模組,提供(provides)了許多非常有用(useful)的功能(functionality),來存取(access) &amp; 與檔案系統(file system)互動(interact)</li> <li><code>path</code>模組"不需要"(no need to)事先安裝(install it),才能使用。因為它本身已經是Node的核心模組(core)的一部分(part of)了,它能夠簡單地(simply)透過引用(=&gt; <code>require</code>語法)來使用<code>path</code>模組 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-153-1><a id=__codelineno-153-1 name=__codelineno-153-1 href=#__codelineno-153-1></a><span class=kd>const</span><span class=w> </span><span class=nx>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li><code>path</code>模組有提供<a href=https://nodejs.org/api/path.html#path_path_sep>path.sep</a>屬性,來作為路徑的分隔符號(path segment separator)<ul> <li>也就是說,在Windows作業系統會是<code>\</code>; 而在Linux/macOS作業系統會是<code>/</code></li> </ul> </li> <li><code>path</code>模組有提供<a href=https://nodejs.org/api/path.html#path_path_delimiter>path.delimiter</a>屬性,來作為路徑的定界符(path delimiter)<ul> <li>也就是說,在Windows作業系統會是<code>;</code>; 而在Linux/macOS作業系統會是<code>:</code></li> </ul> </li> <li>以下是<code>path</code>模組常會用到的方法(methods)</li> <li><a href=https://nodejs.org/api/path.html#path_path_basename_path_ext>path.basename(path[, ext])</a><ul> <li>該方法會回傳(return)整個路徑(path)的最後一個(last)部分(portion); 而該方法的第2個參數(parameter)可以用來過濾掉(filter out)副檔名(file extension) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-154-1><a id=__codelineno-154-1 name=__codelineno-154-1 href=#__codelineno-154-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>basename</span><span class=p>(</span><span class=s1>&#39;/test/something&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//something</span>
</span><span id=__span-154-2><a id=__codelineno-154-2 name=__codelineno-154-2 href=#__codelineno-154-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>basename</span><span class=p>(</span><span class=s1>&#39;/test/something.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//something.txt</span>
</span><span id=__span-154-3><a id=__codelineno-154-3 name=__codelineno-154-3 href=#__codelineno-154-3></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>basename</span><span class=p>(</span><span class=s1>&#39;/test/something.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//something</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_dirname_path>path.dirname(path)</a><ul> <li>該方法會回傳(return)其檔案路徑(path)參數(parameter)的檔案目錄(directory)的部分(part) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-155-1><a id=__codelineno-155-1 name=__codelineno-155-1 href=#__codelineno-155-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>dirname</span><span class=p>(</span><span class=s1>&#39;/test/something&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// /test</span>
</span><span id=__span-155-2><a id=__codelineno-155-2 name=__codelineno-155-2 href=#__codelineno-155-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>dirname</span><span class=p>(</span><span class=s1>&#39;/test/something/file.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// /test/something</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_extname_path>path.extname(path)</a><ul> <li>該方法會回傳(return)其檔案路徑(path)參數(parameter)的副檔名(file extension)的部分(part) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-156-1><a id=__codelineno-156-1 name=__codelineno-156-1 href=#__codelineno-156-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>extname</span><span class=p>(</span><span class=s1>&#39;/test/something&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// &#39;&#39;</span>
</span><span id=__span-156-2><a id=__codelineno-156-2 name=__codelineno-156-2 href=#__codelineno-156-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>extname</span><span class=p>(</span><span class=s1>&#39;/test/something/file.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// &#39;.txt&#39;</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_isabsolute_path>path.isAbsolute(path)</a><ul> <li>該方法會回傳(return)其檔案路徑(path)參數(parameter)是否為一種"絕對路徑"的形式 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-157-1><a id=__codelineno-157-1 name=__codelineno-157-1 href=#__codelineno-157-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>isAbsolute</span><span class=p>(</span><span class=s1>&#39;/test/something&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// true</span>
</span><span id=__span-157-2><a id=__codelineno-157-2 name=__codelineno-157-2 href=#__codelineno-157-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>isAbsolute</span><span class=p>(</span><span class=s1>&#39;./test/something&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>// false</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_join_paths>path.join([...paths])</a><ul> <li>該方法會結合路徑(path)的2個or多個部分(part) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-158-1><a id=__codelineno-158-1 name=__codelineno-158-1 href=#__codelineno-158-1></a><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;joe&#39;</span>
</span><span id=__span-158-2><a id=__codelineno-158-2 name=__codelineno-158-2 href=#__codelineno-158-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;users&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;notes.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/users/joe/notes.txt&#39;</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_normalize_path>path.normalize(path)</a><ul> <li>該方法會嘗試(tries to)去計算(calculate)其檔案路徑(path)參數(parameter)的真實路徑(actual path) (=&gt; 當這個檔案路徑參數(<code>path</code>)有包含(contains)了<code>.</code> or <code>..</code> or <code>//</code>... 等等之類的相對說明符(relative specifiers))</li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_parse_path>path.parse(path)</a><ul> <li>該方法會以一個物件(object)的形式,將其檔案路徑(path)參數(parameter)解析(parses)為多個重要片段(segments),來組成(compose)出這個路徑物件</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-159-1><a id=__codelineno-159-1 name=__codelineno-159-1 href=#__codelineno-159-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>parse</span><span class=p>(</span><span class=s1>&#39;/users/test.txt&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>上述的範例程式碼,將會回傳 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-160-1><a id=__codelineno-160-1 name=__codelineno-160-1 href=#__codelineno-160-1></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-160-2><a id=__codelineno-160-2 name=__codelineno-160-2 href=#__codelineno-160-2></a><span class=w>    </span><span class=nx>root</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span><span id=__span-160-3><a id=__codelineno-160-3 name=__codelineno-160-3 href=#__codelineno-160-3></a><span class=w>    </span><span class=nx>dir</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/users&#39;</span><span class=p>,</span>
</span><span id=__span-160-4><a id=__codelineno-160-4 name=__codelineno-160-4 href=#__codelineno-160-4></a><span class=w>    </span><span class=nx>base</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;test.txt&#39;</span><span class=p>,</span>
</span><span id=__span-160-5><a id=__codelineno-160-5 name=__codelineno-160-5 href=#__codelineno-160-5></a><span class=w>    </span><span class=nx>ext</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;.txt&#39;</span><span class=p>,</span>
</span><span id=__span-160-6><a id=__codelineno-160-6 name=__codelineno-160-6 href=#__codelineno-160-6></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;test&#39;</span>
</span><span id=__span-160-7><a id=__codelineno-160-7 name=__codelineno-160-7 href=#__codelineno-160-7></a><span class=w>  </span><span class=p>}</span>
</span></code></pre></div></li> <li><code>root</code>: 根目錄(root)</li> <li><code>dir</code>: 從根目錄(root)開始(starting from)的檔案目錄的路徑(folder path)</li> <li><code>base</code>: 檔案名稱(file name)+副檔名(file extension)</li> <li><code>name</code>: 檔案名稱(file name)</li> <li><code>ext</code>: 檔案的副檔名(file extension)</li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_relative_from_to>path.relative(from, to)</a><ul> <li>該方法會接受(accepts)2個檔案路徑(paths)作為參數(arguments),並以(based on)當前(current)工作目錄(working directory)的位置的角度,回傳(returns)一個從第1個參數(=&gt; <code>from</code>)到第2個參數(=&gt; <code>to</code>)的相對路徑(relative path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-161-1><a id=__codelineno-161-1 name=__codelineno-161-1 href=#__codelineno-161-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>relative</span><span class=p>(</span><span class=s1>&#39;/Users/joe&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;test.txt&#39;</span>
</span><span id=__span-161-2><a id=__codelineno-161-2 name=__codelineno-161-2 href=#__codelineno-161-2></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>).</span><span class=nx>relative</span><span class=p>(</span><span class=s1>&#39;/Users/joe&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;/Users/joe/something/test.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;something/test.txt&#39;</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/path.html#path_path_resolve_paths>path.resolve([...paths])</a><ul> <li>我們利用此方法,來將相對路徑(relative path)計算(calculation)出絕對路徑(absolute path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-162-1><a id=__codelineno-162-1 name=__codelineno-162-1 href=#__codelineno-162-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/Users/joe/joe.txt&#39; if run from my home folder</span>
</span></code></pre></div></li> <li>透過指定第2個參數(parameter),<code>path.resolve()</code>方法會使用第1個參數為基礎來解析(resolve)第2個參數 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-163-1><a id=__codelineno-163-1 name=__codelineno-163-1 href=#__codelineno-163-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;tmp&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/Users/joe/tmp/joe.txt&#39; if run from my home folder</span>
</span></code></pre></div></li> <li>如果第一個參數(parameter)是以斜線(slash)開頭(starts with)的話,就表示(means)這是一個絕對路徑(absolute path) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-164-1><a id=__codelineno-164-1 name=__codelineno-164-1 href=#__codelineno-164-1></a><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;/etc&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span><span class=w> </span><span class=c1>//&#39;/etc/joe.txt&#39;</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=the-nodejs-os-module>The Node.js os module<a class=headerlink href=#the-nodejs-os-module title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/os.html#os_os>OS</a><br></p> </blockquote> <ul> <li>這個模組會提供(provides)許多功能(functions)讓我們能夠跟底層作業系統(underlying operating system) &amp; 該程式運行時所在的電腦(the computer the program runs on)做互動(interact)並檢索其資訊(retrieve information)</li> <li><code>js const os = require('os')</code></li> <li>在<code>os</code>模組之中,有一些有用(useful)的屬性(properties)能告訴我們一些與處理檔案(handling files)有關的(related to)重要的事情(key things),像是以下屬性們<ul> <li><a href=https://nodejs.org/api/os.html#os_os_eol>os.EOL</a></li> <li>該屬性會給出(gives)定界符(delimiter)序列(sequence)。在Linux/macOS作業系統中就是<code>\n</code>,而在Windows作業系統中會是<code>\r\n</code></li> <li><a href=https://nodejs.org/api/os.html#os_signal_constants>os.constants.signal</a></li> <li>該屬性會告訴我們所有跟處理(handling)進程(process)信號(signals)有關(releated to)的常數(constants),像是<code>SIGHUP</code>, <code>SIGKILL</code>, ...等等之類的</li> <li><a href=https://nodejs.org/api/os.html#os_error_constants>os.constants.errorno</a></li> <li>該屬性會設定(sets)錯誤報告(error reporting)的常數(constants),像是<code>EADDRINUSE</code>, <code>EOVERFLOW</code>, ...等等之類的</li> </ul> </li> <li>接下來,我們來看看<code>os</code>模組中主要會用到的方法(methods)</li> <li><a href=https://nodejs.org/api/os.html#os_os_arch>os.arch()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifies)此底層作業系統( underlying)的架構(architecture),像是<code>arm</code>, <code>x64</code>, <code>arm64</code></li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_cpus>os.cpus()</a><ul> <li>該方法會回傳(return)一個陣列(array)來表示我們的作業系統(system)上有多少可用(available)的中央處理器們(CPUs)的資源的資訊(information)</li> <li><code>js [ { model: 'Intel(R) Core(TM)2 Duo CPU P8600 @ 2.40GHz', speed: 2400, times: { user: 281685380, nice: 0, sys: 187986530, idle: 685833750, irq: 0 } }, { model: 'Intel(R) Core(TM)2 Duo CPU P8600 @ 2.40GHz', speed: 2400, times: { user: 282348700, nice: 0, sys: 161800480, idle: 703509470, irq: 0 } } ]</code></li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_endianness>os.endianness()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifying)此作業系統的中央處理器(CPU)資源的字節序(endianness),僅會回傳<code>BE</code>或是<code>LE</code></li> <li>可參考維基百科的<a href=https://en.wikipedia.org/wiki/Endianness>Big Endian or Little Endian</a></li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_freemem>os.freemem</a><ul> <li>該方法會回傳(return)一個整數(integer, =&gt; 以<code>bytes</code>為單位)來代表(represent)此作業系統的記憶體(memory)資源</li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_homedir>os.homedir()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示當前(current)使用者(user)的家目錄(home directory)</li> <li><code>bash '/Users/joe'</code></li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_hostname>os.hostname()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示該作業系統(operating system)的主機名稱(host name)</li> </ul> </li> <li><a href=https://nodejs.org/api/os.html#os_os_loadavg>os.loadavg()</a><ul> <li>該方法會回傳(return)一個陣列(array)來表示該作業系統(operating system)於第<code>1</code>, <code>5</code>, <code>15</code>分鐘(這三個時段的時候),計算(calculation)出載入(load)所花費的平均時間(average) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-165-1><a id=__codelineno-165-1 name=__codelineno-165-1 href=#__codelineno-165-1></a><span class=p>[</span><span class=mf>3.68798828125</span><span class=p>,</span><span class=w> </span><span class=mf>4.00244140625</span><span class=p>,</span><span class=w> </span><span class=mf>11.1181640625</span><span class=p>]</span>
</span></code></pre></div></li> <li><strong>注意! <code>load average</code>這個值只對Linux/macOS作業系統才有用</strong></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_networkinterfaces>os.networkInterfaces()</a><ul> <li>該方法會回傳(returns)一個物件(object),包含此作業系統(system)中可用(available)的網路介面(network interfaces)的細節資訊(details) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-166-1><a id=__codelineno-166-1 name=__codelineno-166-1 href=#__codelineno-166-1></a><span class=p>{</span><span class=w> </span><span class=nx>lo0</span><span class=o>:</span>
</span><span id=__span-166-2><a id=__codelineno-166-2 name=__codelineno-166-2 href=#__codelineno-166-2></a><span class=w>  </span><span class=p>[</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span><span id=__span-166-3><a id=__codelineno-166-3 name=__codelineno-166-3 href=#__codelineno-166-3></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;255.0.0.0&#39;</span><span class=p>,</span>
</span><span id=__span-166-4><a id=__codelineno-166-4 name=__codelineno-166-4 href=#__codelineno-166-4></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv4&#39;</span><span class=p>,</span>
</span><span id=__span-166-5><a id=__codelineno-166-5 name=__codelineno-166-5 href=#__codelineno-166-5></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe:82:00:00:00:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-6><a id=__codelineno-166-6 name=__codelineno-166-6 href=#__codelineno-166-6></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-166-7><a id=__codelineno-166-7 name=__codelineno-166-7 href=#__codelineno-166-7></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;::1&#39;</span><span class=p>,</span>
</span><span id=__span-166-8><a id=__codelineno-166-8 name=__codelineno-166-8 href=#__codelineno-166-8></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&#39;</span><span class=p>,</span>
</span><span id=__span-166-9><a id=__codelineno-166-9 name=__codelineno-166-9 href=#__codelineno-166-9></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv6&#39;</span><span class=p>,</span>
</span><span id=__span-166-10><a id=__codelineno-166-10 name=__codelineno-166-10 href=#__codelineno-166-10></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe:82:00:00:00:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-11><a id=__codelineno-166-11 name=__codelineno-166-11 href=#__codelineno-166-11></a><span class=w>      </span><span class=nx>scopeid</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
</span><span id=__span-166-12><a id=__codelineno-166-12 name=__codelineno-166-12 href=#__codelineno-166-12></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-166-13><a id=__codelineno-166-13 name=__codelineno-166-13 href=#__codelineno-166-13></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe80::1&#39;</span><span class=p>,</span>
</span><span id=__span-166-14><a id=__codelineno-166-14 name=__codelineno-166-14 href=#__codelineno-166-14></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;ffff:ffff:ffff:ffff::&#39;</span><span class=p>,</span>
</span><span id=__span-166-15><a id=__codelineno-166-15 name=__codelineno-166-15 href=#__codelineno-166-15></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv6&#39;</span><span class=p>,</span>
</span><span id=__span-166-16><a id=__codelineno-166-16 name=__codelineno-166-16 href=#__codelineno-166-16></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe:82:00:00:00:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-17><a id=__codelineno-166-17 name=__codelineno-166-17 href=#__codelineno-166-17></a><span class=w>      </span><span class=nx>scopeid</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
</span><span id=__span-166-18><a id=__codelineno-166-18 name=__codelineno-166-18 href=#__codelineno-166-18></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>],</span>
</span><span id=__span-166-19><a id=__codelineno-166-19 name=__codelineno-166-19 href=#__codelineno-166-19></a><span class=w>  </span><span class=nx>en1</span><span class=o>:</span>
</span><span id=__span-166-20><a id=__codelineno-166-20 name=__codelineno-166-20 href=#__codelineno-166-20></a><span class=w>  </span><span class=p>[</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe82::9b:8282:d7e6:496e&#39;</span><span class=p>,</span>
</span><span id=__span-166-21><a id=__codelineno-166-21 name=__codelineno-166-21 href=#__codelineno-166-21></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;ffff:ffff:ffff:ffff::&#39;</span><span class=p>,</span>
</span><span id=__span-166-22><a id=__codelineno-166-22 name=__codelineno-166-22 href=#__codelineno-166-22></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv6&#39;</span><span class=p>,</span>
</span><span id=__span-166-23><a id=__codelineno-166-23 name=__codelineno-166-23 href=#__codelineno-166-23></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;06:00:00:02:0e:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-24><a id=__codelineno-166-24 name=__codelineno-166-24 href=#__codelineno-166-24></a><span class=w>      </span><span class=nx>scopeid</span><span class=o>:</span><span class=w> </span><span class=mf>5</span><span class=p>,</span>
</span><span id=__span-166-25><a id=__codelineno-166-25 name=__codelineno-166-25 href=#__codelineno-166-25></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-166-26><a id=__codelineno-166-26 name=__codelineno-166-26 href=#__codelineno-166-26></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;192.168.1.38&#39;</span><span class=p>,</span>
</span><span id=__span-166-27><a id=__codelineno-166-27 name=__codelineno-166-27 href=#__codelineno-166-27></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;255.255.255.0&#39;</span><span class=p>,</span>
</span><span id=__span-166-28><a id=__codelineno-166-28 name=__codelineno-166-28 href=#__codelineno-166-28></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv4&#39;</span><span class=p>,</span>
</span><span id=__span-166-29><a id=__codelineno-166-29 name=__codelineno-166-29 href=#__codelineno-166-29></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;06:00:00:02:0e:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-30><a id=__codelineno-166-30 name=__codelineno-166-30 href=#__codelineno-166-30></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>],</span>
</span><span id=__span-166-31><a id=__codelineno-166-31 name=__codelineno-166-31 href=#__codelineno-166-31></a><span class=w>  </span><span class=nx>utun0</span><span class=o>:</span>
</span><span id=__span-166-32><a id=__codelineno-166-32 name=__codelineno-166-32 href=#__codelineno-166-32></a><span class=w>  </span><span class=p>[</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>address</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe80::2513:72bc:f405:61d0&#39;</span><span class=p>,</span>
</span><span id=__span-166-33><a id=__codelineno-166-33 name=__codelineno-166-33 href=#__codelineno-166-33></a><span class=w>      </span><span class=nx>netmask</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;ffff:ffff:ffff:ffff::&#39;</span><span class=p>,</span>
</span><span id=__span-166-34><a id=__codelineno-166-34 name=__codelineno-166-34 href=#__codelineno-166-34></a><span class=w>      </span><span class=nx>family</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IPv6&#39;</span><span class=p>,</span>
</span><span id=__span-166-35><a id=__codelineno-166-35 name=__codelineno-166-35 href=#__codelineno-166-35></a><span class=w>      </span><span class=nx>mac</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;fe:80:00:20:00:00&#39;</span><span class=p>,</span>
</span><span id=__span-166-36><a id=__codelineno-166-36 name=__codelineno-166-36 href=#__codelineno-166-36></a><span class=w>      </span><span class=nx>scopeid</span><span class=o>:</span><span class=w> </span><span class=mf>8</span><span class=p>,</span>
</span><span id=__span-166-37><a id=__codelineno-166-37 name=__codelineno-166-37 href=#__codelineno-166-37></a><span class=w>      </span><span class=nx>internal</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>]</span><span class=w> </span>
</span><span id=__span-166-38><a id=__codelineno-166-38 name=__codelineno-166-38 href=#__codelineno-166-38></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_platform>os.platform()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifying)此作業系統(operating system)的被編譯(compiled for)的平台(platform)。以下是可能的回傳值</li> <li><code>darwin</code></li> <li><code>freebsd</code></li> <li><code>linux</code></li> <li><code>openbsd</code></li> <li><code>win32</code></li> <li>...等等之類的</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_release>os.release()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifying)此作業系統(operating system)與其版本號(release number)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_tmpdir>os.tmpdir()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifying)此作業系統的臨時檔案會存放在哪個檔案目錄(temp folder)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_totalmem>os.totalmem()</a><ul> <li>該方法會回傳(return)一個整數(string)來代表(represent)此作業系統(operating system)中可用(available)的總記憶體量(total memory, =&gt; 以<code>bytes</code>為單位來表示)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_type>os.type()</a><ul> <li>該方法會回傳(return)一個字串(string)來表示(identifying)目前所在的作業系統名稱(operating system name)是什麼。以下是最常見的3種作業系統分別對應的值</li> <li><code>Linux</code>作業系統: Linux</li> <li><code>macOS</code>作業系統: Darwin</li> <li><code>Windows</code>作業系統: Windows_NT</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_uptime>os.uptime()</a><ul> <li>該方法會回傳(return)一個整數(integer)來表示自從(since)上次電腦重開機(last rebooted)到現在,已經運行(running)了多久(=&gt; 以"秒"為單位)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/os.html#os_os_userinfo_options>os.userInfo([options])</a><ul> <li>該方法會回傳(returns)一個物件(object)包含了當前的使用者名稱(username), 使用者ID(uid), 群組ID(gid), shell, 家目錄(homedir), ...等等之類的</li> </ul> </li> </ul> <h3 id=the-nodejs-events-module>The Node.js events module<a class=headerlink href=#the-nodejs-events-module title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_events>Events</a><br></p> </blockquote> <ul> <li><strong><code>event</code>模組(module)會提供(provides)我們EventEmitter類別(class),這是在Node中處理事件們(events)的關鍵(key)</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-167-1><a id=__codelineno-167-1 name=__codelineno-167-1 href=#__codelineno-167-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>)</span>
</span><span id=__span-167-2><a id=__codelineno-167-2 name=__codelineno-167-2 href=#__codelineno-167-2></a><span class=kd>const</span><span class=w> </span><span class=nx>door</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>()</span>
</span></code></pre></div></li> <li>事件監聽器(Event listener)會吃(eats)它自己(its own)的狗食(dog food),並使用(uses)以下的事件(events)<ul> <li><code>newListener</code>: 當事件監聽器(event listener)被新增(added)時</li> <li><code>removeListener</code>: 當事件監聽器(event listener)被移除(removed)時</li> </ul> </li> <li>以下是<code>event</code>模組(module)中常用的方法(methods)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_addlistener_eventname_listener>emitter.addListener(eventName, listener)</a><ul> <li>該方法會新增(adds)一個事件監聽器函式(<code>listener</code> function)到事件監聽器陣列(<code>listeners</code> array)的最後面(end)</li> <li>等同於<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_on_eventname_listener>emitter.on(eventName, listener)</a></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_emit_eventname_args>emitter.emit(eventName[, ...args])</a><ul> <li>發出(Emits)一個事件(event)。該方法會 <strong>同步地</strong> (synchronously)依照被註冊(registered)的順序(in the order)來 <strong>呼叫</strong> (calls) <strong>每一個</strong> (every) <strong>事件監聽器</strong> (event listener)</li> <li><code>js door.emit("slam") // emitting the event "slam"</code></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_eventnames>emitter.eventNames()</a><ul> <li>該方法會回傳(return)一個陣列(array)來代表(represent)有註冊(registered)在目前(current)的<code>EventEmitter</code>物件(object)上的事件們(events) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-168-1><a id=__codelineno-168-1 name=__codelineno-168-1 href=#__codelineno-168-1></a><span class=nx>door</span><span class=p>.</span><span class=nx>eventNames</span><span class=p>()</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_getmaxlisteners>emitter.getMaxListeners()</a><ul> <li>該方法會回傳(returns)一個整數(integer)來代表當前的<code>EventEmitter</code>物件(object)"最多"(maximum)能被新增(add)幾個事件監聽器(listeners)在其上面</li> <li>預設值(default): <code>10</code></li> <li>並可以透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_setmaxlisteners_n>emitter.setMaxListeners(n)</a>方法來設定指定的<code>EventEmitter</code>物件(object)"最多"(maximum)能被新增(add)幾個事件監聽器(listeners)到其上面</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_listenercount_eventname>emitter.listenerCount(eventName)</a><ul> <li>該方法會回傳(returns)一個整數(integer)來代表當前的<code>EventEmitter</code>物件(object)"上有幾個事件監聽器(listeners) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-169-1><a id=__codelineno-169-1 name=__codelineno-169-1 href=#__codelineno-169-1></a><span class=nx>door</span><span class=p>.</span><span class=nx>listenerCount</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_listeners_eventname>emitter.listeners(eventName)</a><ul> <li>該方法會回傳(returns)一個陣列(array)來代表當前的<code>EventEmitter</code>物件(object)"上有哪些事件監聽器(listeners) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-170-1><a id=__codelineno-170-1 name=__codelineno-170-1 href=#__codelineno-170-1></a><span class=nx>door</span><span class=p>.</span><span class=nx>listeners</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_removelistener_eventname_listener>emitter.removeListener(eventName, listener)</a><ul> <li>該方法會從事件監聽器陣列(<code>listener</code> array)上移除(removes)指定(specified)的事件監聽器(<code>listener</code>)</li> <li>從Node <code>v10.0.0</code>版本開始,等同於<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_off_eventname_listener>emitter.off(eventName, listener)</a></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_on_eventname_listener>emitter.on(eventName, listener)</a><ul> <li>該方法會新增(adds)一個回呼函式(callback function)給當前被發出(emitted)的事件(event) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-171-1><a id=__codelineno-171-1 name=__codelineno-171-1 href=#__codelineno-171-1></a><span class=nx>door</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-171-2><a id=__codelineno-171-2 name=__codelineno-171-2 href=#__codelineno-171-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Door was opened&#39;</span><span class=p>)</span>
</span><span id=__span-171-3><a id=__codelineno-171-3 name=__codelineno-171-3 href=#__codelineno-171-3></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_emitter_once_eventname_listener>emitter.once(eventName, listener)</a><ul> <li>該方法會新增(adds)一個回呼函式(callback function)在被註冊(registered)以後(after),而第1次(first)被發出(emitted)的的事件(event)。這個方法只會被呼叫(called)一次(once),不會(never)再被呼叫一次(again) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-172-1><a id=__codelineno-172-1 name=__codelineno-172-1 href=#__codelineno-172-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>)</span>
</span><span id=__span-172-2><a id=__codelineno-172-2 name=__codelineno-172-2 href=#__codelineno-172-2></a><span class=kd>const</span><span class=w> </span><span class=nx>ee</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>()</span>
</span><span id=__span-172-3><a id=__codelineno-172-3 name=__codelineno-172-3 href=#__codelineno-172-3></a>
</span><span id=__span-172-4><a id=__codelineno-172-4 name=__codelineno-172-4 href=#__codelineno-172-4></a><span class=nx>ee</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;my-event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-172-5><a id=__codelineno-172-5 name=__codelineno-172-5 href=#__codelineno-172-5></a><span class=w>  </span><span class=c1>//call callback function once</span>
</span><span id=__span-172-6><a id=__codelineno-172-6 name=__codelineno-172-6 href=#__codelineno-172-6></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_prependlistener_eventname_listener>emitter.prependListener(eventName, listener)</a><ul> <li>當我們使用<code>emitter.on()</code>或是<code>emitter.addListener()</code>這2種方法來新增(add)事件監聽器(listener)時,它們會把事件監聽器新增到整個監聽器(listeners)隊列(queue)的最後面(last),並且最後(last)一個呼叫(called)。此時,如果我們想要新增事件監聽器到整個監聽器隊列的最前面(before)時,就可以透過<code>emitter.prependListener()</code>方法來達成,並且第1個呼叫(called)其新增的事件監聽器</li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_prependoncelistener_eventname_listener>emitter.prependOnceListener(eventName, listener)</a><ul> <li>當我們使用<code>emitter.once()</code>方法來新增事件監聽器時,它會把事件監聽器新增到整個監聽器(listeners)隊列(queue)的最後面(last),並且最後(last)一個呼叫(called)。此時,如果我們想要新增事件監聽器到整個監聽器隊列的最前面(before)時,就可以透過<code>emitter.prependOnceListener()</code>方法來達成,並且第1個呼叫(called)其新增的事件監聽器</li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_removealllisteners_eventname>emitter.removeAllListeners([eventName])</a><ul> <li>該方法會從<code>EventEmitter</code>物件(object)中移除(removes) <strong>指定事件(specific event)中</strong> 所有(all)的事件監聽器(listeners)</li> <li><code>js door.removeAllListeners('open')</code></li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_removelistener_eventname_listener>emitter.removeListener(eventName, listener)</a><ul> <li>該方法會 <strong>移除(remove)一個指定(specific)的事件監聽器(listener)</strong> 。我們可以將該方法的回呼函式(callback function)參數儲存(saving)為一個變數(variable),以讓之後(later)當我們需要參考(reference)時,可以透過此變數來呼叫<code>emitter.removeListener()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-173-1><a id=__codelineno-173-1 name=__codelineno-173-1 href=#__codelineno-173-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomething</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-173-2><a id=__codelineno-173-2 name=__codelineno-173-2 href=#__codelineno-173-2></a><span class=nx>door</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>doSomething</span><span class=p>)</span>
</span><span id=__span-173-3><a id=__codelineno-173-3 name=__codelineno-173-3 href=#__codelineno-173-3></a><span class=nx>door</span><span class=p>.</span><span class=nx>removeListener</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>doSomething</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_setmaxlisteners_n>emitter.setMaxListeners(n)</a><ul> <li>該方法可以設定(set) <strong>最多(maximum)</strong> 能新增幾個事件監聽器(listeners)到<code>EventEmitter</code>物件(object)上面。預設值(defaults)為<code>10</code>個事件監聽器,但能設定要增加(increased) or 減少(lowered) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-174-1><a id=__codelineno-174-1 name=__codelineno-174-1 href=#__codelineno-174-1></a><span class=nx>door</span><span class=p>.</span><span class=nx>setMaxListeners</span><span class=p>(</span><span class=mf>50</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=the-nodejs-http-module>The Node.js http module<a class=headerlink href=#the-nodejs-http-module title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/http.html#http_http>HTTP</a><br></p> </blockquote> <ul> <li><code>HTTP</code>核心模組(core module)是Node網路(networking)的關鍵模組(key module)</li> <li><code>HTTP</code>模組可以透過引用(require)來使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-175-1><a id=__codelineno-175-1 name=__codelineno-175-1 href=#__codelineno-175-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>該模組會提供一些屬性(properties), 方法(methods), 和一些類別(classes)</li> <li>屬性(Properties)</li> <li><a href=https://nodejs.org/api/http.html#http_http_methods>http.METHODS</a><ul> <li>該屬性會列出(lists)所有能支援(supported)的HTTP方法(methods) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-176-1><a id=__codelineno-176-1 name=__codelineno-176-1 href=#__codelineno-176-1></a><span class=o>&gt;</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>).</span><span class=nx>METHODS</span>
</span><span id=__span-176-2><a id=__codelineno-176-2 name=__codelineno-176-2 href=#__codelineno-176-2></a><span class=p>[</span><span class=w> </span><span class=s1>&#39;ACL&#39;</span><span class=p>,</span>
</span><span id=__span-176-3><a id=__codelineno-176-3 name=__codelineno-176-3 href=#__codelineno-176-3></a><span class=w>  </span><span class=s1>&#39;BIND&#39;</span><span class=p>,</span>
</span><span id=__span-176-4><a id=__codelineno-176-4 name=__codelineno-176-4 href=#__codelineno-176-4></a><span class=w>  </span><span class=s1>&#39;CHECKOUT&#39;</span><span class=p>,</span>
</span><span id=__span-176-5><a id=__codelineno-176-5 name=__codelineno-176-5 href=#__codelineno-176-5></a><span class=w>  </span><span class=s1>&#39;CONNECT&#39;</span><span class=p>,</span>
</span><span id=__span-176-6><a id=__codelineno-176-6 name=__codelineno-176-6 href=#__codelineno-176-6></a><span class=w>  </span><span class=s1>&#39;COPY&#39;</span><span class=p>,</span>
</span><span id=__span-176-7><a id=__codelineno-176-7 name=__codelineno-176-7 href=#__codelineno-176-7></a><span class=w>  </span><span class=s1>&#39;DELETE&#39;</span><span class=p>,</span>
</span><span id=__span-176-8><a id=__codelineno-176-8 name=__codelineno-176-8 href=#__codelineno-176-8></a><span class=w>  </span><span class=s1>&#39;GET&#39;</span><span class=p>,</span>
</span><span id=__span-176-9><a id=__codelineno-176-9 name=__codelineno-176-9 href=#__codelineno-176-9></a><span class=w>  </span><span class=s1>&#39;HEAD&#39;</span><span class=p>,</span>
</span><span id=__span-176-10><a id=__codelineno-176-10 name=__codelineno-176-10 href=#__codelineno-176-10></a><span class=w>  </span><span class=s1>&#39;LINK&#39;</span><span class=p>,</span>
</span><span id=__span-176-11><a id=__codelineno-176-11 name=__codelineno-176-11 href=#__codelineno-176-11></a><span class=w>  </span><span class=s1>&#39;LOCK&#39;</span><span class=p>,</span>
</span><span id=__span-176-12><a id=__codelineno-176-12 name=__codelineno-176-12 href=#__codelineno-176-12></a><span class=w>  </span><span class=s1>&#39;M-SEARCH&#39;</span><span class=p>,</span>
</span><span id=__span-176-13><a id=__codelineno-176-13 name=__codelineno-176-13 href=#__codelineno-176-13></a><span class=w>  </span><span class=s1>&#39;MERGE&#39;</span><span class=p>,</span>
</span><span id=__span-176-14><a id=__codelineno-176-14 name=__codelineno-176-14 href=#__codelineno-176-14></a><span class=w>  </span><span class=s1>&#39;MKACTIVITY&#39;</span><span class=p>,</span>
</span><span id=__span-176-15><a id=__codelineno-176-15 name=__codelineno-176-15 href=#__codelineno-176-15></a><span class=w>  </span><span class=s1>&#39;MKCALENDAR&#39;</span><span class=p>,</span>
</span><span id=__span-176-16><a id=__codelineno-176-16 name=__codelineno-176-16 href=#__codelineno-176-16></a><span class=w>  </span><span class=s1>&#39;MKCOL&#39;</span><span class=p>,</span>
</span><span id=__span-176-17><a id=__codelineno-176-17 name=__codelineno-176-17 href=#__codelineno-176-17></a><span class=w>  </span><span class=s1>&#39;MOVE&#39;</span><span class=p>,</span>
</span><span id=__span-176-18><a id=__codelineno-176-18 name=__codelineno-176-18 href=#__codelineno-176-18></a><span class=w>  </span><span class=s1>&#39;NOTIFY&#39;</span><span class=p>,</span>
</span><span id=__span-176-19><a id=__codelineno-176-19 name=__codelineno-176-19 href=#__codelineno-176-19></a><span class=w>  </span><span class=s1>&#39;OPTIONS&#39;</span><span class=p>,</span>
</span><span id=__span-176-20><a id=__codelineno-176-20 name=__codelineno-176-20 href=#__codelineno-176-20></a><span class=w>  </span><span class=s1>&#39;PATCH&#39;</span><span class=p>,</span>
</span><span id=__span-176-21><a id=__codelineno-176-21 name=__codelineno-176-21 href=#__codelineno-176-21></a><span class=w>  </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span><span id=__span-176-22><a id=__codelineno-176-22 name=__codelineno-176-22 href=#__codelineno-176-22></a><span class=w>  </span><span class=s1>&#39;PROPFIND&#39;</span><span class=p>,</span>
</span><span id=__span-176-23><a id=__codelineno-176-23 name=__codelineno-176-23 href=#__codelineno-176-23></a><span class=w>  </span><span class=s1>&#39;PROPPATCH&#39;</span><span class=p>,</span>
</span><span id=__span-176-24><a id=__codelineno-176-24 name=__codelineno-176-24 href=#__codelineno-176-24></a><span class=w>  </span><span class=s1>&#39;PURGE&#39;</span><span class=p>,</span>
</span><span id=__span-176-25><a id=__codelineno-176-25 name=__codelineno-176-25 href=#__codelineno-176-25></a><span class=w>  </span><span class=s1>&#39;PUT&#39;</span><span class=p>,</span>
</span><span id=__span-176-26><a id=__codelineno-176-26 name=__codelineno-176-26 href=#__codelineno-176-26></a><span class=w>  </span><span class=s1>&#39;REBIND&#39;</span><span class=p>,</span>
</span><span id=__span-176-27><a id=__codelineno-176-27 name=__codelineno-176-27 href=#__codelineno-176-27></a><span class=w>  </span><span class=s1>&#39;REPORT&#39;</span><span class=p>,</span>
</span><span id=__span-176-28><a id=__codelineno-176-28 name=__codelineno-176-28 href=#__codelineno-176-28></a><span class=w>  </span><span class=s1>&#39;SEARCH&#39;</span><span class=p>,</span>
</span><span id=__span-176-29><a id=__codelineno-176-29 name=__codelineno-176-29 href=#__codelineno-176-29></a><span class=w>  </span><span class=s1>&#39;SUBSCRIBE&#39;</span><span class=p>,</span>
</span><span id=__span-176-30><a id=__codelineno-176-30 name=__codelineno-176-30 href=#__codelineno-176-30></a><span class=w>  </span><span class=s1>&#39;TRACE&#39;</span><span class=p>,</span>
</span><span id=__span-176-31><a id=__codelineno-176-31 name=__codelineno-176-31 href=#__codelineno-176-31></a><span class=w>  </span><span class=s1>&#39;UNBIND&#39;</span><span class=p>,</span>
</span><span id=__span-176-32><a id=__codelineno-176-32 name=__codelineno-176-32 href=#__codelineno-176-32></a><span class=w>  </span><span class=s1>&#39;UNLINK&#39;</span><span class=p>,</span>
</span><span id=__span-176-33><a id=__codelineno-176-33 name=__codelineno-176-33 href=#__codelineno-176-33></a><span class=w>  </span><span class=s1>&#39;UNLOCK&#39;</span><span class=p>,</span>
</span><span id=__span-176-34><a id=__codelineno-176-34 name=__codelineno-176-34 href=#__codelineno-176-34></a><span class=w>  </span><span class=s1>&#39;UNSUBSCRIBE&#39;</span><span class=w> </span>
</span><span id=__span-176-35><a id=__codelineno-176-35 name=__codelineno-176-35 href=#__codelineno-176-35></a><span class=p>]</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_http_status_codes>http.STATUS_CODES</a><ul> <li>該屬性會列出(lists)所有的HTTP狀態碼(status code)以及它們分別的描述(description) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-177-1><a id=__codelineno-177-1 name=__codelineno-177-1 href=#__codelineno-177-1></a><span class=o>&gt;</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>).</span><span class=nx>STATUS_CODES</span>
</span><span id=__span-177-2><a id=__codelineno-177-2 name=__codelineno-177-2 href=#__codelineno-177-2></a><span class=p>{</span><span class=w> </span><span class=s1>&#39;100&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Continue&#39;</span><span class=p>,</span>
</span><span id=__span-177-3><a id=__codelineno-177-3 name=__codelineno-177-3 href=#__codelineno-177-3></a><span class=w>  </span><span class=s1>&#39;101&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Switching Protocols&#39;</span><span class=p>,</span>
</span><span id=__span-177-4><a id=__codelineno-177-4 name=__codelineno-177-4 href=#__codelineno-177-4></a><span class=w>  </span><span class=s1>&#39;102&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Processing&#39;</span><span class=p>,</span>
</span><span id=__span-177-5><a id=__codelineno-177-5 name=__codelineno-177-5 href=#__codelineno-177-5></a><span class=w>  </span><span class=s1>&#39;200&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;OK&#39;</span><span class=p>,</span>
</span><span id=__span-177-6><a id=__codelineno-177-6 name=__codelineno-177-6 href=#__codelineno-177-6></a><span class=w>  </span><span class=s1>&#39;201&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Created&#39;</span><span class=p>,</span>
</span><span id=__span-177-7><a id=__codelineno-177-7 name=__codelineno-177-7 href=#__codelineno-177-7></a><span class=w>  </span><span class=s1>&#39;202&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Accepted&#39;</span><span class=p>,</span>
</span><span id=__span-177-8><a id=__codelineno-177-8 name=__codelineno-177-8 href=#__codelineno-177-8></a><span class=w>  </span><span class=s1>&#39;203&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Non-Authoritative Information&#39;</span><span class=p>,</span>
</span><span id=__span-177-9><a id=__codelineno-177-9 name=__codelineno-177-9 href=#__codelineno-177-9></a><span class=w>  </span><span class=s1>&#39;204&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;No Content&#39;</span><span class=p>,</span>
</span><span id=__span-177-10><a id=__codelineno-177-10 name=__codelineno-177-10 href=#__codelineno-177-10></a><span class=w>  </span><span class=s1>&#39;205&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Reset Content&#39;</span><span class=p>,</span>
</span><span id=__span-177-11><a id=__codelineno-177-11 name=__codelineno-177-11 href=#__codelineno-177-11></a><span class=w>  </span><span class=s1>&#39;206&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Partial Content&#39;</span><span class=p>,</span>
</span><span id=__span-177-12><a id=__codelineno-177-12 name=__codelineno-177-12 href=#__codelineno-177-12></a><span class=w>  </span><span class=s1>&#39;207&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Multi-Status&#39;</span><span class=p>,</span>
</span><span id=__span-177-13><a id=__codelineno-177-13 name=__codelineno-177-13 href=#__codelineno-177-13></a><span class=w>  </span><span class=s1>&#39;208&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Already Reported&#39;</span><span class=p>,</span>
</span><span id=__span-177-14><a id=__codelineno-177-14 name=__codelineno-177-14 href=#__codelineno-177-14></a><span class=w>  </span><span class=s1>&#39;226&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;IM Used&#39;</span><span class=p>,</span>
</span><span id=__span-177-15><a id=__codelineno-177-15 name=__codelineno-177-15 href=#__codelineno-177-15></a><span class=w>  </span><span class=s1>&#39;300&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Multiple Choices&#39;</span><span class=p>,</span>
</span><span id=__span-177-16><a id=__codelineno-177-16 name=__codelineno-177-16 href=#__codelineno-177-16></a><span class=w>  </span><span class=s1>&#39;301&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Moved Permanently&#39;</span><span class=p>,</span>
</span><span id=__span-177-17><a id=__codelineno-177-17 name=__codelineno-177-17 href=#__codelineno-177-17></a><span class=w>  </span><span class=s1>&#39;302&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Found&#39;</span><span class=p>,</span>
</span><span id=__span-177-18><a id=__codelineno-177-18 name=__codelineno-177-18 href=#__codelineno-177-18></a><span class=w>  </span><span class=s1>&#39;303&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;See Other&#39;</span><span class=p>,</span>
</span><span id=__span-177-19><a id=__codelineno-177-19 name=__codelineno-177-19 href=#__codelineno-177-19></a><span class=w>  </span><span class=s1>&#39;304&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Not Modified&#39;</span><span class=p>,</span>
</span><span id=__span-177-20><a id=__codelineno-177-20 name=__codelineno-177-20 href=#__codelineno-177-20></a><span class=w>  </span><span class=s1>&#39;305&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Use Proxy&#39;</span><span class=p>,</span>
</span><span id=__span-177-21><a id=__codelineno-177-21 name=__codelineno-177-21 href=#__codelineno-177-21></a><span class=w>  </span><span class=s1>&#39;307&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Temporary Redirect&#39;</span><span class=p>,</span>
</span><span id=__span-177-22><a id=__codelineno-177-22 name=__codelineno-177-22 href=#__codelineno-177-22></a><span class=w>  </span><span class=s1>&#39;308&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Permanent Redirect&#39;</span><span class=p>,</span>
</span><span id=__span-177-23><a id=__codelineno-177-23 name=__codelineno-177-23 href=#__codelineno-177-23></a><span class=w>  </span><span class=s1>&#39;400&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Bad Request&#39;</span><span class=p>,</span>
</span><span id=__span-177-24><a id=__codelineno-177-24 name=__codelineno-177-24 href=#__codelineno-177-24></a><span class=w>  </span><span class=s1>&#39;401&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Unauthorized&#39;</span><span class=p>,</span>
</span><span id=__span-177-25><a id=__codelineno-177-25 name=__codelineno-177-25 href=#__codelineno-177-25></a><span class=w>  </span><span class=s1>&#39;402&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Payment Required&#39;</span><span class=p>,</span>
</span><span id=__span-177-26><a id=__codelineno-177-26 name=__codelineno-177-26 href=#__codelineno-177-26></a><span class=w>  </span><span class=s1>&#39;403&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Forbidden&#39;</span><span class=p>,</span>
</span><span id=__span-177-27><a id=__codelineno-177-27 name=__codelineno-177-27 href=#__codelineno-177-27></a><span class=w>  </span><span class=s1>&#39;404&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Not Found&#39;</span><span class=p>,</span>
</span><span id=__span-177-28><a id=__codelineno-177-28 name=__codelineno-177-28 href=#__codelineno-177-28></a><span class=w>  </span><span class=s1>&#39;405&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Method Not Allowed&#39;</span><span class=p>,</span>
</span><span id=__span-177-29><a id=__codelineno-177-29 name=__codelineno-177-29 href=#__codelineno-177-29></a><span class=w>  </span><span class=s1>&#39;406&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Not Acceptable&#39;</span><span class=p>,</span>
</span><span id=__span-177-30><a id=__codelineno-177-30 name=__codelineno-177-30 href=#__codelineno-177-30></a><span class=w>  </span><span class=s1>&#39;407&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Proxy Authentication Required&#39;</span><span class=p>,</span>
</span><span id=__span-177-31><a id=__codelineno-177-31 name=__codelineno-177-31 href=#__codelineno-177-31></a><span class=w>  </span><span class=s1>&#39;408&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Request Timeout&#39;</span><span class=p>,</span>
</span><span id=__span-177-32><a id=__codelineno-177-32 name=__codelineno-177-32 href=#__codelineno-177-32></a><span class=w>  </span><span class=s1>&#39;409&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Conflict&#39;</span><span class=p>,</span>
</span><span id=__span-177-33><a id=__codelineno-177-33 name=__codelineno-177-33 href=#__codelineno-177-33></a><span class=w>  </span><span class=s1>&#39;410&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Gone&#39;</span><span class=p>,</span>
</span><span id=__span-177-34><a id=__codelineno-177-34 name=__codelineno-177-34 href=#__codelineno-177-34></a><span class=w>  </span><span class=s1>&#39;411&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Length Required&#39;</span><span class=p>,</span>
</span><span id=__span-177-35><a id=__codelineno-177-35 name=__codelineno-177-35 href=#__codelineno-177-35></a><span class=w>  </span><span class=s1>&#39;412&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Precondition Failed&#39;</span><span class=p>,</span>
</span><span id=__span-177-36><a id=__codelineno-177-36 name=__codelineno-177-36 href=#__codelineno-177-36></a><span class=w>  </span><span class=s1>&#39;413&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Payload Too Large&#39;</span><span class=p>,</span>
</span><span id=__span-177-37><a id=__codelineno-177-37 name=__codelineno-177-37 href=#__codelineno-177-37></a><span class=w>  </span><span class=s1>&#39;414&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;URI Too Long&#39;</span><span class=p>,</span>
</span><span id=__span-177-38><a id=__codelineno-177-38 name=__codelineno-177-38 href=#__codelineno-177-38></a><span class=w>  </span><span class=s1>&#39;415&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Unsupported Media Type&#39;</span><span class=p>,</span>
</span><span id=__span-177-39><a id=__codelineno-177-39 name=__codelineno-177-39 href=#__codelineno-177-39></a><span class=w>  </span><span class=s1>&#39;416&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Range Not Satisfiable&#39;</span><span class=p>,</span>
</span><span id=__span-177-40><a id=__codelineno-177-40 name=__codelineno-177-40 href=#__codelineno-177-40></a><span class=w>  </span><span class=s1>&#39;417&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Expectation Failed&#39;</span><span class=p>,</span>
</span><span id=__span-177-41><a id=__codelineno-177-41 name=__codelineno-177-41 href=#__codelineno-177-41></a><span class=w>  </span><span class=s1>&#39;418&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;I\&#39;m a teapot&#39;</span><span class=p>,</span>
</span><span id=__span-177-42><a id=__codelineno-177-42 name=__codelineno-177-42 href=#__codelineno-177-42></a><span class=w>  </span><span class=s1>&#39;421&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Misdirected Request&#39;</span><span class=p>,</span>
</span><span id=__span-177-43><a id=__codelineno-177-43 name=__codelineno-177-43 href=#__codelineno-177-43></a><span class=w>  </span><span class=s1>&#39;422&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Unprocessable Entity&#39;</span><span class=p>,</span>
</span><span id=__span-177-44><a id=__codelineno-177-44 name=__codelineno-177-44 href=#__codelineno-177-44></a><span class=w>  </span><span class=s1>&#39;423&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Locked&#39;</span><span class=p>,</span>
</span><span id=__span-177-45><a id=__codelineno-177-45 name=__codelineno-177-45 href=#__codelineno-177-45></a><span class=w>  </span><span class=s1>&#39;424&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Failed Dependency&#39;</span><span class=p>,</span>
</span><span id=__span-177-46><a id=__codelineno-177-46 name=__codelineno-177-46 href=#__codelineno-177-46></a><span class=w>  </span><span class=s1>&#39;425&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Unordered Collection&#39;</span><span class=p>,</span>
</span><span id=__span-177-47><a id=__codelineno-177-47 name=__codelineno-177-47 href=#__codelineno-177-47></a><span class=w>  </span><span class=s1>&#39;426&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Upgrade Required&#39;</span><span class=p>,</span>
</span><span id=__span-177-48><a id=__codelineno-177-48 name=__codelineno-177-48 href=#__codelineno-177-48></a><span class=w>  </span><span class=s1>&#39;428&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Precondition Required&#39;</span><span class=p>,</span>
</span><span id=__span-177-49><a id=__codelineno-177-49 name=__codelineno-177-49 href=#__codelineno-177-49></a><span class=w>  </span><span class=s1>&#39;429&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Too Many Requests&#39;</span><span class=p>,</span>
</span><span id=__span-177-50><a id=__codelineno-177-50 name=__codelineno-177-50 href=#__codelineno-177-50></a><span class=w>  </span><span class=s1>&#39;431&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Request Header Fields Too Large&#39;</span><span class=p>,</span>
</span><span id=__span-177-51><a id=__codelineno-177-51 name=__codelineno-177-51 href=#__codelineno-177-51></a><span class=w>  </span><span class=s1>&#39;451&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Unavailable For Legal Reasons&#39;</span><span class=p>,</span>
</span><span id=__span-177-52><a id=__codelineno-177-52 name=__codelineno-177-52 href=#__codelineno-177-52></a><span class=w>  </span><span class=s1>&#39;500&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Internal Server Error&#39;</span><span class=p>,</span>
</span><span id=__span-177-53><a id=__codelineno-177-53 name=__codelineno-177-53 href=#__codelineno-177-53></a><span class=w>  </span><span class=s1>&#39;501&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Not Implemented&#39;</span><span class=p>,</span>
</span><span id=__span-177-54><a id=__codelineno-177-54 name=__codelineno-177-54 href=#__codelineno-177-54></a><span class=w>  </span><span class=s1>&#39;502&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Bad Gateway&#39;</span><span class=p>,</span>
</span><span id=__span-177-55><a id=__codelineno-177-55 name=__codelineno-177-55 href=#__codelineno-177-55></a><span class=w>  </span><span class=s1>&#39;503&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Service Unavailable&#39;</span><span class=p>,</span>
</span><span id=__span-177-56><a id=__codelineno-177-56 name=__codelineno-177-56 href=#__codelineno-177-56></a><span class=w>  </span><span class=s1>&#39;504&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Gateway Timeout&#39;</span><span class=p>,</span>
</span><span id=__span-177-57><a id=__codelineno-177-57 name=__codelineno-177-57 href=#__codelineno-177-57></a><span class=w>  </span><span class=s1>&#39;505&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;HTTP Version Not Supported&#39;</span><span class=p>,</span>
</span><span id=__span-177-58><a id=__codelineno-177-58 name=__codelineno-177-58 href=#__codelineno-177-58></a><span class=w>  </span><span class=s1>&#39;506&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Variant Also Negotiates&#39;</span><span class=p>,</span>
</span><span id=__span-177-59><a id=__codelineno-177-59 name=__codelineno-177-59 href=#__codelineno-177-59></a><span class=w>  </span><span class=s1>&#39;507&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Insufficient Storage&#39;</span><span class=p>,</span>
</span><span id=__span-177-60><a id=__codelineno-177-60 name=__codelineno-177-60 href=#__codelineno-177-60></a><span class=w>  </span><span class=s1>&#39;508&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Loop Detected&#39;</span><span class=p>,</span>
</span><span id=__span-177-61><a id=__codelineno-177-61 name=__codelineno-177-61 href=#__codelineno-177-61></a><span class=w>  </span><span class=s1>&#39;509&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Bandwidth Limit Exceeded&#39;</span><span class=p>,</span>
</span><span id=__span-177-62><a id=__codelineno-177-62 name=__codelineno-177-62 href=#__codelineno-177-62></a><span class=w>  </span><span class=s1>&#39;510&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Not Extended&#39;</span><span class=p>,</span>
</span><span id=__span-177-63><a id=__codelineno-177-63 name=__codelineno-177-63 href=#__codelineno-177-63></a><span class=w>  </span><span class=s1>&#39;511&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Network Authentication Required&#39;</span><span class=w> </span>
</span><span id=__span-177-64><a id=__codelineno-177-64 name=__codelineno-177-64 href=#__codelineno-177-64></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_http_globalagent>http.globalAgent</a><ul> <li>該屬性會指向(points to)全域的代理器(<code>Agent</code>)物件(object)的實例(instance),也就是<a href=https://nodejs.org/api/http.html#http_class_http_agent>http.Agent</a>類別(class)的實例(instance)</li> <li>該屬性被用來管理(manage)與<code>HTTP</code>客戶端(clients)的連接(connections)持久性(persistence) &amp; 重用(reuse)。因此該屬性是Node的<code>HTTP</code>網路(networking)的關鍵元件(key component)</li> <li>關於<code>http.Agent</code>類別(class),在稍後(later on)的描述(description)中會有更多介紹</li> </ul> </li> <li>方法(Methods)</li> <li><a href=https://nodejs.org/api/http.html#http_http_createserver_options_requestlistener>http.createServer([options][, requestListener])</a><ul> <li>該方法會回傳(return)一個新的<a href=https://nodejs.org/api/http.html#http_class_http_server>http.Server</a>類別(class)的實例(instance) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-178-1><a id=__codelineno-178-1 name=__codelineno-178-1 href=#__codelineno-178-1></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-178-2><a id=__codelineno-178-2 name=__codelineno-178-2 href=#__codelineno-178-2></a><span class=w>  </span><span class=c1>//handle every single request with this callback</span>
</span><span id=__span-178-3><a id=__codelineno-178-3 name=__codelineno-178-3 href=#__codelineno-178-3></a><span class=p>})</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_http_request_options_callback>http.request(url[, options][, callback])</a><ul> <li>該方法會向伺服器端發出<code>HTTP</code>的請求(<code>request</code>),並建立(creating)一個<a href=https://nodejs.org/api/http.html#http_class_http_clientrequest>http.ClientRequest</a>類別(class)的實例(instance)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_http_get_options_callback>http.get(url[, options][, callback])</a><ul> <li>與<code>http.request()</code>方法類似(similar),但會自動地(automatically)設定(sets)<code>HTTP</code>的請求(<code>request</code>)方法為<code>GET</code>方法,並且會自動呼叫<a href=https://nodejs.org/api/http.html#http_request_end_data_encoding_callback>request.end([data[, encoding]][, callback])</a>方法</li> </ul> </li> <li>類別(Classes)</li> <li><code>HTTP</code>模組(module)會提供以下5種類別(classes)<ul> <li><code>http.Agent</code></li> <li><code>http.ClientRequest</code></li> <li><code>http.Server</code></li> <li><code>http.ServerResponse</code></li> <li><code>http.IncomingMessage</code></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_agent>http.Agent</a><ul> <li>Node會建立一個全域的代理器(<code>Agent</code>)類別(class)的實例(instance),以用來管理(manage)與<code>HTTP</code>客戶端(clients)的連接(connections)持久性(persistence) &amp; 重用(reuse)。因此<code>http.Agent</code>類別(class)是Node的<code>HTTP</code>網路(networking)的關鍵元件(key component)</li> <li>這個物件會確保(make sure)對於伺服器端(server)的每個請求(every request)都是排隊(queued)的,並且任何單一(single)插座(socket)都是有被重複使用(reused)的</li> <li><strong>此類別(class)也會維護(maintains)插座池(a pool of sockets)。這也就是Node效能(performance)好的關鍵(key)原因(reason)之一</strong></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_clientrequest>http.ClientRequest</a><ul> <li>當呼叫(called)<a href=https://nodejs.org/api/http.html#http_http_request_options_callback>http.request</a>或是<a href=https://nodejs.org/api/http.html#http_http_get_options_callback>http.get()</a>這2種方法之一時,皆會建立(created)一個<code>http.ClientRequest</code>物件(object)</li> <li>當收到(received)回應(response)時,將會以一個<code>http.IncomingMessage</code>實例(instance)作為參數(argument),來呼叫<code>response</code>事件(event)來作為回應(response)</li> <li>該類別(class)所回傳(returned)的回應資料(data of a response),可以透過以下2種方式來讀取</li> <li>我們可以呼叫<code>response.read()</code>方法</li> <li>在<code>response</code>事件處理器(event handler)中,我們可以設定(setup)一個事件監聽器(event listener)給<code>data</code>事件(event),因此我們就能監聽(listen)串流進去(streamed into)的資料流(data)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_server>http.Server</a><ul> <li>當透過<code>http.createServer()</code>方法(method)來建立(creating)一個新的伺服器(new server)時,通常(commonly)會實例化(instantiated)並且回傳(returned)此類別(=&gt; 也就是<code>http.Server</code>類別(class))</li> <li>一旦(Once)我們擁有(have)一個伺服器物件(server object)時,我們可以透過以下2種方法(methods)來存取(access)這個伺服器物件</li> <li><a href=https://nodejs.org/api/http.html#http_server_close_callback>server.close([callback])</a>: 阻止(stop)伺服器(server)繼續接受(accepting)新的連接(new connections)</li> <li><a href=https://nodejs.org/api/http.html#http_server_listen>server.listen()</a>: 啟動(starts)HTTP伺服器(server),並監聽(listens)連接(connections)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_serverresponse>http.ServerResponse</a><ul> <li>此類別是透過<code>http.Server</code>類別(class)所建立的,並傳遞(passed)給作為觸發(fires)<code>request</code>事件(event)的第2個參數(parameter)</li> <li><strong>常見(Commonly)且知名(known)的做法是在程式碼中用作<code>res</code></strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-179-1><a id=__codelineno-179-1 name=__codelineno-179-1 href=#__codelineno-179-1></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-179-2><a id=__codelineno-179-2 name=__codelineno-179-2 href=#__codelineno-179-2></a><span class=w>  </span><span class=c1>//res is an http.ServerResponse object</span>
</span><span id=__span-179-3><a id=__codelineno-179-3 name=__codelineno-179-3 href=#__codelineno-179-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>在事件處理器(handler)中,我們常會呼叫(call)的會是<a href=https://nodejs.org/api/http.html#http_response_end_data_encoding_callback>response.end([data[, encoding]][, callback])</a>方法(method),<code>response.end()</code>方法會關閉(close)<code>response</code>物件,同時訊息(message)已經完成(complete)了,伺服器(server)也能將此訊息發送(send)給客戶端(client)。<code>response.end()</code>方法將會在每次回應(each response)時,都會被呼叫(called)到</li> <li>以下的方法(methods)們將會被用來與HTTP標頭(headers)做互動(interact)</li> <li><a href=https://nodejs.org/api/http.html#http_response_getheadernames>response.getHeaderNames()</a><ul> <li>此方法會得到(get)一個已經(already)設定(set)好的HTTP標頭(headers)的名稱清單(the list of names)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_getheaders>response.getHeaders()</a><ul> <li>此方法會得到(get)一個已經(already)設定(set)好的HTTP標頭(headers)的拷貝(copy, =&gt; 會以物件(object)的形式來展示)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_setheader_name_value>response.setHeader('headername', value)</a><ul> <li>此方法會設定一個(set)HTTP標頭(header)的值(value)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_getheaders>response.getHeader('headername')</a><ul> <li>此方法會得到(get)一個已經(already)設定(set)好的HTTP標頭(header)的值(value)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_removeheader_name>response.removeHeader('headername')</a><ul> <li>此方法會移除(remove)一個已經(already)設定(set)好的HTTP標頭(header)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_hasheader_name>response.hasHeader('headername')</a><ul> <li>當指定的HTTP標頭(header)已經(already)有設定(set)過的值時候,就會回傳<code>true</code></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_headerssent>response.headersSent</a><ul> <li>當指定的HTTP標頭(header)已經(already)傳送(sent)給客戶端(client)的時候,就會回傳<code>true</code></li> </ul> </li> <li>在處理完HTTP標頭(header)以後,我們就可以透過<a href=https://nodejs.org/api/http.html#http_response_writehead_statuscode_statusmessage_headers>response.writeHead(statusCode[, statusMessage][, headers])</a>方法來將HTTP標頭(header)傳送給客戶端(client)。<code>response.writeHead()</code>方法會接受狀態碼(statusCode)作為第1個參數(parameter),接著是選擇性(optional)的參數(=&gt; 狀態訊息(status message)),最後是HTTP標頭(headers)物件(object)</li> <li>若想要將資料(data)傳送(send)給客戶端(client)的內文(<code>response body</code>)的話,我們會需要透過<a href=https://nodejs.org/api/http.html#http_response_write_chunk_encoding_callback>response.write(chunk[, encoding][, callback])</a>方法,而<code>response.write()</code>方法將會傳送(send)緩存資料(buffered data)給HTTP回應串流(response stream)</li> <li>如果尚未(not yet)先使用<code>response.writeHead()</code>方法來傳送(sent)HTTP標頭(header)出去的話,它將會先(first)傳送(send)依照傳過來的HTTP請求(<code>response</code>)的狀態碼(status code) &amp; 狀態訊息(status message)來傳送回去HTTP標頭(header)給客戶端(client)。我們也可以透過<a href=https://nodejs.org/api/http.html#http_response_statuscode>response.statusCode</a>與<a href=https://nodejs.org/api/http.html#http_response_statusmessage>response.statusMessage</a>這2種屬性(properties)來設定要回傳給客戶端的HTTP標頭(header)的狀態碼(status code) &amp; 狀態訊息(status message)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage>http.IncomingMessage</a><ul> <li>此一物件(object)可透過以下2種方式來建立(created)出來</li> <li>當<code>http.Server</code>物件在監聽(listening)<code>request</code>事件(event)時</li> <li>當<code>http.ClientRequest</code>物件在監聽(listening)<code>response</code>事件(event)時</li> <li><code>http.IncomingMessage</code>物件可以被用來存取回應物件(<code>response</code>)</li> <li>利用它自己的<a href=https://nodejs.org/api/http.html#http_message_statuscode>message.statusCode</a>與<a href=https://nodejs.org/api/http.html#http_message_statusmessage>message.statusMessage</a>這2種屬性</li> <li>利用他自己的HTTP標頭(headers)方法或是<a href=https://nodejs.org/api/http.html#http_message_rawheaders>message.rawHeaders</a>屬性</li> <li>HTTP方法(method)可以利用它自己的<a href=https://nodejs.org/api/http.html#http_message_method>message.method</a>屬性</li> <li>HTTP版本(version)可以利用它自己的<a href=https://nodejs.org/api/http.html#http_message_httpversion>message.httpVersion</a>屬性</li> <li><code>URL</code>可以利用它自己的<a href=https://nodejs.org/api/http.html#http_message_url>message.url</a>屬性</li> <li>底層插座(underlying socket)可以利用它自己的<a href=https://nodejs.org/api/http.html#http_message_socket>message.socket</a>屬性</li> <li>由於(since)<code>http.IncomingMessage</code>物件實現(implements)了可讀取(readable)串流(stream)介面(interface),因此可透過串流(streams)來存取(accessed)資料(data)</li> </ul> </li> </ul> <h3 id=nodejs-buffers>Node.js Buffers<a class=headerlink href=#nodejs-buffers title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_buffer>Buffer</a><br></p> </blockquote> <ul> <li><code>Buffer</code>是什麼? (What is a buffer?)</li> <li><code>buffer</code>(緩存)是記憶體(memory)的一個區域(area)。Javascript的開發者(developers)可能會不太熟悉這個觀念,而不像是使用其他<code>C</code>, <code>C++</code>, <code>Go</code>程式語言(或是其他也在使用系統程式語言(system programming language)的人),每天需要與記憶體互動(interact)的開發者,來得熟悉</li> <li><code>buffer</code>(緩存)代表一個從<code>V8</code>這個Javascript引擎(engine)所分配(allocated)出來的固定大小(a fixed-size chunk)的記憶體(memory),並且不能再被調整大小(resized)</li> <li>我們可以把<code>buffer</code>(緩存)想像(think of)成是一個類似正整數陣列(an array of integer),其中的每個(each)數字都代表(represent)資料的一個位元組(a byte of data)</li> <li><code>buffer</code>(緩存)是透過Node的<a href=https://nodejs.org/api/buffer.html#buffer_buffer>Buffer</a>類別(class)來實作(implemented)的</li> <li>我們為什麼會需要<code>buffer</code>(緩存)? (Why do we need buffer?)</li> <li>相比於傳統上僅處理字串(string)而不是二進制數據(binaries)的生態圈(ecosystem),Node的<code>Buffer</code>類別(class)是被引進(introduced)來幫助開發者處理(dealt with)二進制的資料(binary data)</li> <li><code>Buffer</code>(緩存)與<code>Stream</code>(串流)是緊密相連(deeply linked)的。當串流處理器(stream processor)收到(receives)資料(data)的速度比起它能消化(digest)的速度快(faster)時,串流處理器就會將資料放到<code>buffer</code></li> <li>對於<code>buffer</code>(緩存)的一個簡單視覺化(visualization)的方式就是當我們在觀看YouTube影片時,紅線(red line)會超過(beyond)我們的觀看點(visualization point)---這就代表YoutTube下載資料(downloading data)的速度比我們觀看(viewing)影片的速度來得快(faster),並且由我們的瀏覽器(browser)負責處理<code>buffer</code>(緩存)</li> <li>如何建立<code>buffer</code>(緩存)? (How to create a buffer)</li> <li><code>buffer</code>(緩存)是透過<a href=https://nodejs.org/api/buffer.html#buffer_buffer_from_buffer_alloc_and_buffer_allocunsafe>Buffer.from(), Buffer.alloc(), and Buffer.allocUnsafe()</a>方法們來建立(created)的 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-180-1><a id=__codelineno-180-1 name=__codelineno-180-1 href=#__codelineno-180-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_array>Buffer.from(array)</a></li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_arraybuffer_byteoffset_length>Buffer.from(arrayBuffer[, byteOffset[, length]])</a></li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_buffer>Buffer.from(buffer)</a></li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_string_encoding>Buffer.from(string[, encoding])</a></li> </ul> </li> <li>我們也可以僅傳遞(passing)一個大小(size)來初始化(initialize)一個<code>buffer</code>(緩存)。以下的範例會建立一個1<code>KB</code>大小的<code>buffer</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-181-1><a id=__codelineno-181-1 name=__codelineno-181-1 href=#__codelineno-181-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>1024</span><span class=p>)</span>
</span><span id=__span-181-2><a id=__codelineno-181-2 name=__codelineno-181-2 href=#__codelineno-181-2></a><span class=c1>//or</span>
</span><span id=__span-181-3><a id=__codelineno-181-3 name=__codelineno-181-3 href=#__codelineno-181-3></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>allocUnsafe</span><span class=p>(</span><span class=mf>1024</span><span class=p>)</span>
</span></code></pre></div><ul> <li>儘管(While)以上的2種方法(=&gt; 也就是<a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_alloc_size_fill_encoding>Buffer.alloc()</a>與<a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe()</a>)皆分配給<code>buffer</code>(緩存)一個指定(specified)大小(size)的位元組(bytes),但是由<code>Buffer.alloc()</code>方法所建立的<code>buffer</code>會被初始化(initialized)為<code>0</code>,而由<code>Buffer.allocUnsafe()</code>方法所建立的<code>buffer</code>將"不會"被初始化(uninitialized)。這也意味著儘管由<code>Buffer.allocUnsafe()</code>方法所建立的<code>buffer</code>將會比由<code>Buffer.alloc()</code>方法所建立的<code>buffer</code>來得快很多(quite fast),但是由<code>Buffer.allocUnsafe()</code>方法所建立的<code>buffer</code>被分配(allocated)到的記憶體(memory)片段(segment)可能會包含(contain)舊資料(old data),而這些舊資料將有可能是敏感性(sensitive)資料</li> <li>當記憶體(memory)中存在舊資料(older data),就可以在<code>buffer</code>(緩存)記憶體被讀取(read) or 洩漏(leaked)時可以被存取(accessed)。正也因為這樣,<code>Buffer.allocUnsafe()</code>方法才會被命名為不安全(unsafe)的,並且在使用此方法時需要更加注意(extra care)</li> </ul> </li> <li>使用<code>buffer</code>(緩存) (Using a buffer)</li> <li>存取<code>buffer</code>(緩存)的內容 (Access the content of a buffer)<ul> <li><code>buffer</code>(緩存)是一個由二進制資料(bytes)組成的陣列(array),可以用如同陣列(array)一樣的方式來存取(accessed) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-182-1><a id=__codelineno-182-1 name=__codelineno-182-1 href=#__codelineno-182-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-182-2><a id=__codelineno-182-2 name=__codelineno-182-2 href=#__codelineno-182-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span><span class=w> </span><span class=c1>//72</span>
</span><span id=__span-182-3><a id=__codelineno-182-3 name=__codelineno-182-3 href=#__codelineno-182-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>[</span><span class=mf>1</span><span class=p>])</span><span class=w> </span><span class=c1>//101</span>
</span><span id=__span-182-4><a id=__codelineno-182-4 name=__codelineno-182-4 href=#__codelineno-182-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>[</span><span class=mf>2</span><span class=p>])</span><span class=w> </span><span class=c1>//121</span>
</span></code></pre></div><ul> <li>以上的數字是萬國碼(Unicode Code),表示字元(character)在緩衝區(<code>buffer</code>)的位置(position)。<code>H</code>=&gt; 72, <code>e</code>=&gt; 101, <code>y</code>=&gt; 121</li> </ul> </li> <li>我們也可以使用<a href=https://nodejs.org/api/buffer.html#buffer_buf_tostring_encoding_start_end>buf.toString()</a>方法來將<code>buffer</code>(緩存)的完整內容(full content)打印(print)出來 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-183-1><a id=__codelineno-183-1 name=__codelineno-183-1 href=#__codelineno-183-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></code></pre></div></li> <li>當我們在初始化(initialize)一個<code>buffer</code>(緩存)時,有設定(sets)好它的大小(size)的話,則我們將能存取會包含(contain)隨機數據(random data)而不是空(empty)的<code>buffer</code>(緩存)的預初始化記憶體(pre-initialized memory)</li> </ul> </li> <li>取得<code>buffer</code>(緩存)的長度 (Get the length of a buffer)<ul> <li>可利用<a href=https://nodejs.org/api/buffer.html#buffer_buf_length>buf.length</a>屬性 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-184-1><a id=__codelineno-184-1 name=__codelineno-184-1 href=#__codelineno-184-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-184-2><a id=__codelineno-184-2 name=__codelineno-184-2 href=#__codelineno-184-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>遍歷<code>buffer</code>(緩存)的內容 (Iterate over the contents of a buffer) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-185-1><a id=__codelineno-185-1 name=__codelineno-185-1 href=#__codelineno-185-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-185-2><a id=__codelineno-185-2 name=__codelineno-185-2 href=#__codelineno-185-2></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>item</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>buf</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-185-3><a id=__codelineno-185-3 name=__codelineno-185-3 href=#__codelineno-185-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span><span class=w> </span><span class=c1>//72 101 121 33</span>
</span><span id=__span-185-4><a id=__codelineno-185-4 name=__codelineno-185-4 href=#__codelineno-185-4></a><span class=p>}</span>
</span></code></pre></div></li> <li>更改<code>buffer</code>(緩存)的內容 (Changing the content of a buffer)<ul> <li>可利用<a href=https://nodejs.org/api/buffer.html#buffer_buf_write_string_offset_length_encoding>buf.write(string[, offset[, length]][, encoding])</a>方法來整個(whole)資料字串(string of data)寫入(write)到<code>buffer</code>(緩存)之中 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-186-1><a id=__codelineno-186-1 name=__codelineno-186-1 href=#__codelineno-186-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>4</span><span class=p>)</span>
</span><span id=__span-186-2><a id=__codelineno-186-2 name=__codelineno-186-2 href=#__codelineno-186-2></a><span class=nx>buf</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>就如同我們也可以使用陣列(array)語法(syntax)來存取(access)<code>buffer</code>(緩存),我們也能利用同樣的方式(in the same way)來設定(set)<code>buffer</code>(緩存)的內容(contents) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-187-1><a id=__codelineno-187-1 name=__codelineno-187-1 href=#__codelineno-187-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-187-2><a id=__codelineno-187-2 name=__codelineno-187-2 href=#__codelineno-187-2></a><span class=nx>buf</span><span class=p>[</span><span class=mf>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>111</span><span class=w> </span><span class=c1>//o</span>
</span><span id=__span-187-3><a id=__codelineno-187-3 name=__codelineno-187-3 href=#__codelineno-187-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span><span class=w> </span><span class=c1>//Hoy!</span>
</span></code></pre></div></li> </ul> </li> <li>複製一個<code>buffer</code>(緩存) (Copy a buffer)<ul> <li>可利用<a href=https://nodejs.org/api/buffer.html#buffer_buf_copy_target_targetstart_sourcestart_sourceend>buf.copy(target[, targetStart[, sourceStart[, sourceEnd]]])</a>方法來複製一個<code>buffer</code>(緩存) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-188-1><a id=__codelineno-188-1 name=__codelineno-188-1 href=#__codelineno-188-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-188-2><a id=__codelineno-188-2 name=__codelineno-188-2 href=#__codelineno-188-2></a><span class=kd>let</span><span class=w> </span><span class=nx>bufcopy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>4</span><span class=p>)</span><span class=w> </span><span class=c1>//allocate 4 bytes</span>
</span><span id=__span-188-3><a id=__codelineno-188-3 name=__codelineno-188-3 href=#__codelineno-188-3></a><span class=nx>buf</span><span class=p>.</span><span class=nx>copy</span><span class=p>(</span><span class=nx>bufcopy</span><span class=p>)</span>
</span></code></pre></div></li> <li>在預設的情況下,我們將複製整個<code>buffer</code>(緩存)。<code>buffer.copy()</code>方法內的3個參數(parameters)可以讓我們定義(define)</li> <li>起始位置(starting position)</li> <li>結束位置(ending position)</li> <li>新的<code>buffer</code>長度(the new buffer length) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-189-1><a id=__codelineno-189-1 name=__codelineno-189-1 href=#__codelineno-189-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-189-2><a id=__codelineno-189-2 name=__codelineno-189-2 href=#__codelineno-189-2></a><span class=kd>let</span><span class=w> </span><span class=nx>bufcopy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>2</span><span class=p>)</span><span class=w> </span><span class=c1>//allocate 2 bytes</span>
</span><span id=__span-189-3><a id=__codelineno-189-3 name=__codelineno-189-3 href=#__codelineno-189-3></a><span class=nx>buf</span><span class=p>.</span><span class=nx>copy</span><span class=p>(</span><span class=nx>bufcopy</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>)</span>
</span><span id=__span-189-4><a id=__codelineno-189-4 name=__codelineno-189-4 href=#__codelineno-189-4></a><span class=nx>bufcopy</span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span><span class=w> </span><span class=c1>//&#39;He&#39;</span>
</span></code></pre></div></li> </ul> </li> <li>將<code>buffer</code>(緩存)切片 (Slice a buffer)<ul> <li>如果我們想建立(create)一個部分(partial)可視化(visualization)的<code>buffer</code>(緩存),我們可以建立一個切片(slice)。 <strong>切片(slice)"並不是"複製(copy): 原始(original)<code>buffer</code>(緩存)仍然是事實來源(the source of truth),但如果原始緩存被改變時,我們所建立的<code>buffer</code>切片(slice)也會被改變</strong></li> <li>可利用<a href=https://nodejs.org/api/buffer.html#buffer_buf_slice_start_end>buf.slice([start[, end]])</a>方法來建立一個<code>buffer</code>(緩存)切片,此方法的第1個參數(parameter)代表起始位置(starting position),以及可指定(specify)第2個選擇性(optional)的參數(parameter)作為結束位置(ending position) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-190-1><a id=__codelineno-190-1 name=__codelineno-190-1 href=#__codelineno-190-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span><span id=__span-190-2><a id=__codelineno-190-2 name=__codelineno-190-2 href=#__codelineno-190-2></a><span class=nx>buf</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>0</span><span class=p>).</span><span class=nx>toString</span><span class=p>()</span><span class=w> </span><span class=c1>//Hey!</span>
</span><span id=__span-190-3><a id=__codelineno-190-3 name=__codelineno-190-3 href=#__codelineno-190-3></a><span class=kd>const</span><span class=w> </span><span class=nx>slice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>buf</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>)</span>
</span><span id=__span-190-4><a id=__codelineno-190-4 name=__codelineno-190-4 href=#__codelineno-190-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>slice</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span><span class=w> </span><span class=c1>//He</span>
</span><span id=__span-190-5><a id=__codelineno-190-5 name=__codelineno-190-5 href=#__codelineno-190-5></a><span class=nx>buf</span><span class=p>[</span><span class=mf>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>111</span><span class=w> </span><span class=c1>//o</span>
</span><span id=__span-190-6><a id=__codelineno-190-6 name=__codelineno-190-6 href=#__codelineno-190-6></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>slice</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span><span class=w> </span><span class=c1>//Ho</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=nodejs-streams>Node.js Streams<a class=headerlink href=#nodejs-streams title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_stream>Stream</a><br></p> </blockquote> <ul> <li>什麼是<code>streams</code>(串流)? (What are streams?)</li> <li><code>Streams</code>(串流)是其中一個為Node應用程式(applications)提供動力(power)的基本(fundamental)觀念(concept)之一</li> <li><code>Streams</code>(串流)是一個用來處理(handle)讀寫(reading/writing)檔案(files)、網路通訊(network communications)、或是任何(any kind of)端對端(end-to-end)的資訊交流(information exchange)的一種有效率(efficient)的方式(way)</li> <li><code>Streams</code>(串流)並不是Node特有(unique)的概念(concept)。早在幾十年(decades)以前左右,<code>Streams</code>(串流)就已經被<code>Unix</code>作業系統(operating system)所引進(introduced)了,因此程式(program)就能透過管道運算子(pipe operator, =&gt; 也就是<code>|</code>)來與每一個通過(passing)的<code>streams</code>(串流)做互動</li> <li>舉例來說,若是傳統(traditional)的方法(way),當我們告訴程式(program)要讀取(read)一個檔案(file)時,檔案會被讀取到記憶體(memory)中,從開始(start)到結束(finish),然後我們就能處理(process)它</li> <li>透過<code>streams</code>(串流)來將檔案內容一部分一部分(piece by piece)地讀取(read),而不用在處理該檔案內容時,需要先把整個(all)檔案內容事先讀取到記憶體(memory)中</li> <li>Node的<a href=https://nodejs.org/api/stream.html#stream_stream>Stream</a>內建核心模組提供(provides)了能建構(built)出所有<code>streams</code>(串流)API的基礎(foundation)</li> <li>所有的<code>streams</code>(串流)都是<a href=https://nodejs.org/api/events.html#events_class_eventemitter>EventEmitter</a>類別(class)的實例(instances)</li> <li>為什麼要使用<code>streams</code>(串流)? (Why streams?)</li> <li>在資料處理(data handling)的方法(methods)這方面,<code>Streams</code>(串流)基本上提供了以下2個主要(major)的優點(advantages)<ul> <li>記憶體效率(Memory efficiency): 當我們處理(process)資料時,不需要事先(before)將大量的資料(large amounts of data)讀取(load)到記憶體中(in memory)</li> <li>時間效率(Time efficiency): 開始處理(processing)資料(data)的前置時間縮短(less time)。從(since)我們擁有資料後,我們就可以直接進行處理,而不是(rather than)等待整個資料負載(data payload)為可用(available)的時候才能開始處理</li> </ul> </li> <li>一個<code>streams</code>(串流)的範例 (An example of stream)</li> <li>有一個典型的範例就是從硬碟(disk)讀取資料(reading file)</li> <li>利用Node的<code>fs</code>模組,我們可以讀取一個檔案,並在當有新被建立(established)的連線(connection)與我們的HTTP伺服器(server)連線時,提供文件(serve it) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-191-1><a id=__codelineno-191-1 name=__codelineno-191-1 href=#__codelineno-191-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span><span id=__span-191-2><a id=__codelineno-191-2 name=__codelineno-191-2 href=#__codelineno-191-2></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-191-3><a id=__codelineno-191-3 name=__codelineno-191-3 href=#__codelineno-191-3></a>
</span><span id=__span-191-4><a id=__codelineno-191-4 name=__codelineno-191-4 href=#__codelineno-191-4></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-191-5><a id=__codelineno-191-5 name=__codelineno-191-5 href=#__codelineno-191-5></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=nx>__dirname</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;/data.txt&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-191-6><a id=__codelineno-191-6 name=__codelineno-191-6 href=#__codelineno-191-6></a><span class=w>    </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span><span id=__span-191-7><a id=__codelineno-191-7 name=__codelineno-191-7 href=#__codelineno-191-7></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-191-8><a id=__codelineno-191-8 name=__codelineno-191-8 href=#__codelineno-191-8></a><span class=p>})</span>
</span><span id=__span-191-9><a id=__codelineno-191-9 name=__codelineno-191-9 href=#__codelineno-191-9></a><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mf>3000</span><span class=p>)</span>
</span></code></pre></div><ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_readfile_path_options_callback>fs.readFile(path[, options], callback)</a>: 此方法會讀取(reads)整個檔案內容(full contents of the file),當此方法完成時,會呼叫(invokes)回呼函式(callback)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_response_end_data_encoding_callback>response.end([data[, encoding]][, callback])</a>: 此方法會回傳(return)整個檔案內容(full contents)給HTTP客戶端(client)</li> <li>如果這個檔案很大的話,此操作會將花費大量的時間</li> </ul> </li> <li>以下的範例程式碼是用<code>streams</code>(串流)來完成同樣的事情 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-192-1><a id=__codelineno-192-1 name=__codelineno-192-1 href=#__codelineno-192-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span><span id=__span-192-2><a id=__codelineno-192-2 name=__codelineno-192-2 href=#__codelineno-192-2></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span><span id=__span-192-3><a id=__codelineno-192-3 name=__codelineno-192-3 href=#__codelineno-192-3></a>
</span><span id=__span-192-4><a id=__codelineno-192-4 name=__codelineno-192-4 href=#__codelineno-192-4></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-192-5><a id=__codelineno-192-5 name=__codelineno-192-5 href=#__codelineno-192-5></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>createReadStream</span><span class=p>(</span><span class=nx>__dirname</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;/data.txt&#39;</span><span class=p>)</span>
</span><span id=__span-192-6><a id=__codelineno-192-6 name=__codelineno-192-6 href=#__codelineno-192-6></a><span class=w>  </span><span class=nx>stream</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>
</span><span id=__span-192-7><a id=__codelineno-192-7 name=__codelineno-192-7 href=#__codelineno-192-7></a><span class=p>})</span>
</span><span id=__span-192-8><a id=__codelineno-192-8 name=__codelineno-192-8 href=#__codelineno-192-8></a><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mf>3000</span><span class=p>)</span>
</span></code></pre></div><ul> <li>我們沒有等待整個檔案被完全讀取(fully read),而是當我們有已經準備好(ready)的大量數據(a chunk of data)要被傳送時,就可以立即開始利用串流(streaming)的方式傳輸到HTTP客戶端(client)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>readable.pipe(destination[, options])</a>方法的介紹</li> <li>上面的範例使用<code>stream.pipe(res)</code>方法,而這個方法(method)會在檔案串流(file stream)上被呼叫(called)</li> <li>這個方法是用來做什麼的? 它會獲得(takes)消息來源(source),並用管道(<code>pipe</code>)的方式來傳送到目的地(destination)</li> <li>我們也可以在消息來源串流(source stream)上呼叫(call)<code>stream.pipe(res)</code>這個方法,因此在這種情況下,檔案通常會被用管道(<code>pipe</code>)的方式來傳送到HTTP的回應物件(<code>response</code>)中</li> <li><code>stream.pipe(res)</code>這個方法回傳的值就是目的地串流(destination stream),而它是一個非常方便(convenient)的東西來讓我們可以串連(chain)多個(multiple)管道(<code>pipe</code>)呼叫(calls) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-193-1><a id=__codelineno-193-1 name=__codelineno-193-1 href=#__codelineno-193-1></a><span class=nx>src</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest1</span><span class=p>).</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest2</span><span class=p>)</span>
</span></code></pre></div><ul> <li>以上做法的構想(construct)會跟以下這種方式是相同的 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-194-1><a id=__codelineno-194-1 name=__codelineno-194-1 href=#__codelineno-194-1></a><span class=nx>src</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest1</span><span class=p>)</span>
</span><span id=__span-194-2><a id=__codelineno-194-2 name=__codelineno-194-2 href=#__codelineno-194-2></a><span class=nx>dest1</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest2</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>利用串流驅動的Node APIs (Streams-powered Node.js APIs)</li> <li>因為這些優點(advantages),許多Node的內建核心模組(core module)都有提供(provide)原生(native)的串流(<code>stream</code>)處理(handling)能力(capabilities),尤其(notably)是以下幾種方式<ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_stdin>process.stdin</a>: 此屬性會回傳(returns)一個<code>streams</code>(串流)來連接(connected)到標準輸入(<code>stdin</code>)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_stdout>process.stdout</a>: 此屬性會回傳(returns)一個<code>streams</code>(串流)來連接(connected)到標準輸出(<code>stdout</code>)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_stderr>process.stderr</a>: 此屬性會回傳(returns)一個<code>streams</code>(串流)來連接(connected)到標準錯誤(<code>stderr</code>)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createreadstream_path_options>fs.createReadStream(path[, options])</a>: 此方法會建立(creates)一個可讀取(readable)的檔案串流(stream to a file)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createwritestream_path_options>fs.createWriteStream(path[, options])</a>: 此方法會建立(creates)一個可寫入(writable)的檔案串流(stream to a file)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/net.html#net_net_connect>net.connect()</a>: 此方法會開始(initiates)一個以<code>streams</code>為基礎(stream-based)的連線(connection)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_http_request_url_options_callback>http.request(url[, options][, callback])</a>: 此方法會回傳(returns)一個<code>http.ClientRequest</code>類別(class)的實例(instance),而這個實例會是一個可寫入(writable)的串流(<code>stream</code>)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html#zlib_zlib_creategzip_options>zlib.createGzip([options])</a>: 此方法會利用<code>gzip</code>這種壓縮演算法(compress algorithm)來將資料(data)壓縮(compress)進<code>streams</code>(串流)裡面(into)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html#zlib_zlib_creategunzip_options>zlib.createGunzip([options])</a>: 此方法會解壓縮(decompress)一個<code>gzip</code>串流(<code>stream</code>)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html#zlib_zlib_createdeflate_options>zlib.createDeflate([options])</a>: 此方法會利用<code>deflate</code>這種壓縮演算法(compress algorithm)來將資料(data)壓縮(compress)進<code>streams</code>(串流)裡面(into)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html#zlib_zlib_createinflate_options>zlib.createInflate([options])</a>: 此方法會解壓縮(decompress)一個<code>deflate</code>串流(<code>stream</code>)</li> </ul> </li> <li>不同類型的串流(<code>stream</code>) (Different types of streams)</li> <li>串流(<code>stream</code>)會有以下4種類別(classes)<ul> <li><code>Readable</code>: 可讀取串流(readable stream)是一個我們可以透過管道傳出(pipe from),而不能傳入(pipe into)的<code>stream</code>(串流); 也就是說,我們可以利用可讀取串流(readable stream)來接收資料(receive data),而不能傳送資料(send data)給它。當我們推送(push)資料(data)進入(into)可讀取串流(readable stream)時,這些資料是緩存(buffered)的,直到(until)使用者(consumer)開始讀取(starts to read)這些資料(data)</li> <li><code>Writable</code>: 可寫入串流(writable stream)是一個我們可以透過管道傳入(pipe into),而不能傳出(pipe from)的<code>stream</code>(串流); 也就是說,我們可以利用可寫入串流(writable stream)來傳送資料(send data),而不能傳入資料(receive data)給它。</li> <li><code>Duplex</code>: 雙向串流(duplex stream)是一個既能接受我們透過管道傳入(pipe into),也能接受我們透過管道傳出(pipe from)。基本上來說(basically),就是可讀取串流(readable stream) &amp; 可寫入串流(writable stream)的結合(combination)</li> <li><code>Transform</code>: 轉換串流(transform stream)類似於雙向串流(duplex stream),但是轉換串流(transform stream)的輸出(output)是它的輸入(its input)的轉換(transform)</li> </ul> </li> <li>如何建立一個可讀取串流(readable stream)? (How to create a readable stream)</li> <li>我們可以透過Node的<code>Stream</code>內建核心模組來獲得(get)一個可讀取串流(readable stream),接著我們再初始化(initialize)它並且實作(implement)它的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size_1>readable._read(size)</a>方法(method)</li> <li>首先,我們先建立(create)一個串流物件(stream object) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-195-1><a id=__codelineno-195-1 name=__codelineno-195-1 href=#__codelineno-195-1></a><span class=kd>const</span><span class=w> </span><span class=nx>Stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>)</span>
</span><span id=__span-195-2><a id=__codelineno-195-2 name=__codelineno-195-2 href=#__codelineno-195-2></a><span class=kd>const</span><span class=w> </span><span class=nx>readableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>()</span>
</span></code></pre></div></li> <li>接著,實作(implement)它的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size_1>readable._read(size)</a>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-196-1><a id=__codelineno-196-1 name=__codelineno-196-1 href=#__codelineno-196-1></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>_read</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{}</span>
</span></code></pre></div></li> <li>我們也可以利用<code>read</code>這個選項(option)來實作(implement)<code>readable._read(size)</code>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-197-1><a id=__codelineno-197-1 name=__codelineno-197-1 href=#__codelineno-197-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>({</span>
</span><span id=__span-197-2><a id=__codelineno-197-2 name=__codelineno-197-2 href=#__codelineno-197-2></a><span class=w>  </span><span class=nx>read</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-197-3><a id=__codelineno-197-3 name=__codelineno-197-3 href=#__codelineno-197-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>現在(Now),<code>stream</code>(串流)是被初始化過後(initialized)的,我們可以傳送資料(send data)給它 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-198-1><a id=__codelineno-198-1 name=__codelineno-198-1 href=#__codelineno-198-1></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>)</span>
</span><span id=__span-198-2><a id=__codelineno-198-2 name=__codelineno-198-2 href=#__codelineno-198-2></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;ho!&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>如何建立一個可寫入串流(writable stream)? (How to create a writable stream)</li> <li>為了建立(create)出一個可寫入串流(writable stream),我們先繼承(extend)基礎(base)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_streams>Writable</a>物件(object),接著我們會實作(implement)這個<code>Writable</code>物件的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback_1>writable._write(chunk, encoding, callback)</a>方法(method)</li> <li>首先,我們先建立(create)一個串流物件(stream object) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-199-1><a id=__codelineno-199-1 name=__codelineno-199-1 href=#__codelineno-199-1></a><span class=kd>const</span><span class=w> </span><span class=nx>Stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>)</span>
</span><span id=__span-199-2><a id=__codelineno-199-2 name=__codelineno-199-2 href=#__codelineno-199-2></a><span class=kd>const</span><span class=w> </span><span class=nx>writableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Writable</span><span class=p>()</span>
</span></code></pre></div></li> <li>接著,實作(implement)它的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback_1>writable._write(chunk, encoding, callback)</a>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-200-1><a id=__codelineno-200-1 name=__codelineno-200-1 href=#__codelineno-200-1></a><span class=nx>writableStream</span><span class=p>.</span><span class=nx>_write</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>,</span><span class=w> </span><span class=nx>encoding</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-200-2><a id=__codelineno-200-2 name=__codelineno-200-2 href=#__codelineno-200-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span><span id=__span-200-3><a id=__codelineno-200-3 name=__codelineno-200-3 href=#__codelineno-200-3></a><span class=w>  </span><span class=nx>next</span><span class=p>()</span>
</span><span id=__span-200-4><a id=__codelineno-200-4 name=__codelineno-200-4 href=#__codelineno-200-4></a><span class=p>}</span>
</span></code></pre></div></li> <li>現在(Now),我們就可以透過管道傳入(pipe into)一個可讀取串流(readable stream)進去 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-201-1><a id=__codelineno-201-1 name=__codelineno-201-1 href=#__codelineno-201-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>writableStream</span><span class=p>)</span>
</span></code></pre></div></li> <li>如何從可讀取串流中(readable stream)獲得資料? (How to get data from a readable stream?)</li> <li><code>Question</code>: 我們該如何從可讀取串流中(readable stream)獲得資料呢?<ul> <li><code>Answer</code>: 利用可寫入串流(writable stream) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-202-1><a id=__codelineno-202-1 name=__codelineno-202-1 href=#__codelineno-202-1></a><span class=kd>const</span><span class=w> </span><span class=nx>Stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>)</span>
</span><span id=__span-202-2><a id=__codelineno-202-2 name=__codelineno-202-2 href=#__codelineno-202-2></a>
</span><span id=__span-202-3><a id=__codelineno-202-3 name=__codelineno-202-3 href=#__codelineno-202-3></a><span class=kd>const</span><span class=w> </span><span class=nx>readableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>({</span>
</span><span id=__span-202-4><a id=__codelineno-202-4 name=__codelineno-202-4 href=#__codelineno-202-4></a><span class=w>  </span><span class=nx>read</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-202-5><a id=__codelineno-202-5 name=__codelineno-202-5 href=#__codelineno-202-5></a><span class=p>})</span>
</span><span id=__span-202-6><a id=__codelineno-202-6 name=__codelineno-202-6 href=#__codelineno-202-6></a><span class=kd>const</span><span class=w> </span><span class=nx>writableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Writable</span><span class=p>()</span>
</span><span id=__span-202-7><a id=__codelineno-202-7 name=__codelineno-202-7 href=#__codelineno-202-7></a>
</span><span id=__span-202-8><a id=__codelineno-202-8 name=__codelineno-202-8 href=#__codelineno-202-8></a><span class=nx>writableStream</span><span class=p>.</span><span class=nx>_write</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>,</span><span class=w> </span><span class=nx>encoding</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-202-9><a id=__codelineno-202-9 name=__codelineno-202-9 href=#__codelineno-202-9></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span><span id=__span-202-10><a id=__codelineno-202-10 name=__codelineno-202-10 href=#__codelineno-202-10></a><span class=w>  </span><span class=nx>next</span><span class=p>()</span>
</span><span id=__span-202-11><a id=__codelineno-202-11 name=__codelineno-202-11 href=#__codelineno-202-11></a><span class=p>}</span>
</span><span id=__span-202-12><a id=__codelineno-202-12 name=__codelineno-202-12 href=#__codelineno-202-12></a>
</span><span id=__span-202-13><a id=__codelineno-202-13 name=__codelineno-202-13 href=#__codelineno-202-13></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>writableStream</span><span class=p>)</span>
</span><span id=__span-202-14><a id=__codelineno-202-14 name=__codelineno-202-14 href=#__codelineno-202-14></a>
</span><span id=__span-202-15><a id=__codelineno-202-15 name=__codelineno-202-15 href=#__codelineno-202-15></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>)</span>
</span><span id=__span-202-16><a id=__codelineno-202-16 name=__codelineno-202-16 href=#__codelineno-202-16></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;ho!&#39;</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> <li>我們也可以直接地(directly)消耗(consume)一個可讀取串流(readable stream),可利用<code>readable</code>事件(event) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-203-1><a id=__codelineno-203-1 name=__codelineno-203-1 href=#__codelineno-203-1></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;readable&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-203-2><a id=__codelineno-203-2 name=__codelineno-203-2 href=#__codelineno-203-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>readableStream</span><span class=p>.</span><span class=nx>read</span><span class=p>())</span>
</span><span id=__span-203-3><a id=__codelineno-203-3 name=__codelineno-203-3 href=#__codelineno-203-3></a><span class=p>})</span>
</span></code></pre></div></li> <li>如何傳送資料給可寫入串流(writable stream)? (How to send data to a writable stream)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback>writable.write(chunk[, encoding][, callback])</a>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-204-1><a id=__codelineno-204-1 name=__codelineno-204-1 href=#__codelineno-204-1></a><span class=nx>writableStream</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;hey!\n&#39;</span><span class=p>)</span>
</span></code></pre></div></li> <li>當我們結束寫入操作時,該如何對可寫入串流(writable stream)發送一個信號呢? (Signaling a writable stream that you ended writing)</li> <li>可利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_end_chunk_encoding_callback>writable.end([chunk[, encoding]][, callback])</a>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-205-1><a id=__codelineno-205-1 name=__codelineno-205-1 href=#__codelineno-205-1></a><span class=kd>const</span><span class=w> </span><span class=nx>Stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>)</span>
</span><span id=__span-205-2><a id=__codelineno-205-2 name=__codelineno-205-2 href=#__codelineno-205-2></a>
</span><span id=__span-205-3><a id=__codelineno-205-3 name=__codelineno-205-3 href=#__codelineno-205-3></a><span class=kd>const</span><span class=w> </span><span class=nx>readableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>({</span>
</span><span id=__span-205-4><a id=__codelineno-205-4 name=__codelineno-205-4 href=#__codelineno-205-4></a><span class=w>  </span><span class=nx>read</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-205-5><a id=__codelineno-205-5 name=__codelineno-205-5 href=#__codelineno-205-5></a><span class=p>})</span>
</span><span id=__span-205-6><a id=__codelineno-205-6 name=__codelineno-205-6 href=#__codelineno-205-6></a><span class=kd>const</span><span class=w> </span><span class=nx>writableStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Stream</span><span class=p>.</span><span class=nx>Writable</span><span class=p>()</span>
</span><span id=__span-205-7><a id=__codelineno-205-7 name=__codelineno-205-7 href=#__codelineno-205-7></a>
</span><span id=__span-205-8><a id=__codelineno-205-8 name=__codelineno-205-8 href=#__codelineno-205-8></a><span class=nx>writableStream</span><span class=p>.</span><span class=nx>_write</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>,</span><span class=w> </span><span class=nx>encoding</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-205-9><a id=__codelineno-205-9 name=__codelineno-205-9 href=#__codelineno-205-9></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span><span id=__span-205-10><a id=__codelineno-205-10 name=__codelineno-205-10 href=#__codelineno-205-10></a><span class=w>  </span><span class=nx>next</span><span class=p>()</span>
</span><span id=__span-205-11><a id=__codelineno-205-11 name=__codelineno-205-11 href=#__codelineno-205-11></a><span class=p>}</span>
</span><span id=__span-205-12><a id=__codelineno-205-12 name=__codelineno-205-12 href=#__codelineno-205-12></a>
</span><span id=__span-205-13><a id=__codelineno-205-13 name=__codelineno-205-13 href=#__codelineno-205-13></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>writableStream</span><span class=p>)</span>
</span><span id=__span-205-14><a id=__codelineno-205-14 name=__codelineno-205-14 href=#__codelineno-205-14></a>
</span><span id=__span-205-15><a id=__codelineno-205-15 name=__codelineno-205-15 href=#__codelineno-205-15></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>)</span>
</span><span id=__span-205-16><a id=__codelineno-205-16 name=__codelineno-205-16 href=#__codelineno-205-16></a><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;ho!&#39;</span><span class=p>)</span>
</span><span id=__span-205-17><a id=__codelineno-205-17 name=__codelineno-205-17 href=#__codelineno-205-17></a>
</span><span id=__span-205-18><a id=__codelineno-205-18 name=__codelineno-205-18 href=#__codelineno-205-18></a><span class=nx>writableStream</span><span class=p>.</span><span class=nx>end</span><span class=p>()</span>
</span></code></pre></div></li> </ul> <h3 id=nodejs-the-difference-between-development-and-production>Node.js, the difference between development and production<a class=headerlink href=#nodejs-the-difference-between-development-and-production title="Permanent link">&para;</a></h3> <ul> <li>我們可以對生產環境(production environment)、開發環境(development environment)做不同的設定(configurations)</li> <li>Node會假設(assumes)我們總是在開發環境中(development environment)執行。這時,我們可以透過設定Node的環境變數(environment variable)為"生產環境(production environment)",來向Node發出我們在生產環境執行(running)應用程式的信號(signal)</li> <li><code>bash export NODE_ENV=production</code><ul> <li>以上的指令是在<code>shell</code>中執行的,但是最好將這個指令加到我們的<code>shell</code>設定檔(例: <code>.bash_profile</code>)中,否則當我們重開機(system restart)時,在終端機上執行指令所產生的Node環境變數設定就"不會"被保留(not persist)</li> </ul> </li> <li>我們也可以透過以下的另一種方式來設定Node環境變數(environment variable),就是在執行Node應用程式初始化(initialization)的指令(command)前面,前綴(prepending)Node環境變數</li> <li><code>console NODE_ENV=production node app.js</code></li> <li>Node環境變數的設定是一種慣例(convention),也被廣泛(widely)地被使用(used in)在外部函式庫(external libraries)中</li> <li>將Node環境變數設定為 <strong>生產環境</strong> ,通常(generally)可確保(ensures)以下2件事情</li> <li>日誌記錄(logging)保持(kept)在最少(minimum)、最必要(essential)的水平(level)</li> <li>會發生(take place)更多的緩存級別(caching levels),以優化(optimize)效能(performance)</li> <li>舉例來說,<a href=https://expressjs.com/ >Express</a>所使用的模板函式庫(templating library)---&gt;<a href=https://pugjs.org/api/getting-started.html>pug</a>,會在當Node環境變數 <strong>不是</strong> 被設定為生產環境(<code>production</code>)時,就會以除錯模式(in debug mode)來編譯(compiles)</li> <li>在開發模式(development mode)中,<code>Express</code>的<code>views</code>會在每次(every)請求(<code>request</code>)時被編譯(compiled); 然而當在生產模式(production mode)中,則會將其緩存(cached)。以下會有更多的範例(examples)</li> <li>我們可以利用條件陳述句(conditional statements)來切換在不同環境(in different environments)中執行(execute)程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-206-1><a id=__codelineno-206-1 name=__codelineno-206-1 href=#__codelineno-206-1></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;development&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-206-2><a id=__codelineno-206-2 name=__codelineno-206-2 href=#__codelineno-206-2></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-206-3><a id=__codelineno-206-3 name=__codelineno-206-3 href=#__codelineno-206-3></a><span class=p>}</span>
</span><span id=__span-206-4><a id=__codelineno-206-4 name=__codelineno-206-4 href=#__codelineno-206-4></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;production&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-206-5><a id=__codelineno-206-5 name=__codelineno-206-5 href=#__codelineno-206-5></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-206-6><a id=__codelineno-206-6 name=__codelineno-206-6 href=#__codelineno-206-6></a><span class=p>}</span>
</span><span id=__span-206-7><a id=__codelineno-206-7 name=__codelineno-206-7 href=#__codelineno-206-7></a><span class=k>if</span><span class=p>([</span><span class=s1>&#39;production&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;staging&#39;</span><span class=p>].</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-206-8><a id=__codelineno-206-8 name=__codelineno-206-8 href=#__codelineno-206-8></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-206-9><a id=__codelineno-206-9 name=__codelineno-206-9 href=#__codelineno-206-9></a><span class=p>})</span>
</span></code></pre></div></li> <li>舉例來說,在<code>Express</code>框架應用程式(app)中,我們可以利用條件陳述句(conditional statements)來針對每個環境(per environment)設定(set)不同的錯誤處理器(error handler) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-207-1><a id=__codelineno-207-1 name=__codelineno-207-1 href=#__codelineno-207-1></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;development&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-207-2><a id=__codelineno-207-2 name=__codelineno-207-2 href=#__codelineno-207-2></a><span class=w>  </span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>errorHandler</span><span class=p>({</span><span class=w> </span><span class=nx>dumpExceptions</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=nx>showStack</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>}))</span>
</span><span id=__span-207-3><a id=__codelineno-207-3 name=__codelineno-207-3 href=#__codelineno-207-3></a><span class=p>})</span>
</span><span id=__span-207-4><a id=__codelineno-207-4 name=__codelineno-207-4 href=#__codelineno-207-4></a>
</span><span id=__span-207-5><a id=__codelineno-207-5 name=__codelineno-207-5 href=#__codelineno-207-5></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;production&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-207-6><a id=__codelineno-207-6 name=__codelineno-207-6 href=#__codelineno-207-6></a><span class=w>  </span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>errorHandler</span><span class=p>())</span>
</span><span id=__span-207-7><a id=__codelineno-207-7 name=__codelineno-207-7 href=#__codelineno-207-7></a><span class=p>})</span>
</span></code></pre></div></li> </ul> <h3 id=error-handling-in-nodejs>Error handling in Node.js<a class=headerlink href=#error-handling-in-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/errors.html#errors_errors>Errors</a><br></p> </blockquote> <ul> <li>在Node中,是透過(through)例外(<code>exceptions</code>)來處理(handled)錯誤(errors)的</li> <li>建立一個例外 (Creating exceptions)</li> <li>要建立一個例外,可以透過拋出(<code>throw</code>)關鍵字(keyword) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-208-1><a id=__codelineno-208-1 name=__codelineno-208-1 href=#__codelineno-208-1></a><span class=k>throw</span><span class=w> </span><span class=nx>value</span>
</span></code></pre></div></li> <li>一旦Javascript執行(executes)到此行(this line)指令,正常(normal)的程式流程(program flow)就會被停止(halted),並且程式的控制權(control)會被保留(held back)給最近(nearest)的例外處理器(<code>exception handler</code>)<ul> <li>通常,在客戶端(client-side)的程式碼(code)中,以上範例中的<code>value</code>可以是任何(any)Javascript的值,包含一個字串(<code>string</code>)、數字(<code>number</code>)、或是物件(<code>object</code>)</li> <li><strong>在Node中,我們"不會"拋出(throw)字串(strings),我們只會拋出(throw)錯誤物件(<code>Error</code> objects)</strong></li> </ul> </li> <li>錯誤物件 (Error objects)</li> <li>在Node中,錯誤物件(<code>error</code> object)可以是一個錯誤物件(<code>Error</code> object)的實例(instance),或是繼承(extends)自Node的<code>Errors</code>內建核心模組內所提供(provided)的錯誤類別(<code>Error</code> class)的物件(object) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-209-1><a id=__codelineno-209-1 name=__codelineno-209-1 href=#__codelineno-209-1></a><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Ran out of coffee&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>或是 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-210-1><a id=__codelineno-210-1 name=__codelineno-210-1 href=#__codelineno-210-1></a><span class=kd>class</span><span class=w> </span><span class=nx>NotEnoughCoffeeError</span><span class=w> </span><span class=k>extends</span><span class=w> </span><span class=ne>Error</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-210-2><a id=__codelineno-210-2 name=__codelineno-210-2 href=#__codelineno-210-2></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-210-3><a id=__codelineno-210-3 name=__codelineno-210-3 href=#__codelineno-210-3></a><span class=p>}</span>
</span><span id=__span-210-4><a id=__codelineno-210-4 name=__codelineno-210-4 href=#__codelineno-210-4></a><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>NotEnoughCoffeeError</span><span class=p>()</span>
</span></code></pre></div></li> </ul> </li> <li>處理例外 (Handling exceptions)</li> <li>一個例外處理器(exception handler)就是<code>try/catch</code>陳述句(statement)</li> <li>任何包在(included)<code>try</code>區塊(block)內的程式碼所引發(raised in)的例外(exception),都會在其相對應(corresponding)的<code>catch</code>區塊(block)中被處理(handled) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-211-1><a id=__codelineno-211-1 name=__codelineno-211-1 href=#__codelineno-211-1></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-211-2><a id=__codelineno-211-2 name=__codelineno-211-2 href=#__codelineno-211-2></a><span class=w>  </span><span class=c1>//lines of code</span>
</span><span id=__span-211-3><a id=__codelineno-211-3 name=__codelineno-211-3 href=#__codelineno-211-3></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{}</span>
</span></code></pre></div><ul> <li>在以上的範例程式碼中,<code>e</code>就是例外值(<code>exception</code> value)。我們可以在<code>catch</code>區塊(block)中新增(add)多個(multiple)錯誤處理器(handlers),這些錯誤處理器就可以用來捕獲(<code>catch</code>)各種不同的錯誤(different kinds of errors)</li> </ul> </li> <li>捕獲未捕獲的例外 (Catching uncaught exceptions)</li> <li>當程式(program)正在執行中時,如果在程式中有未捕獲的例外(uncaught exception)被拋出(thrown)時,我們的程式將會崩潰(crash)</li> <li>為了解決這個問題,我們可以監聽<code>process</code>物件上的<a href=https://nodejs.org/api/process.html#process_event_uncaughtexception>uncaughtException</a>事件 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-212-1><a id=__codelineno-212-1 name=__codelineno-212-1 href=#__codelineno-212-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;uncaughtException&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-212-2><a id=__codelineno-212-2 name=__codelineno-212-2 href=#__codelineno-212-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;There was an uncaught error&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-212-3><a id=__codelineno-212-3 name=__codelineno-212-3 href=#__codelineno-212-3></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mf>1</span><span class=p>)</span><span class=w> </span><span class=c1>//mandatory (as per the Node.js docs)</span>
</span><span id=__span-212-4><a id=__codelineno-212-4 name=__codelineno-212-4 href=#__codelineno-212-4></a><span class=p>})</span>
</span></code></pre></div><ul> <li>我們不需要為此事先匯入(import)Node的<code>process</code>內建核心模組(core module),因為<code>process</code>模組是Node會自動(automatically)注入(injected)的</li> </ul> </li> <li><code>Promise</code>物件的例外 (Exceptions with promises)</li> <li><strong>我們可以利用<code>Promise</code>物件來串連(chain)不同的操作(different operations),並且在最後(at the end)處理錯誤(handle errors)</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-213-1><a id=__codelineno-213-1 name=__codelineno-213-1 href=#__codelineno-213-1></a><span class=nx>doSomething1</span><span class=p>()</span>
</span><span id=__span-213-2><a id=__codelineno-213-2 name=__codelineno-213-2 href=#__codelineno-213-2></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>doSomething2</span><span class=p>)</span>
</span><span id=__span-213-3><a id=__codelineno-213-3 name=__codelineno-213-3 href=#__codelineno-213-3></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>doSomething3</span><span class=p>)</span>
</span><span id=__span-213-4><a id=__codelineno-213-4 name=__codelineno-213-4 href=#__codelineno-213-4></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></code></pre></div></li> <li>那我們該怎麼知道錯誤(<code>error</code>)是在哪裡發生(occured)的呢? 其實我們並不需要真的(really)知道這件事,我們可以在每個(each)被呼叫(call)的函式(functions)中,都處理(handle)錯誤(error)(=&gt; 也就是以上範例中的<code>doSomethingX</code>),並且在錯誤處理器中(inside the <code>error</code> handler)拋出(throw)一個錯誤(<code>error</code>),而這個被拋出的錯誤會被用來呼叫(call)外面(outside)的<code>catch</code>錯誤處理器(handler) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-214-1><a id=__codelineno-214-1 name=__codelineno-214-1 href=#__codelineno-214-1></a><span class=kd>const</span><span class=w> </span><span class=nx>doSomething1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-214-2><a id=__codelineno-214-2 name=__codelineno-214-2 href=#__codelineno-214-2></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-214-3><a id=__codelineno-214-3 name=__codelineno-214-3 href=#__codelineno-214-3></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-214-4><a id=__codelineno-214-4 name=__codelineno-214-4 href=#__codelineno-214-4></a><span class=w>    </span><span class=c1>//...</span>
</span><span id=__span-214-5><a id=__codelineno-214-5 name=__codelineno-214-5 href=#__codelineno-214-5></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-214-6><a id=__codelineno-214-6 name=__codelineno-214-6 href=#__codelineno-214-6></a><span class=w>    </span><span class=c1>//... handle it locally</span>
</span><span id=__span-214-7><a id=__codelineno-214-7 name=__codelineno-214-7 href=#__codelineno-214-7></a><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span><span id=__span-214-8><a id=__codelineno-214-8 name=__codelineno-214-8 href=#__codelineno-214-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-214-9><a id=__codelineno-214-9 name=__codelineno-214-9 href=#__codelineno-214-9></a><span class=w>  </span><span class=c1>//...</span>
</span><span id=__span-214-10><a id=__codelineno-214-10 name=__codelineno-214-10 href=#__codelineno-214-10></a><span class=p>}</span>
</span></code></pre></div></li> <li>為了能夠(be able to)在本地(locally)處理錯誤(handler <code>errors</code>)而不用(without)在我們呼叫(call)函式(function)時才處理(handling),我們可以跳出(break)串連(chain),並且透過在每個(each)<code>then()</code>函式後面建立(create)一個函式(function)來處理(process)例外(exception) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-215-1><a id=__codelineno-215-1 name=__codelineno-215-1 href=#__codelineno-215-1></a><span class=nx>doSomething1</span><span class=p>()</span>
</span><span id=__span-215-2><a id=__codelineno-215-2 name=__codelineno-215-2 href=#__codelineno-215-2></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-215-3><a id=__codelineno-215-3 name=__codelineno-215-3 href=#__codelineno-215-3></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>doSomething2</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-215-4><a id=__codelineno-215-4 name=__codelineno-215-4 href=#__codelineno-215-4></a><span class=w>      </span><span class=c1>//handle error</span>
</span><span id=__span-215-5><a id=__codelineno-215-5 name=__codelineno-215-5 href=#__codelineno-215-5></a><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=c1>//break the chain!</span>
</span><span id=__span-215-6><a id=__codelineno-215-6 name=__codelineno-215-6 href=#__codelineno-215-6></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-215-7><a id=__codelineno-215-7 name=__codelineno-215-7 href=#__codelineno-215-7></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-215-8><a id=__codelineno-215-8 name=__codelineno-215-8 href=#__codelineno-215-8></a><span class=w>  </span><span class=p>.</span><span class=nx>then</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-215-9><a id=__codelineno-215-9 name=__codelineno-215-9 href=#__codelineno-215-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>doSomething2</span><span class=p>().</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-215-10><a id=__codelineno-215-10 name=__codelineno-215-10 href=#__codelineno-215-10></a><span class=w>      </span><span class=c1>//handle error</span>
</span><span id=__span-215-11><a id=__codelineno-215-11 name=__codelineno-215-11 href=#__codelineno-215-11></a><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=c1>//break the chain!</span>
</span><span id=__span-215-12><a id=__codelineno-215-12 name=__codelineno-215-12 href=#__codelineno-215-12></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-215-13><a id=__codelineno-215-13 name=__codelineno-215-13 href=#__codelineno-215-13></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-215-14><a id=__codelineno-215-14 name=__codelineno-215-14 href=#__codelineno-215-14></a><span class=w>  </span><span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>))</span>
</span></code></pre></div></li> <li>利用<code>async/await</code>語法來處理例外 (Error handling with async/await)</li> <li>我們可以利用<code>async/await</code>語法來處理例外(exceptions),但我們仍然需要捕抓(catch)錯誤(<code>errors</code>),我們可以利用以下的方式(way)來完成 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-216-1><a id=__codelineno-216-1 name=__codelineno-216-1 href=#__codelineno-216-1></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>someFunction</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-216-2><a id=__codelineno-216-2 name=__codelineno-216-2 href=#__codelineno-216-2></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-216-3><a id=__codelineno-216-3 name=__codelineno-216-3 href=#__codelineno-216-3></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>someOtherFunction</span><span class=p>()</span>
</span><span id=__span-216-4><a id=__codelineno-216-4 name=__codelineno-216-4 href=#__codelineno-216-4></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-216-5><a id=__codelineno-216-5 name=__codelineno-216-5 href=#__codelineno-216-5></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span><span id=__span-216-6><a id=__codelineno-216-6 name=__codelineno-216-6 href=#__codelineno-216-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-216-7><a id=__codelineno-216-7 name=__codelineno-216-7 href=#__codelineno-216-7></a><span class=p>}</span>
</span></code></pre></div></li> </ul> <h3 id=how-to-log-an-object-in-nodejs>How to log an object in Node.js<a class=headerlink href=#how-to-log-an-object-in-nodejs title="Permanent link">&para;</a></h3> <blockquote> <p>Node內建核心模組<a href=https://nodejs.org/api/console.html#console_console>Console</a><br></p> </blockquote> <ul> <li>當我們在瀏覽器(in the browser)的Javascript程式碼中輸入(type)<code>console.log()</code>語法時,就會在瀏覽器後台(browser console)建立(create)一個漂亮(nice)的條目(entry)</li> <li><img alt=console-log-browser src=../../assets/pics/nodejs/console-log-browser.png></li> <li>當我們點擊(click)箭頭(arrow)時,日誌(log)就會被展開(expanded),這時我們就可以清楚地(clearly)看到物件(object)的屬性們(properties)</li> <li><img alt=console-log-browser-expanded src=../../assets/pics/nodejs/console-log-browser-expanded.png></li> <li>在Node中,也會發生(happens)相同(same)的事情</li> <li>當我們要記錄(log)某些內容到後台(console)時,並不能那麼奢侈的(luxury)。因為如果我們是手動(manually)執行(run)Node程式(program)的話,它將會輸出(output)日誌物件(object)到<code>shell</code>或是到日誌檔案(log file)中。這時,我們將會得到物件的字串表現形式(string representation of the object)</li> <li>現在,直到(until)一定的(certain)巢狀程度級別(level of nesting)之前,一切都是很好的(fine)。但是,從第二層(two levels of)的巢狀物件結構(nesting)以後(after),Node就會放棄(gives up)並且打印(print)出<code>[Object]</code>作為佔位符(placeholder) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-217-1><a id=__codelineno-217-1 name=__codelineno-217-1 href=#__codelineno-217-1></a><span class=kd>const</span><span class=w> </span><span class=nx>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-2><a id=__codelineno-217-2 name=__codelineno-217-2 href=#__codelineno-217-2></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;joe&#39;</span><span class=p>,</span>
</span><span id=__span-217-3><a id=__codelineno-217-3 name=__codelineno-217-3 href=#__codelineno-217-3></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>35</span><span class=p>,</span>
</span><span id=__span-217-4><a id=__codelineno-217-4 name=__codelineno-217-4 href=#__codelineno-217-4></a><span class=w>  </span><span class=nx>person1</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-5><a id=__codelineno-217-5 name=__codelineno-217-5 href=#__codelineno-217-5></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Tony&#39;</span><span class=p>,</span>
</span><span id=__span-217-6><a id=__codelineno-217-6 name=__codelineno-217-6 href=#__codelineno-217-6></a><span class=w>    </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>50</span><span class=p>,</span>
</span><span id=__span-217-7><a id=__codelineno-217-7 name=__codelineno-217-7 href=#__codelineno-217-7></a><span class=w>    </span><span class=nx>person2</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-8><a id=__codelineno-217-8 name=__codelineno-217-8 href=#__codelineno-217-8></a><span class=w>      </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Albert&#39;</span><span class=p>,</span>
</span><span id=__span-217-9><a id=__codelineno-217-9 name=__codelineno-217-9 href=#__codelineno-217-9></a><span class=w>      </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>21</span><span class=p>,</span>
</span><span id=__span-217-10><a id=__codelineno-217-10 name=__codelineno-217-10 href=#__codelineno-217-10></a><span class=w>      </span><span class=nx>person3</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-11><a id=__codelineno-217-11 name=__codelineno-217-11 href=#__codelineno-217-11></a><span class=w>        </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Peter&#39;</span><span class=p>,</span>
</span><span id=__span-217-12><a id=__codelineno-217-12 name=__codelineno-217-12 href=#__codelineno-217-12></a><span class=w>        </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>23</span>
</span><span id=__span-217-13><a id=__codelineno-217-13 name=__codelineno-217-13 href=#__codelineno-217-13></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-217-14><a id=__codelineno-217-14 name=__codelineno-217-14 href=#__codelineno-217-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-217-15><a id=__codelineno-217-15 name=__codelineno-217-15 href=#__codelineno-217-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-217-16><a id=__codelineno-217-16 name=__codelineno-217-16 href=#__codelineno-217-16></a><span class=p>}</span>
</span><span id=__span-217-17><a id=__codelineno-217-17 name=__codelineno-217-17 href=#__codelineno-217-17></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>)</span>
</span><span id=__span-217-18><a id=__codelineno-217-18 name=__codelineno-217-18 href=#__codelineno-217-18></a>
</span><span id=__span-217-19><a id=__codelineno-217-19 name=__codelineno-217-19 href=#__codelineno-217-19></a>
</span><span id=__span-217-20><a id=__codelineno-217-20 name=__codelineno-217-20 href=#__codelineno-217-20></a><span class=p>{</span>
</span><span id=__span-217-21><a id=__codelineno-217-21 name=__codelineno-217-21 href=#__codelineno-217-21></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;joe&#39;</span><span class=p>,</span>
</span><span id=__span-217-22><a id=__codelineno-217-22 name=__codelineno-217-22 href=#__codelineno-217-22></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>35</span><span class=p>,</span>
</span><span id=__span-217-23><a id=__codelineno-217-23 name=__codelineno-217-23 href=#__codelineno-217-23></a><span class=w>  </span><span class=nx>person1</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-24><a id=__codelineno-217-24 name=__codelineno-217-24 href=#__codelineno-217-24></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Tony&#39;</span><span class=p>,</span>
</span><span id=__span-217-25><a id=__codelineno-217-25 name=__codelineno-217-25 href=#__codelineno-217-25></a><span class=w>    </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>50</span><span class=p>,</span>
</span><span id=__span-217-26><a id=__codelineno-217-26 name=__codelineno-217-26 href=#__codelineno-217-26></a><span class=w>    </span><span class=nx>person2</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-217-27><a id=__codelineno-217-27 name=__codelineno-217-27 href=#__codelineno-217-27></a><span class=w>      </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Albert&#39;</span><span class=p>,</span>
</span><span id=__span-217-28><a id=__codelineno-217-28 name=__codelineno-217-28 href=#__codelineno-217-28></a><span class=w>      </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>21</span><span class=p>,</span>
</span><span id=__span-217-29><a id=__codelineno-217-29 name=__codelineno-217-29 href=#__codelineno-217-29></a><span class=w>      </span><span class=nx>person3</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=nb>Object</span><span class=p>]</span>
</span><span id=__span-217-30><a id=__codelineno-217-30 name=__codelineno-217-30 href=#__codelineno-217-30></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-217-31><a id=__codelineno-217-31 name=__codelineno-217-31 href=#__codelineno-217-31></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-217-32><a id=__codelineno-217-32 name=__codelineno-217-32 href=#__codelineno-217-32></a><span class=p>}</span>
</span></code></pre></div></li> <li>那麼,我們該如何打印(print)出整個物件(whole object)呢?<ul> <li>最佳的做法(best way)會是在(while)維持(preserving)漂亮的打印(pretty print)輸出結果時,同時使用Javascript可支援的<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify>JSON.stringify()</a>方法(method) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-218-1><a id=__codelineno-218-1 name=__codelineno-218-1 href=#__codelineno-218-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>obj</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>))</span>
</span></code></pre></div><ul> <li>這個<code>2</code>是用來作為指定縮排(indentation)的空格數(number of spaces)</li> </ul> </li> <li>另一個可供選擇(option)的做法是利用Node的<a href=https://nodejs.org/api/util.html#util_util>Utilities</a>內建核心模組中的<a href=https://nodejs.org/api/util.html#util_util_inspect_object_showhidden_depth_colors>util.inspect(object[, showHidden[, depth[, colors]]])</a>方法(method)</li> <li>這個方法(method)可以指定以下的參數們<ul> <li><code>depth</code>(深度): 要展開到這個物件的第幾層</li> <li>預設值: <code>2</code></li> <li><code>colors</code>: 可以客製化地設定文字輸出的顏色</li> </ul> </li> <li>但<code>util.inspect()</code>這個方法會遇到的問題是,超過(after)2層(level)以上的巢狀物件(nested objects)會被攤平(flattened),這也會使原本有就比較複雜(complex)結構的物件(objects)會變得更複雜</li> </ul> </li> </ul> <h3 id=nodejs-with-typescript>Node.js with TypeScript<a class=headerlink href=#nodejs-with-typescript title="Permanent link">&para;</a></h3> <ul> <li>什麼是<code>Typescript</code>? (What is TypeScript)</li> <li><code>Typescript</code>是一個由Microsoft開發與維護的開源、熱門的程式語言,它受到全世界許多軟體開發者的喜愛和使用</li> <li>基本上(Basically), <strong><code>Typescript</code>是Javascript這個程式語言的一個超集(<code>superset</code>)</strong> ,並新增了一些能力(capabilities)給這個程式語言。最著名(notable)的新增(addition)功能就是 <strong>靜態型別定義(static type definitions)</strong> ,而這是一般(plain)的Javascript所沒有的功能。受型別(types)所惠,我們可以宣告(declare) <strong>我們預期什麼形式的參數</strong> (what kind of arguments we are expecting)、 <strong>函式確切會回傳什麼東西</strong> (what is returned exactly in our functions)、 <strong>我們建立的物件的確切樣子</strong> (what's the exact shape of the object that we are creating)</li> <li><code>Typescript</code>是一個非常強大(powerful)的工具(tool),並且它開啟(opens)了Javascript專案(project)可能性(possibilites)的新世界(new world)。它讓我們的程式碼能在提交(before code is even shipped)之前更安全(secure)、穩固(robust),當(during)我們在撰寫程式碼時,<code>Typescript</code>會捕抓問題(catches problems),並極好地(wonderfully)整合(integrates)到程式碼編輯器(code editors)中(例: <code>Visual Studio Code</code>)</li> <li>我們可以在之後再來討論(talk about)<code>Typescript</code>的好處(benefits),現在先讓我們先看看一些範例(examples)程式碼吧</li> <li>瞧瞧以下的程式碼片段(code snippet),接著我們就可以將它們拆解(unpack)再一起(together)了 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-219-1><a id=__codelineno-219-1 name=__codelineno-219-1 href=#__codelineno-219-1></a><span class=nx>type</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-219-2><a id=__codelineno-219-2 name=__codelineno-219-2 href=#__codelineno-219-2></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=nx>string</span><span class=p>;</span>
</span><span id=__span-219-3><a id=__codelineno-219-3 name=__codelineno-219-3 href=#__codelineno-219-3></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=nx>number</span><span class=p>;</span>
</span><span id=__span-219-4><a id=__codelineno-219-4 name=__codelineno-219-4 href=#__codelineno-219-4></a><span class=p>};</span>
</span><span id=__span-219-5><a id=__codelineno-219-5 name=__codelineno-219-5 href=#__codelineno-219-5></a>
</span><span id=__span-219-6><a id=__codelineno-219-6 name=__codelineno-219-6 href=#__codelineno-219-6></a><span class=kd>function</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=nx>User</span><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=kr>boolean</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-219-7><a id=__codelineno-219-7 name=__codelineno-219-7 href=#__codelineno-219-7></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>age</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>18</span><span class=p>;</span>
</span><span id=__span-219-8><a id=__codelineno-219-8 name=__codelineno-219-8 href=#__codelineno-219-8></a><span class=p>}</span>
</span><span id=__span-219-9><a id=__codelineno-219-9 name=__codelineno-219-9 href=#__codelineno-219-9></a>
</span><span id=__span-219-10><a id=__codelineno-219-10 name=__codelineno-219-10 href=#__codelineno-219-10></a><span class=kd>const</span><span class=w> </span><span class=nx>justine</span><span class=o>:</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-219-11><a id=__codelineno-219-11 name=__codelineno-219-11 href=#__codelineno-219-11></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Justine&#39;</span><span class=p>,</span>
</span><span id=__span-219-12><a id=__codelineno-219-12 name=__codelineno-219-12 href=#__codelineno-219-12></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=mf>23</span><span class=p>,</span>
</span><span id=__span-219-13><a id=__codelineno-219-13 name=__codelineno-219-13 href=#__codelineno-219-13></a><span class=p>};</span>
</span><span id=__span-219-14><a id=__codelineno-219-14 name=__codelineno-219-14 href=#__codelineno-219-14></a>
</span><span id=__span-219-15><a id=__codelineno-219-15 name=__codelineno-219-15 href=#__codelineno-219-15></a><span class=kd>const</span><span class=w> </span><span class=nx>isJustineAnAdult</span><span class=o>:</span><span class=w> </span><span class=kr>boolean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>justine</span><span class=p>);</span>
</span></code></pre></div><ul> <li>首先,<code>type</code>關鍵字的第一部份負責(responsible)宣告(declaring)代表(representing)使用者自己客製化(custom)的物件型別</li> <li>之後,我們會利用(utilize)這個新(newly)建立的型別來建立一個新的函式(function)<code>isAdult()</code>,該函式能接受(accpets)一個<code>User</code>型別的<code>user</code>參數(argument),並回傳(returns)一個布林值(<code>boolean</code>)</li> <li>接著,我們建立了<code>justine</code>這個<code>user</code>,它會是我們的範例資料以用來呼叫(calling)之前(previously)定義(defined)的函式(function)</li> <li>最後,我們會建立(create)一個新的帶有是否<code>justine</code>為成年人(adult)的這個資訊(information)的變數(vaiable)</li> <li>這個範例還有一些我們也應該需要額外(additional)知道的事情<ul> <li>首先,如果我們沒有遵守(comply with)宣告(declared)好的型別(types)時,<code>Typescript</code>會警告(alarm)我們就會警告我們有些東西出錯(wrong)了,以防止(prevent)誤用(misuse)</li> <li>第二點是,不是每個東西都需要明確地(explicitly)定義型別(typed)---<code>Typescript</code>是非常聰明(smart)的,並且能為我們推斷(deduce)型別(types)。例如: 即使(even if)我們沒有明確地(explicitly)輸入(type),<code>isJustineAnAdult</code>也會是一個布林(<code>boolean</code>)型別,或者即使(even if)我們沒有宣告(declare)<code>justine</code>為<code>User</code>型別(type),它也會變成一個對於函式(function)來說有效(valid)的參數(argument)</li> </ul> </li> </ul> </li> <li>Okay! 所以我們已經有一些<code>Typescript</code>程式碼了。那麼,該怎麼使用呢?<ul> <li>首先,我們需要在我們的專案中先安裝npm上的<a href=https://www.npmjs.com/package/typescript>typescript</a></li> <li>$ <code>npm install typescript</code></li> <li>現在,我們可以在終端機(terminal)利用<code>tsc</code>指令來將<code>Typescript</code>程式碼編譯(compile)成Javascript程式碼。讓我們開始來動手做吧</li> <li>假設我們有個檔案的名稱叫做<code>example.ts</code>,那麼在終端機的指令會像是<ul> <li>$ <code>tsc example.ts</code></li> <li>這個指令會導致(result in)一個新(new)的檔案(file)叫做<code>example.js</code>,這樣我們就可以使用Node來執行了</li> </ul> </li> <li>現在,當我們知道如何編譯(how to compile) &amp; 如何執行<code>Typescript</code>程式碼(run TypeScript code)了以後,那就讓我們來看看<code>Typescript</code>的防止錯誤功能(bug-preventing capabilities)</li> <li>以下是我們如何修改(modify)我們原本的程式碼(code) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-220-1><a id=__codelineno-220-1 name=__codelineno-220-1 href=#__codelineno-220-1></a><span class=nx>type</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-220-2><a id=__codelineno-220-2 name=__codelineno-220-2 href=#__codelineno-220-2></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=nx>string</span><span class=p>;</span>
</span><span id=__span-220-3><a id=__codelineno-220-3 name=__codelineno-220-3 href=#__codelineno-220-3></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=nx>number</span><span class=p>;</span>
</span><span id=__span-220-4><a id=__codelineno-220-4 name=__codelineno-220-4 href=#__codelineno-220-4></a><span class=p>};</span>
</span><span id=__span-220-5><a id=__codelineno-220-5 name=__codelineno-220-5 href=#__codelineno-220-5></a>
</span><span id=__span-220-6><a id=__codelineno-220-6 name=__codelineno-220-6 href=#__codelineno-220-6></a><span class=kd>function</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=nx>User</span><span class=p>)</span><span class=o>:</span><span class=w> </span><span class=kr>boolean</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-220-7><a id=__codelineno-220-7 name=__codelineno-220-7 href=#__codelineno-220-7></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>age</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mf>18</span><span class=p>;</span>
</span><span id=__span-220-8><a id=__codelineno-220-8 name=__codelineno-220-8 href=#__codelineno-220-8></a><span class=p>}</span>
</span><span id=__span-220-9><a id=__codelineno-220-9 name=__codelineno-220-9 href=#__codelineno-220-9></a>
</span><span id=__span-220-10><a id=__codelineno-220-10 name=__codelineno-220-10 href=#__codelineno-220-10></a><span class=kd>const</span><span class=w> </span><span class=nx>justine</span><span class=o>:</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-220-11><a id=__codelineno-220-11 name=__codelineno-220-11 href=#__codelineno-220-11></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Justine&#39;</span><span class=p>,</span>
</span><span id=__span-220-12><a id=__codelineno-220-12 name=__codelineno-220-12 href=#__codelineno-220-12></a><span class=w>  </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Secret!&#39;</span><span class=p>,</span>
</span><span id=__span-220-13><a id=__codelineno-220-13 name=__codelineno-220-13 href=#__codelineno-220-13></a><span class=p>};</span>
</span><span id=__span-220-14><a id=__codelineno-220-14 name=__codelineno-220-14 href=#__codelineno-220-14></a>
</span><span id=__span-220-15><a id=__codelineno-220-15 name=__codelineno-220-15 href=#__codelineno-220-15></a><span class=kd>const</span><span class=w> </span><span class=nx>isJustineAnAdult</span><span class=o>:</span><span class=w> </span><span class=nx>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>justine</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;I shouldn&#39;t be here!&quot;</span><span class=p>);</span>
</span></code></pre></div></li> <li>接下來,以下會是<code>Typescript</code>會回報我們的事情 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-221-1><a id=__codelineno-221-1 name=__codelineno-221-1 href=#__codelineno-221-1></a><span class=nx>example</span><span class=p>.</span><span class=nx>ts</span><span class=o>:</span><span class=mf>12</span><span class=o>:</span><span class=mf>3</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=nx>TS2322</span><span class=o>:</span><span class=w> </span><span class=nx>Type</span><span class=w> </span><span class=s1>&#39;string&#39;</span><span class=w> </span><span class=nx>is</span><span class=w> </span><span class=nx>not</span><span class=w> </span><span class=nx>assignable</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>type</span><span class=w> </span><span class=s1>&#39;number&#39;</span><span class=p>.</span>
</span><span id=__span-221-2><a id=__codelineno-221-2 name=__codelineno-221-2 href=#__codelineno-221-2></a>
</span><span id=__span-221-3><a id=__codelineno-221-3 name=__codelineno-221-3 href=#__codelineno-221-3></a><span class=mf>12</span><span class=w>   </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Secret!&quot;</span><span class=p>,</span>
</span><span id=__span-221-4><a id=__codelineno-221-4 name=__codelineno-221-4 href=#__codelineno-221-4></a><span class=w>    </span><span class=o>~~~</span>
</span><span id=__span-221-5><a id=__codelineno-221-5 name=__codelineno-221-5 href=#__codelineno-221-5></a>
</span><span id=__span-221-6><a id=__codelineno-221-6 name=__codelineno-221-6 href=#__codelineno-221-6></a><span class=w>  </span><span class=nx>example</span><span class=p>.</span><span class=nx>ts</span><span class=o>:</span><span class=mf>3</span><span class=o>:</span><span class=mf>3</span>
</span><span id=__span-221-7><a id=__codelineno-221-7 name=__codelineno-221-7 href=#__codelineno-221-7></a><span class=w>    </span><span class=mf>3</span><span class=w>   </span><span class=nx>age</span><span class=o>:</span><span class=w> </span><span class=nx>number</span><span class=p>;</span>
</span><span id=__span-221-8><a id=__codelineno-221-8 name=__codelineno-221-8 href=#__codelineno-221-8></a><span class=w>        </span><span class=o>~~~</span>
</span><span id=__span-221-9><a id=__codelineno-221-9 name=__codelineno-221-9 href=#__codelineno-221-9></a><span class=w>    </span><span class=nx>The</span><span class=w> </span><span class=nx>expected</span><span class=w> </span><span class=nx>type</span><span class=w> </span><span class=nx>comes</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=nx>property</span><span class=w> </span><span class=s1>&#39;age&#39;</span><span class=w> </span><span class=nx>which</span><span class=w> </span><span class=nx>is</span><span class=w> </span><span class=nx>declared</span><span class=w> </span><span class=nx>here</span><span class=w> </span><span class=nx>on</span><span class=w> </span><span class=nx>type</span><span class=w> </span><span class=s1>&#39;User&#39;</span>
</span><span id=__span-221-10><a id=__codelineno-221-10 name=__codelineno-221-10 href=#__codelineno-221-10></a>
</span><span id=__span-221-11><a id=__codelineno-221-11 name=__codelineno-221-11 href=#__codelineno-221-11></a><span class=nx>example</span><span class=p>.</span><span class=nx>ts</span><span class=o>:</span><span class=mf>15</span><span class=o>:</span><span class=mf>7</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=nx>TS2322</span><span class=o>:</span><span class=w> </span><span class=nx>Type</span><span class=w> </span><span class=s1>&#39;boolean&#39;</span><span class=w> </span><span class=nx>is</span><span class=w> </span><span class=nx>not</span><span class=w> </span><span class=nx>assignable</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>type</span><span class=w> </span><span class=s1>&#39;string&#39;</span><span class=p>.</span>
</span><span id=__span-221-12><a id=__codelineno-221-12 name=__codelineno-221-12 href=#__codelineno-221-12></a>
</span><span id=__span-221-13><a id=__codelineno-221-13 name=__codelineno-221-13 href=#__codelineno-221-13></a><span class=mf>15</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>isJustineAnAdult</span><span class=o>:</span><span class=w> </span><span class=nx>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>justine</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;I shouldn&#39;t be here!&quot;</span><span class=p>);</span>
</span><span id=__span-221-14><a id=__codelineno-221-14 name=__codelineno-221-14 href=#__codelineno-221-14></a><span class=w>        </span><span class=o>~~~~~~~~~~~~~~~~</span>
</span><span id=__span-221-15><a id=__codelineno-221-15 name=__codelineno-221-15 href=#__codelineno-221-15></a>
</span><span id=__span-221-16><a id=__codelineno-221-16 name=__codelineno-221-16 href=#__codelineno-221-16></a><span class=nx>example</span><span class=p>.</span><span class=nx>ts</span><span class=o>:</span><span class=mf>15</span><span class=o>:</span><span class=mf>51</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>error</span><span class=w> </span><span class=nx>TS2554</span><span class=o>:</span><span class=w> </span><span class=nx>Expected</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=nx>arguments</span><span class=p>,</span><span class=w> </span><span class=nx>but</span><span class=w> </span><span class=nx>got</span><span class=w> </span><span class=mf>2.</span>
</span><span id=__span-221-17><a id=__codelineno-221-17 name=__codelineno-221-17 href=#__codelineno-221-17></a>
</span><span id=__span-221-18><a id=__codelineno-221-18 name=__codelineno-221-18 href=#__codelineno-221-18></a><span class=mf>15</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>isJustineAnAdult</span><span class=o>:</span><span class=w> </span><span class=nx>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>isAdult</span><span class=p>(</span><span class=nx>justine</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;I shouldn&#39;t be here!&quot;</span><span class=p>);</span>
</span><span id=__span-221-19><a id=__codelineno-221-19 name=__codelineno-221-19 href=#__codelineno-221-19></a><span class=w>                                                    </span><span class=o>~~~~~~~~~~~~~~~~~~~~~~</span>
</span><span id=__span-221-20><a id=__codelineno-221-20 name=__codelineno-221-20 href=#__codelineno-221-20></a>
</span><span id=__span-221-21><a id=__codelineno-221-21 name=__codelineno-221-21 href=#__codelineno-221-21></a>
</span><span id=__span-221-22><a id=__codelineno-221-22 name=__codelineno-221-22 href=#__codelineno-221-22></a><span class=nx>Found</span><span class=w> </span><span class=mf>3</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span>
</span></code></pre></div></li> <li>正如同我們所看到(As you can see)的,<code>Typescript</code>成功地(successfully)防止(prevent)我們交付(shipping)的程式碼(code)無法如預期地(unexpectedly)運作(work)。這真是太棒了!</li> </ul> </li> <li>關於<code>Typescript</code>的更多事情 (More about TypeScript)</li> <li><code>Typescript</code>提供(offers)了大量(a whole lot of )其他(others)很棒的機制(mechanisms),例如: 介面(<code>interfaces</code>)、類別(<code>classes</code>)、實用程序型別(<code>utility types</code>)...等等。此外,在較大的專案(on bigger projects)中,我們可以在一個單獨的檔案(a separate file)中宣告(declare)我們自己的<code>Typescript</code>編譯器設定(compiler configuration),並細化(granularly)調整(adjust)其工作方式,像是嚴格程度(how strict) &amp; 會將已編譯檔案儲存在哪裡(where it stores compiled files for example)<ul> <li>我們可以到<a href=https://www.typescriptlang.org/docs/ >Typescript的官方文件</a>以閱讀更多(read more about)這個令人驚嘆(awesome)的東西(stuff)</li> </ul> </li> <li><code>Typescript</code>有一些其它的好處(other benefits)是值得一提的(worth mentioning),像是<code>Typescript</code>可以被漸進式地(progressively)採用(adopted),它能讓程式碼變得更易讀(readable) &amp; 更好理解的(understandable),並且它也允許(allows)開發者(developer)在較舊的Node版本中仍能使用現代化(modern)的語言功能(language features)</li> <li>在Node世界中的<code>Typescript</code> (TypeScript in the Node.js world)</li> <li>在Node的世界中,<code>Typescript</code>已經樹立了良好的典範,並且已經被許多公司、開源軟體專案、工具、框架...等等所採用</li> <li>以下是一些著名的開源軟體專案例子,有使用到<code>Typescript</code>的<ul> <li><a href=https://nestjs.com/ >NestJS</a>: 它是一個健全(robust)且功能完善(fully-featured)的框架(framework),並且能夠輕鬆(easy)、愉快(pleasant)地建立可擴展的(scalable) &amp; 結構完善(well-architected)的系統(systems)</li> <li><a href=https://typeorm.io/#/ >TypeORM</a>: 優秀(great)的<code>ORM</code>,它有受到其它語言(other languages)使用的知名工具(well-known tools)(像是: Java的<a href=https://hibernate.org/ >Hibernate</a>、PHP的<a href=https://www.doctrine-project.org/ >Doctrine</a>、.NET的<a href=https://docs.microsoft.com/zh-tw/ef/ >Entity Framework</a>)的影響(influenced)</li> <li><a href=https://rxjs.dev/ >RxJS</a>: 廣泛地(widely)被運用(used)在互動式(reactive)程式設計(programming)的函式庫(library)</li> <li>以及許許多多的優秀的開源軟體專案之中,甚至(even)可能我們的專案就會成為下一個</li> </ul> </li> </ul> <hr> <h2 id=nodejs_1>Node.js 核心模組<a class=headerlink href=#nodejs_1 title="Permanent link">&para;</a></h2> <h3 id=http><a href=https://nodejs.org/api/http.html>HTTP</a><a class=headerlink href=#http title="Permanent link">&para;</a></h3> <ul> <li>要使用HTTP server &amp; client,必須要先<code>require('http')</code></li> <li>Node的HTTP介面(interfaces)旨在支援HTTP協定的許多功能 ,因為這些功能傳統上較難使用,尤其是在大量.大塊(chunk-encoded)的訊息</li> <li>該介面非常地小心,永遠不會緩衝(buffer)整個請求(requests)和回應(responses),所以使用者可以傳送實時資料流(stream data)</li> <li>HTTP訊息標頭(message headers)通常用物件(object)來表示</li> <li>範例<code>HTTP message header</code> ``` js { 'content-length': '123', 'content-type': 'text/plain', 'connection': 'keep-alive', 'host': 'mysite.com', 'accept': '<em>/</em>' }</li> <li>鍵(keys)要用小寫表示,值(values)是按照原本的不變</li> <li>為了能支援所有可能的HTTP應用程式,Node的HTTP API是屬於非常底層的,它只處理資料流(stream handling),但是不解析實際的標頭(headers)或是正文(context)</li> <li>可參考<a href=https://nodejs.org/api/http.html#http_message_headers>message.headers</a>以了解該如何處理重複標頭(duplicate headers)的細節</li> <li>收到的原始標頭會保留在<a href=https://nodejs.org/api/http.html#http_message_rawheaders>message.rawHeaders</a>屬性值中,並以陣列(array)的形式來儲存該資訊,像是<code>[key, value, key2, value2, ...]</code></li> <li>以上述的<code>HTTP message header</code>為例,它的<code>message.rawHeaders</code>的值會像是以下的陣列(array)形式 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-222-1><a id=__codelineno-222-1 name=__codelineno-222-1 href=#__codelineno-222-1></a><span class=p>[</span><span class=w> </span><span class=s1>&#39;ConTent-Length&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>,</span>
</span><span id=__span-222-2><a id=__codelineno-222-2 name=__codelineno-222-2 href=#__codelineno-222-2></a><span class=w>  </span><span class=s1>&#39;content-LENGTH&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;123&#39;</span><span class=p>,</span>
</span><span id=__span-222-3><a id=__codelineno-222-3 name=__codelineno-222-3 href=#__codelineno-222-3></a><span class=w>  </span><span class=s1>&#39;content-type&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;text/plain&#39;</span><span class=p>,</span>
</span><span id=__span-222-4><a id=__codelineno-222-4 name=__codelineno-222-4 href=#__codelineno-222-4></a><span class=w>  </span><span class=s1>&#39;CONNECTION&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;keep-alive&#39;</span><span class=p>,</span>
</span><span id=__span-222-5><a id=__codelineno-222-5 name=__codelineno-222-5 href=#__codelineno-222-5></a><span class=w>  </span><span class=s1>&#39;Host&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;mysite.com&#39;</span><span class=p>,</span>
</span><span id=__span-222-6><a id=__codelineno-222-6 name=__codelineno-222-6 href=#__codelineno-222-6></a><span class=w>  </span><span class=s1>&#39;accepT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;*/*&#39;</span>
</span><span id=__span-222-7><a id=__codelineno-222-7 name=__codelineno-222-7 href=#__codelineno-222-7></a><span class=p>]</span>
</span></code></pre></div><blockquote> <p>method</p> </blockquote> </li> <li><a href=https://nodejs.org/api/http.html#http_http_createserver_options_requestlistener>http.createServer([options][, requestListener])</a><br><ul> <li>會回傳一個 http.Server 實例</li> <li>options</li> <li>http.IncomingMessage</li> <li>ServerResponse</li> <li>insecureHTTPParser (Default: false)</li> <li>maxHeaderSize (Default: 16384 (16KB)</li> <li>requestListener (Function)<blockquote> <p>Class</p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage>Class: http.IncomingMessage</a><ul> <li>這個Class物件會由http.server與http.ClientRequest所建</li> <li>它是用來作為被傳給request event &amp; response event的第1個參數</li> <li>它會被用來存取回應物件的狀態(response status),標頭(response headers),資料(response data)</li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_class_http_serverresponse>Class: http.ServerResponse</a><ul> <li>這個Class物件會由HTTP server內部自動建立,而不是透過user來建立的</li> <li>它是用來作為被傳給request event的第2個參數<blockquote> <p>property</p> </blockquote> </li> <li><a href=https://nodejs.org/api/http.html#http_response_statuscode>response.statusCode</a><ul> <li>當使用隱式標頭(implicit headers)時,也就是當沒有明確地使用<a href=https://nodejs.org/api/http.html#http_response_writehead_statuscode_statusmessage_headers>response.writeHead()</a>時,這個屬性會在headers被更新時決定要傳給client端什麼狀態碼(status code)</li> <li>當回應標頭(response header)已經傳到client端之後,這個屬性會指出已經發送出去的狀態碼</li> <li>預設是200 (number型別)</li> <li>例: <code>response.statusCode = 404;</code><blockquote> <p>method</p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_setheader_name_value>response.setHeader(name, value)</a><ul> <li>args</li> <li>name: (string)</li> <li>value: (any)</li> <li>Returns: <a href=https://nodejs.org/api/http.html#http_class_http_serverresponse>http.ServerResponse</a> </li> <li>回傳一個回應物件(response object)</li> <li>為隱式標頭(implicit header)設定一筆單一的值,若此標頭已經存在於待發送的header中,那麼待發送header的值就會被取代掉</li> <li>若要發送為同一個名稱的多個header時,可以用一個Array['xxx', 'yyy']來包住所有的header值</li> <li>如果輸入非字串型別的值,將自動被儲存下來,而無須多做修改</li> <li>當header的name或是value包含無效的字元時,就會引發TypeError錯誤</li> <li>例: <code>response.setHeader('Content-Type', 'text/html');</code></li> <li>例: <code>response.setHeader('Set-Cookie', ['type=ninja', 'language=javascript']);</code></li> <li>當headers被設定為使用response.setHeader(),它們將會被合併到其他所有要傳給 <a href=https://nodejs.org/api/http.html#http_response_writehead_statuscode_statusmessage_headers>response.writeHead()</a>的headers,並且會自動將要傳給response.writeHead()的headers列為優先</li> <li>若需要逐步新增headers,讓未來有需要的話可以檢索和修改,請使用response.setHeader(),而不要使用response.writeHead() <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-223-1><a id=__codelineno-223-1 name=__codelineno-223-1 href=#__codelineno-223-1></a><span class=c1>// Returns content-type = text/plain</span>
</span><span id=__span-223-2><a id=__codelineno-223-2 name=__codelineno-223-2 href=#__codelineno-223-2></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-223-3><a id=__codelineno-223-3 name=__codelineno-223-3 href=#__codelineno-223-3></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;text/html&#39;</span><span class=p>);</span>
</span><span id=__span-223-4><a id=__codelineno-223-4 name=__codelineno-223-4 href=#__codelineno-223-4></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s1>&#39;X-Foo&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;bar&#39;</span><span class=p>);</span>
</span><span id=__span-223-5><a id=__codelineno-223-5 name=__codelineno-223-5 href=#__codelineno-223-5></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mf>200</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;text/plain&#39;</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-223-6><a id=__codelineno-223-6 name=__codelineno-223-6 href=#__codelineno-223-6></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;ok&#39;</span><span class=p>);</span>
</span><span id=__span-223-7><a id=__codelineno-223-7 name=__codelineno-223-7 href=#__codelineno-223-7></a><span class=p>});</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/http.html#http_response_end_data_encoding_callback>response.end()</a><ul> <li>完整版: response.end([data[, encoding]][, callback]) </li> <li>args</li> <li>data: (string || Buffer)</li> <li>encoding: (string)</li> <li>callback: (Function)</li> <li>Returns: (this)</li> <li>這個方法會向server發送信號,表示所有的回應標頭(response header)和內文(body)皆已發送出去,這時server應認定該請求消息已完成</li> <li>response.end()需要在每個回應的 <strong>結尾</strong> 都使用它</li> <li>如果data參數有給定的話,它實際上是去呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_response_write_chunk_encoding_callback>response.write(data, encoding)</a>,並接著執行res.end(callback)</li> <li>如果callback函式有給定的話,該callback函式會在回應串流(response stream)結束之後才會被呼叫並執行</li> </ul> </li> </ul> </li> </ul> <h3 id=process><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html>Process</a><a class=headerlink href=#process title="Permanent link">&para;</a></h3> <ul> <li><code>process</code>是一個全域的物件,針對當前的Node應用程序的進程(process),提供資訊與控制</li> <li>讀: 獲取process資訊(資源使用、執行環境、執行狀態)</li> <li>寫: 執行process操作(監聽事件、排程任務、發出警吿)</li> <li>因為<code>process</code>身為global物件,所以可以在Node應用程式中直接使用,而無需事先require()。</li> <li>但它也還是能透過require()來匯入並使用這個模組</li> <li>例: $ <code>const process = require('process');</code><blockquote> <p>Process events</p> </blockquote> </li> <li><a href=https://nodejs.org/api/process.html#process_event_exit>Event: <strong>exit</strong></a><ul> <li>args</li> <li>code: (integer)</li> <li>由於以下的任一個原因而導致Node應用程式即將退出時,將發出(emitted)該事件</li> <li>明確地呼叫<code>process.exit()</code>方法時</li> <li>Node的事件循環(event loop)不再需要執行其他額外的工作時</li> <li>目前沒有方法可以防止在這個時間點要退出事件循環(event loop),一旦所有的 <strong>exit</strong> 監聽器(listener)執行結束後,就會終止Node的進程</li> <li>只要有給定退出碼(不管是透過<code>process.exitCode</code>屬性或是現在這個 <strong>exit事件</strong> 的<code>exitCode</code>參數)並傳遞給<code>process.exit()</code>方法時,該事件監聽回呼函式(listener callback function)就會被呼叫</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-224-1><a id=__codelineno-224-1 name=__codelineno-224-1 href=#__codelineno-224-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;exit&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>code</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-224-2><a id=__codelineno-224-2 name=__codelineno-224-2 href=#__codelineno-224-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`About to exit with code: </span><span class=si>${</span><span class=nx>code</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-224-3><a id=__codelineno-224-3 name=__codelineno-224-3 href=#__codelineno-224-3></a><span class=p>});</span>
</span></code></pre></div></li> <li>監聽功能 <strong>必須只</strong> 執行 <strong>同步化的操作</strong> ,以下的範例程式碼,該Node進程會在呼叫<code>exit</code>事件監聽器(event listeners)後 <strong>就立即退出</strong> ,因而導致任何仍在事件迴圈(event loop)中的佇列(queued)中的額外的工作都會被拋棄(abandoned)</li> <li>以下的程式碼為例,<code>setTimeout()</code>這個函式 <strong>永遠不會</strong> 被執行到</li> <li>情境說明( <strong>錯誤示範</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-225-1><a id=__codelineno-225-1 name=__codelineno-225-1 href=#__codelineno-225-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;exit&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>code</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-225-2><a id=__codelineno-225-2 name=__codelineno-225-2 href=#__codelineno-225-2></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-225-3><a id=__codelineno-225-3 name=__codelineno-225-3 href=#__codelineno-225-3></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;This will not run&#39;</span><span class=p>);</span>
</span><span id=__span-225-4><a id=__codelineno-225-4 name=__codelineno-225-4 href=#__codelineno-225-4></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-225-5><a id=__codelineno-225-5 name=__codelineno-225-5 href=#__codelineno-225-5></a><span class=p>});</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_signal_events>Event: <strong>Signal events</strong></a><ul> <li>信號事件(Signal events)會在Node進程(process)收到信號時發出(emitted)</li> <li>信號(Signals)不能用在<a href=https://nodejs.org/dist/latest-v15.x/docs/api/worker_threads.html#worker_threads_worker_threads>Worker threads</a></li> <li>信號處理器(signal handler)會將收到的信號名稱(signal's name)做為第一個參數</li> <li>例: <code>SIGINT</code>, <code>SIGTERM</code></li> <li>每個事件(event)的名稱將會是大寫的常用信號名稱</li> <li>例: <code>SIGINT</code> =&gt; SIGINT 信號們 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-226-1><a id=__codelineno-226-1 name=__codelineno-226-1 href=#__codelineno-226-1></a><span class=c1>// Begin reading from stdin so the process does not exit.</span>
</span><span id=__span-226-2><a id=__codelineno-226-2 name=__codelineno-226-2 href=#__codelineno-226-2></a><span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>.</span><span class=nx>resume</span><span class=p>();</span>
</span><span id=__span-226-3><a id=__codelineno-226-3 name=__codelineno-226-3 href=#__codelineno-226-3></a>
</span><span id=__span-226-4><a id=__codelineno-226-4 name=__codelineno-226-4 href=#__codelineno-226-4></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-226-5><a id=__codelineno-226-5 name=__codelineno-226-5 href=#__codelineno-226-5></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Received SIGINT. Press Control-D to exit.&#39;</span><span class=p>);</span>
</span><span id=__span-226-6><a id=__codelineno-226-6 name=__codelineno-226-6 href=#__codelineno-226-6></a><span class=p>});</span>
</span><span id=__span-226-7><a id=__codelineno-226-7 name=__codelineno-226-7 href=#__codelineno-226-7></a>
</span><span id=__span-226-8><a id=__codelineno-226-8 name=__codelineno-226-8 href=#__codelineno-226-8></a><span class=c1>// Using a single function to handle multiple signals</span>
</span><span id=__span-226-9><a id=__codelineno-226-9 name=__codelineno-226-9 href=#__codelineno-226-9></a><span class=kd>function</span><span class=w> </span><span class=nx>handle</span><span class=p>(</span><span class=nx>signal</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-226-10><a id=__codelineno-226-10 name=__codelineno-226-10 href=#__codelineno-226-10></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Received </span><span class=si>${</span><span class=nx>signal</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-226-11><a id=__codelineno-226-11 name=__codelineno-226-11 href=#__codelineno-226-11></a><span class=p>}</span>
</span><span id=__span-226-12><a id=__codelineno-226-12 name=__codelineno-226-12 href=#__codelineno-226-12></a>
</span><span id=__span-226-13><a id=__codelineno-226-13 name=__codelineno-226-13 href=#__codelineno-226-13></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGINT&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>handle</span><span class=p>);</span>
</span><span id=__span-226-14><a id=__codelineno-226-14 name=__codelineno-226-14 href=#__codelineno-226-14></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>handle</span><span class=p>);</span>
</span></code></pre></div></li> <li><code>SIGTERM</code>與<code>SIGINT</code>在非Windows作業系統的環境中,擁有預設處理器可以在退出程式碼之前,重置終端機模式為 <strong>128 + signal number</strong>。如果這些信號之一已安裝了監聽器(listener),則將刪除其默認行為(Node應用程式也不再退出)</li> <li><code>SIGTERM</code>: 在Windows作業系統的環境中不支援,但可以監聽它(listened on)</li> <li><code>SIGINT</code>: 在終端機中是可被所有作業系統所支援的,它通常可以用<code>ctrl-C</code>來產生</li> <li><code>SIGKILL</code>: 不能安裝監聽器(listener),它將無條件終止Node應用程式,無論我們在哪個作業系統的環境中</li> <li>補充: 因為Windows作業系統並不支援信號(signals),所以不能說是等同於信號終止,但是Node有提供了一些仿效的做法,例如: <a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_kill_pid_signal>process.kill()</a>與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/child_process.html#child_process_subprocess_kill_signal>subprocess.kill()</a></li> <li>發送<code>SIGINT</code>,<code>SIGTERM</code>,<code>SIGKILL</code>將導致目標進程(target process)無條件被終止。此後,子進程(subprocess)將回報該進程(process)已被信號(signal)終止了</li> <li>發送信號(signal) <code>0</code> 可以用來做為一種獨立的平台以測試進程(process)的存在 <blockquote> <p>method</p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_cpuusage_previousvalue>process.cpuUsage([previousValue])</a></li> <li>args<ul> <li>previousValue: (Object)</li> <li>上一次呼叫process.cpuUsage()的回傳值</li> </ul> </li> <li>Returns: (Object)<ul> <li>user: (integer)</li> <li>system: (integer)</li> </ul> </li> <li>該方法會回傳一個具有<code>user</code>, <code>system</code>的物件(<code>Object</code>),來表示當前的進程(current process)的<code>user</code>和<code>system</code>的時間使用率<ul> <li>這些值都是以百萬分之一秒為單位(微秒)---&gt;時間單位</li> <li>這些值分別用來測量花在使用者端的程式碼＆系統端的程式碼的時間</li> <li>當有多個CPU內核在為這個進程(process)執行工作時,則這些值最終可能會大於實際經過的時間</li> </ul> </li> <li>上一次呼叫<code>process.cpuUsage()</code>的結果可以作為參數傳遞給函式,以得知差異讀數(diff reading) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-227-1><a id=__codelineno-227-1 name=__codelineno-227-1 href=#__codelineno-227-1></a><span class=kd>const</span><span class=w> </span><span class=nx>startUsage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>cpuUsage</span><span class=p>();</span>
</span><span id=__span-227-2><a id=__codelineno-227-2 name=__codelineno-227-2 href=#__codelineno-227-2></a><span class=c1>// { user: 38579, system: 6986 }</span>
</span><span id=__span-227-3><a id=__codelineno-227-3 name=__codelineno-227-3 href=#__codelineno-227-3></a>
</span><span id=__span-227-4><a id=__codelineno-227-4 name=__codelineno-227-4 href=#__codelineno-227-4></a><span class=c1>// spin the CPU for 500 milliseconds</span>
</span><span id=__span-227-5><a id=__codelineno-227-5 name=__codelineno-227-5 href=#__codelineno-227-5></a><span class=kd>const</span><span class=w> </span><span class=nx>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span><span id=__span-227-6><a id=__codelineno-227-6 name=__codelineno-227-6 href=#__codelineno-227-6></a><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>now</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>500</span><span class=p>);</span>
</span><span id=__span-227-7><a id=__codelineno-227-7 name=__codelineno-227-7 href=#__codelineno-227-7></a>
</span><span id=__span-227-8><a id=__codelineno-227-8 name=__codelineno-227-8 href=#__codelineno-227-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>cpuUsage</span><span class=p>(</span><span class=nx>startUsage</span><span class=p>));</span>
</span><span id=__span-227-9><a id=__codelineno-227-9 name=__codelineno-227-9 href=#__codelineno-227-9></a><span class=c1>// { user: 514883, system: 11226 }</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_memoryusage>process.memoryUsage()</a></li> <li>Returns: (Object)<ul> <li>rss: (integer)</li> <li>rss =&gt; (常駐集的大小,Resident Set Size),代表該進程(process)在主記憶體裝置中已被使用掉的內存記憶體空間(即總分配內存的子集); 包括所有的<code>C++</code>與<code>Javascript</code>的物件和程式碼</li> <li>heapTotal: (integer)</li> <li>參考V8 engine的內存記憶體使用情況 </li> <li>heapUsed: (integer)</li> <li>參考V8 engine的內存記憶體使用情況 </li> <li>external: (integer)</li> <li>參考由V8 engine管理的<code>C++物件</code>綁定到<code>Javascript物件</code>的內存記憶體使用量 </li> <li>arrayBuffers: (integer)</li> <li>參考分配到<code>ArrayBuffers</code> &amp; <code>SharedArrayBuffers</code>,也包含所有Node應用程式的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html>Buffer</a>物件</li> <li><code>arrayBuffers</code>也包含在<code>external</code>的值中</li> <li>當Node應用程式被用作嵌入式函式庫時,該值可能為0,是因為在這種情況下<code>arrayBuffers</code>可能不會被追蹤到</li> </ul> </li> <li>該方法會回傳一個物件(<code>Object</code>)來描述Node應用程式的內存記憶體(memory)用量<ul> <li>這個值會以<code>bytes</code>為單位來表示</li> </ul> </li> <li>範例程式碼<ul> <li>以下面的程式碼為例 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-228-1><a id=__codelineno-228-1 name=__codelineno-228-1 href=#__codelineno-228-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>memoryUsage</span><span class=p>());</span>
</span></code></pre></div></li> <li>會產生一個物件</li> <li><code>{ rss: 4935680, heapTotal: 1826816, heapUsed: 650472, external: 49879, arrayBuffers: 9386 }</code></li> </ul> </li> <li>當使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/worker_threads.html#worker_threads_class_worker>Worker threads</a>時,<code>rss</code>將會是一個對於整個進程(entire process)有效的值(valid),而其他參數僅會參考到當前的進程</li> <li>process.resourceUsage()</li> <li>Returns: (Object)<ul> <li>userCPUTime: (integer)</li> <li>對應到<code>ru_utime</code>的值,並以微秒為單位表示</li> <li>與process.cpuUsage().user的值相同</li> <li>systemCPUTime: (integer)</li> <li>對應到<code>ru_stime</code>的值,並以微秒為單位表示</li> <li>與process.cpuUsage().system的值相同</li> </ul> </li> <li>該方法會回傳一個物件(<code>Object</code>)來表示當前進程(current process)的資源使用率(resource usage); 以上所有該方法的回傳值都是來自於呼叫<a href=https://docs.libuv.org/en/v1.x/misc.html#uv_getrusage>uv_rusage_t struct</a>的uv_getrusage()方法的回傳值 &gt; uv_getrusage(): Gets the resource usage measures for the current process.</li> <li>process.cwd()</li> <li>Returns: (string)<ul> <li>該方法會回傳當前進程(current process)所在的工作目錄的路徑(working directory)</li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-229-1><a id=__codelineno-229-1 name=__codelineno-229-1 href=#__codelineno-229-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>Current</span><span class=w> </span><span class=nx>directory</span><span class=o>:</span><span class=w>  </span><span class=p>{</span><span class=nx>process</span><span class=p>.</span><span class=nx>cwd</span><span class=p>()});</span>
</span></code></pre></div></li> <li>process.exit([code])</li> <li>args<ul> <li>code: (integer)</li> <li>表示要指定的退出碼</li> <li>預設值: 0 (代表成功)</li> </ul> </li> <li>該方法指示Node應用程式以同步地方式(synchronously)來終止進程(terminate the process)並顯示退出碼<ul> <li>若[code]參數被省略,則會以<code>0</code>為退出碼或是<code>process.exitCode</code>的值為準(當該屬性在之前有被設定過的話)</li> <li>Node應用程式不會在所有的<a href=https://nodejs.org/api/process.html#process_event_exit>Event: 'exit'</a>事件監聽器(event listeners)被呼叫之前就終止掉</li> </ul> </li> <li>範例程式碼<ul> <li>以失敗(failure)的狀態碼來退出Node應用程式 </li> <li>$ <code>process.exit(1);</code></li> <li>在執行該Node應用程式的shell上,我們會看到退出碼(exit code)為<code>1</code></li> </ul> </li> <li>當我們呼叫<code>process.exit()</code>方法時,會強迫Node應用程式盡快地終止該進程,即便是還有pending狀態中的非同步操作尚未完全完成的情況,包括I/O操作,像是<code>process.stdout</code> &amp; <code>process.stderr</code><ul> <li>在大多數的情況下,其實我們並不需要明確地呼叫<code>process.exit()</code>方法。因為在事件循環(event loop)當中沒有額外pending狀態中的工作的話,Node應用程式就會自行退出</li> <li>我們也可以透過設定好<code>process.exitCode</code>屬性的值,來告知進程在正常退出時,要使用哪個退出碼</li> </ul> </li> <li>情境說明( <strong>錯誤示範</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-230-1><a id=__codelineno-230-1 name=__codelineno-230-1 href=#__codelineno-230-1></a><span class=c1>// This is an example of what *not* to do:</span>
</span><span id=__span-230-2><a id=__codelineno-230-2 name=__codelineno-230-2 href=#__codelineno-230-2></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>someConditionNotMet</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-230-3><a id=__codelineno-230-3 name=__codelineno-230-3 href=#__codelineno-230-3></a><span class=w>  </span><span class=nx>printUsageToStdout</span><span class=p>();</span>
</span><span id=__span-230-4><a id=__codelineno-230-4 name=__codelineno-230-4 href=#__codelineno-230-4></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-230-5><a id=__codelineno-230-5 name=__codelineno-230-5 href=#__codelineno-230-5></a><span class=p>}</span>
</span></code></pre></div><ul> <li>以上的程式碼是一個使用<code>process.exit()</code>的 <strong>錯誤示範</strong> ,可能會因此導致要print到stdout的資料被截斷或遺失</li> <li>這樣做之所以有問題的原因是因為在Node的世界中要寫入到<code>process.stdout</code>有時候是非同步的(asynchronous),也可能會在Node的事件迴圈(event loop)中多次發生</li> <li>所以我們需要在額外寫入到stdout之後,才能呼叫process.exit()來強制將該進程退出</li> </ul> </li> <li>範例程式碼( <strong>正確做法</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-231-1><a id=__codelineno-231-1 name=__codelineno-231-1 href=#__codelineno-231-1></a><span class=c1>// How to properly set the exit code while letting</span>
</span><span id=__span-231-2><a id=__codelineno-231-2 name=__codelineno-231-2 href=#__codelineno-231-2></a><span class=c1>// the process exit gracefully.</span>
</span><span id=__span-231-3><a id=__codelineno-231-3 name=__codelineno-231-3 href=#__codelineno-231-3></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>someConditionNotMet</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-231-4><a id=__codelineno-231-4 name=__codelineno-231-4 href=#__codelineno-231-4></a><span class=w>  </span><span class=nx>printUsageToStdout</span><span class=p>();</span>
</span><span id=__span-231-5><a id=__codelineno-231-5 name=__codelineno-231-5 href=#__codelineno-231-5></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span><span class=p>;</span>
</span><span id=__span-231-6><a id=__codelineno-231-6 name=__codelineno-231-6 href=#__codelineno-231-6></a><span class=p>}</span>
</span></code></pre></div><ul> <li>以上的程式碼是正確的解決方法,我們應該要先設定好<code>process.exitCode</code>屬性的值,而不是直接呼叫<code>process.exit()</code>方法,並避免為事件迴圈(event loop)安排額外的工作來允許該進程能自然地退出</li> <li>如果是因為遇到錯誤情況而有必要強制終止該進程的話,可以拋出一個<code>uncaught error</code>,並根據這個錯誤來終止該進程,也會比直接呼叫<code>process.exit()</code>來得更安全</li> </ul> </li> <li>在<a href=https://nodejs.org/dist/latest-v15.x/docs/api/worker_threads.html#worker_threads_worker_threads>Worker threads</a>中,<code>process.exit()</code>會停止當前的線程(current thread),而不是當前的進程(current process)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_kill_pid_signal>process.kill(pid[ ,signal])</a></li> <li>args<ul> <li>pid: (number)</li> <li>給定一個進程(process) ID</li> <li>signal: (string || number)</li> <li>以字串或是數值的形式來發送信號</li> <li>預設值: <code>SIGTERM</code></li> </ul> </li> <li>該方法會將信號(signal)發送給指定<code>pid</code>的進程(process)</li> <li>信號的名稱為字串型別,常見的像是<code>SIGINT</code>, <code>SIGHUP</code></li> <li>當給定的目標<code>pid</code>不存在時,該方法會拋出錯誤。作為特殊情況時,可以利用<code>0</code>作為信號來測試某個<code>pid</code>的進程是否存在<ul> <li>當在Windows作業系統時,想砍掉一個進程群組(kill a process group)會拋出一個錯誤</li> </ul> </li> <li>其實<code>process.kill()</code>這個方法只是一個信號發送器(signal sender),就如同 $<code>kill</code> 的系統指令一樣<ul> <li>比起單純的系統指令 $<code>kill</code>,發送信號的這個方法可能會額外做一些其他的事,而不單純只是砍掉目標進程(kill the target process)</li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-232-1><a id=__codelineno-232-1 name=__codelineno-232-1 href=#__codelineno-232-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGHUP&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-232-2><a id=__codelineno-232-2 name=__codelineno-232-2 href=#__codelineno-232-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Got SIGHUP signal.&#39;</span><span class=p>);</span>
</span><span id=__span-232-3><a id=__codelineno-232-3 name=__codelineno-232-3 href=#__codelineno-232-3></a><span class=p>});</span>
</span><span id=__span-232-4><a id=__codelineno-232-4 name=__codelineno-232-4 href=#__codelineno-232-4></a>
</span><span id=__span-232-5><a id=__codelineno-232-5 name=__codelineno-232-5 href=#__codelineno-232-5></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-232-6><a id=__codelineno-232-6 name=__codelineno-232-6 href=#__codelineno-232-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Exiting.&#39;</span><span class=p>);</span>
</span><span id=__span-232-7><a id=__codelineno-232-7 name=__codelineno-232-7 href=#__codelineno-232-7></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-232-8><a id=__codelineno-232-8 name=__codelineno-232-8 href=#__codelineno-232-8></a><span class=p>},</span><span class=w> </span><span class=mf>100</span><span class=p>);</span>
</span><span id=__span-232-9><a id=__codelineno-232-9 name=__codelineno-232-9 href=#__codelineno-232-9></a>
</span><span id=__span-232-10><a id=__codelineno-232-10 name=__codelineno-232-10 href=#__codelineno-232-10></a><span class=nx>process</span><span class=p>.</span><span class=nx>kill</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>pid</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;SIGHUP&#39;</span><span class=p>);</span>
</span></code></pre></div><ul> <li>當Node應用程式的進程收到<code>SIGUSR1</code>的信號時,Node會啟動一個偵錯器(debugger)</li> <li>可參考<a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_signal_events>Signal events</a></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_nexttick_callback_args>process.nextTick(callback[ ,...args])</a></li> <li>args<ul> <li>callback: (Function)</li> <li>回呼函式 </li> <li>...args: (any)</li> <li>當有呼叫callback function時,要附加給該回呼函式的參數們</li> <li>該方法會新增一個<code>callback function</code>到"next tick queue"。當Javascript堆疊(stack)當前的操作執行完成並允許事件迴圈(event loop)繼續之前,該佇列(queue)會完全耗盡(fully drained)</li> <li>如果要循環地重複呼叫<code>process.nextTick()</code>,可能會建立一個無限循環的迴圈(infinite loop)</li> <li>相關背景知識可參考<a href=https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#process-nexttick>Event Loop</a>章節的介紹</li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-233-1><a id=__codelineno-233-1 name=__codelineno-233-1 href=#__codelineno-233-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>);</span>
</span><span id=__span-233-2><a id=__codelineno-233-2 name=__codelineno-233-2 href=#__codelineno-233-2></a><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-233-3><a id=__codelineno-233-3 name=__codelineno-233-3 href=#__codelineno-233-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;nextTick callback&#39;</span><span class=p>);</span>
</span><span id=__span-233-4><a id=__codelineno-233-4 name=__codelineno-233-4 href=#__codelineno-233-4></a><span class=p>});</span>
</span><span id=__span-233-5><a id=__codelineno-233-5 name=__codelineno-233-5 href=#__codelineno-233-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;scheduled&#39;</span><span class=p>);</span>
</span><span id=__span-233-6><a id=__codelineno-233-6 name=__codelineno-233-6 href=#__codelineno-233-6></a><span class=c1>// Output:</span>
</span><span id=__span-233-7><a id=__codelineno-233-7 name=__codelineno-233-7 href=#__codelineno-233-7></a><span class=c1>// start</span>
</span><span id=__span-233-8><a id=__codelineno-233-8 name=__codelineno-233-8 href=#__codelineno-233-8></a><span class=c1>// scheduled</span>
</span><span id=__span-233-9><a id=__codelineno-233-9 name=__codelineno-233-9 href=#__codelineno-233-9></a><span class=c1>// nextTick callback</span>
</span></code></pre></div></li> <li>process.nextTick()方法在開發API時很重要,以便給用戶在物件被構建(constructed) <strong>之後</strong> ,但是在任何I/O相關操作發生 <strong>之前</strong> ,來指派事件處理器(assign event handlers) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-234-1><a id=__codelineno-234-1 name=__codelineno-234-1 href=#__codelineno-234-1></a><span class=kd>function</span><span class=w> </span><span class=nx>MyThing</span><span class=p>(</span><span class=nx>options</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-234-2><a id=__codelineno-234-2 name=__codelineno-234-2 href=#__codelineno-234-2></a><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=nx>setupOptions</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span>
</span><span id=__span-234-3><a id=__codelineno-234-3 name=__codelineno-234-3 href=#__codelineno-234-3></a>
</span><span id=__span-234-4><a id=__codelineno-234-4 name=__codelineno-234-4 href=#__codelineno-234-4></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-234-5><a id=__codelineno-234-5 name=__codelineno-234-5 href=#__codelineno-234-5></a><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=nx>startDoingStuff</span><span class=p>();</span>
</span><span id=__span-234-6><a id=__codelineno-234-6 name=__codelineno-234-6 href=#__codelineno-234-6></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-234-7><a id=__codelineno-234-7 name=__codelineno-234-7 href=#__codelineno-234-7></a><span class=p>}</span>
</span><span id=__span-234-8><a id=__codelineno-234-8 name=__codelineno-234-8 href=#__codelineno-234-8></a>
</span><span id=__span-234-9><a id=__codelineno-234-9 name=__codelineno-234-9 href=#__codelineno-234-9></a><span class=kd>const</span><span class=w> </span><span class=nx>thing</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyThing</span><span class=p>();</span>
</span><span id=__span-234-10><a id=__codelineno-234-10 name=__codelineno-234-10 href=#__codelineno-234-10></a><span class=nx>thing</span><span class=p>.</span><span class=nx>getReadyForStuff</span><span class=p>();</span>
</span><span id=__span-234-11><a id=__codelineno-234-11 name=__codelineno-234-11 href=#__codelineno-234-11></a>
</span><span id=__span-234-12><a id=__codelineno-234-12 name=__codelineno-234-12 href=#__codelineno-234-12></a><span class=c1>// thing.startDoingStuff() gets called now, not before.</span>
</span></code></pre></div></li> <li>對於API來說,要馬 100%同步 or 100%非同步,是很重要的事情<ul> <li>情境說明( <strong>錯誤示範</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-235-1><a id=__codelineno-235-1 name=__codelineno-235-1 href=#__codelineno-235-1></a><span class=c1>// WARNING!  DO NOT USE!  BAD UNSAFE HAZARD!</span>
</span><span id=__span-235-2><a id=__codelineno-235-2 name=__codelineno-235-2 href=#__codelineno-235-2></a><span class=kd>function</span><span class=w> </span><span class=nx>maybeSync</span><span class=p>(</span><span class=nx>arg</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-235-3><a id=__codelineno-235-3 name=__codelineno-235-3 href=#__codelineno-235-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>arg</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-235-4><a id=__codelineno-235-4 name=__codelineno-235-4 href=#__codelineno-235-4></a><span class=w>    </span><span class=nx>cb</span><span class=p>();</span>
</span><span id=__span-235-5><a id=__codelineno-235-5 name=__codelineno-235-5 href=#__codelineno-235-5></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-235-6><a id=__codelineno-235-6 name=__codelineno-235-6 href=#__codelineno-235-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-235-7><a id=__codelineno-235-7 name=__codelineno-235-7 href=#__codelineno-235-7></a>
</span><span id=__span-235-8><a id=__codelineno-235-8 name=__codelineno-235-8 href=#__codelineno-235-8></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>stat</span><span class=p>(</span><span class=s1>&#39;file&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>);</span>
</span><span id=__span-235-9><a id=__codelineno-235-9 name=__codelineno-235-9 href=#__codelineno-235-9></a><span class=p>}</span>
</span></code></pre></div></li> <li>以上的範例是冒險的(hazardous),因為假設我們遇到以下的情況</li> <li>接下來的情況會造成不清楚到底是foo() 或是 bar()先被呼叫</li> <li>情境說明( <strong>錯誤示範</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-236-1><a id=__codelineno-236-1 name=__codelineno-236-1 href=#__codelineno-236-1></a><span class=kd>const</span><span class=w> </span><span class=nx>maybeTrue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0.5</span><span class=p>;</span>
</span><span id=__span-236-2><a id=__codelineno-236-2 name=__codelineno-236-2 href=#__codelineno-236-2></a>
</span><span id=__span-236-3><a id=__codelineno-236-3 name=__codelineno-236-3 href=#__codelineno-236-3></a><span class=nx>maybeSync</span><span class=p>(</span><span class=nx>maybeTrue</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-236-4><a id=__codelineno-236-4 name=__codelineno-236-4 href=#__codelineno-236-4></a><span class=w>  </span><span class=nx>foo</span><span class=p>();</span>
</span><span id=__span-236-5><a id=__codelineno-236-5 name=__codelineno-236-5 href=#__codelineno-236-5></a><span class=p>});</span>
</span><span id=__span-236-6><a id=__codelineno-236-6 name=__codelineno-236-6 href=#__codelineno-236-6></a>
</span><span id=__span-236-7><a id=__codelineno-236-7 name=__codelineno-236-7 href=#__codelineno-236-7></a><span class=nx>bar</span><span class=p>();</span>
</span></code></pre></div></li> <li>範例程式碼( <strong>正確做法</strong> )</li> <li>以下的做法會比較好 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-237-1><a id=__codelineno-237-1 name=__codelineno-237-1 href=#__codelineno-237-1></a><span class=kd>function</span><span class=w> </span><span class=nx>definitelyAsync</span><span class=p>(</span><span class=nx>arg</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-237-2><a id=__codelineno-237-2 name=__codelineno-237-2 href=#__codelineno-237-2></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>arg</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-237-3><a id=__codelineno-237-3 name=__codelineno-237-3 href=#__codelineno-237-3></a><span class=w>    </span><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(</span><span class=nx>cb</span><span class=p>);</span>
</span><span id=__span-237-4><a id=__codelineno-237-4 name=__codelineno-237-4 href=#__codelineno-237-4></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-237-5><a id=__codelineno-237-5 name=__codelineno-237-5 href=#__codelineno-237-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-237-6><a id=__codelineno-237-6 name=__codelineno-237-6 href=#__codelineno-237-6></a>
</span><span id=__span-237-7><a id=__codelineno-237-7 name=__codelineno-237-7 href=#__codelineno-237-7></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>stat</span><span class=p>(</span><span class=s1>&#39;file&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>);</span>
</span><span id=__span-237-8><a id=__codelineno-237-8 name=__codelineno-237-8 href=#__codelineno-237-8></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_send_message_sendhandle_options_callback>process.send(message[, sendHandle[, options]][, callback])</a></li> <li>args<ul> <li>message: (Object)</li> <li>sendHandle ([net.Server])(<a href=https://nodejs.org/api/net.html#net_class_net_server>https://nodejs.org/api/net.html#net_class_net_server</a>) || <a href=https://nodejs.org/api/net.html#net_class_net_socket>net.Socket</a>)</li> <li>options: (Object)</li> <li>被用作將特定操作類型的發送參數化</li> <li><code>options</code>也支援以下的屬性<ul> <li><code>keepOpen</code>: (boolean)</li> <li>當在傳遞<code>net.Socket</code>的實例們(instances)時,可以用來傳遞的值</li> <li>預設值: false</li> <li>當<code>keepOpen</code>=true時, <code>socket</code>會在發送過程(sending process)中保持開放</li> </ul> </li> </ul> </li> <li>Returns: (boolean)<ul> <li>如果是利用<code>IPC channel</code>來產生Node應用程式的話,<code>process.send()</code>方法可以用來傳遞訊息給父進程(parent process)</li> <li>消息(message)會被parent's <a href=https://nodejs.org/api/child_process.html#child_process_class_childprocess>ChildProcess</a>物件作為<a href=https://nodejs.org/api/child_process.html#child_process_event_message>message event</a>來接收</li> <li>如果未使用<code>IPC channel</code>來產生Node應用程式的話,則<code>process.send()</code>回傳的結果將會是<code>undefined</code></li> <li>該訊息(message)已經歷過序列化(serialization)與解析(parsing)</li> <li>結果消息(resulting message)可能會跟最初發送的消息不太一樣</li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_uptime>process.uptime()</a></li> <li>Returns: (number)</li> <li>該方法會回傳當前Node應用程式已經運行多久的秒數<ul> <li>回傳值會包括含有小數點的秒數,可以利用Math.floor()來算出小於等於所給數字的最大整數</li> <li>例: $ <code>Math.floor(5.95)</code> =&gt; <code>5</code> <blockquote> <p>property</p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_argv>process.argv</a></li> <li>Type: (string) </li> <li>該屬性會回傳一個陣列(array),該陣列會包含當啟動Node應用程式的進程的時候,整個命令列(command-line)要傳遞的所有參數<ul> <li>其中的第一個元素會是<a href=https://nodejs.org/api/process.html#process_process_execpath>process.execPath</a></li> <li>第二個元素會是正在被執行的Javascript檔案的路徑位置</li> <li>剩下的元素就是任何其他的命令列參數(command-line arguments)</li> </ul> </li> <li>範例程式碼<ul> <li>假設以下範例程式的檔案名稱是<code>process-args.js</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-238-1><a id=__codelineno-238-1 name=__codelineno-238-1 href=#__codelineno-238-1></a><span class=c1>// print process.argv</span>
</span><span id=__span-238-2><a id=__codelineno-238-2 name=__codelineno-238-2 href=#__codelineno-238-2></a><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>val</span><span class=p>,</span><span class=w> </span><span class=nx>index</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-238-3><a id=__codelineno-238-3 name=__codelineno-238-3 href=#__codelineno-238-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>index</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>val</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-238-4><a id=__codelineno-238-4 name=__codelineno-238-4 href=#__codelineno-238-4></a><span class=p>});</span>
</span></code></pre></div></li> <li>可以利用以下的方式來啟動Node應用程式的進程(process)</li> <li>$ <code>node process-args.js one two=three four</code></li> <li>將會回傳以下的值 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-239-1><a id=__codelineno-239-1 name=__codelineno-239-1 href=#__codelineno-239-1></a><span class=mf>0</span><span class=o>:</span><span class=w> </span><span class=err>/usr/local/bin/node</span>
</span><span id=__span-239-2><a id=__codelineno-239-2 name=__codelineno-239-2 href=#__codelineno-239-2></a><span class=mf>1</span><span class=o>:</span><span class=w> </span><span class=err>/Users/mjr/work/node/process-args.js</span>
</span><span id=__span-239-3><a id=__codelineno-239-3 name=__codelineno-239-3 href=#__codelineno-239-3></a><span class=mf>2</span><span class=o>:</span><span class=w> </span><span class=nx>one</span>
</span><span id=__span-239-4><a id=__codelineno-239-4 name=__codelineno-239-4 href=#__codelineno-239-4></a><span class=mf>3</span><span class=o>:</span><span class=w> </span><span class=nx>two</span><span class=o>=</span><span class=nx>three</span>
</span><span id=__span-239-5><a id=__codelineno-239-5 name=__codelineno-239-5 href=#__codelineno-239-5></a><span class=mf>4</span><span class=o>:</span><span class=w> </span><span class=nx>four</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_debugport>process.debugPort</a></li> <li>Type: (number)</li> <li>該屬性值代表當啟用(enabled)Node應用程式的除錯器時(dubugger),所使用的埠號(port)</li> <li><a href=https://nodejs.org/api/process.html#process_process_env>process.env</a></li> <li>Type: (Object) </li> <li>該屬性會回傳一個物件,包含使用者的環境變數<ul> <li>像是以下的<code>Object</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-240-1><a id=__codelineno-240-1 name=__codelineno-240-1 href=#__codelineno-240-1></a><span class=p>{</span>
</span><span id=__span-240-2><a id=__codelineno-240-2 name=__codelineno-240-2 href=#__codelineno-240-2></a><span class=w>  </span><span class=nx>TERM</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;xterm-256color&#39;</span><span class=p>,</span>
</span><span id=__span-240-3><a id=__codelineno-240-3 name=__codelineno-240-3 href=#__codelineno-240-3></a><span class=w>  </span><span class=nx>SHELL</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/usr/local/bin/bash&#39;</span><span class=p>,</span>
</span><span id=__span-240-4><a id=__codelineno-240-4 name=__codelineno-240-4 href=#__codelineno-240-4></a><span class=w>  </span><span class=nx>USER</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;maciej&#39;</span><span class=p>,</span>
</span><span id=__span-240-5><a id=__codelineno-240-5 name=__codelineno-240-5 href=#__codelineno-240-5></a><span class=w>  </span><span class=nx>PATH</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;~/.bin/:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin&#39;</span><span class=p>,</span>
</span><span id=__span-240-6><a id=__codelineno-240-6 name=__codelineno-240-6 href=#__codelineno-240-6></a><span class=w>  </span><span class=nx>PWD</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/Users/maciej&#39;</span><span class=p>,</span>
</span><span id=__span-240-7><a id=__codelineno-240-7 name=__codelineno-240-7 href=#__codelineno-240-7></a><span class=w>  </span><span class=nx>EDITOR</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;vim&#39;</span><span class=p>,</span>
</span><span id=__span-240-8><a id=__codelineno-240-8 name=__codelineno-240-8 href=#__codelineno-240-8></a><span class=w>  </span><span class=nx>SHLVL</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span><span id=__span-240-9><a id=__codelineno-240-9 name=__codelineno-240-9 href=#__codelineno-240-9></a><span class=w>  </span><span class=nx>HOME</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/Users/maciej&#39;</span><span class=p>,</span>
</span><span id=__span-240-10><a id=__codelineno-240-10 name=__codelineno-240-10 href=#__codelineno-240-10></a><span class=w>  </span><span class=nx>LOGNAME</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;maciej&#39;</span><span class=p>,</span>
</span><span id=__span-240-11><a id=__codelineno-240-11 name=__codelineno-240-11 href=#__codelineno-240-11></a><span class=w>  </span><span class=nx>_</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;/usr/local/bin/node&#39;</span>
</span><span id=__span-240-12><a id=__codelineno-240-12 name=__codelineno-240-12 href=#__codelineno-240-12></a><span class=p>}</span><span class=w> </span>
</span></code></pre></div></li> <li>可以修改這個環境變數的物件,但僅限於該Node應用程式進程(process),或者除非明確地要求不會反應到其他<a href=https://nodejs.org/api/worker_threads.html#worker_threads_class_worker>Worker threads</a>上</li> <li>換句話說,以下的範例並不會如預期地運作</li> <li>$ <code>node -e 'process.env.foo = "bar"' &amp;&amp; echo $foo</code></li> <li>雖然將執行以下操作 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-241-1><a id=__codelineno-241-1 name=__codelineno-241-1 href=#__codelineno-241-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;bar&#39;</span><span class=p>;</span>
</span><span id=__span-241-2><a id=__codelineno-241-2 name=__codelineno-241-2 href=#__codelineno-241-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>foo</span><span class=p>);</span>
</span></code></pre></div></li> </ul> </li> <li>從Node v10.0.0的版本以後開始,指派給<code>process.env</code>的環境變數的值 <strong>不會</strong> 再做隱性轉換型別<ul> <li>所以以下的方式 <strong>不建議</strong> 再使用</li> <li>情境說明( <strong>錯誤示範</strong> ) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-242-1><a id=__codelineno-242-1 name=__codelineno-242-1 href=#__codelineno-242-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>test</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-242-2><a id=__codelineno-242-2 name=__codelineno-242-2 href=#__codelineno-242-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>test</span><span class=p>);</span>
</span><span id=__span-242-3><a id=__codelineno-242-3 name=__codelineno-242-3 href=#__codelineno-242-3></a><span class=c1>// =&gt; &#39;null&#39;</span>
</span><span id=__span-242-4><a id=__codelineno-242-4 name=__codelineno-242-4 href=#__codelineno-242-4></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>test</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>undefined</span><span class=p>;</span>
</span><span id=__span-242-5><a id=__codelineno-242-5 name=__codelineno-242-5 href=#__codelineno-242-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>test</span><span class=p>);</span>
</span><span id=__span-242-6><a id=__codelineno-242-6 name=__codelineno-242-6 href=#__codelineno-242-6></a><span class=c1>// =&gt; &#39;undefined&#39;</span>
</span></code></pre></div></li> </ul> </li> <li>如果要從<code>process.env</code>的屬性值中,刪除Node應用程式的環境變數的話,可以利用Javascript的<code>delete</code>指令來完成<ul> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-243-1><a id=__codelineno-243-1 name=__codelineno-243-1 href=#__codelineno-243-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span><span class=p>;</span>
</span><span id=__span-243-2><a id=__codelineno-243-2 name=__codelineno-243-2 href=#__codelineno-243-2></a><span class=ow>delete</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>TEST</span><span class=p>;</span>
</span><span id=__span-243-3><a id=__codelineno-243-3 name=__codelineno-243-3 href=#__codelineno-243-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>TEST</span><span class=p>);</span>
</span><span id=__span-243-4><a id=__codelineno-243-4 name=__codelineno-243-4 href=#__codelineno-243-4></a><span class=c1>// =&gt; undefined</span>
</span></code></pre></div></li> </ul> </li> <li>在Windows作業系統中,環境變數沒有區分大小寫(case-insensitive)<ul> <li>以下範例程式碼 <strong>僅限於Windows作業系統中</strong> 可以這樣使用 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-244-1><a id=__codelineno-244-1 name=__codelineno-244-1 href=#__codelineno-244-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>TEST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span><span class=p>;</span>
</span><span id=__span-244-2><a id=__codelineno-244-2 name=__codelineno-244-2 href=#__codelineno-244-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>test</span><span class=p>);</span>
</span><span id=__span-244-3><a id=__codelineno-244-3 name=__codelineno-244-3 href=#__codelineno-244-3></a><span class=c1>// =&gt; 1</span>
</span></code></pre></div></li> </ul> </li> <li>除非在建立<a href=https://nodejs.org/api/worker_threads.html#worker_threads_class_worker>Worker</a>實例時有明確指定環境變數,不然每個<code>Worker thread</code>都有自己的一份<code>process.env</code>副本(copy),是基於它們各自的父線程(parent thread)的環境變數(<code>process.env</code>),或是任何被作為<code>env</code>選項並給定到<code>Worker constructor</code><ul> <li><code>Worker threads</code>之間並無法看到<code>process.env</code>的修改,只有主線程(main thread)才能進行對作業系統或是本機加載項(native add-ons)做看得見的修改</li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_execargv>process.execArgv</a></li> <li>Type: (string [set])</li> <li>該屬性會回傳當Node應用程式的進程被啟動時,在Node.js命令列上面的特定選項的集合(the set of Node.js-specific command-line options)<ul> <li>這邊所指的特定選項(options)並不會出現在<code>process.argv</code>的屬性值之中,而且也不包括可執行的(executable),該準備要執行的檔案名稱,以及該準備要執行的檔案名稱 <strong>後面</strong> 的任何選項(options)</li> <li>這些選項對於以與父級相同執行環境的子進程(child process)是很有用的</li> <li>在終端機(CLI)執行該以下的指令後</li> <li>例: $ <code>node --harmony script.js --version</code></li> <li>檢視<code>process.execArgv</code>的屬性值會得到<ul> <li>=&gt; <code>['--harmony']</code></li> </ul> </li> <li>對照檢視<code>process.argv</code>的屬性值會得到<ul> <li>=&gt; <code>['/usr/local/bin/node', 'script.js', '--version']</code></li> </ul> </li> <li>可參考有關<a href=https://nodejs.org/api/worker_threads.html#worker_threads_new_worker_filename_options>Worker constructor</a>中的<code>execArgv</code>屬性以了解更多的訊息</li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_execpath>process.execPath</a></li> <li>Type: (string)</li> <li>該屬性值會回傳Node應用程式的進程中的可執行文件(executable)的絕對路徑<ul> <li>例: <code>'/usr/local/bin/node'</code> </li> <li>如果遇到可執行文件的路徑是<code>symbolic link</code>,會自動解決掉該問題 </li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_process_exitcode>process.exitCode</a></li> <li>型別: (integer)</li> <li>當進程被正常地退出時,或是透過<code>process.exit()</code>方法退出時但沒有給定退出碼時,<code>process.exitCode</code>的屬性值代表該進程的退出碼</li> <li>當我們給定process.exit([code])方法的退出碼參數值時,會推翻(override)之前的<code>process.exitCode</code>的屬性值設定</li> <li><a href=https://nodejs.org/api/process.html#process_process_pid>process.pid</a></li> <li>Type: (integer)</li> <li>該屬性會回傳該進程的ID(process ID, pid)<ul> <li>$ <code>console.log(</code>This process is pid ${process.pid}<code>);</code> </li> </ul> </li> <li><a href=https://nodejs.org/api/process.html#process_a_note_on_process_i_o>A note on process I/O</a></li> <li><a href=https://nodejs.org/api/process.html#process_process_stdin>process.stdin</a></li> <li><a href=https://nodejs.org/api/process.html#process_process_stdout>process.stdout</a></li> <li><a href=https://nodejs.org/api/process.html#process_process_stderr>process.stderr</a></li> <li><a href=https://nodejs.org/api/process.html#process_process_title>process.title</a></li> <li>Type: (string)</li> <li>該屬性會回傳當前的進程標題(current process title) =&gt; 也就是會回傳當前<code>ps</code>的值</li> <li>當指派新的值給<code>process.title</code>屬性時,會修改掉當前<code>ps</code>的值</li> <li><a href=https://nodejs.org/api/process.html#process_process_version>process.version</a></li> <li>Type: (string)</li> <li>該屬性值代表Node.js的版本號(version) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-245-1><a id=__codelineno-245-1 name=__codelineno-245-1 href=#__codelineno-245-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Version: </span><span class=si>${</span><span class=nx>process</span><span class=p>.</span><span class=nx>version</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-245-2><a id=__codelineno-245-2 name=__codelineno-245-2 href=#__codelineno-245-2></a><span class=c1>// Version: v14.8.0</span>
</span></code></pre></div><ul> <li>如果想要取得不帶有前綴v開頭的版本號字串的話,可以利用以下的屬性值</li> <li>$ <code>process.versions.node</code> </li> </ul> </li> </ul> <blockquote> <p>Exit codes(退出碼) - 在沒有其他額外的 <strong>非同步操作</strong> 處於<code>pending狀態</code>後,Node應用程式通常會以<code>0</code>的退出碼來正常退出 - 以下是常見的退出碼 + <code>0</code>: 正常退出 (預設值) + <code>1</code>: 未捕獲的致命錯誤(Uncaught Fatal Exception),並且沒有受到<code>domain</code>或是<a href=https://nodejs.org/api/process.html#process_event_uncaughtexception>uncaughtException</a>事件處理器來處理 + 以下略...</p> </blockquote> <h3 id=console><a href=https://nodejs.org/api/console.html#console_console>Console</a><a class=headerlink href=#console title="Permanent link">&para;</a></h3> <ul> <li><code>console</code>模組提供了一組簡單的除錯控制台(debugging console),類似於網頁瀏覽器所提供的Javascript控制台機制</li> <li><code>console</code>模組會匯出(export)兩個特定的元件(specific components)<ul> <li>第一個特定的元件是: <a href=https://nodejs.org/api/console.html#console_class_console>Console類別(class)</a>的方法,像是<code>console.log()</code>&amp;<code>console.error()</code>&amp;<code>console.warn()</code>,它們可以被用來寫入到Node流(stream)中</li> <li>第二個特定的原件是: 一個全域(global)的<code>console</code>實例(instance)會寫入到<a href=https://nodejs.org/api/process.html#process_process_stdout>process.stdout</a>與<a href=https://nodejs.org/api/process.html#process_process_stderr>process.stderr</a>。全域的<code>console</code>物件可以直接被使用,而 <strong>不用</strong> 事先匯入( <strong>require('console')</strong> )</li> </ul> </li> <li><strong>注意</strong> : 全域的<code>console</code>物件方法既不能像類似它們的瀏覽器API一樣始終同步(consistently synchronous),也不能像Node流(streams)一樣始終非同步(consistently asynchronous)<ul> <li>可參考<code>process</code>模組的 <a href=https://nodejs.org/api/process.html#process_a_note_on_process_i_o>A note on process I/O</a> 章節</li> </ul> </li> <li>使用全域的<code>console物件</code>的範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-246-1><a id=__codelineno-246-1 name=__codelineno-246-1 href=#__codelineno-246-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hello world&#39;</span><span class=p>);</span>
</span><span id=__span-246-2><a id=__codelineno-246-2 name=__codelineno-246-2 href=#__codelineno-246-2></a><span class=c1>// Prints: hello world, to stdout</span>
</span><span id=__span-246-3><a id=__codelineno-246-3 name=__codelineno-246-3 href=#__codelineno-246-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hello %s&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;world&#39;</span><span class=p>);</span>
</span><span id=__span-246-4><a id=__codelineno-246-4 name=__codelineno-246-4 href=#__codelineno-246-4></a><span class=c1>// Prints: hello world, to stdout</span>
</span><span id=__span-246-5><a id=__codelineno-246-5 name=__codelineno-246-5 href=#__codelineno-246-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Whoops, something bad happened&#39;</span><span class=p>));</span>
</span><span id=__span-246-6><a id=__codelineno-246-6 name=__codelineno-246-6 href=#__codelineno-246-6></a><span class=c1>// Prints error message and stack trace to stderr:</span>
</span><span id=__span-246-7><a id=__codelineno-246-7 name=__codelineno-246-7 href=#__codelineno-246-7></a><span class=c1>//   Error: Whoops, something bad happened</span>
</span><span id=__span-246-8><a id=__codelineno-246-8 name=__codelineno-246-8 href=#__codelineno-246-8></a><span class=c1>//     at [eval]:5:15</span>
</span><span id=__span-246-9><a id=__codelineno-246-9 name=__codelineno-246-9 href=#__codelineno-246-9></a><span class=c1>//     at Script.runInThisContext (node:vm:132:18)</span>
</span><span id=__span-246-10><a id=__codelineno-246-10 name=__codelineno-246-10 href=#__codelineno-246-10></a><span class=c1>//     at Object.runInThisContext (node:vm:309:38)</span>
</span><span id=__span-246-11><a id=__codelineno-246-11 name=__codelineno-246-11 href=#__codelineno-246-11></a><span class=c1>//     at node:internal/process/execution:77:19</span>
</span><span id=__span-246-12><a id=__codelineno-246-12 name=__codelineno-246-12 href=#__codelineno-246-12></a><span class=c1>//     at [eval]-wrapper:6:22</span>
</span><span id=__span-246-13><a id=__codelineno-246-13 name=__codelineno-246-13 href=#__codelineno-246-13></a><span class=c1>//     at evalScript (node:internal/process/execution:76:60)</span>
</span><span id=__span-246-14><a id=__codelineno-246-14 name=__codelineno-246-14 href=#__codelineno-246-14></a><span class=c1>//     at node:internal/main/eval_string:23:3</span>
</span><span id=__span-246-15><a id=__codelineno-246-15 name=__codelineno-246-15 href=#__codelineno-246-15></a>
</span><span id=__span-246-16><a id=__codelineno-246-16 name=__codelineno-246-16 href=#__codelineno-246-16></a><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Will Robinson&#39;</span><span class=p>;</span>
</span><span id=__span-246-17><a id=__codelineno-246-17 name=__codelineno-246-17 href=#__codelineno-246-17></a><span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`Danger </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>! Danger!`</span><span class=p>);</span>
</span><span id=__span-246-18><a id=__codelineno-246-18 name=__codelineno-246-18 href=#__codelineno-246-18></a><span class=c1>// Prints: Danger Will Robinson! Danger!, to stderr</span>
</span></code></pre></div></li> <li>使用<code>Console類別</code>的範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-247-1><a id=__codelineno-247-1 name=__codelineno-247-1 href=#__codelineno-247-1></a><span class=kd>const</span><span class=w> </span><span class=nx>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getStreamSomehow</span><span class=p>();</span>
</span><span id=__span-247-2><a id=__codelineno-247-2 name=__codelineno-247-2 href=#__codelineno-247-2></a><span class=kd>const</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getStreamSomehow</span><span class=p>();</span>
</span><span id=__span-247-3><a id=__codelineno-247-3 name=__codelineno-247-3 href=#__codelineno-247-3></a><span class=kd>const</span><span class=w> </span><span class=nx>myConsole</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>Console</span><span class=p>(</span><span class=nx>out</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>);</span>
</span><span id=__span-247-4><a id=__codelineno-247-4 name=__codelineno-247-4 href=#__codelineno-247-4></a>
</span><span id=__span-247-5><a id=__codelineno-247-5 name=__codelineno-247-5 href=#__codelineno-247-5></a><span class=nx>myConsole</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hello world&#39;</span><span class=p>);</span>
</span><span id=__span-247-6><a id=__codelineno-247-6 name=__codelineno-247-6 href=#__codelineno-247-6></a><span class=c1>// Prints: hello world, to out</span>
</span><span id=__span-247-7><a id=__codelineno-247-7 name=__codelineno-247-7 href=#__codelineno-247-7></a><span class=nx>myConsole</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;hello %s&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;world&#39;</span><span class=p>);</span>
</span><span id=__span-247-8><a id=__codelineno-247-8 name=__codelineno-247-8 href=#__codelineno-247-8></a><span class=c1>// Prints: hello world, to out</span>
</span><span id=__span-247-9><a id=__codelineno-247-9 name=__codelineno-247-9 href=#__codelineno-247-9></a><span class=nx>myConsole</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Whoops, something bad happened&#39;</span><span class=p>));</span>
</span><span id=__span-247-10><a id=__codelineno-247-10 name=__codelineno-247-10 href=#__codelineno-247-10></a><span class=c1>// Prints: [Error: Whoops, something bad happened], to err</span>
</span><span id=__span-247-11><a id=__codelineno-247-11 name=__codelineno-247-11 href=#__codelineno-247-11></a>
</span><span id=__span-247-12><a id=__codelineno-247-12 name=__codelineno-247-12 href=#__codelineno-247-12></a><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Will Robinson&#39;</span><span class=p>;</span>
</span><span id=__span-247-13><a id=__codelineno-247-13 name=__codelineno-247-13 href=#__codelineno-247-13></a><span class=nx>myConsole</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=sb>`Danger </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>! Danger!`</span><span class=p>);</span>
</span><span id=__span-247-14><a id=__codelineno-247-14 name=__codelineno-247-14 href=#__codelineno-247-14></a><span class=c1>// Prints: Danger Will Robinson! Danger!, to err</span>
</span></code></pre></div><blockquote> <p>Class</p> </blockquote> </li> <li><a href=https://nodejs.org/api/console.html#console_class_console>Class: Console</a></li> <li><code>Console</code>類別可以用來建立簡單且可配置(configurable)的輸出流(output streams)紀錄器(logger),並且可以利用以下兩種方式來存取,或是用它們相仿的解構對應物件(destructured counterparts)來存取<ul> <li>存取方式一: <code>require('console').Console</code></li> <li>例: <code>const { Console } = require('console');</code></li> <li>存取方式二: <code>console.Console</code></li> <li>例: <code>const { Console } = console;</code><blockquote> <p>method</p> </blockquote> </li> <li><a href=https://nodejs.org/api/console.html#console_console_clear>console.clear()</a></li> <li>當標準輸出(<code>stdout</code>)是<code>TTY</code>時,呼叫<code>console.clear()</code>的時候,會嘗試清除<code>TTY</code>; 當標準輸出(<code>stdout</code>)不是<code>TTY</code>時,則該方法不會做任何事情</li> <li>使用特定的<code>console.clear()</code>操作時,會因為使用的作業系統不同or終端機類型不同,而有所差異。在大部分的Linux作業系統中,<code>console.clear()</code>方法會執行與<code>clear</code>指令差不多的操作; 在Windows作業系統中,<code>console.clear()</code>將僅會清除掉在當前(current)的終端機視口(terminal viewport)中的Node應用程式的二進制(binary)文件的輸出(output)</li> <li><a href=https://nodejs.org/api/console.html#console_console_count_label>console.count([label])</a></li> <li>args<ul> <li>label: (string)</li> <li>可以給定要顯示的計數器的標籤值</li> <li>預設值: <code>default</code></li> </ul> </li> <li>該方法會回傳一個內部計數器(internal counter)維持顯示一組<code>標籤</code>(label) &amp; <code>次數</code>(times)<ul> <li><code>標籤</code>(label): 可以透過呼叫<code>console.count()</code>方法時,由開發者給定標籤值</li> <li><code>次數</code>(times): 指定給標籤,呼叫<code>console.count()</code>方法並輸出給<code>stdout</code>的次數</li> <li>範例程式碼</li> <li><code>console &gt; console.count() default: 1 undefined &gt; console.count('default') default: 2 undefined &gt; console.count('abc') abc: 1 undefined &gt; console.count('xyz') xyz: 1 undefined &gt; console.count('abc') abc: 2 undefined &gt; console.count() default: 3 undefined &gt;</code></li> </ul> </li> <li><a href=https://nodejs.org/api/console.html#console_console_error_data_args>console.error([data][, ...args])</a></li> <li>args<ul> <li>data: (any)</li> <li>...args: (any)</li> </ul> </li> <li>該方法會用新的一行(newline)打印(print)出標準錯誤(<code>stderr</code>)</li> <li>該方法可以傳遞多個參數<ul> <li>第一個參數會被用來當作主要訊息(primary message)</li> <li>其他額外的參數(additional arguments)會被用作替換值(substitution),類似於<a href=https://man7.org/linux/man-pages/man3/printf.3.html>printf(3)</a></li> <li>其他額外的參數都會被傳遞給<code>util.format()</code>方法</li> <li>相關資訊可參考<a href=https://nodejs.org/api/util.html#util_util_format_format_args>util.format()</a>方法</li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-248-1><a id=__codelineno-248-1 name=__codelineno-248-1 href=#__codelineno-248-1></a><span class=kd>const</span><span class=w> </span><span class=nx>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5</span><span class=p>;</span>
</span><span id=__span-248-2><a id=__codelineno-248-2 name=__codelineno-248-2 href=#__codelineno-248-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error #%d&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>code</span><span class=p>);</span>
</span><span id=__span-248-3><a id=__codelineno-248-3 name=__codelineno-248-3 href=#__codelineno-248-3></a><span class=c1>// Prints: error #5, to stderr</span>
</span><span id=__span-248-4><a id=__codelineno-248-4 name=__codelineno-248-4 href=#__codelineno-248-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>code</span><span class=p>);</span>
</span><span id=__span-248-5><a id=__codelineno-248-5 name=__codelineno-248-5 href=#__codelineno-248-5></a><span class=c1>// Prints: error 5, to stderr</span>
</span></code></pre></div><ul> <li>若格式化元素(formatted elements),例如: <code>%d</code>沒有在新的一行中被發現,則<a href=https://nodejs.org/api/util.html#util_util_inspect_object_options>util.inspect()</a>方法會被呼叫,並在每個參數上呼叫該元素(<code>%d</code>),並將結果的字串值連接起來</li> </ul> </li> <li><a href=https://nodejs.org/api/console.html#console_console_log_data_args>console.log([data][, ...args])</a></li> <li>args<ul> <li>data: (any)</li> <li>...args: (any)</li> </ul> </li> <li>該方法會用新的一行(newline)打印(print)出標準輸出(<code>stdout</code>)</li> <li>該方法可以傳遞多個參數<ul> <li>第一個參數會被用來當作主要訊息(primary message)</li> <li>其他額外的參數(additional arguments)會被用作替換值(substitution),類似於<a href=https://man7.org/linux/man-pages/man3/printf.3.html>printf(3)</a></li> <li>其他額外的參數都會被傳遞給<code>util.format()</code>方法</li> <li>相關資訊可參考<a href=https://nodejs.org/api/util.html#util_util_format_format_args>util.format()</a>方法</li> </ul> </li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-249-1><a id=__codelineno-249-1 name=__codelineno-249-1 href=#__codelineno-249-1></a><span class=kd>const</span><span class=w> </span><span class=nx>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5</span><span class=p>;</span>
</span><span id=__span-249-2><a id=__codelineno-249-2 name=__codelineno-249-2 href=#__codelineno-249-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;count: %d&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=p>);</span>
</span><span id=__span-249-3><a id=__codelineno-249-3 name=__codelineno-249-3 href=#__codelineno-249-3></a><span class=c1>// Prints: count: 5, to stdout</span>
</span><span id=__span-249-4><a id=__codelineno-249-4 name=__codelineno-249-4 href=#__codelineno-249-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;count:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>count</span><span class=p>);</span>
</span><span id=__span-249-5><a id=__codelineno-249-5 name=__codelineno-249-5 href=#__codelineno-249-5></a><span class=c1>// Prints: count: 5, to stdout</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/api/console.html#console_console_time_label>console.time([label])</a></li> <li>args<ul> <li>label: (string)</li> <li>可以給定該計時器的標籤值,以作為計時器識別用</li> <li>預設值: <code>default</code></li> </ul> </li> <li>該方法會啟動一個計時器(timer)被用來計算該操作(operation)的持續時間</li> <li>計時器會用獨一無二(unique)的標籤(label)來識別</li> <li>計時器會呼叫同標籤(same label)的<code>console.timeEnd()</code>方法來停止計時器,並將經過的時間以合適的時間單位輸出到標準輸出(<code>stdout</code>)中<ul> <li>舉例來說,如果經過的時間是3869毫秒(ms),那麼<code>console.timeEnd()</code>方法會顯示"3.869"秒</li> </ul> </li> <li><a href=https://nodejs.org/api/console.html#console_console_timeend_label>console.timeEnd([label])</a></li> <li>args<ul> <li>label: (string)</li> <li>可以給定該計時器的標籤值,以作為計時器識別用</li> <li>預設值: <code>default</code></li> </ul> </li> <li>該方法會停止之前透過呼叫<code>console.time()</code>方法設定好的計時器,並將結果打印(print)到標準輸出(<code>stdout</code>)中</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-250-1><a id=__codelineno-250-1 name=__codelineno-250-1 href=#__codelineno-250-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>time</span><span class=p>(</span><span class=s1>&#39;100-elements&#39;</span><span class=p>);</span>
</span><span id=__span-250-2><a id=__codelineno-250-2 name=__codelineno-250-2 href=#__codelineno-250-2></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>let</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>100</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-250-3><a id=__codelineno-250-3 name=__codelineno-250-3 href=#__codelineno-250-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>timeEnd</span><span class=p>(</span><span class=s1>&#39;100-elements&#39;</span><span class=p>);</span>
</span><span id=__span-250-4><a id=__codelineno-250-4 name=__codelineno-250-4 href=#__codelineno-250-4></a><span class=c1>// prints 100-elements: 225.438ms</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/api/console.html#console_console_trace_message_args>console.trace([message][, ...args])</a></li> <li>args<ul> <li>message: (any)</li> <li>...args: (any)</li> </ul> </li> <li>該方法會將<code>Trace:</code>這段字串打印(print)到標準錯誤(<code>stderr</code>)中,接著透過<a href=https://nodejs.org/api/util.html#util_util_format_format_args>util.format()</a>方法打印出格式化過的字串(formatted message),並堆棧追蹤(stack trace)到程式碼中的當前位置</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-251-1><a id=__codelineno-251-1 name=__codelineno-251-1 href=#__codelineno-251-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>trace</span><span class=p>(</span><span class=s1>&#39;Show me&#39;</span><span class=p>);</span>
</span><span id=__span-251-2><a id=__codelineno-251-2 name=__codelineno-251-2 href=#__codelineno-251-2></a><span class=c1>// Prints: (stack trace will vary based on where trace is called)</span>
</span><span id=__span-251-3><a id=__codelineno-251-3 name=__codelineno-251-3 href=#__codelineno-251-3></a><span class=c1>//  Trace: Show me</span>
</span><span id=__span-251-4><a id=__codelineno-251-4 name=__codelineno-251-4 href=#__codelineno-251-4></a><span class=c1>//    at repl:2:9</span>
</span><span id=__span-251-5><a id=__codelineno-251-5 name=__codelineno-251-5 href=#__codelineno-251-5></a><span class=c1>//    at REPLServer.defaultEval (repl.js:248:27)</span>
</span><span id=__span-251-6><a id=__codelineno-251-6 name=__codelineno-251-6 href=#__codelineno-251-6></a><span class=c1>//    at bound (domain.js:287:14)</span>
</span><span id=__span-251-7><a id=__codelineno-251-7 name=__codelineno-251-7 href=#__codelineno-251-7></a><span class=c1>//    at REPLServer.runBound [as eval] (domain.js:300:12)</span>
</span><span id=__span-251-8><a id=__codelineno-251-8 name=__codelineno-251-8 href=#__codelineno-251-8></a><span class=c1>//    at REPLServer.&lt;anonymous&gt; (repl.js:412:12)</span>
</span><span id=__span-251-9><a id=__codelineno-251-9 name=__codelineno-251-9 href=#__codelineno-251-9></a><span class=c1>//    at emitOne (events.js:82:20)</span>
</span><span id=__span-251-10><a id=__codelineno-251-10 name=__codelineno-251-10 href=#__codelineno-251-10></a><span class=c1>//    at REPLServer.emit (events.js:169:7)</span>
</span><span id=__span-251-11><a id=__codelineno-251-11 name=__codelineno-251-11 href=#__codelineno-251-11></a><span class=c1>//    at REPLServer.Interface._onLine (readline.js:210:10)</span>
</span><span id=__span-251-12><a id=__codelineno-251-12 name=__codelineno-251-12 href=#__codelineno-251-12></a><span class=c1>//    at REPLServer.Interface._line (readline.js:549:8)</span>
</span><span id=__span-251-13><a id=__codelineno-251-13 name=__codelineno-251-13 href=#__codelineno-251-13></a><span class=c1>//    at REPLServer.Interface._ttyWrite (readline.js:826:14)</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=readline><a href=https://nodejs.org/api/readline.html#readline_readline>Readline</a><a class=headerlink href=#readline title="Permanent link">&para;</a></h3> <ul> <li><code>Readline</code>模組提供一個介面能從<a href=https://nodejs.org/api/stream.html#stream_readable_streams>Readable stream</a>一次一行地讀取數據,它可以用以下的方式來存取 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-252-1><a id=__codelineno-252-1 name=__codelineno-252-1 href=#__codelineno-252-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readline</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;readline&#39;</span><span class=p>);</span>
</span></code></pre></div></li> <li>以下是<code>readline</code>模組的簡易範例的圖解說明 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-253-1><a id=__codelineno-253-1 name=__codelineno-253-1 href=#__codelineno-253-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readline</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;readline&#39;</span><span class=p>);</span>
</span><span id=__span-253-2><a id=__codelineno-253-2 name=__codelineno-253-2 href=#__codelineno-253-2></a>
</span><span id=__span-253-3><a id=__codelineno-253-3 name=__codelineno-253-3 href=#__codelineno-253-3></a><span class=kd>const</span><span class=w> </span><span class=nx>rl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readline</span><span class=p>.</span><span class=nx>createInterface</span><span class=p>({</span>
</span><span id=__span-253-4><a id=__codelineno-253-4 name=__codelineno-253-4 href=#__codelineno-253-4></a><span class=w>  </span><span class=nx>input</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>,</span>
</span><span id=__span-253-5><a id=__codelineno-253-5 name=__codelineno-253-5 href=#__codelineno-253-5></a><span class=w>  </span><span class=nx>output</span><span class=o>:</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span>
</span><span id=__span-253-6><a id=__codelineno-253-6 name=__codelineno-253-6 href=#__codelineno-253-6></a><span class=p>});</span>
</span><span id=__span-253-7><a id=__codelineno-253-7 name=__codelineno-253-7 href=#__codelineno-253-7></a>
</span><span id=__span-253-8><a id=__codelineno-253-8 name=__codelineno-253-8 href=#__codelineno-253-8></a><span class=nx>rl</span><span class=p>.</span><span class=nx>question</span><span class=p>(</span><span class=s1>&#39;What do you think of Node.js? &#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>answer</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-253-9><a id=__codelineno-253-9 name=__codelineno-253-9 href=#__codelineno-253-9></a><span class=w>  </span><span class=c1>// TODO: Log the answer in a database</span>
</span><span id=__span-253-10><a id=__codelineno-253-10 name=__codelineno-253-10 href=#__codelineno-253-10></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Thank you for your valuable feedback: </span><span class=si>${</span><span class=nx>answer</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-253-11><a id=__codelineno-253-11 name=__codelineno-253-11 href=#__codelineno-253-11></a>
</span><span id=__span-253-12><a id=__codelineno-253-12 name=__codelineno-253-12 href=#__codelineno-253-12></a><span class=w>  </span><span class=nx>rl</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span><span id=__span-253-13><a id=__codelineno-253-13 name=__codelineno-253-13 href=#__codelineno-253-13></a><span class=p>});</span>
</span></code></pre></div><ul> <li>一旦以上的程式碼被呼叫後,Node應用程式就不會終止,直到<a href=https://nodejs.org/api/readline.html#readline_class_interface>readline.Interface</a>這個介面被關閉為止,因為這個介面會等待輸入流(input stream)接收到數據為止<blockquote> <p>Class</p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/api/readline.html#readline_class_interface>Class: Interface</a><ul> <li>繼承(Extends): (<a href=https://nodejs.org/api/events.html#events_class_eventemitter>EventEmitter</a>)</li> </ul> </li> <li><code>reader.Interface</code>的實例(instances)是透過<a href=https://nodejs.org/api/readline.html#readline_readline_createinterface_options>readline.createInterface()</a>方法建造的<ul> <li>每一個實例都會與單一的輸入可讀取流(input Readable stream) &amp; 單一的輸出可寫入流(output Writable stream)</li> <li>輸出流會被用來從輸入流(input stream)中讀取使用者的輸入(input)並打印出提示(prompts)<blockquote> <p>method</p> </blockquote> </li> <li><a href=https://nodejs.org/api/readline.html#readline_rl_question_query_callback>readline.question(query, callback)</a><ul> <li>args</li> <li>query (string)<ul> <li>要寫入到輸出(<code>output</code>)的陳述句(statement)或是查詢語句(<code>query</code>),位於提示之前(prepended to the prompt)</li> </ul> </li> <li>callback (Function)<ul> <li>透過使用者對查詢語句(<code>query</code>)的回應(response)來呼叫的回呼函式</li> </ul> </li> <li>該方法會透過寫入輸出(<code>output</code>)來展示查詢語句(<code>query</code>),並等待使用者輸入後並將該輸入提供給輸入(<code>input</code>)。接著會將提供的輸入(provided input)作為第一個參數,傳遞給回呼函式</li> <li>當輸入流被暫停(paused)時,呼叫<code>readline.question()</code>方法時,會繼續(resume)輸入流</li> <li>若<code>readline.createInterface()</code>被建立時,該輸出(<code>output</code>)被設定為<code>null</code>或是<code>undefined</code>,該查詢語句(<code>query</code>)不會被寫入(written)</li> <li>範例程式碼</li> <li><code>js rl.question('What is your favorite food? ', (answer) =&gt; { console.log(`Oh, so your favorite food is ${answer}`); });</code></li> <li>傳遞給<code>readline.question()</code>的回呼函式不會遵從一般接受<code>Error</code>物件或是<code>null</code>作為第一個參數的模式。回呼函式會以被提供的答案(provided answer)作為唯一的參數</li> </ul> </li> <li><a href=https://nodejs.org/api/readline.html#readline_rl_close>readline.close()</a><ul> <li>該方法會關閉<code>readline.createInterface()</code>實例,並放棄對輸入流(<code>input</code> streams)與輸出流(<code>output</code> streams)的控制(control over)。當被呼叫時,<a href=https://nodejs.org/api/readline.html#readline_event_close>close事件</a>就會被發出(emitted)</li> <li>呼叫<code>readline.close()</code>方法不會立即停止其它被<code>readline.Interface</code>實例所發出的其它事件(包含<a href=https://nodejs.org/api/readline.html#readline_event_line>line事件</a>)</li> </ul> </li> </ul> </li> </ul> <h3 id=commonjs-modules><a href=https://nodejs.org/api/modules.html#modules_modules_commonjs_modules>CommonJS modules</a><a class=headerlink href=#commonjs-modules title="Permanent link">&para;</a></h3> <ul> <li>在Node的模組系統(module system)中,每個檔案都被視為一個分開的模組(separate module)</li> <li>以下的情境說明,我們假設有一個檔案,其檔案名稱為<code>foo.js</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-254-1><a id=__codelineno-254-1 name=__codelineno-254-1 href=#__codelineno-254-1></a><span class=kd>const</span><span class=w> </span><span class=nx>circle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./circle.js&#39;</span><span class=p>);</span>
</span><span id=__span-254-2><a id=__codelineno-254-2 name=__codelineno-254-2 href=#__codelineno-254-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`The area of a circle of radius 4 is </span><span class=si>${</span><span class=nx>circle</span><span class=p>.</span><span class=nx>area</span><span class=p>(</span><span class=mf>4</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></code></pre></div><ul> <li>在這個檔案的第一行中,<code>foo.js</code>檔案會載入(loads) <code>circle.js</code>模組,這兩個檔案都是在同一個檔案目錄(directory)中</li> </ul> </li> <li>以下是<code>circle.js</code>的檔案內容 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-255-1><a id=__codelineno-255-1 name=__codelineno-255-1 href=#__codelineno-255-1></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>PI</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Math</span><span class=p>;</span>
</span><span id=__span-255-2><a id=__codelineno-255-2 name=__codelineno-255-2 href=#__codelineno-255-2></a>
</span><span id=__span-255-3><a id=__codelineno-255-3 name=__codelineno-255-3 href=#__codelineno-255-3></a><span class=nx>exports</span><span class=p>.</span><span class=nx>area</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>PI</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>**</span><span class=w> </span><span class=mf>2</span><span class=p>;</span>
</span><span id=__span-255-4><a id=__codelineno-255-4 name=__codelineno-255-4 href=#__codelineno-255-4></a>
</span><span id=__span-255-5><a id=__codelineno-255-5 name=__codelineno-255-5 href=#__codelineno-255-5></a><span class=nx>exports</span><span class=p>.</span><span class=nx>circumference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=mf>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>PI</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>r</span><span class=p>;</span>
</span></code></pre></div><ul> <li><code>circle.js</code>模組已匯出了<code>area()</code>與<code>circumference()</code>這兩個函式,透過在特殊的<code>exports</code>物件上指定(specifying)額外的(additional)屬性可以將函式與物件新增到模組的最上層(root of a module)</li> <li>這時該模組(= <code>circle.js</code>)的區域變數會是私有的(private),因為Node會將模組(module)包裝(wrapped)成為一個函式</li> <li>詳情可參考<a href=https://nodejs.org/api/modules.html#modules_the_module_wrapper>module wrapper</a></li> <li>在上述的<code>PI</code>範例中,<code>PI</code>變數就是<code>circle.js</code>的私有(private)變數</li> </ul> </li> <li><code>module.exports</code>屬性可以被指派(assigned)一個新的值,像是函式or物件</li> <li>以下的範例程式碼,<code>bar.js</code>檔案會使用到<code>square</code>模組,該模組會匯出(exports)一個<code>Square</code>類別(class) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-256-1><a id=__codelineno-256-1 name=__codelineno-256-1 href=#__codelineno-256-1></a><span class=kd>const</span><span class=w> </span><span class=nx>Square</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./square.js&#39;</span><span class=p>);</span>
</span><span id=__span-256-2><a id=__codelineno-256-2 name=__codelineno-256-2 href=#__codelineno-256-2></a><span class=kd>const</span><span class=w> </span><span class=nx>mySquare</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Square</span><span class=p>(</span><span class=mf>2</span><span class=p>);</span>
</span><span id=__span-256-3><a id=__codelineno-256-3 name=__codelineno-256-3 href=#__codelineno-256-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`The area of mySquare is </span><span class=si>${</span><span class=nx>mySquare</span><span class=p>.</span><span class=nx>area</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></code></pre></div><ul> <li><code>square</code>模組是在<code>square.js</code>這個檔案中定義的 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-257-1><a id=__codelineno-257-1 name=__codelineno-257-1 href=#__codelineno-257-1></a><span class=c1>// Assigning to exports will not modify module, must use module.exports</span>
</span><span id=__span-257-2><a id=__codelineno-257-2 name=__codelineno-257-2 href=#__codelineno-257-2></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kd>class</span><span class=w> </span><span class=nx>Square</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-257-3><a id=__codelineno-257-3 name=__codelineno-257-3 href=#__codelineno-257-3></a><span class=w>  </span><span class=kr>constructor</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-257-4><a id=__codelineno-257-4 name=__codelineno-257-4 href=#__codelineno-257-4></a><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=nx>width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>width</span><span class=p>;</span>
</span><span id=__span-257-5><a id=__codelineno-257-5 name=__codelineno-257-5 href=#__codelineno-257-5></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-257-6><a id=__codelineno-257-6 name=__codelineno-257-6 href=#__codelineno-257-6></a>
</span><span id=__span-257-7><a id=__codelineno-257-7 name=__codelineno-257-7 href=#__codelineno-257-7></a><span class=w>  </span><span class=nx>area</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-257-8><a id=__codelineno-257-8 name=__codelineno-257-8 href=#__codelineno-257-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>width</span><span class=w> </span><span class=o>**</span><span class=w> </span><span class=mf>2</span><span class=p>;</span>
</span><span id=__span-257-9><a id=__codelineno-257-9 name=__codelineno-257-9 href=#__codelineno-257-9></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-257-10><a id=__codelineno-257-10 name=__codelineno-257-10 href=#__codelineno-257-10></a><span class=p>};</span>
</span></code></pre></div></li> </ul> </li> <li>模組系統(module system)會在<code>require('module')</code>這個模組中實作(implemented)<blockquote> <p><a href=https://nodejs.org/api/modules.html#modules_core_modules>Core modules</a></p> </blockquote> </li> <li>Node有許多被編譯(compiled)成二進制文件(binary)的模組,這些Node內建的核心模組在官方文件的其它地方都有更詳細的介紹</li> <li><code>require()</code>方法會優先讀取Node內建的核心模組,當它們的標識符(identifier)被作為參數傳入給<code>require()</code>方法時 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-258-1><a id=__codelineno-258-1 name=__codelineno-258-1 href=#__codelineno-258-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span></code></pre></div><ul> <li>以上的引用方式會優先引用Node內建的核心模組-<code>HTTP</code>模組 (即使有同名稱的檔案在目錄中)<blockquote> <p><a href=https://nodejs.org/api/modules.html#modules_folders_as_modules>Folders as modules</a></p> </blockquote> </li> </ul> </li> <li>將程式(programs)與套件(libraries)整理到一個自給自足的(self-contained)目錄中,然後為這些目錄提供單一個入口(single entry point)是很方便的</li> <li>以下有3種方式可以將資料夾(folder)作為參數傳遞給<code>require()</code>方法<ul> <li>方法一: 在該資料夾的最上層(root)建立一個<a href=https://nodejs.org/api/packages.html#packages_node_js_package_json_field_definitions>package.json</a>檔案,並指定一個<code>main</code>屬性值來表示當載入此套件(package)時,預設要引入哪個模組 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-259-1><a id=__codelineno-259-1 name=__codelineno-259-1 href=#__codelineno-259-1></a><span class=p>{</span><span class=w> </span><span class=s2>&quot;name&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;some-library&quot;</span><span class=p>,</span>
</span><span id=__span-259-2><a id=__codelineno-259-2 name=__codelineno-259-2 href=#__codelineno-259-2></a><span class=w>  </span><span class=s2>&quot;main&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;./lib/some-library.js&quot;</span><span class=w> </span>
</span><span id=__span-259-3><a id=__codelineno-259-3 name=__codelineno-259-3 href=#__codelineno-259-3></a><span class=p>}</span>
</span></code></pre></div></li> <li>上述的範例程式碼中,如果在<code>./some-library/</code>目錄中有<code>./some-library/lib/some-library.js</code>這個檔案的話,Node就會嘗試讀取它</li> <li>如果該目錄中沒有該文件,或是<a href=https://nodejs.org/api/packages.html#packages_main>main</a>目錄已不見了(missing)或是無法找到(cannot be resolved),這時Node就會嘗試去讀取<a href=https://nodejs.org/api/packages.html#packages_name>name</a>檔案中的<code>index.js</code>或是<code>index.node</code></li> <li>情境說明( <strong>當該目錄沒有package.json這個檔案,且又找不到.xxx/lib/xxx.js檔案時</strong> ),當我們引用<code>require('./some-library')</code>的時候,會嘗試去讀取以下2種路徑下的檔案</li> <li>第1種: <code>./some-library/index.js</code></li> <li>第2種: <code>./some-library/index.node</code><ul> <li>如果以上的嘗試都失敗的話,Node就會將整個模組(entire module)回報(report)為遺失(missing),並顯示一個預設的錯誤</li> <li>預設: <code>Error: Cannot find module 'some-library'</code></li> </ul> </li> <li>以上就是對Node的<code>package.json</code>檔案有所體認的程度(the extent of the awareness)</li> <li>方法二: 如果傳遞給<code>require()</code>方法的模組標識符(module identifier)不是一個Node內建的核心模組名稱,而且不是以<code>/</code>, <code>../</code>, <code>./</code> 的路徑開頭的話,Node就會從當前模組的父目錄(也就是前一層目錄, parent directory)開始,接著新增一個<code>node_modules/</code>資料夾,並嘗試從該位置讀取模組</li> <li>如果在該目錄下沒有找到該模組名稱的話,則Node將會往前一層目錄查看,直到到達檔案系統(file system)的根目錄(root)為止</li> <li>情境說明(若在<code>/home/ry/projects/foo.js</code>的檔案為<code>require('bar.js')</code>,則Node會根據以下的順序依序查看接下來的檔案路徑)<ul> <li><code>/home/ry/projects/node_modules/bar.js</code></li> <li><code>/home/ry/node_modules/bar.js</code></li> <li><code>/home/node_modules/bar.js</code></li> <li><code>/node_modules/bar.js</code></li> </ul> </li> <li>這樣做也會讓程式本地化(localize)它們自己的相依性(dependencies),而不會互相抵觸(clash)</li> <li>我們也可以透過明確的檔案路徑or與該模組一起分發(distributed)的子模組(sub modules)路徑,以後綴(suffix)的方式加在該模組名稱的後面,來引用到我們的程式碼中<ul> <li>例: <code>require('example-module/path/to/file')</code></li> <li>註: 後綴路徑會遵從與該模組相同的模組解析語意(module resolution semantics)</li> </ul> </li> <li>方法三: 如果<code>NODE_PATH</code>這個環境變數設定為以冒號區隔(colon-delimited)的絕對路徑的話,則Node將會搜尋該模組的這些絕對路徑(如果在其他位置沒有找到的話)</li> <li>在Windows作業系統中,NODE_PATH會用分號(semicolon)做區隔</li> <li><code>NODE_PATH</code>起初是為了在當前的模組解析(<a href=https://nodejs.org/api/modules.html#modules_all_together>module resolution</a>)演算法被定義之前,能夠支援從不同路徑來載入模組而建立的<ul> <li>至今,<code>NODE_PATH</code>仍然支援,但是Node生態系統已經決定了定位出模組相依性的規範,而顯得<code>NODE_PATH</code>不再是那麼必要了</li> <li>有時候,當其他人不知道這次的部署(deployments)需要依賴(rely on)<code>NODE_PATH</code>環境變數時,會發生出乎意料的行為</li> <li>有時候,一個模組的相依性改變了,會導致<code>NODE_PATH</code>環境變數搜尋時會載入到不同的該模組的不同版本(甚至是不同的模組)</li> </ul> </li> <li>此外,Node會根據以下的順序來搜尋<code>GLOBAL_FOLDERS</code>清單<ul> <li><code>$HOME/.node_modules</code></li> <li><code>$HOME/.node_libraries</code></li> <li><code>$PREFIX/lib/node</code></li> <li>註: <code>$HOME</code>表示使用者的家目錄; <code>$PREFIX</code>表示Node已安裝<code>node_prefix</code></li> </ul> </li> <li>這些做法主要是基於具有歷史意義的原因</li> <li><strong>建議</strong> : 強烈鼓勵將相依的檔案放在本地端的<code>node_modules</code>資料夾,這會使載入模組的速度更快 &amp; 更可靠(reliably)<blockquote> <p><a href=https://nodejs.org/api/modules.html#modules_the_module_scope>The module scope</a></p> </blockquote> </li> </ul> </li> <li><a href=https://nodejs.org/api/modules.html#modules_dirname>__dirname</a><ul> <li>Returns: (string)</li> <li>該屬性會回傳當前模組的資料夾名稱(也就是所在路徑, directory name)</li> <li>這個屬性跟<a href=https://nodejs.org/api/path.html#path_path_dirname_path>path.dirname(path)</a>與<a href=https://nodejs.org/api/modules.html#modules_filename>__filename</a>是一樣的</li> <li>範例程式碼(從<code>/Users/mjr</code>的家目錄中,執行<code>node example.js</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-260-1><a id=__codelineno-260-1 name=__codelineno-260-1 href=#__codelineno-260-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>);</span>
</span><span id=__span-260-2><a id=__codelineno-260-2 name=__codelineno-260-2 href=#__codelineno-260-2></a><span class=c1>// Prints: /Users/mjr</span>
</span><span id=__span-260-3><a id=__codelineno-260-3 name=__codelineno-260-3 href=#__codelineno-260-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>dirname</span><span class=p>(</span><span class=nx>__filename</span><span class=p>));</span>
</span><span id=__span-260-4><a id=__codelineno-260-4 name=__codelineno-260-4 href=#__codelineno-260-4></a><span class=c1>// Prints: /Users/mjr</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/modules.html#modules_filename>__filename</a><ul> <li>Returns: (string)</li> <li>該屬性會回傳當前模組的檔案名稱(file name),也就是當前模組的絕對路徑(如果存在連結(symlink)的話,已解析過的)</li> <li>對於主程式,<code>__filename</code>不一定要與<code>CLI</code>中的檔案名稱相同</li> <li>範例程式碼(從<code>/Users/mjr</code>的家目錄中,執行<code>node example.js</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-261-1><a id=__codelineno-261-1 name=__codelineno-261-1 href=#__codelineno-261-1></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>__filename</span><span class=p>);</span>
</span><span id=__span-261-2><a id=__codelineno-261-2 name=__codelineno-261-2 href=#__codelineno-261-2></a><span class=c1>// Prints: /Users/mjr/example.js</span>
</span><span id=__span-261-3><a id=__codelineno-261-3 name=__codelineno-261-3 href=#__codelineno-261-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>);</span>
</span><span id=__span-261-4><a id=__codelineno-261-4 name=__codelineno-261-4 href=#__codelineno-261-4></a><span class=c1>// Prints: /Users/mjr</span>
</span></code></pre></div></li> <li>假如有兩個模組--- <code>a</code> &amp; <code>b</code>,然後<code>b</code>模組是<code>a</code>模組的相依項目(dependency),並且資料夾結構如下</li> <li><code>/Users/mjr/app/a.js</code></li> <li><code>/Users/mjr/app/node_modules/b/b.js</code></li> <li>關於以上的範例,<code>b.js</code>檔案的<code>__filename</code>屬性值會是<code>/Users/mjr/app/node_modules/b/b.js</code>; 另外,<code>a.js</code>檔案的<code>__filename</code>屬性值會是<code>/Users/mjr/app/a.js</code><blockquote> <p><a href=https://nodejs.org/api/modules.html#modules_the_module_object>The module object</a></p> </blockquote> </li> </ul> </li> <li>在每個模組中,<code>module</code>物件中閒置的(free)變數代表對於當前模組物件的參考。為了方便起見,<code>module.exports</code>也可以透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/modules.html#modules_exports>exports</a>這個全域物件來存取。<a href=https://nodejs.org/dist/latest-v15.x/docs/api/modules.html#modules_module>module</a>物件對於每一個模組來說,實際上是一個區域物件,而不是全域物件 &gt; object<ul> <li><a href=https://nodejs.org/api/modules.html#modules_module_exports>module.exports</a><ul> <li>該物件是由<a href=https://nodejs.org/api/module.html#module_modules_module_api>Module system</a>所建立的,有些時候這樣是不能被接受(not acceptable)的,許多人希望他們的模組是某個類別(class)的實例(instance)</li> <li>為此,可以將所需匯出的物件指派給<code>module.exports</code>物件</li> <li>將所需的物件指派給<code>exports</code>會簡單地重新綁定(simply rebind)<code>exports</code>區域變數,然而這可能不是我們所想要的結果</li> <li>範例程式碼(假設我們正在製作一個模組,叫做<code>a.js</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-262-1><a id=__codelineno-262-1 name=__codelineno-262-1 href=#__codelineno-262-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span><span id=__span-262-2><a id=__codelineno-262-2 name=__codelineno-262-2 href=#__codelineno-262-2></a>
</span><span id=__span-262-3><a id=__codelineno-262-3 name=__codelineno-262-3 href=#__codelineno-262-3></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>();</span>
</span><span id=__span-262-4><a id=__codelineno-262-4 name=__codelineno-262-4 href=#__codelineno-262-4></a>
</span><span id=__span-262-5><a id=__codelineno-262-5 name=__codelineno-262-5 href=#__codelineno-262-5></a><span class=c1>// Do some work, and after some time emit</span>
</span><span id=__span-262-6><a id=__codelineno-262-6 name=__codelineno-262-6 href=#__codelineno-262-6></a><span class=c1>// the &#39;ready&#39; event from the module itself.</span>
</span><span id=__span-262-7><a id=__codelineno-262-7 name=__codelineno-262-7 href=#__codelineno-262-7></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-262-8><a id=__codelineno-262-8 name=__codelineno-262-8 href=#__codelineno-262-8></a><span class=w>  </span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;ready&#39;</span><span class=p>);</span>
</span><span id=__span-262-9><a id=__codelineno-262-9 name=__codelineno-262-9 href=#__codelineno-262-9></a><span class=p>},</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
</span></code></pre></div></li> <li>這時我們就可以在另外一個檔案中引入上述的模組 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-263-1><a id=__codelineno-263-1 name=__codelineno-263-1 href=#__codelineno-263-1></a><span class=kd>const</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./a&#39;</span><span class=p>);</span>
</span><span id=__span-263-2><a id=__codelineno-263-2 name=__codelineno-263-2 href=#__codelineno-263-2></a><span class=nx>a</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;ready&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-263-3><a id=__codelineno-263-3 name=__codelineno-263-3 href=#__codelineno-263-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;module &quot;a&quot; is ready&#39;</span><span class=p>);</span>
</span><span id=__span-263-4><a id=__codelineno-263-4 name=__codelineno-263-4 href=#__codelineno-263-4></a><span class=p>});</span>
</span></code></pre></div></li> <li>情境說明( <strong>錯誤示範</strong> )---不會被執行</li> <li>因為指派給<code>module.exports</code>物件需要立即完成它,並且不能在任何回呼函式(callbacks)中完成</li> <li><code>x.js</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-264-1><a id=__codelineno-264-1 name=__codelineno-264-1 href=#__codelineno-264-1></a><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-264-2><a id=__codelineno-264-2 name=__codelineno-264-2 href=#__codelineno-264-2></a><span class=w>  </span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>a</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;hello&#39;</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-264-3><a id=__codelineno-264-3 name=__codelineno-264-3 href=#__codelineno-264-3></a><span class=p>},</span><span class=w> </span><span class=mf>0</span><span class=p>);</span>
</span></code></pre></div></li> <li><code>y.js</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-265-1><a id=__codelineno-265-1 name=__codelineno-265-1 href=#__codelineno-265-1></a><span class=kd>const</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./x&#39;</span><span class=p>);</span>
</span><span id=__span-265-2><a id=__codelineno-265-2 name=__codelineno-265-2 href=#__codelineno-265-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>a</span><span class=p>);</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/modules.html#modules_module_exports>exports shortcut</a><ul> <li>該變數只有在模組檔案層級(module's file-level)的範圍(scope)才可用,並且在模組被評估之前(evaluated)就會被<code>module.exports</code>物件指派其值</li> <li><strong>該變數允許一個捷徑,因此<code>module.exports.f = ...</code>可以被更簡潔地寫成<code>exports.f = ...</code></strong></li> <li>然而,請注意!就如同任何的變數一樣,如果有新的值被指派給<code>exports</code>變數,則它就不再被重新綁定到<code>module.exports</code>物件上</li> <li>範例程式碼 <code>js module.exports.hello = true; // Exported from require of module exports = { hello: false }; // Not exported, only available in the module</code></li> <li>當<code>module.exports</code>屬性完全被一個物件取代(replaced)時,通常也會重新指派給<code>exports</code>變數</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-266-1><a id=__codelineno-266-1 name=__codelineno-266-1 href=#__codelineno-266-1></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Constructor</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-266-2><a id=__codelineno-266-2 name=__codelineno-266-2 href=#__codelineno-266-2></a><span class=w>  </span><span class=c1>// ... etc.</span>
</span><span id=__span-266-3><a id=__codelineno-266-3 name=__codelineno-266-3 href=#__codelineno-266-3></a><span class=p>};</span>
</span></code></pre></div></li> <li>為了說明以上的這種行為,請想像有一個假設的(hypothetical)<code>require()</code>方法實作(implementation),該行為與實際的<code>require()</code>方法相當類似</li> <li>範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-267-1><a id=__codelineno-267-1 name=__codelineno-267-1 href=#__codelineno-267-1></a><span class=kd>function</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-267-2><a id=__codelineno-267-2 name=__codelineno-267-2 href=#__codelineno-267-2></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>module</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>exports</span><span class=o>:</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-267-3><a id=__codelineno-267-3 name=__codelineno-267-3 href=#__codelineno-267-3></a><span class=w>  </span><span class=p>((</span><span class=nx>module</span><span class=p>,</span><span class=w> </span><span class=nx>exports</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-267-4><a id=__codelineno-267-4 name=__codelineno-267-4 href=#__codelineno-267-4></a><span class=w>    </span><span class=c1>// Module code here. In this example, define a function.</span>
</span><span id=__span-267-5><a id=__codelineno-267-5 name=__codelineno-267-5 href=#__codelineno-267-5></a><span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>someFunc</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-267-6><a id=__codelineno-267-6 name=__codelineno-267-6 href=#__codelineno-267-6></a><span class=w>    </span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>someFunc</span><span class=p>;</span>
</span><span id=__span-267-7><a id=__codelineno-267-7 name=__codelineno-267-7 href=#__codelineno-267-7></a><span class=w>    </span><span class=c1>// At this point, exports is no longer a shortcut to module.exports, and</span>
</span><span id=__span-267-8><a id=__codelineno-267-8 name=__codelineno-267-8 href=#__codelineno-267-8></a><span class=w>    </span><span class=c1>// this module will still export an empty default object.</span>
</span><span id=__span-267-9><a id=__codelineno-267-9 name=__codelineno-267-9 href=#__codelineno-267-9></a><span class=w>    </span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>someFunc</span><span class=p>;</span>
</span><span id=__span-267-10><a id=__codelineno-267-10 name=__codelineno-267-10 href=#__codelineno-267-10></a><span class=w>    </span><span class=c1>// At this point, the module will now export someFunc, instead of the</span>
</span><span id=__span-267-11><a id=__codelineno-267-11 name=__codelineno-267-11 href=#__codelineno-267-11></a><span class=w>    </span><span class=c1>// default object.</span>
</span><span id=__span-267-12><a id=__codelineno-267-12 name=__codelineno-267-12 href=#__codelineno-267-12></a><span class=w>  </span><span class=p>})(</span><span class=nx>module</span><span class=p>,</span><span class=w> </span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>);</span>
</span><span id=__span-267-13><a id=__codelineno-267-13 name=__codelineno-267-13 href=#__codelineno-267-13></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>;</span>
</span><span id=__span-267-14><a id=__codelineno-267-14 name=__codelineno-267-14 href=#__codelineno-267-14></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> </li> </ul> <h3 id=timers><a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_timers>Timers</a><a class=headerlink href=#timers title="Permanent link">&para;</a></h3> <ul> <li><code>timer</code>模組會公開(exposes)一個全域的API,用來安排在將來的某個時段呼叫該函式所使用的。因為<code>timer</code>模組中的方法都是全域的,所以不用事先引用(<code>require('timers')</code>)模組後才能使用這些API</li> <li>Node的<code>timer</code>模組中的方法會實作(implement)類似於網頁瀏覽器(web browsers)中<code>timers</code>API,但會使用不同的實作方法</li> <li>而Node的<code>timer</code>模組會圍繞在<a href=https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#setimmediate-vs-settimeout>事件迴圈(event loop)</a>的基礎之上來實作不同的方法<blockquote> <p>method</p> </blockquote> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_setimmediate_callback_args>setImmediate(callback[, ...args])</a><ul> <li>args</li> <li>callback: (Function)<ul> <li>在本次的事件迴圈結束時,要呼叫的函式</li> </ul> </li> <li>...args: (any)<ul> <li>當回呼函式(callback)被呼叫時,可以選擇性地(optional)傳遞參數(arguments)</li> </ul> </li> <li>Returns: 可以傳遞給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_clearimmediate_immediate>clearImmediate()</a>方法所使用的<code>Timeout物件</code></li> <li>安排在<code>callback I/O事件</code>的立即執行(immediate execution)回呼函式</li> <li>當有多個<code>setImmediate()</code>方法被使用時,這些回呼函式會依照被建立的順序排隊等待被執行(queued for execution)。整個回呼隊列(callback queue)會處理每次的事件迴圈迭代(event loop iteration)</li> <li>如果有一個立即執行計時器(immediate timer)正在一個回呼執行(execution callback)中的隊列(queue)中,該立即執行計時器(immediate timer)就不會被觸發,直到下次事件迴圈迭代(the next event loop iteration)以前</li> <li>如果<code>setImmediate()</code>方法的<code>callback</code>參數不是一個函式(function)的話,會拋出一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/errors.html#errors_class_typeerror>TypeError</a>錯誤</li> <li><code>setImmediate()</code>方法有一個客製化的<code>promises</code>變形(custom variant for promises),可以利用Node的內建核心模組<code>Util</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/util.html#util_util_promisify_original>util.promisify()</a>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-268-1><a id=__codelineno-268-1 name=__codelineno-268-1 href=#__codelineno-268-1></a><span class=kd>const</span><span class=w> </span><span class=nx>util</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;util&#39;</span><span class=p>);</span>
</span><span id=__span-268-2><a id=__codelineno-268-2 name=__codelineno-268-2 href=#__codelineno-268-2></a><span class=kd>const</span><span class=w> </span><span class=nx>setImmediatePromise</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>util</span><span class=p>.</span><span class=nx>promisify</span><span class=p>(</span><span class=nx>setImmediate</span><span class=p>);</span>
</span><span id=__span-268-3><a id=__codelineno-268-3 name=__codelineno-268-3 href=#__codelineno-268-3></a>
</span><span id=__span-268-4><a id=__codelineno-268-4 name=__codelineno-268-4 href=#__codelineno-268-4></a><span class=nx>setImmediatePromise</span><span class=p>(</span><span class=s1>&#39;foobar&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>value</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-268-5><a id=__codelineno-268-5 name=__codelineno-268-5 href=#__codelineno-268-5></a><span class=w>  </span><span class=c1>// value === &#39;foobar&#39; (passing values is optional)</span>
</span><span id=__span-268-6><a id=__codelineno-268-6 name=__codelineno-268-6 href=#__codelineno-268-6></a><span class=w>  </span><span class=c1>// This is executed after all I/O callbacks.</span>
</span><span id=__span-268-7><a id=__codelineno-268-7 name=__codelineno-268-7 href=#__codelineno-268-7></a><span class=p>});</span>
</span><span id=__span-268-8><a id=__codelineno-268-8 name=__codelineno-268-8 href=#__codelineno-268-8></a>
</span><span id=__span-268-9><a id=__codelineno-268-9 name=__codelineno-268-9 href=#__codelineno-268-9></a><span class=c1>// Or with async function</span>
</span><span id=__span-268-10><a id=__codelineno-268-10 name=__codelineno-268-10 href=#__codelineno-268-10></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>timerExample</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-268-11><a id=__codelineno-268-11 name=__codelineno-268-11 href=#__codelineno-268-11></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before I/O callbacks&#39;</span><span class=p>);</span>
</span><span id=__span-268-12><a id=__codelineno-268-12 name=__codelineno-268-12 href=#__codelineno-268-12></a><span class=w>  </span><span class=k>await</span><span class=w> </span><span class=nx>setImmediatePromise</span><span class=p>();</span>
</span><span id=__span-268-13><a id=__codelineno-268-13 name=__codelineno-268-13 href=#__codelineno-268-13></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;After I/O callbacks&#39;</span><span class=p>);</span>
</span><span id=__span-268-14><a id=__codelineno-268-14 name=__codelineno-268-14 href=#__codelineno-268-14></a><span class=p>}</span>
</span><span id=__span-268-15><a id=__codelineno-268-15 name=__codelineno-268-15 href=#__codelineno-268-15></a><span class=nx>timerExample</span><span class=p>();</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_setinterval_callback_delay_args>setInterval(callback[, delay[, ...args]])</a><ul> <li>args</li> <li>callback: (Function)<ul> <li>設定當計時器(timer)經過設定好的間隔時間(elapses)後,要 <strong>重複執行</strong> 的回呼函式(callback function)</li> </ul> </li> <li>delay: (number)<ul> <li>呼叫回呼函式(callback)之前要間隔的毫秒數</li> <li>預設值: <code>1</code></li> <li>當該參數的值大於<code>2147483647</code>或是小於<code>1</code>時,都會被設定為<code>1</code>; 若該參數為非整數的值,會被無條件捨去後,變成整數</li> </ul> </li> <li><code>...args</code>: (any)<ul> <li>當回呼函式(callback)被呼叫時,可以選擇性地(optional)傳遞參數(arguments)</li> </ul> </li> <li>Returns: 可以傳遞給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_clearinterval_timeout>clearInterval()</a>方法所使用的<code>Timeout物件</code></li> <li>安排一個會每<code>n</code>毫秒後,重複(repeated)執行的回呼函式(callback function)</li> <li>如果<code>setInterval()</code>方法的<code>callback</code>參數不是一個函式(function)的話,會拋出一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/errors.html#errors_class_typeerror>TypeError</a>錯誤</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_setinterval_callback_delay_args>setTimeout(callback[, delay[, ...args]])</a><ul> <li>args</li> <li>callback: (function)<ul> <li>設定當計時器(timer)經過設定好的間隔時間(elapses)後,要 <strong>執行一次</strong> 的回呼函式(callback function)</li> </ul> </li> <li>delay: (number)<ul> <li>呼叫回呼函式(callback)之前要經過的毫秒數</li> <li>預設值: <code>1</code></li> <li>當該參數的值大於<code>2147483647</code>或是小於<code>1</code>時,都會被設定為<code>1</code>; 若該參數為非整數的值,會被無條件捨去後,變成整數</li> </ul> </li> <li>...args: (any)<ul> <li>當回呼函式(callback)被呼叫時,可以選擇性地(optional)傳遞參數(arguments)</li> </ul> </li> <li>Returns: 可以傳遞給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/timers.html#timers_cleartimeout_timeout>clearTimeout()</a>方法所使用的<code>Timeout物件</code></li> <li>安排一個當經過<code>n</code>毫秒後,會執行的回呼函式(callback function)</li> <li>注意: <code>setTimeout()</code>方法要呼叫的回呼函式可能不會在設定好的毫秒數後,被精確地(precisely)呼叫。Node <strong>不能保證</strong> 回呼函式被呼叫的精確時間(exact timing)以及順序(ordering)。只能盡量讓要呼叫的回呼函式(callback)在設定好的時間後被觸發</li> <li>如果<code>setTimeout()</code>方法的<code>callback</code>參數不是一個函式(function)的話,會拋出一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/errors.html#errors_class_typeerror>TypeError</a>錯誤</li> <li><code>setTimeout()</code>方法有一個客製化的<code>promises</code>變形(custom variant for promises),可以利用Node的內建核心模組<code>Util</code>中的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/util.html#util_util_promisify_original>util.promisify()</a>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-269-1><a id=__codelineno-269-1 name=__codelineno-269-1 href=#__codelineno-269-1></a><span class=kd>const</span><span class=w> </span><span class=nx>util</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;util&#39;</span><span class=p>);</span>
</span><span id=__span-269-2><a id=__codelineno-269-2 name=__codelineno-269-2 href=#__codelineno-269-2></a><span class=kd>const</span><span class=w> </span><span class=nx>setTimeoutPromise</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>util</span><span class=p>.</span><span class=nx>promisify</span><span class=p>(</span><span class=nx>setTimeout</span><span class=p>);</span>
</span><span id=__span-269-3><a id=__codelineno-269-3 name=__codelineno-269-3 href=#__codelineno-269-3></a>
</span><span id=__span-269-4><a id=__codelineno-269-4 name=__codelineno-269-4 href=#__codelineno-269-4></a><span class=nx>setTimeoutPromise</span><span class=p>(</span><span class=mf>40</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;foobar&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>value</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-269-5><a id=__codelineno-269-5 name=__codelineno-269-5 href=#__codelineno-269-5></a><span class=w>  </span><span class=c1>// value === &#39;foobar&#39; (passing values is optional)</span>
</span><span id=__span-269-6><a id=__codelineno-269-6 name=__codelineno-269-6 href=#__codelineno-269-6></a><span class=w>  </span><span class=c1>// This is executed after about 40 milliseconds.</span>
</span><span id=__span-269-7><a id=__codelineno-269-7 name=__codelineno-269-7 href=#__codelineno-269-7></a><span class=p>});</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=events><a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_events>Events</a><a class=headerlink href=#events title="Permanent link">&para;</a></h3> <ul> <li>大部分Node中的核心API都是基於慣用的(idiomatic)非同步(asynchronous)事件驅動(event-driven)架構(architecture)。在這種架構中,某些類型的物件(被稱為<code>emitters</code>)會發出(emit)被命名的事件(named events),導致(cause)函式物件(<code>Function</code> object, =&gt; 也就是監聽器(listeners))被呼叫(to be called)</li> <li>舉例來說,每當有同級連接(peer connects)時,都會發出(emit)一次事件(event)到一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/net.html#net_class_net_server>net.Server</a>物件(object); 當檔案被開啟(opened)時,會有一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_class_fs_readstream>fs.ReadStream</a>實例(instance)會發出(emit)一個事件(event); 每當(whenever)有資料可以被讀取時,就會發出(emit)一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html>stream</a>事件(event)</li> <li>發出的事件(emit events)中的所有物件(objects)都是<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_class_eventemitter>EventEmitter</a>類別(class)的實例(instances)。這些物件會公開(expose)一個<code>emitter.on()</code>函式(function),這個函式允許(allows)一個或多個函式附加到(attached)由該物件(by object)所發出(emitted)的被命名的事件(named events)上。 <strong>通常,事件名稱都是用駝峰命名法(camel-cased)來命名的字串(strings),但是可以使用任何有效的(valid)Javascript屬性鍵(property key)</strong></li> <li>當<code>EventEmitter</code>物件發出(emits)一個事件(event),所有被附加到(attached)那個特定的(specific)事件上的函式(functions)都會被同步地呼叫(called synchronously)。被呼叫的監聽器(the called listeners)所返回(returned)的任何值都會被忽略(ignored)和丟棄(discarded)掉</li> <li>以下的範例程式碼會展示(shows)具有單一個(single)監聽器(listener)的簡單<code>EventEmitter</code>物件實例(instance)。<code>eventEmitter.on()</code>方法是用來註冊監聽器(register listeners),而<code>eventEmitter.emit()</code>方法則是用來觸發(trigger)一個事件(event) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-270-1><a id=__codelineno-270-1 name=__codelineno-270-1 href=#__codelineno-270-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span><span id=__span-270-2><a id=__codelineno-270-2 name=__codelineno-270-2 href=#__codelineno-270-2></a>
</span><span id=__span-270-3><a id=__codelineno-270-3 name=__codelineno-270-3 href=#__codelineno-270-3></a><span class=kd>class</span><span class=w> </span><span class=nx>MyEmitter</span><span class=w> </span><span class=k>extends</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-270-4><a id=__codelineno-270-4 name=__codelineno-270-4 href=#__codelineno-270-4></a>
</span><span id=__span-270-5><a id=__codelineno-270-5 name=__codelineno-270-5 href=#__codelineno-270-5></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-270-6><a id=__codelineno-270-6 name=__codelineno-270-6 href=#__codelineno-270-6></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-270-7><a id=__codelineno-270-7 name=__codelineno-270-7 href=#__codelineno-270-7></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;an event occurred!&#39;</span><span class=p>);</span>
</span><span id=__span-270-8><a id=__codelineno-270-8 name=__codelineno-270-8 href=#__codelineno-270-8></a><span class=p>});</span>
</span><span id=__span-270-9><a id=__codelineno-270-9 name=__codelineno-270-9 href=#__codelineno-270-9></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span></code></pre></div><blockquote> <p>傳遞參數與<code>this</code>給事件監聽器(Passing arguments and this to listeners)</p> </blockquote> </li> <li><code>eventEmitter.emit()</code>方法允許將任意一組參數(arguments)傳遞給事件監聽器函式(listener functions)。</li> <li>請記住! 在呼叫普通的(ordinary)事件監聽器函式(listener function)時,<code>this</code>這個關鍵字會被刻意地(intentionally)被設定作為引用(reference)事件監聽器(listener)所附加的<code>EventEmitter</code>實例(instance) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-271-1><a id=__codelineno-271-1 name=__codelineno-271-1 href=#__codelineno-271-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-271-2><a id=__codelineno-271-2 name=__codelineno-271-2 href=#__codelineno-271-2></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=kd>function</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-271-3><a id=__codelineno-271-3 name=__codelineno-271-3 href=#__codelineno-271-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>myEmitter</span><span class=p>);</span>
</span><span id=__span-271-4><a id=__codelineno-271-4 name=__codelineno-271-4 href=#__codelineno-271-4></a><span class=w>  </span><span class=c1>// Prints:</span>
</span><span id=__span-271-5><a id=__codelineno-271-5 name=__codelineno-271-5 href=#__codelineno-271-5></a><span class=w>  </span><span class=c1>//   a b MyEmitter {</span>
</span><span id=__span-271-6><a id=__codelineno-271-6 name=__codelineno-271-6 href=#__codelineno-271-6></a><span class=w>  </span><span class=c1>//     domain: null,</span>
</span><span id=__span-271-7><a id=__codelineno-271-7 name=__codelineno-271-7 href=#__codelineno-271-7></a><span class=w>  </span><span class=c1>//     _events: { event: [Function] },</span>
</span><span id=__span-271-8><a id=__codelineno-271-8 name=__codelineno-271-8 href=#__codelineno-271-8></a><span class=w>  </span><span class=c1>//     _eventsCount: 1,</span>
</span><span id=__span-271-9><a id=__codelineno-271-9 name=__codelineno-271-9 href=#__codelineno-271-9></a><span class=w>  </span><span class=c1>//     _maxListeners: undefined } true</span>
</span><span id=__span-271-10><a id=__codelineno-271-10 name=__codelineno-271-10 href=#__codelineno-271-10></a><span class=p>});</span>
</span><span id=__span-271-11><a id=__codelineno-271-11 name=__codelineno-271-11 href=#__codelineno-271-11></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>);</span>
</span></code></pre></div></li> <li>可以使用ES6的箭頭函式(Arrow Functions)來作為事件監聽器(listeners),然而當這麼做時,<code>this</code>關鍵字就不會再引用(reference)<code>EventEmitter</code>實例(instance) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-272-1><a id=__codelineno-272-1 name=__codelineno-272-1 href=#__codelineno-272-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-272-2><a id=__codelineno-272-2 name=__codelineno-272-2 href=#__codelineno-272-2></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-272-3><a id=__codelineno-272-3 name=__codelineno-272-3 href=#__codelineno-272-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>);</span>
</span><span id=__span-272-4><a id=__codelineno-272-4 name=__codelineno-272-4 href=#__codelineno-272-4></a><span class=w>  </span><span class=c1>// Prints: a b {}</span>
</span><span id=__span-272-5><a id=__codelineno-272-5 name=__codelineno-272-5 href=#__codelineno-272-5></a><span class=p>});</span>
</span><span id=__span-272-6><a id=__codelineno-272-6 name=__codelineno-272-6 href=#__codelineno-272-6></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>);</span>
</span></code></pre></div><blockquote> <p>非同步與同步(Asynchronous vs. synchronous)</p> </blockquote> </li> <li><code>Eventemitter</code>實例(instance)會同步地(synchronously)依據所有的事件監聽器(listeners)的照序(in the order)呼叫,這樣可以確保(ensures)事件的正確排序(proper sequencing),並且能避免爭用條件(race conditions)與邏輯錯誤(logic error)<ul> <li>等到適當時機(appropriate)時,事件監聽器函式(listener functions)可以利用<code>setImmediate()</code>方法 &amp; <code>process.nextTick()</code>方法來切換到非同步操作模式(asynchronous mode of operation) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-273-1><a id=__codelineno-273-1 name=__codelineno-273-1 href=#__codelineno-273-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-273-2><a id=__codelineno-273-2 name=__codelineno-273-2 href=#__codelineno-273-2></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-273-3><a id=__codelineno-273-3 name=__codelineno-273-3 href=#__codelineno-273-3></a><span class=w>  </span><span class=nx>setImmediate</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-273-4><a id=__codelineno-273-4 name=__codelineno-273-4 href=#__codelineno-273-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;this happens asynchronously&#39;</span><span class=p>);</span>
</span><span id=__span-273-5><a id=__codelineno-273-5 name=__codelineno-273-5 href=#__codelineno-273-5></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-273-6><a id=__codelineno-273-6 name=__codelineno-273-6 href=#__codelineno-273-6></a><span class=p>});</span>
</span><span id=__span-273-7><a id=__codelineno-273-7 name=__codelineno-273-7 href=#__codelineno-273-7></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;b&#39;</span><span class=p>);</span>
</span></code></pre></div><blockquote> <p>僅處理事件"1次"(Handling events only once)</p> </blockquote> </li> </ul> </li> <li>若利用<code>eventEmitter.on()</code>方法來註冊(registered)一個事件監聽器(listener)時,則當每次(every time)發出(emitted)被命名的事件(named event)時,都會呼叫(invoked)該事件監聽器(listener) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-274-1><a id=__codelineno-274-1 name=__codelineno-274-1 href=#__codelineno-274-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-274-2><a id=__codelineno-274-2 name=__codelineno-274-2 href=#__codelineno-274-2></a><span class=kd>let</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span>
</span><span id=__span-274-3><a id=__codelineno-274-3 name=__codelineno-274-3 href=#__codelineno-274-3></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-274-4><a id=__codelineno-274-4 name=__codelineno-274-4 href=#__codelineno-274-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=o>++</span><span class=nx>m</span><span class=p>);</span>
</span><span id=__span-274-5><a id=__codelineno-274-5 name=__codelineno-274-5 href=#__codelineno-274-5></a><span class=p>});</span>
</span><span id=__span-274-6><a id=__codelineno-274-6 name=__codelineno-274-6 href=#__codelineno-274-6></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span><span id=__span-274-7><a id=__codelineno-274-7 name=__codelineno-274-7 href=#__codelineno-274-7></a><span class=c1>// Prints: 1</span>
</span><span id=__span-274-8><a id=__codelineno-274-8 name=__codelineno-274-8 href=#__codelineno-274-8></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span><span id=__span-274-9><a id=__codelineno-274-9 name=__codelineno-274-9 href=#__codelineno-274-9></a><span class=c1>// Prints: 2</span>
</span></code></pre></div></li> <li>若利用<code>eventEmitter.once()</code>方法的話,可以註冊(register)一個針對特定事件(particular event)才會 <strong>最多被呼叫一次</strong>(called at most once)的事件監聽器(listener)。而一旦這個特定事件被發出(emitted)時,該事件監聽器(listener)就會被取消註冊(unregistered)後,再呼叫(called)該事件監聽器(listener) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-275-1><a id=__codelineno-275-1 name=__codelineno-275-1 href=#__codelineno-275-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-275-2><a id=__codelineno-275-2 name=__codelineno-275-2 href=#__codelineno-275-2></a><span class=kd>let</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span>
</span><span id=__span-275-3><a id=__codelineno-275-3 name=__codelineno-275-3 href=#__codelineno-275-3></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-275-4><a id=__codelineno-275-4 name=__codelineno-275-4 href=#__codelineno-275-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=o>++</span><span class=nx>m</span><span class=p>);</span>
</span><span id=__span-275-5><a id=__codelineno-275-5 name=__codelineno-275-5 href=#__codelineno-275-5></a><span class=p>});</span>
</span><span id=__span-275-6><a id=__codelineno-275-6 name=__codelineno-275-6 href=#__codelineno-275-6></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span><span id=__span-275-7><a id=__codelineno-275-7 name=__codelineno-275-7 href=#__codelineno-275-7></a><span class=c1>// Prints: 1</span>
</span><span id=__span-275-8><a id=__codelineno-275-8 name=__codelineno-275-8 href=#__codelineno-275-8></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span><span id=__span-275-9><a id=__codelineno-275-9 name=__codelineno-275-9 href=#__codelineno-275-9></a><span class=c1>// Ignored</span>
</span></code></pre></div><blockquote> <p>錯誤事件(Error events)</p> </blockquote> </li> <li>當某個<code>EventEmitter</code>實例(instance)發生錯誤(error occurs)時,典型的動作(typical action)是發出(emitted)一個<code>error</code>事件(event)。而這些<code>error</code>事件(event)會在Node中被視為(treated as)特殊情況(special cases)</li> <li>若一個<code>Eventemitter</code>實例(instance)之中,不存在至少(at least)一個用來註冊(registered)給<code>error</code>事件(event)的事件監聽器(listener)的話,同時也已經發出(emitted)了一個<code>error</code>事件(event),這時該<code>error</code>事件(event)就會被拋出(thrown),並且堆疊追蹤(stack trace)就會被打印(printed)出,最後Node的進程(process)就會退出(exits) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-276-1><a id=__codelineno-276-1 name=__codelineno-276-1 href=#__codelineno-276-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-276-2><a id=__codelineno-276-2 name=__codelineno-276-2 href=#__codelineno-276-2></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;whoops!&#39;</span><span class=p>));</span>
</span><span id=__span-276-3><a id=__codelineno-276-3 name=__codelineno-276-3 href=#__codelineno-276-3></a><span class=c1>// Throws and crashes Node.js</span>
</span></code></pre></div></li> <li>為了防止(To guard against) Node的進程(process)崩潰(crashing),可以使用Node的<a href=https://nodejs.org/api/domain.html#domain_domain>Domain</a>內建核心模組<ul> <li>請注意! <code>Domain</code>模組已棄置(deprecated)</li> </ul> </li> <li>作為最佳的實踐做法(As a best practice),事件監聽器(listeners)應該總是被新增到<code>error</code>事件(event)上 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-277-1><a id=__codelineno-277-1 name=__codelineno-277-1 href=#__codelineno-277-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-277-2><a id=__codelineno-277-2 name=__codelineno-277-2 href=#__codelineno-277-2></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-277-3><a id=__codelineno-277-3 name=__codelineno-277-3 href=#__codelineno-277-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;whoops! there was an error&#39;</span><span class=p>);</span>
</span><span id=__span-277-4><a id=__codelineno-277-4 name=__codelineno-277-4 href=#__codelineno-277-4></a><span class=p>});</span>
</span><span id=__span-277-5><a id=__codelineno-277-5 name=__codelineno-277-5 href=#__codelineno-277-5></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;whoops!&#39;</span><span class=p>));</span>
</span><span id=__span-277-6><a id=__codelineno-277-6 name=__codelineno-277-6 href=#__codelineno-277-6></a><span class=c1>// Prints: whoops! there was an error</span>
</span></code></pre></div></li> <li>我們可以透過<a href=https://nodejs.org/api/events.html#events_events_errormonitor>events.errorMonitor</a>符號(symbol)來安裝一個事件監聽器(listener),以用來監測<code>error</code>事件(event),而不用(without)消耗(consuming)發出的錯誤(emitted error) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-278-1><a id=__codelineno-278-1 name=__codelineno-278-1 href=#__codelineno-278-1></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>,</span><span class=w> </span><span class=nx>errorMonitor</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span><span id=__span-278-2><a id=__codelineno-278-2 name=__codelineno-278-2 href=#__codelineno-278-2></a>
</span><span id=__span-278-3><a id=__codelineno-278-3 name=__codelineno-278-3 href=#__codelineno-278-3></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>();</span>
</span><span id=__span-278-4><a id=__codelineno-278-4 name=__codelineno-278-4 href=#__codelineno-278-4></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=nx>errorMonitor</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-278-5><a id=__codelineno-278-5 name=__codelineno-278-5 href=#__codelineno-278-5></a><span class=w>  </span><span class=nx>MyMonitoringTool</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span><span id=__span-278-6><a id=__codelineno-278-6 name=__codelineno-278-6 href=#__codelineno-278-6></a><span class=p>});</span>
</span><span id=__span-278-7><a id=__codelineno-278-7 name=__codelineno-278-7 href=#__codelineno-278-7></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;whoops!&#39;</span><span class=p>));</span>
</span><span id=__span-278-8><a id=__codelineno-278-8 name=__codelineno-278-8 href=#__codelineno-278-8></a><span class=c1>// Still throws and crashes Node.js</span>
</span></code></pre></div><blockquote> <p>Class</p> </blockquote> </li> <li><a href=https://nodejs.org/api/events.html#events_class_eventemitter>EventEmitter</a><ul> <li><code>EventEmitter</code>類別(class)是被用來定義 &amp; 公開<code>Events</code>模組(module)的</li> <li>可以這樣引用<code>EvenEmitter</code>類別(class) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-279-1><a id=__codelineno-279-1 name=__codelineno-279-1 href=#__codelineno-279-1></a><span class=kd>const</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span></code></pre></div></li> <li>當新的事件監聽器(new listeners)被新增時,所有的<code>EvenEmitter</code>類別(class)都會發出<a href=https://nodejs.org/api/events.html#events_event_newlistener>newListener</a>這個事件(event); 並且當已經存在的(existed)事件監聽器(listeners)被移除時(removed),會發出<a href=https://nodejs.org/api/events.html#events_event_removelistener>removeListener</a>這個事件</li> <li><code>EventEmitter</code>類別(class)可以支援<a href=https://nodejs.org/api/events.html#events_capture_rejections_of_promises>captureRejections</a>這個選項(option)</li> <li><code>captureRejections</code>: (boolean)<ul> <li>這個選項能夠自動地(automatic)捕抓(capturing)被拒絕(rejection)的<code>Promise</code>物件</li> <li>預設值: <code>false</code></li> </ul> </li> </ul> </li> <li> <blockquote> <p>Event</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/events.html#events_event_newlistener>newListener</a></li> <li>args<ul> <li>eventName: (string) | (symbol)</li> <li>正在監聽的事件(event)的名稱</li> <li>listener: (Function)</li> <li>事件處理器(event handler)函式(function)</li> </ul> </li> <li><code>EventEmitter</code>實例(instance)會在當有一個事件監聽器(listener)被加入到自身內部的(internal)事件監聽器們(listeners)陣列(array)之前,先發出(emit)一個自身(own)的<code>newListener</code>事件(event)</li> <li>為了<code>newListener</code>事件(event)而註冊(registered)的事件監聽器們(listeners)將會傳遞(passed)事件名稱與要新增(being added)的事件監聽器(listener)的參考(reference)</li> <li>事實上,在新增事件監聽器(listener)之前觸發(triggered)的事件中有一個微妙(subtle)卻很重要(important)的副作用(side effect)</li> <li>任何用來註冊(registered)給同名(same <code>name</code>)的<code>newListener</code>回呼函式(callback)之內(within)的額外(additional)的事件監聽器們(listeners),都會在那些被新增(added)到進程中(process)的事件監聽器"之前"就會被插入 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-280-1><a id=__codelineno-280-1 name=__codelineno-280-1 href=#__codelineno-280-1></a><span class=kd>class</span><span class=w> </span><span class=nx>MyEmitter</span><span class=w> </span><span class=k>extends</span><span class=w> </span><span class=nx>EventEmitter</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-280-2><a id=__codelineno-280-2 name=__codelineno-280-2 href=#__codelineno-280-2></a>
</span><span id=__span-280-3><a id=__codelineno-280-3 name=__codelineno-280-3 href=#__codelineno-280-3></a><span class=kd>const</span><span class=w> </span><span class=nx>myEmitter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MyEmitter</span><span class=p>();</span>
</span><span id=__span-280-4><a id=__codelineno-280-4 name=__codelineno-280-4 href=#__codelineno-280-4></a><span class=c1>// Only do this once so we don&#39;t loop forever</span>
</span><span id=__span-280-5><a id=__codelineno-280-5 name=__codelineno-280-5 href=#__codelineno-280-5></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;newListener&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>event</span><span class=p>,</span><span class=w> </span><span class=nx>listener</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-280-6><a id=__codelineno-280-6 name=__codelineno-280-6 href=#__codelineno-280-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>event</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;event&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-280-7><a id=__codelineno-280-7 name=__codelineno-280-7 href=#__codelineno-280-7></a><span class=w>    </span><span class=c1>// Insert a new listener in front</span>
</span><span id=__span-280-8><a id=__codelineno-280-8 name=__codelineno-280-8 href=#__codelineno-280-8></a><span class=w>    </span><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-280-9><a id=__codelineno-280-9 name=__codelineno-280-9 href=#__codelineno-280-9></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>);</span>
</span><span id=__span-280-10><a id=__codelineno-280-10 name=__codelineno-280-10 href=#__codelineno-280-10></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-280-11><a id=__codelineno-280-11 name=__codelineno-280-11 href=#__codelineno-280-11></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-280-12><a id=__codelineno-280-12 name=__codelineno-280-12 href=#__codelineno-280-12></a><span class=p>});</span>
</span><span id=__span-280-13><a id=__codelineno-280-13 name=__codelineno-280-13 href=#__codelineno-280-13></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-280-14><a id=__codelineno-280-14 name=__codelineno-280-14 href=#__codelineno-280-14></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>);</span>
</span><span id=__span-280-15><a id=__codelineno-280-15 name=__codelineno-280-15 href=#__codelineno-280-15></a><span class=p>});</span>
</span><span id=__span-280-16><a id=__codelineno-280-16 name=__codelineno-280-16 href=#__codelineno-280-16></a><span class=nx>myEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>);</span>
</span><span id=__span-280-17><a id=__codelineno-280-17 name=__codelineno-280-17 href=#__codelineno-280-17></a><span class=c1>// Prints:</span>
</span><span id=__span-280-18><a id=__codelineno-280-18 name=__codelineno-280-18 href=#__codelineno-280-18></a><span class=c1>//   B</span>
</span><span id=__span-280-19><a id=__codelineno-280-19 name=__codelineno-280-19 href=#__codelineno-280-19></a><span class=c1>//   A</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/api/events.html#events_event_removelistener>removeListener</a></li> <li>args<ul> <li>eventName: (string) | (symbol)</li> <li>事件(event)的名稱</li> <li>listener: (Function)</li> <li>事件處理器(event handler)函式(function)</li> </ul> </li> <li>當事件監聽器(listener)被移除(removed)後,會發出(emitted)一個<code>removeListener</code>事件(event)</li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_on_eventname_listener>emitter.on(eventName, listener)</a><ul> <li>args</li> <li>eventName: (string) | (symbol)<ul> <li>事件(event)的名稱</li> </ul> </li> <li>listener: (Function)<ul> <li>該事件監聽器要執行的回呼函式(callback function)</li> </ul> </li> <li>Returns: (<code>EventEmitter</code>)類別(class)</li> <li>在指定的事件(event, 也就是<code>eventName</code>參數的值)中的事件監聽器(listeners)陣列(array)的結尾(end)上新增一個事件監聽器函式(<code>listener</code> function, 也就是<code>listener</code>參數的值)</li> <li>不會去檢查是否有該事件監聽器要執行的回呼函式(callback function)已經被新增了</li> <li>若多次呼叫(Multiple calls)並傳遞相同的<code>eventName</code>與<code>listener</code>兩個參數值的組合(combination)的話,將導致(result in)此事件監聽器(listener)會被多次(multiple times)呼叫(called) &amp; 新增(added) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-281-1><a id=__codelineno-281-1 name=__codelineno-281-1 href=#__codelineno-281-1></a><span class=nx>server</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>stream</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-281-2><a id=__codelineno-281-2 name=__codelineno-281-2 href=#__codelineno-281-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;someone connected!&#39;</span><span class=p>);</span>
</span><span id=__span-281-3><a id=__codelineno-281-3 name=__codelineno-281-3 href=#__codelineno-281-3></a><span class=p>});</span>
</span></code></pre></div></li> <li>以上的範例程式碼可以看出來,<code>emitter.on()</code>方法將會回傳(returns)一個對<code>EventEmitter</code>類別(class)的參考(reference),以便讓這個呼叫(calls)可以被串連使用(chained)</li> <li>預設情況下,事件監聽器(event listeners)們會依照它們被新增的順序(in the order they are added)呼叫(invoked)</li> <li>另一個替代方案(alternative)是利用<a href=https://nodejs.org/api/events.html#events_emitter_prependlistener_eventname_listener>emitter.prependListener(eventName, listener)</a>方法來將一個指定的事件監聽器(event listener)新增到整個事件監聽器陣列(the listeners array)的最前面(beginning) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-282-1><a id=__codelineno-282-1 name=__codelineno-282-1 href=#__codelineno-282-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>();</span>
</span><span id=__span-282-2><a id=__codelineno-282-2 name=__codelineno-282-2 href=#__codelineno-282-2></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>));</span>
</span><span id=__span-282-3><a id=__codelineno-282-3 name=__codelineno-282-3 href=#__codelineno-282-3></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>prependListener</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;b&#39;</span><span class=p>));</span>
</span><span id=__span-282-4><a id=__codelineno-282-4 name=__codelineno-282-4 href=#__codelineno-282-4></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span><span id=__span-282-5><a id=__codelineno-282-5 name=__codelineno-282-5 href=#__codelineno-282-5></a><span class=c1>// Prints:</span>
</span><span id=__span-282-6><a id=__codelineno-282-6 name=__codelineno-282-6 href=#__codelineno-282-6></a><span class=c1>//   b</span>
</span><span id=__span-282-7><a id=__codelineno-282-7 name=__codelineno-282-7 href=#__codelineno-282-7></a><span class=c1>//   a</span>
</span></code></pre></div></li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_emit_eventname_args>emitter.emit(eventName[, ...args])</a><ul> <li>args</li> <li>eventName: (string) | (symbol)</li> <li>...args: (any)</li> <li>Returns: (boolean)<ul> <li>當該指定的事件名稱(event, 也就是<code>eventName</code>參數的值)有事件監聽器(listeners)時,回傳<code>true</code>; 反之,則回傳<code>false</code></li> </ul> </li> <li>同步地(Synchronously)呼叫(calls)被註冊(registered)給指定的事件(event, 也就是<code>eventName</code>參數的值)中的每一個(each of)事件監聽器(listeners),並依照它們被註冊(registered)的順序(in the order),傳遞(passing)給每個事件監聽器(to each)需要的參數(supplied arguments)</li> </ul> </li> <li><a href=https://nodejs.org/api/events.html#events_emitter_once_eventname_listener>emitter.once(eventName, listener)</a><ul> <li>args</li> <li>eventName: (string) | (symbol)<ul> <li>事件(event)的名稱</li> </ul> </li> <li>listener: (Function)<ul> <li>該事件監聽器要執行的回呼函式(callback function)</li> </ul> </li> <li>Returns: (<code>EventEmitter</code>)類別(class)</li> <li>新增一個 <strong>一次性(one-time)</strong> 的事件監聽器函式(<code>listener</code> function, 也就是<code>listener</code>參數的值)給指定的事件(event, 也就是<code>eventName</code>參數的值)</li> <li>當下一次該指定的<code>eventName</code>事件被觸發(triggered)時,這個 <strong>一次性(one-time)</strong> 的事件監聽器函式(listener)就會被呼叫(invoked)並移除(removed) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-283-1><a id=__codelineno-283-1 name=__codelineno-283-1 href=#__codelineno-283-1></a><span class=nx>server</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>stream</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-283-2><a id=__codelineno-283-2 name=__codelineno-283-2 href=#__codelineno-283-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Ah, we have our first user!&#39;</span><span class=p>);</span>
</span><span id=__span-283-3><a id=__codelineno-283-3 name=__codelineno-283-3 href=#__codelineno-283-3></a><span class=p>});</span>
</span></code></pre></div></li> <li>以上的範例程式碼可以看出來,<code>emitter.on()</code>方法將會回傳(returns)一個對<code>EventEmitter</code>類別(class)的參考(reference),以便讓這個呼叫(calls)可以被串連使用(chained)</li> <li>預設情況下,事件監聽器(event listeners)們會依照它們被新增的順序(in the order they are added)呼叫(invoked)</li> <li>另一個替代方案(alternative)是利用<a href=https://nodejs.org/api/events.html#events_emitter_prependlistener_eventname_listener>emitter.prependListener(eventName, listener)</a>方法來將一個指定的事件監聽器(event listener)新增到整個事件監聽器陣列(the listeners array)的最前面(beginning) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-284-1><a id=__codelineno-284-1 name=__codelineno-284-1 href=#__codelineno-284-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myEE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>EventEmitter</span><span class=p>();</span>
</span><span id=__span-284-2><a id=__codelineno-284-2 name=__codelineno-284-2 href=#__codelineno-284-2></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>));</span>
</span><span id=__span-284-3><a id=__codelineno-284-3 name=__codelineno-284-3 href=#__codelineno-284-3></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>prependOnceListener</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;b&#39;</span><span class=p>));</span>
</span><span id=__span-284-4><a id=__codelineno-284-4 name=__codelineno-284-4 href=#__codelineno-284-4></a><span class=nx>myEE</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>);</span>
</span><span id=__span-284-5><a id=__codelineno-284-5 name=__codelineno-284-5 href=#__codelineno-284-5></a><span class=c1>// Prints:</span>
</span><span id=__span-284-6><a id=__codelineno-284-6 name=__codelineno-284-6 href=#__codelineno-284-6></a><span class=c1>//   b</span>
</span><span id=__span-284-7><a id=__codelineno-284-7 name=__codelineno-284-7 href=#__codelineno-284-7></a><span class=c1>//   a</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=buffers><a href=https://nodejs.org/api/buffer.html#buffer_buffer>Buffers</a><a class=headerlink href=#buffers title="Permanent link">&para;</a></h3> <ul> <li><code>Buffer</code>(緩存)物件(object)被用來代表(represent)一個固定長度(fixed-length)的字節序列(sequence of bytes)。有許多Node的官方API都有支援<code>Buffer</code>(緩存)</li> <li><code>Buffer</code>(緩存)類別(Class)是Javascript的<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Uint8Array</a>類別的子類別(subclass),並且<code>Buffer</code>類別有繼承(extends)了它的許多方法(methods),這些方法們都有涵蓋(cover)了額外(additional)的許多使用情境(use cases)</li> <li>因為Node的官方API能接受(accept)普通(plain)的<code>Uint8Array</code>類別,所以到不論在哪裡(wherever)也都會支持(supported)<code>`Buffer</code>(緩存)類別</li> <li><code>Buffer</code>(緩存)類別(Class)是在全域的(global)範圍(scope)之內,因此不太可能(unlikely)會需要利用<code>require('buffer').Buffer</code>的語法來匯入此模組</li> <li><code>Buffer</code>緩存物件(object)的範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-285-1><a id=__codelineno-285-1 name=__codelineno-285-1 href=#__codelineno-285-1></a><span class=c1>// Creates a zero-filled Buffer of length 10.</span>
</span><span id=__span-285-2><a id=__codelineno-285-2 name=__codelineno-285-2 href=#__codelineno-285-2></a><span class=kd>const</span><span class=w> </span><span class=nx>buf1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-285-3><a id=__codelineno-285-3 name=__codelineno-285-3 href=#__codelineno-285-3></a>
</span><span id=__span-285-4><a id=__codelineno-285-4 name=__codelineno-285-4 href=#__codelineno-285-4></a><span class=c1>// Creates a Buffer of length 10,</span>
</span><span id=__span-285-5><a id=__codelineno-285-5 name=__codelineno-285-5 href=#__codelineno-285-5></a><span class=c1>// filled with bytes which all have the value `1`.</span>
</span><span id=__span-285-6><a id=__codelineno-285-6 name=__codelineno-285-6 href=#__codelineno-285-6></a><span class=kd>const</span><span class=w> </span><span class=nx>buf2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>10</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-285-7><a id=__codelineno-285-7 name=__codelineno-285-7 href=#__codelineno-285-7></a>
</span><span id=__span-285-8><a id=__codelineno-285-8 name=__codelineno-285-8 href=#__codelineno-285-8></a><span class=c1>// Creates an uninitialized buffer of length 10.</span>
</span><span id=__span-285-9><a id=__codelineno-285-9 name=__codelineno-285-9 href=#__codelineno-285-9></a><span class=c1>// This is faster than calling Buffer.alloc() but the returned</span>
</span><span id=__span-285-10><a id=__codelineno-285-10 name=__codelineno-285-10 href=#__codelineno-285-10></a><span class=c1>// Buffer instance might contain old data that needs to be</span>
</span><span id=__span-285-11><a id=__codelineno-285-11 name=__codelineno-285-11 href=#__codelineno-285-11></a><span class=c1>// overwritten using fill(), write(), or other functions that fill the Buffer&#39;s</span>
</span><span id=__span-285-12><a id=__codelineno-285-12 name=__codelineno-285-12 href=#__codelineno-285-12></a><span class=c1>// contents.</span>
</span><span id=__span-285-13><a id=__codelineno-285-13 name=__codelineno-285-13 href=#__codelineno-285-13></a><span class=kd>const</span><span class=w> </span><span class=nx>buf3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>allocUnsafe</span><span class=p>(</span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-285-14><a id=__codelineno-285-14 name=__codelineno-285-14 href=#__codelineno-285-14></a>
</span><span id=__span-285-15><a id=__codelineno-285-15 name=__codelineno-285-15 href=#__codelineno-285-15></a><span class=c1>// Creates a Buffer containing the bytes [1, 2, 3].</span>
</span><span id=__span-285-16><a id=__codelineno-285-16 name=__codelineno-285-16 href=#__codelineno-285-16></a><span class=kd>const</span><span class=w> </span><span class=nx>buf4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>([</span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>]);</span>
</span><span id=__span-285-17><a id=__codelineno-285-17 name=__codelineno-285-17 href=#__codelineno-285-17></a>
</span><span id=__span-285-18><a id=__codelineno-285-18 name=__codelineno-285-18 href=#__codelineno-285-18></a><span class=c1>// Creates a Buffer containing the bytes [1, 1, 1, 1] – the entries</span>
</span><span id=__span-285-19><a id=__codelineno-285-19 name=__codelineno-285-19 href=#__codelineno-285-19></a><span class=c1>// are all truncated using `(value &amp; 255)` to fit into the range 0–255.</span>
</span><span id=__span-285-20><a id=__codelineno-285-20 name=__codelineno-285-20 href=#__codelineno-285-20></a><span class=kd>const</span><span class=w> </span><span class=nx>buf5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>([</span><span class=mf>257</span><span class=p>,</span><span class=w> </span><span class=mf>257.5</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mf>255</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>]);</span>
</span><span id=__span-285-21><a id=__codelineno-285-21 name=__codelineno-285-21 href=#__codelineno-285-21></a>
</span><span id=__span-285-22><a id=__codelineno-285-22 name=__codelineno-285-22 href=#__codelineno-285-22></a><span class=c1>// Creates a Buffer containing the UTF-8-encoded bytes for the string &#39;tést&#39;:</span>
</span><span id=__span-285-23><a id=__codelineno-285-23 name=__codelineno-285-23 href=#__codelineno-285-23></a><span class=c1>// [0x74, 0xc3, 0xa9, 0x73, 0x74] (in hexadecimal notation)</span>
</span><span id=__span-285-24><a id=__codelineno-285-24 name=__codelineno-285-24 href=#__codelineno-285-24></a><span class=c1>// [116, 195, 169, 115, 116] (in decimal notation)</span>
</span><span id=__span-285-25><a id=__codelineno-285-25 name=__codelineno-285-25 href=#__codelineno-285-25></a><span class=kd>const</span><span class=w> </span><span class=nx>buf6</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;tést&#39;</span><span class=p>);</span>
</span><span id=__span-285-26><a id=__codelineno-285-26 name=__codelineno-285-26 href=#__codelineno-285-26></a>
</span><span id=__span-285-27><a id=__codelineno-285-27 name=__codelineno-285-27 href=#__codelineno-285-27></a><span class=c1>// Creates a Buffer containing the Latin-1 bytes [0x74, 0xe9, 0x73, 0x74].</span>
</span><span id=__span-285-28><a id=__codelineno-285-28 name=__codelineno-285-28 href=#__codelineno-285-28></a><span class=kd>const</span><span class=w> </span><span class=nx>buf7</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;tést&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;latin1&#39;</span><span class=p>);</span>
</span></code></pre></div><blockquote> <p><code>Buffers</code>(緩存)物件們與字元編碼 (Buffers and character encodings)</p> </blockquote> </li> <li>若要將<code>Buffer</code>(緩存)物件(object)轉換(converting)為字串(string)或是反過來轉換的話,可能會需要指定(specified)一個編碼方式。若這時候沒有指定一個編碼方式(character encoding)的話,預設(default)會使用(used)<code>utf-8</code>這個編碼方式來進行 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-286-1><a id=__codelineno-286-1 name=__codelineno-286-1 href=#__codelineno-286-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;hello world&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=p>);</span>
</span><span id=__span-286-2><a id=__codelineno-286-2 name=__codelineno-286-2 href=#__codelineno-286-2></a>
</span><span id=__span-286-3><a id=__codelineno-286-3 name=__codelineno-286-3 href=#__codelineno-286-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>));</span>
</span><span id=__span-286-4><a id=__codelineno-286-4 name=__codelineno-286-4 href=#__codelineno-286-4></a><span class=c1>// Prints: 68656c6c6f20776f726c64</span>
</span><span id=__span-286-5><a id=__codelineno-286-5 name=__codelineno-286-5 href=#__codelineno-286-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>));</span>
</span><span id=__span-286-6><a id=__codelineno-286-6 name=__codelineno-286-6 href=#__codelineno-286-6></a><span class=c1>// Prints: aGVsbG8gd29ybGQ=</span>
</span><span id=__span-286-7><a id=__codelineno-286-7 name=__codelineno-286-7 href=#__codelineno-286-7></a>
</span><span id=__span-286-8><a id=__codelineno-286-8 name=__codelineno-286-8 href=#__codelineno-286-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;fhqwhgads&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=p>));</span>
</span><span id=__span-286-9><a id=__codelineno-286-9 name=__codelineno-286-9 href=#__codelineno-286-9></a><span class=c1>// Prints: &lt;Buffer 66 68 71 77 68 67 61 64 73&gt;</span>
</span><span id=__span-286-10><a id=__codelineno-286-10 name=__codelineno-286-10 href=#__codelineno-286-10></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;fhqwhgads&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf16le&#39;</span><span class=p>));</span>
</span><span id=__span-286-11><a id=__codelineno-286-11 name=__codelineno-286-11 href=#__codelineno-286-11></a><span class=c1>// Prints: &lt;Buffer 66 00 68 00 71 00 77 00 68 00 67 00 61 00 64 00 73 00&gt;</span>
</span></code></pre></div></li> <li>以下是目前(currently)Node有支援(supported)的字元編碼(character encodings)方式<ul> <li><code>utf8</code>: 多字節(Multi-byte)編碼(encoded)的萬國碼(Unicode)字元們(characters)。有許多的網頁(web pages) &amp; 其它的文件(document)格式(formats)都是使用<a href=https://en.wikipedia.org/wiki/UTF-8>utf-8</a>這個編碼方式</li> <li>這是<code>Buffer</code>物件所預設(default)的編碼方式(character encoding)</li> <li>若將<code>Buffer</code>物件解碼成(decoding)字串時,並不會僅僅(exclusively)包含(contain)有效的(valid)<code>UTF-8</code>編碼格式的資料(data),有錯誤(errors)的萬國碼資料會被以<code>U+FFFD �</code>這個萬國碼(Unicode)取代字元(replacement character)來表示(represent)</li> <li><code>utf16le</code>: 多字節(Multi-byte)編碼(encoded)的萬國碼(Unicode)字元們(characters)。不同(Unlike)於<code>utf8</code>的是,每一個在字串(string)中的字元(each character)都會以2或是4個位元組(bytes)來編碼(encoded)</li> <li>Node只會支援(supports)<a href=https://en.wikipedia.org/wiki/UTF-16>UTF-16</a>的變體(variant)=&gt; <a href=https://en.wikipedia.org/wiki/Endianness>little-endian</a></li> <li><code>latin1</code>: <code>Latin-1</code>是代表(stands for)<a href=https://en.wikipedia.org/wiki/ISO/IEC_8859-1>ISO-8859-1</a>。這個字元編碼方式(character encoding)僅會支援(supports)從萬國碼(Unicode)的<code>U+0000</code>~<code>U+00FF</code>字元(character)能編碼(encoded)。每個字元(Each character)都會用單一個位元組(single byte)來編碼(encoded)。那些不在(do not fit into)前述範圍(range)內的字元們(characters)會被截掉(truncated)後,並會關聯(mapped)到前述範圍內的字元(characters)</li> </ul> </li> <li>若利用上述(above)提及(referred)的任何一種方式,將<code>Buffers</code>(緩存)物件(object)轉換為字串(string),那就是 <strong>解碼(decoding)</strong> ; 而如果是將字串(string)轉換為<code>Buffers</code>(緩存)物件(object),那就是 <strong>編碼(encoding)</strong></li> <li>Node也有支援(supports)以下2種位元組轉字串(binary-to-text)的編碼方式(encodings)。 <strong>對於位元組轉字串的編碼方式來說,命名慣例(naming convention)是相反的,也就是說將<code>Buffers</code>(緩存)物件(object)轉換為字串(string),那就是編碼(encoding); 而如果是將字串(string)轉換為<code>Buffers</code>(緩存)物件(object),那就是解碼(decoding)</strong><ul> <li><code>base64</code>: 就是<a href=https://en.wikipedia.org/wiki/Base64>Base64</a>這個編碼方式(encoding)。</li> <li>每當透過(from)字串來建立(creating)一個<code>Buffers</code>(緩存)物件(object)時,這個編碼方式也能正確地(correctly)接受(accept)自<a href=https://tools.ietf.org/html/rfc4648#section-5>RFC4648的第5章節</a>中指定(specified)的"<code>URL</code>與檔案名稱的安全字母( Filename Safe Alphabet)"。在<code>base64</code>這個編碼方式中的所有被包含(contained)在字串中(within)的空白字元(whitespace characters),像是空白(spaces)、<code>tabs</code>鍵、換行符(new lines)都會被忽略(ignored)</li> <li><code>hex</code>: 將每個位元組(each bytes)都編碼(encode)為2個16進位(hexadecimal)的字元(characters)</li> <li>當解碼字串(decoding strings)僅(exclusively)包含(contain)有效的(valid)16進位(hexadecimal)的字元(characters)時,就可能(may)會發生(occur)資料截斷(data truncation)。請見以下範例(example)</li> </ul> </li> <li>Node也可以支援(supported)以下的傳統(legacy)字元編碼方式(character encodings)<ul> <li><code>ascii</code>: 僅適用於7個位元組(=&gt; 也就是7-bit)的<a href=https://en.wikipedia.org/wiki/ASCII>ASCII</a>編碼格式的資料(data)</li> <li>當將字串(string)編碼(encoding)為<code>Buffers</code>(緩存)物件(object)時,這就相當(equivalent)於是使用(using)<code>latin1</code>這個編碼方式</li> <li>當將<code>Buffers</code>(緩存)物件(object)解碼(decoding)為字串(string)時,使用<code>ascii</code>這個編碼方式就會另外(additionally)將每個位元組(each byte)的最高位元(highest bit)移動(unset),然後再解碼(decoding)為<code>latin1</code>的編碼格式</li> <li>通常(Generally),我們沒有理由(no reason)會需要使用<code>ascii</code>這種編碼方式,因為已經有<code>utf-8</code>編碼格式了(或者,如果對已知數據(the data is known)總是僅能使用<code>ASCII</code>編碼格式(ASCII-only)的話 or 在編碼(<code>encode</code>)/解碼(<code>decode</code>)時,僅能使用<code>ASCII</code>編碼格式的文字(ASCII-only text)的話,則<code>latin1</code>就會是一個更好的選擇(better choice))</li> <li><strong>Node之所以會提供(provided)<code>ASCII</code>這種編碼格式的原因就只是為了傳統(legacy)的相容性(compatibility)問題</strong></li> <li><code>binary</code>: 為<code>latin1</code>的別名(alias)。可先參考<a href=https://developer.mozilla.org/en-US/docs/Web/API/DOMString/Binary>binary strings</a>來了解更多關於這個主題(topic)的背景知識(brackground)</li> <li>其實<code>binary</code>這個編碼方式的命名(name)很容易被誤導(misleading),是因為所有這裡所列出(listed)的編碼方式(encodings)都是要將字串(<code>string</code>)與二進位元(<code>binary</code>)的資料之間做相互轉換(convert between)。 <strong>而對於要將字串(<code>string</code>)與<code>Buffers</code>(緩存)物件(object)的資料之間做相互轉換(converting between),通常<code>utf-8</code>編碼方式會是正確的選擇(right choice)</strong></li> <li><code>ucs2</code>: 為<code>utf16le</code>的別名(alias)。在以前(used to),<code>UCS-2</code>這種編碼方式是指參考(refer to)<code>UTF-16</code>編碼方式而產生的變形(variant),主要是為了支援(support)那些點位(code points)超過(larger than)<code>U+FFFF</code>的字元(characters)</li> <li>在Node中,這些點位(code points)皆總是有被支援(always supported)了 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-287-1><a id=__codelineno-287-1 name=__codelineno-287-1 href=#__codelineno-287-1></a><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;1ag&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span><span id=__span-287-2><a id=__codelineno-287-2 name=__codelineno-287-2 href=#__codelineno-287-2></a><span class=c1>// Prints &lt;Buffer 1a&gt;, data truncated when first non-hexadecimal value</span>
</span><span id=__span-287-3><a id=__codelineno-287-3 name=__codelineno-287-3 href=#__codelineno-287-3></a><span class=c1>// (&#39;g&#39;) encountered.</span>
</span><span id=__span-287-4><a id=__codelineno-287-4 name=__codelineno-287-4 href=#__codelineno-287-4></a>
</span><span id=__span-287-5><a id=__codelineno-287-5 name=__codelineno-287-5 href=#__codelineno-287-5></a><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;1a7g&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span><span id=__span-287-6><a id=__codelineno-287-6 name=__codelineno-287-6 href=#__codelineno-287-6></a><span class=c1>// Prints &lt;Buffer 1a&gt;, data truncated when data ends in single digit (&#39;7&#39;).</span>
</span><span id=__span-287-7><a id=__codelineno-287-7 name=__codelineno-287-7 href=#__codelineno-287-7></a>
</span><span id=__span-287-8><a id=__codelineno-287-8 name=__codelineno-287-8 href=#__codelineno-287-8></a><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;1634&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span><span id=__span-287-9><a id=__codelineno-287-9 name=__codelineno-287-9 href=#__codelineno-287-9></a><span class=c1>// Prints &lt;Buffer 16 34&gt;, all data represented.</span>
</span></code></pre></div></li> </ul> </li> <li>現代化網頁瀏覽器皆有遵循<a href=https://encoding.spec.whatwg.org/ >WHATWG Encoding Standard</a>,也就是<code>latin1</code>、<code>ISO-8859-1</code>皆為<code>win-1252</code>這個編碼方式的別名(alias)。這也意味(means)著當執行像是<code>http.get()</code>方法的時候,如果回傳(returned)的字元編碼格式(charset)為<code>WHATWG</code>規格(specification)中列出(listed)的其中一種時,很有可能(possible)其實伺服器(server)實際上(actually)是回傳(returned)以<code>win-1252</code>這個編碼方式所編碼過後的資料(=&gt; 也就是<code>win-1252</code>-encoded data),所以這時候如果使用<code>latin1</code>這個編碼方式來解碼(decode)字元(characters)的話,會造成錯誤(incorrectly)<blockquote> <p><code>Buffers</code>(緩存)物件(object) &amp; 迭代 (Buffers and iteration)</p> </blockquote> </li> <li><code>Buffers</code>(緩存)實例(instances)是能夠利用(using)<code>for...of</code>語法(syntax)來迭代(iterated over)的 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-288-1><a id=__codelineno-288-1 name=__codelineno-288-1 href=#__codelineno-288-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>([</span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>]);</span>
</span><span id=__span-288-2><a id=__codelineno-288-2 name=__codelineno-288-2 href=#__codelineno-288-2></a>
</span><span id=__span-288-3><a id=__codelineno-288-3 name=__codelineno-288-3 href=#__codelineno-288-3></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>buf</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-288-4><a id=__codelineno-288-4 name=__codelineno-288-4 href=#__codelineno-288-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>b</span><span class=p>);</span>
</span><span id=__span-288-5><a id=__codelineno-288-5 name=__codelineno-288-5 href=#__codelineno-288-5></a><span class=p>}</span>
</span><span id=__span-288-6><a id=__codelineno-288-6 name=__codelineno-288-6 href=#__codelineno-288-6></a><span class=c1>// Prints:</span>
</span><span id=__span-288-7><a id=__codelineno-288-7 name=__codelineno-288-7 href=#__codelineno-288-7></a><span class=c1>//   1</span>
</span><span id=__span-288-8><a id=__codelineno-288-8 name=__codelineno-288-8 href=#__codelineno-288-8></a><span class=c1>//   2</span>
</span><span id=__span-288-9><a id=__codelineno-288-9 name=__codelineno-288-9 href=#__codelineno-288-9></a><span class=c1>//   3</span>
</span></code></pre></div></li> <li>此外(Additionally),<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_buf_values>buf.values()</a>、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_buf_keys>buf.keys()</a>、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_buf_entries>buf.entries()</a>方法(methods)皆可以被用來(used to)建立(create)迭代(iterators)<blockquote> <p>Class</p> </blockquote> </li> <li><a href=https://nodejs.org/api/buffer.html#buffer_class_buffer>Buffer</a><ul> <li><code>Buffers</code>(緩存)類別(class)是一個全域(global)的型別(type)以用來更直接(directly)地處理(dealing)二進位制位元(binary)的資料(data)。它能透過許多種方式(in a variety of ways)來建構(constructed)出來</li> </ul> </li> <li> <blockquote> <p>Static method</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_alloc_size_fill_encoding>Buffer.alloc(size[, fill[, encoding]])</a></li> <li>args<ul> <li>size: (integer)</li> <li>渴望(desired)新(new)的<code>Buffers</code>(緩存)物件(object)長度(length)是多少</li> <li>fill: (string) | (Buffer) | <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Unit8Array</a> | integer</li> <li>要預先填進(pre-fill)新(new)的<code>Buffers</code>(緩存)物件(object)的值(value)</li> <li>預設值: <code>0</code></li> <li>encoding: (string)</li> <li>如果<code>fill</code>參數的值是字串(string)型別的話,那麼此<code>encoding</code>參數的值就會是這個字串參數的編碼格式(encoding)</li> <li>預設值: <code>utf8</code></li> </ul> </li> <li>會分配(allocates)一個符合<code>size</code>參數值指定大小的新(new)的<code>Buffers</code>(緩存)物件(object)。如果<code>fill</code>參數的值是<code>undefined</code>的話,則<code>Buffer</code>物件的值將會是<code>0</code>(zero-filled) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-289-1><a id=__codelineno-289-1 name=__codelineno-289-1 href=#__codelineno-289-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>5</span><span class=p>);</span>
</span><span id=__span-289-2><a id=__codelineno-289-2 name=__codelineno-289-2 href=#__codelineno-289-2></a>
</span><span id=__span-289-3><a id=__codelineno-289-3 name=__codelineno-289-3 href=#__codelineno-289-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-289-4><a id=__codelineno-289-4 name=__codelineno-289-4 href=#__codelineno-289-4></a><span class=c1>// Prints: &lt;Buffer 00 00 00 00 00&gt;</span>
</span></code></pre></div></li> <li>若<code>size</code>參數的值比<a href=https://nodejs.org/api/buffer.html#buffer_buffer_constants_max_length>buffer.constants.MAX_LENGTH</a>屬性的值還要大(larger)或是<code>size</code>參數的值比<code>0</code>還要小(smaller)的話,就會拋出(thrown)<a href=https://nodejs.org/api/errors.html#ERR_INVALID_ARG_VALUE>ERR_INVALID_ARG_VALUE</a>這個錯誤(<code>error</code>)<ul> <li>補充: <code>buffer.constants.MAX_LENGTH</code>屬性的值會視作業系統(operating system)的位元架構(architectures)而定,例如: <code>32-bit</code>的作業系統大約就是1GB左右; 而<code>64-bit</code>的作業系統大約就是2GB左右</li> </ul> </li> <li>若<code>fill</code>參數的值有給定(specified)的話,則這個新被分配(allocated)的<code>Buffers</code>(緩存)物件(object)就會透過呼叫(calling)<a href=https://nodejs.org/api/buffer.html#buffer_buf_fill_value_offset_end_encoding>buf.fill(fill)</a>方法(method)來初始化(initialized) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-290-1><a id=__codelineno-290-1 name=__codelineno-290-1 href=#__codelineno-290-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=p>);</span>
</span><span id=__span-290-2><a id=__codelineno-290-2 name=__codelineno-290-2 href=#__codelineno-290-2></a>
</span><span id=__span-290-3><a id=__codelineno-290-3 name=__codelineno-290-3 href=#__codelineno-290-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-290-4><a id=__codelineno-290-4 name=__codelineno-290-4 href=#__codelineno-290-4></a><span class=c1>// Prints: &lt;Buffer 61 61 61 61 61&gt;</span>
</span></code></pre></div></li> <li>若<code>fill</code>與<code>encoding</code>參數的值都有給定(specified)的話,則這個新被分配(allocated)的<code>Buffers</code>(緩存)物件(object)就會透過呼叫(calling)<a href=https://nodejs.org/api/buffer.html#buffer_buf_fill_value_offset_end_encoding>buf.fill(fill, encoding)</a>方法(method)來初始化(initialized) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-291-1><a id=__codelineno-291-1 name=__codelineno-291-1 href=#__codelineno-291-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>11</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;aGVsbG8gd29ybGQ=&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;base64&#39;</span><span class=p>);</span>
</span><span id=__span-291-2><a id=__codelineno-291-2 name=__codelineno-291-2 href=#__codelineno-291-2></a>
</span><span id=__span-291-3><a id=__codelineno-291-3 name=__codelineno-291-3 href=#__codelineno-291-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-291-4><a id=__codelineno-291-4 name=__codelineno-291-4 href=#__codelineno-291-4></a><span class=c1>// Prints: &lt;Buffer 68 65 6c 6c 6f 20 77 6f 72 6c 64&gt;</span>
</span></code></pre></div></li> <li>雖然呼叫<a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_alloc_size_fill_encoding>Buffer.alloc()</a>方法可預見(measurably)地會比它的替代方法(alternative)(=&gt; 也就是<a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe()</a>方法)來得慢(slower),但是<code>Buffer.alloc()</code>方法能確保(ensures)其所新(newly)建立(created)出來的<code>Buffer</code>(緩存)實例(instance)的內容(contents)將永遠不會(never)包含(contain)之前分配過(previous allocations)的敏感性資料(sensitive data),而這也包括(including)了那些尚未被分配(not have been allocated)給<code>Buffers</code>實例(instance)的資料(data)</li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe(size)</a></li> <li>args<ul> <li>size: (integer)</li> <li>渴望(desired)新(new)的<code>Buffers</code>(緩存)物件(object)長度(length)是多少</li> </ul> </li> <li>會分配(allocates)一個符合<code>size</code>參數值指定大小的新(new)的<code>Buffers</code>(緩存)物件(object)。如果<code>fill</code>參數的值是<code>undefined</code>的話,則<code>Buffer</code>物件的值將會是<code>0</code>(zero-filled)</li> <li>透過<code>Buffer.allocUnsafe()</code>方法(method)所建立(created)的<code>Buffers</code>(緩存)實例(instance)的基本記憶體(underlying memory)將不會被初始化(initialized)。而這個新建立出來的<code>Buffer</code>實例的內容(contents)將會是未知(unknown)的,並且可能(may)會包含(contain)敏感性資料(sensitive data)<ul> <li>可使用<code>Buffer.alloc()</code>方法來建立一個初始化(initialize)的<code>Buffer</code>實例(instance),並預先填進值為<code>0</code>(zeros) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-292-1><a id=__codelineno-292-1 name=__codelineno-292-1 href=#__codelineno-292-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>allocUnsafe</span><span class=p>(</span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-292-2><a id=__codelineno-292-2 name=__codelineno-292-2 href=#__codelineno-292-2></a>
</span><span id=__span-292-3><a id=__codelineno-292-3 name=__codelineno-292-3 href=#__codelineno-292-3></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-292-4><a id=__codelineno-292-4 name=__codelineno-292-4 href=#__codelineno-292-4></a><span class=c1>// Prints (contents may vary): &lt;Buffer a0 8b 28 3f 01 00 00 00 50 32&gt;</span>
</span><span id=__span-292-5><a id=__codelineno-292-5 name=__codelineno-292-5 href=#__codelineno-292-5></a>
</span><span id=__span-292-6><a id=__codelineno-292-6 name=__codelineno-292-6 href=#__codelineno-292-6></a><span class=nx>buf</span><span class=p>.</span><span class=nx>fill</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-292-7><a id=__codelineno-292-7 name=__codelineno-292-7 href=#__codelineno-292-7></a>
</span><span id=__span-292-8><a id=__codelineno-292-8 name=__codelineno-292-8 href=#__codelineno-292-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-292-9><a id=__codelineno-292-9 name=__codelineno-292-9 href=#__codelineno-292-9></a><span class=c1>// Prints: &lt;Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span>
</span></code></pre></div></li> <li>如果<code>Buffer.allocUnsafe()</code>方法(method)中的<code>size</code>參數的值,若不是數字(number)的話就會拋出(thrown)<code>TypeError</code>錯誤(error)</li> </ul> </li> <li><code>Buffer</code>(緩存)模組(module)會在<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_property_buffer_poolsize>Buffer.poolsize()</a>)之中的一個內部(internal)<code>Buffer</code>實例(instance)裡面,預先分配(pre-allocates)好一個指定大小(<code>size</code>)的區塊。而<code>Buffer.poolsize()</code>類別(class)是用來(used as)提供<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe()</a>方法、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_from_array>Buffer.from(array)</a>方法、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_concat_list_totallength>Buffer.concat()</a>方法,以及只有(only)當<code>size</code>這個參數的值小於(less than) or 等於(equal to) <code>Buffer.poolSize &gt;&gt; 1</code>(=&gt; 也就是<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_property_buffer_poolsize>Buffer.poolSize()</a>除以(divided)2後的最大整數值(floor))的時候,才會用到的已經被棄置的<code>new Buffer(size)</code>建構子(constructor)來在共用池(pool)之中快速分配(fast allocation)記憶體位置給新(new)的<code>Buffer</code>(緩存)實例(instance)</li> <li>利用此預分配(pre-allocated)好的內部共用池中的記憶體(internal memory pool)是在呼叫(calling)<code>Buffer.alloc(size, fill)</code>方法、<code>Buffer.allocUnsafe(size).fill(fill)</code>方法之間的一個關鍵的區別<ul> <li>特別的是(Specifically),<code>Buffer.alloc(size, fill)</code>方法(method)永遠不會(never)用到(use)內部(internal)<code>Buffer</code>(緩存)共用池(pool)中的記憶體; 而<code>Buffer.allocUnsafe(size).fill(fill)</code>方法則會在<code>size</code>參數的值小於 or 等於 <code>Buffer.poolSize</code>的一半(half)時,就會用到內部<code>Buffer</code>(緩存)共用池(pool)中的記憶體。雖然這個差異是非常細微(subtle)的,但其實很重要(important)的,尤其是當我們的應用程式(application)要求(requires)額外(additional)的效能(performance)時,這時候就正是<code>Buffer.allocUnsafe()</code>方法(method)所能提供(provides)的了</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_concat_list_totallength>Buffer.concat(list[, totalLength])</a></li> <li>args<ul> <li>list: (<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_buffer>Buffer</a>) | (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Unit8Array</a>)</li> <li>totalLength: (integer)</li> <li>串連在<code>list</code>參數值中的所有<code>Buffer</code>(緩存)實例(instance)後的總長度</li> <li>Returns: (<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_buffer>Buffer</a>)</li> </ul> </li> <li>此方法會回傳已串連<code>list</code>參數值中的所有<code>Buffer</code>(緩存)實例(instance)過後的的一個新的<code>Buffer</code>(緩存)物件<ul> <li>如果<code>list</code>參數值中,沒有任何東西(item); 或是<code>totalLength</code>參數值為<code>0</code>的話,這兩種情況都會回傳(returned)一個新(new)的零長度(zero-length)的<code>Buffer</code>物件</li> <li>若沒有提供(provided)<code>totalLength</code>這個參數值的話,就會透過<code>list</code>中的<code>Buffer</code>(緩存)實例們(instances)來計算(calculated)它們的加總(adding)後的總長度(their lengths)</li> <li>若有提供<code>totalLength</code>這個參數值的話,就會強迫(coerced)變成一個未指派(unsigned)的整數(integer)。如果將<code>list</code>內的所有Buffer<code>(緩存)</code>實例們(instances)合併(combined)後已超過(exceeds)<code>totalLength</code>參數值的話,那<code>Buffer.concat()</code>方法(method)所回傳的<code>Buffer</code>實例就會被截斷(truncated)到符合<code>totalLength</code>參數值所規範的長度限制 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-293-1><a id=__codelineno-293-1 name=__codelineno-293-1 href=#__codelineno-293-1></a><span class=c1>// Create a single `Buffer` from a list of three `Buffer` instances.</span>
</span><span id=__span-293-2><a id=__codelineno-293-2 name=__codelineno-293-2 href=#__codelineno-293-2></a>
</span><span id=__span-293-3><a id=__codelineno-293-3 name=__codelineno-293-3 href=#__codelineno-293-3></a><span class=kd>const</span><span class=w> </span><span class=nx>buf1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-293-4><a id=__codelineno-293-4 name=__codelineno-293-4 href=#__codelineno-293-4></a><span class=kd>const</span><span class=w> </span><span class=nx>buf2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>14</span><span class=p>);</span>
</span><span id=__span-293-5><a id=__codelineno-293-5 name=__codelineno-293-5 href=#__codelineno-293-5></a><span class=kd>const</span><span class=w> </span><span class=nx>buf3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>18</span><span class=p>);</span>
</span><span id=__span-293-6><a id=__codelineno-293-6 name=__codelineno-293-6 href=#__codelineno-293-6></a><span class=kd>const</span><span class=w> </span><span class=nx>totalLength</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>buf1</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>buf2</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>buf3</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span><span id=__span-293-7><a id=__codelineno-293-7 name=__codelineno-293-7 href=#__codelineno-293-7></a>
</span><span id=__span-293-8><a id=__codelineno-293-8 name=__codelineno-293-8 href=#__codelineno-293-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>totalLength</span><span class=p>);</span>
</span><span id=__span-293-9><a id=__codelineno-293-9 name=__codelineno-293-9 href=#__codelineno-293-9></a><span class=c1>// Prints: 42</span>
</span><span id=__span-293-10><a id=__codelineno-293-10 name=__codelineno-293-10 href=#__codelineno-293-10></a>
</span><span id=__span-293-11><a id=__codelineno-293-11 name=__codelineno-293-11 href=#__codelineno-293-11></a><span class=kd>const</span><span class=w> </span><span class=nx>bufA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>concat</span><span class=p>([</span><span class=nx>buf1</span><span class=p>,</span><span class=w> </span><span class=nx>buf2</span><span class=p>,</span><span class=w> </span><span class=nx>buf3</span><span class=p>],</span><span class=w> </span><span class=nx>totalLength</span><span class=p>);</span>
</span><span id=__span-293-12><a id=__codelineno-293-12 name=__codelineno-293-12 href=#__codelineno-293-12></a>
</span><span id=__span-293-13><a id=__codelineno-293-13 name=__codelineno-293-13 href=#__codelineno-293-13></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>bufA</span><span class=p>);</span>
</span><span id=__span-293-14><a id=__codelineno-293-14 name=__codelineno-293-14 href=#__codelineno-293-14></a><span class=c1>// Prints: &lt;Buffer 00 00 00 00 ...&gt;</span>
</span><span id=__span-293-15><a id=__codelineno-293-15 name=__codelineno-293-15 href=#__codelineno-293-15></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>bufA</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span><span id=__span-293-16><a id=__codelineno-293-16 name=__codelineno-293-16 href=#__codelineno-293-16></a><span class=c1>// Prints: 42</span>
</span></code></pre></div></li> </ul> </li> <li><code>Buffer.concat()</code>方法(method)也可以像<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe()</a>方法一樣能使用(use)內部(internal)<code>Buffer</code>(緩存)共用池(pool)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_from_array>Buffer.from(array)</a></li> <li>args<ul> <li>array: (integer[])</li> </ul> </li> <li>此方法會利用<code>array</code>參數值的位元組(bytes)(=&gt; 必須在<code>0</code>~<code>255</code>的範圍內)來分配(allocates)一個新(new)的<code>Buffer</code>(緩存)實例 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-294-1><a id=__codelineno-294-1 name=__codelineno-294-1 href=#__codelineno-294-1></a><span class=c1>// Creates a new Buffer containing the UTF-8 bytes of the string &#39;buffer&#39;.</span>
</span><span id=__span-294-2><a id=__codelineno-294-2 name=__codelineno-294-2 href=#__codelineno-294-2></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>([</span><span class=mh>0x62</span><span class=p>,</span><span class=w> </span><span class=mh>0x75</span><span class=p>,</span><span class=w> </span><span class=mh>0x66</span><span class=p>,</span><span class=w> </span><span class=mh>0x66</span><span class=p>,</span><span class=w> </span><span class=mh>0x65</span><span class=p>,</span><span class=w> </span><span class=mh>0x72</span><span class=p>]);</span>
</span></code></pre></div></li> <li>若<code>array</code>參數的值不是一個Javascript的<code>Array</code>型別 or 另一個(another)適用(appropriate)於<code>Buffer.from()</code>方法的變形(variants)的型別(type)的話,就會拋出(thrown)一個<code>TypeError</code>錯誤(error)</li> <li><code>Buffer.from(array)</code>方法(method)與<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_from_string_encoding>Buffer.from(string)</a>方法(method)也可以像<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_static_method_buffer_allocunsafe_size>Buffer.allocUnsafe()</a>方法一樣能使用(use)內部(internal)<code>Buffer</code>(緩存)共用池(pool)</li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_buffer>Buffer.from(buffer)</a></li> <li>args<ul> <li>buffer: (<a href=https://nodejs.org/api/buffer.html#buffer_class_buffer>Buffer</a>) | (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Unit8Array</a>)</li> <li>指定要從已經存在(existing)的哪個<code>Buffer</code>物件 or <code>Unit8Array</code>類別來複製資料(copy data)</li> </ul> </li> <li>此方法(method)會將傳遞(passed)給這個方法的<code>buffer</code>參數複製(copies)一份資料(data)給新(new)的<code>Buffer</code>(緩存)實例(instance) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-295-1><a id=__codelineno-295-1 name=__codelineno-295-1 href=#__codelineno-295-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;buffer&#39;</span><span class=p>);</span>
</span><span id=__span-295-2><a id=__codelineno-295-2 name=__codelineno-295-2 href=#__codelineno-295-2></a><span class=kd>const</span><span class=w> </span><span class=nx>buf2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>buf1</span><span class=p>);</span>
</span><span id=__span-295-3><a id=__codelineno-295-3 name=__codelineno-295-3 href=#__codelineno-295-3></a>
</span><span id=__span-295-4><a id=__codelineno-295-4 name=__codelineno-295-4 href=#__codelineno-295-4></a><span class=nx>buf1</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x61</span><span class=p>;</span>
</span><span id=__span-295-5><a id=__codelineno-295-5 name=__codelineno-295-5 href=#__codelineno-295-5></a>
</span><span id=__span-295-6><a id=__codelineno-295-6 name=__codelineno-295-6 href=#__codelineno-295-6></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf1</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span><span id=__span-295-7><a id=__codelineno-295-7 name=__codelineno-295-7 href=#__codelineno-295-7></a><span class=c1>// Prints: auffer</span>
</span><span id=__span-295-8><a id=__codelineno-295-8 name=__codelineno-295-8 href=#__codelineno-295-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf2</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span><span id=__span-295-9><a id=__codelineno-295-9 name=__codelineno-295-9 href=#__codelineno-295-9></a><span class=c1>// Prints: buffer</span>
</span></code></pre></div></li> <li>若<code>Buffer.from(buffer)</code>方法(method)的<code>buffer</code>參數的值不是一個Javascript的<code>Buffer</code>物件 or 另一個(another)適用(appropriate)於<code>Buffer.from()</code>方法的變形(variants)的型別(type)的話,就會拋出(thrown)一個<code>TypeError</code>錯誤(error)</li> <li><a href=https://nodejs.org/api/buffer.html#buffer_static_method_buffer_from_string_encoding>Buffer.from(string[, encoding])</a></li> <li>args<ul> <li>string: (string)</li> <li>要編碼為<code>Buffer</code>物件的字串(string)</li> <li>encoding: (string)</li> <li>可指定要使用哪種編碼格式(encoding)來編碼字串(string)</li> <li>預設值: <code>utf8</code></li> </ul> </li> <li>此方法會建立一個新的<code>Buffer</code>(緩存)物件,並且這個<code>Buffer</code>物件的內容會包括(containing)字串(<code>string</code>)參數的值<ul> <li>而此方法(method)的<code>encoding</code>參數是用來確認(identifies)我們將要使用(used)哪種編碼格式(character encoding)來將字串(string)轉換(converting)為位元組(<code>bytes</code>) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-296-1><a id=__codelineno-296-1 name=__codelineno-296-1 href=#__codelineno-296-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;this is a tést&#39;</span><span class=p>);</span>
</span><span id=__span-296-2><a id=__codelineno-296-2 name=__codelineno-296-2 href=#__codelineno-296-2></a><span class=kd>const</span><span class=w> </span><span class=nx>buf2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;7468697320697320612074c3a97374&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span><span id=__span-296-3><a id=__codelineno-296-3 name=__codelineno-296-3 href=#__codelineno-296-3></a>
</span><span id=__span-296-4><a id=__codelineno-296-4 name=__codelineno-296-4 href=#__codelineno-296-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf1</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span><span id=__span-296-5><a id=__codelineno-296-5 name=__codelineno-296-5 href=#__codelineno-296-5></a><span class=c1>// Prints: this is a tést</span>
</span><span id=__span-296-6><a id=__codelineno-296-6 name=__codelineno-296-6 href=#__codelineno-296-6></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf2</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span>
</span><span id=__span-296-7><a id=__codelineno-296-7 name=__codelineno-296-7 href=#__codelineno-296-7></a><span class=c1>// Prints: this is a tést</span>
</span><span id=__span-296-8><a id=__codelineno-296-8 name=__codelineno-296-8 href=#__codelineno-296-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf1</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;latin1&#39;</span><span class=p>));</span>
</span><span id=__span-296-9><a id=__codelineno-296-9 name=__codelineno-296-9 href=#__codelineno-296-9></a><span class=c1>// Prints: this is a tÃ©st</span>
</span></code></pre></div></li> </ul> </li> <li>若<code>Buffer.from(string)</code>方法(method)的<code>string</code>參數的值不是屬於Javascript的<code>string</code>型別 or 另一個(another)適用(appropriate)於<code>Buffer.from()</code>方法的變形(variants)的型別(type)的話,就會拋出(thrown)一個<code>TypeError</code>錯誤(error)</li> </ul> </li> <li> <blockquote> <p>method</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/buffer.html#buffer_buf_tojson>buf.toJSON()</a></li> <li>Returns: (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object>object</a>)</li> <li>此方法(method)會回傳(returns)一個<code>JSON</code>物件來代表(representation)當要將<code>Buffer</code>(緩存)實例(instance)轉換為字串(stringifying)時,<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify>JSON.stringify()</a>方法有不明確地(implicitly)呼叫<code>buf.JSON()</code>方法</li> <li><code>Buffer.from()</code>方法(method)能接受(accepts)從<code>buf.JSON()</code>方法所回傳(returned)出來的<code>JSON</code>物件(objects)的格式(format)</li> <li>尤其是(In particular),<code>buf.toJSON()</code>方法(method)執行起來就會像(works like)是<code>Buffer.from(buf)</code>方法一樣 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-297-1><a id=__codelineno-297-1 name=__codelineno-297-1 href=#__codelineno-297-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>([</span><span class=mh>0x1</span><span class=p>,</span><span class=w> </span><span class=mh>0x2</span><span class=p>,</span><span class=w> </span><span class=mh>0x3</span><span class=p>,</span><span class=w> </span><span class=mh>0x4</span><span class=p>,</span><span class=w> </span><span class=mh>0x5</span><span class=p>]);</span>
</span><span id=__span-297-2><a id=__codelineno-297-2 name=__codelineno-297-2 href=#__codelineno-297-2></a><span class=kd>const</span><span class=w> </span><span class=nx>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span><span id=__span-297-3><a id=__codelineno-297-3 name=__codelineno-297-3 href=#__codelineno-297-3></a>
</span><span id=__span-297-4><a id=__codelineno-297-4 name=__codelineno-297-4 href=#__codelineno-297-4></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>json</span><span class=p>);</span>
</span><span id=__span-297-5><a id=__codelineno-297-5 name=__codelineno-297-5 href=#__codelineno-297-5></a><span class=c1>// Prints: {&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[1,2,3,4,5]}</span>
</span><span id=__span-297-6><a id=__codelineno-297-6 name=__codelineno-297-6 href=#__codelineno-297-6></a>
</span><span id=__span-297-7><a id=__codelineno-297-7 name=__codelineno-297-7 href=#__codelineno-297-7></a><span class=kd>const</span><span class=w> </span><span class=nx>copy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>json</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-297-8><a id=__codelineno-297-8 name=__codelineno-297-8 href=#__codelineno-297-8></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>value</span><span class=p>.</span><span class=nx>type</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;Buffer&#39;</span><span class=w> </span><span class=o>?</span>
</span><span id=__span-297-9><a id=__codelineno-297-9 name=__codelineno-297-9 href=#__codelineno-297-9></a><span class=w>    </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span><span class=w> </span><span class=o>:</span>
</span><span id=__span-297-10><a id=__codelineno-297-10 name=__codelineno-297-10 href=#__codelineno-297-10></a><span class=w>    </span><span class=nx>value</span><span class=p>;</span>
</span><span id=__span-297-11><a id=__codelineno-297-11 name=__codelineno-297-11 href=#__codelineno-297-11></a><span class=p>});</span>
</span><span id=__span-297-12><a id=__codelineno-297-12 name=__codelineno-297-12 href=#__codelineno-297-12></a>
</span><span id=__span-297-13><a id=__codelineno-297-13 name=__codelineno-297-13 href=#__codelineno-297-13></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>copy</span><span class=p>);</span>
</span><span id=__span-297-14><a id=__codelineno-297-14 name=__codelineno-297-14 href=#__codelineno-297-14></a><span class=c1>// Prints: &lt;Buffer 01 02 03 04 05&gt;</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/api/buffer.html#buffer_buf_tostring_encoding_start_end>buf.toString([encoding[, start[, end]]])</a></li> <li>args<ul> <li>encoding: (string)</li> <li>可指定要使用哪種編碼格式(encoding)來編碼字串(string)</li> <li>預設值: <code>utf8</code></li> <li>start: (integer)</li> <li>可指定要從偏移(offset)多少位元組(byte)後才開始(start)解碼(decoding)</li> <li>預設值: <code>0</code></li> <li>end: (integer)</li> <li>可指定要從偏移(offset)多少位元組(byte)後才停止(stop)解碼(decoding)(=&gt; 也就是不要包含的(not inclusive))</li> <li>預設值: <a href=https://nodejs.org/api/buffer.html#buffer_buf_length>buf.length</a></li> </ul> </li> <li>此方法(method)會根據(according)指定(specified)的編碼方式(character encoding)來解碼(decodes)<code>buf</code>物件(也就是=&gt; <code>encoding</code>的參數值)<ul> <li>而<code>start</code>與<code>end</code>參數可以僅在需要解碼(decode only)<code>buf</code>物件的子集(subset)時才傳遞(passed)到<code>buf.toString()</code>方法(method)裡面,作為參數</li> <li>若<code>encoding</code>參數的值是<code>utf8</code>,並且輸入(input)的位元組序列(a byte sequence)不是有效的(not valid)<code>UTF-8</code>格式的話,那麼(then)這些每一個(each)無效(invalid)的位元組(byte)就會被<code>U+FFFD</code>這個替代字元(replacement character)來取代(replaced)</li> </ul> </li> <li>字串實例(string instance)(=&gt; 必須是以<code>UTF-16</code>代碼(code)為單位(unit))的最大長度(maximum length)必須是符合<a href=https://nodejs.org/api/buffer.html#buffer_buffer_constants_max_string_length>buffer.constants.MAX_STRING_LENGTH</a>屬性值的限制 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-298-1><a id=__codelineno-298-1 name=__codelineno-298-1 href=#__codelineno-298-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>allocUnsafe</span><span class=p>(</span><span class=mf>26</span><span class=p>);</span>
</span><span id=__span-298-2><a id=__codelineno-298-2 name=__codelineno-298-2 href=#__codelineno-298-2></a>
</span><span id=__span-298-3><a id=__codelineno-298-3 name=__codelineno-298-3 href=#__codelineno-298-3></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>let</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>26</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-298-4><a id=__codelineno-298-4 name=__codelineno-298-4 href=#__codelineno-298-4></a><span class=w>  </span><span class=c1>// 97 is the decimal ASCII value for &#39;a&#39;.</span>
</span><span id=__span-298-5><a id=__codelineno-298-5 name=__codelineno-298-5 href=#__codelineno-298-5></a><span class=w>  </span><span class=nx>buf1</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>97</span><span class=p>;</span>
</span><span id=__span-298-6><a id=__codelineno-298-6 name=__codelineno-298-6 href=#__codelineno-298-6></a><span class=p>}</span>
</span><span id=__span-298-7><a id=__codelineno-298-7 name=__codelineno-298-7 href=#__codelineno-298-7></a>
</span><span id=__span-298-8><a id=__codelineno-298-8 name=__codelineno-298-8 href=#__codelineno-298-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf1</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>));</span>
</span><span id=__span-298-9><a id=__codelineno-298-9 name=__codelineno-298-9 href=#__codelineno-298-9></a><span class=c1>// Prints: abcdefghijklmnopqrstuvwxyz</span>
</span><span id=__span-298-10><a id=__codelineno-298-10 name=__codelineno-298-10 href=#__codelineno-298-10></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf1</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>5</span><span class=p>));</span>
</span><span id=__span-298-11><a id=__codelineno-298-11 name=__codelineno-298-11 href=#__codelineno-298-11></a><span class=c1>// Prints: abcde</span>
</span><span id=__span-298-12><a id=__codelineno-298-12 name=__codelineno-298-12 href=#__codelineno-298-12></a>
</span><span id=__span-298-13><a id=__codelineno-298-13 name=__codelineno-298-13 href=#__codelineno-298-13></a><span class=kd>const</span><span class=w> </span><span class=nx>buf2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=s1>&#39;tést&#39;</span><span class=p>);</span>
</span><span id=__span-298-14><a id=__codelineno-298-14 name=__codelineno-298-14 href=#__codelineno-298-14></a>
</span><span id=__span-298-15><a id=__codelineno-298-15 name=__codelineno-298-15 href=#__codelineno-298-15></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf2</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>));</span>
</span><span id=__span-298-16><a id=__codelineno-298-16 name=__codelineno-298-16 href=#__codelineno-298-16></a><span class=c1>// Prints: 74c3a97374</span>
</span><span id=__span-298-17><a id=__codelineno-298-17 name=__codelineno-298-17 href=#__codelineno-298-17></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf2</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>));</span>
</span><span id=__span-298-18><a id=__codelineno-298-18 name=__codelineno-298-18 href=#__codelineno-298-18></a><span class=c1>// Prints: té</span>
</span><span id=__span-298-19><a id=__codelineno-298-19 name=__codelineno-298-19 href=#__codelineno-298-19></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>buf2</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=kc>undefined</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>));</span>
</span><span id=__span-298-20><a id=__codelineno-298-20 name=__codelineno-298-20 href=#__codelineno-298-20></a><span class=c1>// Prints: té</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/api/buffer.html#buffer_buf_write_string_offset_length_encoding>buf.write(string[, offset[, length]][, encoding])</a></li> <li>args<ul> <li>string: (string)</li> <li>指定要寫入(write)到<code>Buffer</code>(緩存)物件(object)裡面的字串(<code>string</code>)</li> <li>offset: (integer)</li> <li>要先跳過(skip)多少數量的位元組(number of bytes)後才開始(starting)將指定的字串(<code>string</code>)寫入(write)到<code>Buffer</code>(緩存)物件(object)中</li> <li>length: (integer)</li> <li>可限制最大(maximum)能寫入(write)多少數量的位元組(number of bytes)(並且這個指定大小的數值"不能"超過(not exceed)<code>buf.length - offset</code>的值)</li> <li>預設值: <code>buf.length - offset</code></li> <li>encoding: (string)</li> <li>可指定要用哪種字元編碼格式(character encoding)來將<code>string</code>編碼(encoding)為<code>Buffer</code>(緩存)物件(object)</li> <li>Returns: (integer)</li> <li>此方法(method)會回傳有多少數量的位元組(number of bytes)已經被寫入(written)了</li> </ul> </li> <li>此方法(method)會將<code>string</code>(字串)寫入到<code>Buffer</code>(緩存)物件(object)中,並根據(according to)<code>encoding</code>(字元編碼格式)來編碼(encoding)<ul> <li>此方法(method)的<code>length</code>參數(parameter)值是用來代表要寫入(write)的<code>Buffer</code>(緩存)物件(object)會用掉多少數量的位元組(number of bytes)。若<code>buf</code>物件(object)沒有包含(contain)足夠(enough)的空間(space)能填入整個(entire)指定的<code>string</code>(字串)的話,那麼就只會有部分(part)的指定的<code>string</code>(字串)會被寫入(written)。然而(However),這樣就不會將那些部分(partially)的編碼過後的字元(encoded characters)了寫入到<code>Buffer</code>(緩存)物件(object)中了 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-299-1><a id=__codelineno-299-1 name=__codelineno-299-1 href=#__codelineno-299-1></a><span class=kd>const</span><span class=w> </span><span class=nx>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>256</span><span class=p>);</span>
</span><span id=__span-299-2><a id=__codelineno-299-2 name=__codelineno-299-2 href=#__codelineno-299-2></a>
</span><span id=__span-299-3><a id=__codelineno-299-3 name=__codelineno-299-3 href=#__codelineno-299-3></a><span class=kd>const</span><span class=w> </span><span class=nx>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>buf</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;\u00bd + \u00bc = \u00be&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>);</span>
</span><span id=__span-299-4><a id=__codelineno-299-4 name=__codelineno-299-4 href=#__codelineno-299-4></a>
</span><span id=__span-299-5><a id=__codelineno-299-5 name=__codelineno-299-5 href=#__codelineno-299-5></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>len</span><span class=si>}</span><span class=sb> bytes: </span><span class=si>${</span><span class=nx>buf</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=nx>len</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-299-6><a id=__codelineno-299-6 name=__codelineno-299-6 href=#__codelineno-299-6></a><span class=c1>// Prints: 12 bytes: ½ + ¼ = ¾</span>
</span><span id=__span-299-7><a id=__codelineno-299-7 name=__codelineno-299-7 href=#__codelineno-299-7></a>
</span><span id=__span-299-8><a id=__codelineno-299-8 name=__codelineno-299-8 href=#__codelineno-299-8></a><span class=kd>const</span><span class=w> </span><span class=nx>buffer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-299-9><a id=__codelineno-299-9 name=__codelineno-299-9 href=#__codelineno-299-9></a>
</span><span id=__span-299-10><a id=__codelineno-299-10 name=__codelineno-299-10 href=#__codelineno-299-10></a><span class=kd>const</span><span class=w> </span><span class=nx>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>buffer</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;abcd&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>8</span><span class=p>);</span>
</span><span id=__span-299-11><a id=__codelineno-299-11 name=__codelineno-299-11 href=#__codelineno-299-11></a>
</span><span id=__span-299-12><a id=__codelineno-299-12 name=__codelineno-299-12 href=#__codelineno-299-12></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>length</span><span class=si>}</span><span class=sb> bytes: </span><span class=si>${</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>8</span><span class=p>,</span><span class=w> </span><span class=mf>10</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-299-13><a id=__codelineno-299-13 name=__codelineno-299-13 href=#__codelineno-299-13></a><span class=c1>// Prints: 2 bytes : ab</span>
</span></code></pre></div></li> </ul> </li> </ul> </li> </ul> <h3 id=stream><a href=https://nodejs.org/api/stream.html#stream_stream>Stream</a><a class=headerlink href=#stream title="Permanent link">&para;</a></h3> <ul> <li><code>stream</code>(串流)是在Node中用來處理(working with)數據串流(streaming data)的抽象(abstract)介面(interface)</li> <li>Node內建的<code>stream</code>(串流)模組(module)就是用來提供API來實作(implementing)<code>stream</code></li> <li>Node有提供許多的<code>stream</code>(串流)物件(objects)。舉例來說,以下2種都算是<code>stream</code>實例(instances)</li> <li>往伺服器端發送的請求(<a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage>a request to an HTTP server</a>)</li> <li>連接(connected)到標準輸出(<code>stdout</code>)的串流(<a href=https://nodejs.org/api/process.html#process_process_stdout>process.stdout</a>)</li> <li><code>stream</code>(串流)是可讀取的(readable) &amp; 可寫入的(writable)</li> <li>所有的<code>stream</code>(串流)都是<a href=https://nodejs.org/api/events.html#events_class_eventemitter>EventEmitter</a>的實例(instances)</li> <li>如果想要存取(access)<code>stream</code>(串流)模組(module)的話,能透過以下範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-300-1><a id=__codelineno-300-1 name=__codelineno-300-1 href=#__codelineno-300-1></a><span class=kd>const</span><span class=w> </span><span class=nx>stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>);</span>
</span></code></pre></div></li> <li><code>stream</code>(串流)模組(module)對於想要建立新的串流實例型別的話是非常有用的</li> <li>通常不需要(not necessary)利用(use)<code>stream</code>(串流)模組(module)來消化(consume)<code>stream</code>(串流)<blockquote> <p>此文件的編排 (Organization of this document)</p> </blockquote> </li> <li>此文件(document)包含(contains)了2個主要(primary)的部分(sections)以及第3部分為註解(notes)<ul> <li>第1個部分(section)是在說明(explains)要如何在一個應用程式(application)中(within)使用(use)已經存在(existing)的<code>streams</code>(串流)</li> <li>第2部分(section)是在說明(explains)該如何建立(create)新類型(new types)的<code>streams</code>(串流)<blockquote> <p><code>Streams</code>(串流)的類型 (Types of streams)</p> </blockquote> </li> </ul> </li> <li>在Node中,會有4種基礎的<code>streams</code>(串流)的類型(types)<ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_writable>Writable</a>: 可以向其寫入(written)數據(data)的<code>streams</code>(串流)</li> <li>例: <a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createwritestream_path_options>fs.createWriteStream()</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>Readable</a>: 可以從其之中讀取(read)數據(data)的<code>streams</code>(串流)</li> <li>例: <a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_fs_createreadstream_path_options>fs.createReadStream()</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_duplex>Duplex</a>: 同時可以寫入(Writable) &amp; 讀取(Readable)的<code>streams</code>(串流)</li> <li>例: <a href=https://nodejs.org/dist/latest-v15.x/docs/api/net.html#net_class_net_socket>net.Socket</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_transform>Transaform</a>: 就是一種能在寫入(written) or 讀取(read)時,可以修改(modify)或是轉換(transform)的<code>streams</code>(串流)</li> <li>例: <a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html#zlib_zlib_createdeflate_options>zlib.createDeflate()</a></li> </ul> </li> <li>此外(Additionally),<code>stream</code>(串流)模組(module)包括(includes)了一些實用(utility)的功能(functions),像是以下這幾種<ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_stream_pipeline_source_transforms_destination_callback>stream.pipeline()</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_stream_finished_stream_options_callback>stream.finished()</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_stream_readable_from_iterable_options>stream.Readable.from()</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_stream_addabortsignal_signal_stream>stream.addAbortSignal()</a></li> </ul> </li> <li> <blockquote> <p><code>Stream</code>(串流)的<code>Promise</code>API (Streams Promises API)</p> </blockquote> <ul> <li><code>stream</code>/<code>promise</code>API會提供(provides)一個能回傳(return)<code>Promise</code>物件(objects)而不是(rather than)使用回呼函式(callbacks)的一組(set)非同步(asynchronous)實用功能(utility functions)的<code>stream</code>(串流)</li> <li>這組<code>Promsie</code>API能透過(via)以下2種方式來使用(accessible) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-301-1><a id=__codelineno-301-1 name=__codelineno-301-1 href=#__codelineno-301-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream/promises&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-302-1><a id=__codelineno-302-1 name=__codelineno-302-1 href=#__codelineno-302-1></a><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>).</span><span class=nx>promises</span><span class=p>.</span>
</span></code></pre></div></li> </ul> </li> <li> <blockquote> <p>物件模式 (Object mode)</p> </blockquote> <ul> <li>所有透過Node的APIs操作(operate)下,所建立(created)的<code>streams</code>(串流)都僅(exclusively)是字串(strings)、<code>Buffer</code>(緩存)、或是<code>Unit8Array</code>物件(objects)</li> <li>然而(however),要利用其它Javascript的值(values)來實現(implementations)<code>stream</code>(串流)是有可能(possible)的(=&gt; 但是不包含<code>null</code>,因為<code>null</code>在<code>streams</code>(串流)中是有其它特殊用途(special purpose)的),而以上這種情況的<code>stream</code>(串流)就會被視為(considered to)以"物件模式(object mode)"來操作(operate)</li> </ul> </li> <li> <blockquote> <p>緩存 (Buffering)</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>Writable</a>與<a href=https://nodejs.org/api/stream.html#stream_class_stream_readable>Readable</a><code>streams</code>(串流)都可以將資料儲存(store data)在內部(internal)<code>buffer</code>(緩存)中</li> <li>可能(potentially)緩存(buffered)的資料量(data)是取決於(depends on)傳入(passed into)到<code>stream</code>(串流)建構子(constructor)中的高水位線(<code>highWaterMark</code>)的選項(option)</li> <li>對於正常(normal)的<code>streams</code>(串流)而言,所謂的高水位線(<code>highWaterMark</code>)的選項(option)就是指可以指定(specifies)位元組的總數量(<a href=https://nodejs.org/api/stream.html#stream_highwatermark_discrepancy_after_calling_readable_setencoding>total number of bytes</a>)</li> <li>對於在物件模式(object mode)操作(operating)的<code>streams</code>(串流)而言,所謂的高水位線(<code>highWaterMark</code>)的選項(option)就是指可以指定(specifies)物件的總數量(<code>total number of objects</code>)</li> <li>當透過呼叫(calls)<a href=https://nodejs.org/api/stream.html#stream_readable_push_chunk_encoding>stream.push(chunk)</a>方法來實現(implementation)緩存時,資料(data)會被緩存(buffered in)到可讀取串流中(<code>Readable streams</code>)</li> <li>這時,如果此<code>streams</code>(串流)的消費者(consumer) <strong>沒有呼叫</strong> (call)<a href=https://nodejs.org/api/stream.html#stream_readable_read_size>stream.read()</a>方法的話,那麼該資料(data)就會代理(sit in)內部隊列(internal queue)直到(until)該資料被消化掉(consumed)為止</li> <li>一旦(Once)內部可讀取緩存(internal read <code>buffer</code>)的總大小(total size) <strong>到達</strong> (reaches)了指定(specified)的高水位線(<code>highWaterMark</code>)門檻(threshold)時,這時該<code>stream</code>(串流)就會就會停止(stop)從基礎資源(underlying resource)中讀取(reading)資料(data),直到當前(currently)的緩存資料(the data currently buffered)能被消化(consumed)時才會繼續讀取</li> <li>也就是說,該<code>stream</code>(串流)會停止呼叫內部的<a href=https://nodejs.org/api/stream.html#stream_readable_read_size_1>readable._read()</a>方法(method),而這個方法就是被用來(used to)填滿(fill)可讀取串流(read buffer)</li> <li>當<a href=https://nodejs.org/api/stream.html#stream_writable_write_chunk_encoding_callback>writable.write(chunk)</a>方法(method)被重複地呼叫(called repeatedly)時,資料(data)就會被緩存(buffered in)到可寫入串流(<code>Writable streams</code>)中。當(while)內部可寫入緩存(internal write buffer)的總大小(total size) <strong>低於</strong> (below)設定(set)好的高水位線(<code>highWaterMark</code>)門檻(threshold)時,這時呼叫(calls)<code>writable.write()</code>方法(method)就會回傳(return)<code>true</code>。而一旦(Once)內部可寫入緩存(internal write buffer)的總大小(total size) <strong>到達</strong> (reaches) or <strong>超過</strong> (exceeds)高水位線(<code>highWaterMark</code>)門檻(threshold)時,則會回傳(returned)<code>false</code></li> <li><code>Stream API</code>的其中一個關鍵目標(key goal),尤其(particularly)是<a href=https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options>stream.pipe()</a>方法(method),就是限制(limit)資料(data)的緩存(buffering)在一個可接受(acceptable)的程度(levels)之內,以使資源(resources) &amp; 不同速度的目標(destinations of differing speeds)能夠不會淹沒(overwhelm)掉可用(available)的記憶體空間(memory)</li> <li><strong>高水位線(<code>highWaterMark</code>)選項(option)是一個門檻(threshold),而不是一種限制(limit)。它代表在請求(asking)更多的資料之前,該緩存串流(<code>stream buffers</code>)所擁有的資料量(the amount of data)</strong></li> <li>通常(in general),它並不會強制執行(enforce)嚴格(strict)的記憶體(memory)限制(limitation)。我們可以在特定(specific)的<code>stream</code>(串流)實作(implementations)中選擇(choose to)實施(enforce)更嚴格(stricter)的記憶體限制(limits),但高水位線(<code>highWaterMark</code>)這個選項仍然是選擇性(optional)的操作</li> <li>因為<a href=https://nodejs.org/api/stream.html#stream_class_stream_duplex>Duplex</a>、<a href=https://nodejs.org/api/stream.html#stream_class_stream_transform>Transform</a>都是可以被讀取(<code>Readable</code>)也可以被寫入(<code>Writable</code>)的,每一個<code>stream</code>(串流)會維護(maintains)2個用來讀取(reading) &amp; 寫入(writing)的分開(separate)的內部的緩存(internal <code>buffers</code>),從而允許(allowing)每一端(each side)獨立(independently)於另一端(the other)進行操作(operate),同時保持(maintaining)適當(appropriate)且有效率(efficient)的數據流(flow of data)</li> <li>舉例來說,<a href=https://nodejs.org/api/net.html#net_class_net_socket>net.Socket</a>實例(instances)是雙向串流(<a href=https://nodejs.org/api/stream.html#stream_class_stream_duplex>Duplex</a> <code>streams</code>),而它的可讀取這端(<code>Readable</code> side)允許(allows)消化(consumption)掉從插座(<code>socket</code>)接收(received)到的資料。另外,它的可寫入這端(<code>Writable</code> side)允許(allows)將資料寫入(writing data)到該插座(<code>socket</code>)中</li> <li>這麼做是因為資料寫入到插座(data may be written to <code>socket</code>)的速率(rate)有可能會比收到的時間來得快(faster) or 慢(slower),因此每一端(each side)應該要獨立地(independently)操作(operate) &amp; <code>buffer</code>(緩存)於另一端(the other)</li> <li>內部緩存機制(The mechanics of the internal buffering)是一個內部實作(internal implementation)的細節(detail),而這個細節可能會在任何一個時間(at any time)被改變(changed)掉<ul> <li>然而(However),對於某些進階(certain advanced)的實作(implementations)而言,內部緩存(<code>internal buffers</code>)可以透過<code>writable.writableBuffer</code>、<code>readable.readableBuffer</code>屬性來得到(retrieved)。但是使用像這樣沒有被正式文件化(undocumented)的屬性(properties),是不被鼓勵(discouraged)這麼做的<blockquote> <p><code>stream</code>(串流)消費者的API (API for stream consumers)</p> </blockquote> </li> </ul> </li> </ul> </li> <li>幾乎所有的Node應用程式(applications),不管是多簡單,都會以某種方式(manner)來使用<code>streams</code>(串流)。接下來的就是一個在Node應用程式中使用<code>streams</code>(串流)來實作(implements)一個<code>HTTP</code>伺服器(server)的範例程式碼 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-303-1><a id=__codelineno-303-1 name=__codelineno-303-1 href=#__codelineno-303-1></a><span class=kd>const</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span><span id=__span-303-2><a id=__codelineno-303-2 name=__codelineno-303-2 href=#__codelineno-303-2></a>
</span><span id=__span-303-3><a id=__codelineno-303-3 name=__codelineno-303-3 href=#__codelineno-303-3></a><span class=kd>const</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-303-4><a id=__codelineno-303-4 name=__codelineno-303-4 href=#__codelineno-303-4></a><span class=w>  </span><span class=c1>// `req` is an http.IncomingMessage, which is a readable stream.</span>
</span><span id=__span-303-5><a id=__codelineno-303-5 name=__codelineno-303-5 href=#__codelineno-303-5></a><span class=w>  </span><span class=c1>// `res` is an http.ServerResponse, which is a writable stream.</span>
</span><span id=__span-303-6><a id=__codelineno-303-6 name=__codelineno-303-6 href=#__codelineno-303-6></a>
</span><span id=__span-303-7><a id=__codelineno-303-7 name=__codelineno-303-7 href=#__codelineno-303-7></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>body</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span>
</span><span id=__span-303-8><a id=__codelineno-303-8 name=__codelineno-303-8 href=#__codelineno-303-8></a><span class=w>  </span><span class=c1>// Get the data as utf8 strings.</span>
</span><span id=__span-303-9><a id=__codelineno-303-9 name=__codelineno-303-9 href=#__codelineno-303-9></a><span class=w>  </span><span class=c1>// If an encoding is not set, Buffer objects will be received.</span>
</span><span id=__span-303-10><a id=__codelineno-303-10 name=__codelineno-303-10 href=#__codelineno-303-10></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>setEncoding</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>);</span>
</span><span id=__span-303-11><a id=__codelineno-303-11 name=__codelineno-303-11 href=#__codelineno-303-11></a>
</span><span id=__span-303-12><a id=__codelineno-303-12 name=__codelineno-303-12 href=#__codelineno-303-12></a><span class=w>  </span><span class=c1>// Readable streams emit &#39;data&#39; events once a listener is added.</span>
</span><span id=__span-303-13><a id=__codelineno-303-13 name=__codelineno-303-13 href=#__codelineno-303-13></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-303-14><a id=__codelineno-303-14 name=__codelineno-303-14 href=#__codelineno-303-14></a><span class=w>    </span><span class=nx>body</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>chunk</span><span class=p>;</span>
</span><span id=__span-303-15><a id=__codelineno-303-15 name=__codelineno-303-15 href=#__codelineno-303-15></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-303-16><a id=__codelineno-303-16 name=__codelineno-303-16 href=#__codelineno-303-16></a>
</span><span id=__span-303-17><a id=__codelineno-303-17 name=__codelineno-303-17 href=#__codelineno-303-17></a><span class=w>  </span><span class=c1>// The &#39;end&#39; event indicates that the entire body has been received.</span>
</span><span id=__span-303-18><a id=__codelineno-303-18 name=__codelineno-303-18 href=#__codelineno-303-18></a><span class=w>  </span><span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-303-19><a id=__codelineno-303-19 name=__codelineno-303-19 href=#__codelineno-303-19></a><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-303-20><a id=__codelineno-303-20 name=__codelineno-303-20 href=#__codelineno-303-20></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>body</span><span class=p>);</span>
</span><span id=__span-303-21><a id=__codelineno-303-21 name=__codelineno-303-21 href=#__codelineno-303-21></a><span class=w>      </span><span class=c1>// Write back something interesting to the user:</span>
</span><span id=__span-303-22><a id=__codelineno-303-22 name=__codelineno-303-22 href=#__codelineno-303-22></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=ow>typeof</span><span class=w> </span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-303-23><a id=__codelineno-303-23 name=__codelineno-303-23 href=#__codelineno-303-23></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span><span id=__span-303-24><a id=__codelineno-303-24 name=__codelineno-303-24 href=#__codelineno-303-24></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>er</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-303-25><a id=__codelineno-303-25 name=__codelineno-303-25 href=#__codelineno-303-25></a><span class=w>      </span><span class=c1>// uh oh! bad json!</span>
</span><span id=__span-303-26><a id=__codelineno-303-26 name=__codelineno-303-26 href=#__codelineno-303-26></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>400</span><span class=p>;</span>
</span><span id=__span-303-27><a id=__codelineno-303-27 name=__codelineno-303-27 href=#__codelineno-303-27></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=sb>`error: </span><span class=si>${</span><span class=nx>er</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-303-28><a id=__codelineno-303-28 name=__codelineno-303-28 href=#__codelineno-303-28></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-303-29><a id=__codelineno-303-29 name=__codelineno-303-29 href=#__codelineno-303-29></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-303-30><a id=__codelineno-303-30 name=__codelineno-303-30 href=#__codelineno-303-30></a><span class=p>});</span>
</span><span id=__span-303-31><a id=__codelineno-303-31 name=__codelineno-303-31 href=#__codelineno-303-31></a>
</span><span id=__span-303-32><a id=__codelineno-303-32 name=__codelineno-303-32 href=#__codelineno-303-32></a><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mf>1337</span><span class=p>);</span>
</span><span id=__span-303-33><a id=__codelineno-303-33 name=__codelineno-303-33 href=#__codelineno-303-33></a>
</span><span id=__span-303-34><a id=__codelineno-303-34 name=__codelineno-303-34 href=#__codelineno-303-34></a><span class=c1>// $ curl localhost:1337 -d &quot;{}&quot;</span>
</span><span id=__span-303-35><a id=__codelineno-303-35 name=__codelineno-303-35 href=#__codelineno-303-35></a><span class=c1>// object</span>
</span><span id=__span-303-36><a id=__codelineno-303-36 name=__codelineno-303-36 href=#__codelineno-303-36></a><span class=c1>// $ curl localhost:1337 -d &quot;\&quot;foo\&quot;&quot;</span>
</span><span id=__span-303-37><a id=__codelineno-303-37 name=__codelineno-303-37 href=#__codelineno-303-37></a><span class=c1>// string</span>
</span><span id=__span-303-38><a id=__codelineno-303-38 name=__codelineno-303-38 href=#__codelineno-303-38></a><span class=c1>// $ curl localhost:1337 -d &quot;not json&quot;</span>
</span><span id=__span-303-39><a id=__codelineno-303-39 name=__codelineno-303-39 href=#__codelineno-303-39></a><span class=c1>// error: Unexpected token o in JSON at position 1</span>
</span></code></pre></div><ul> <li>可寫入串流(<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_writable>Writable streams</a>)(=&gt; 就像是上面範例程式碼中的<code>res</code>一樣)會公開(expose)一些方法(methods),例如:<code>res.write()</code>、<code>res.end()</code>這些方法是用來將資料寫入(write data)到<code>stream</code>(串流)中的</li> <li>可讀取串流(<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>Readable streams</a>)會在當資料(data)可以從<code>stream</code>(串流)中被讀取(read off)時,使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_class_eventemitter>EventEmitter</a>API來通知(notifying)應用程式的程式碼(application code)</li> <li>而該可從<code>stream</code>(串流)中讀取的資料(available data)可以利用多種方式(multiple ways)來讀取(read from)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_writable>Writable streams</a>、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>Readable streams</a>都可以透過多種方式(in various ways)來使用(use)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_class_eventemitter>EventEmitter</a>API來傳達(communicate)當前<code>stream</code>(串流)的狀態(state)</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_duplex>Duplex</a>、<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_transform>Transform</a>都是可寫入串流(<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_writable>Writable streams</a>) &amp; 可讀取串流(<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>Readable streams</a>)</li> <li>從<code>stream</code>(串流)中寫入資料(writing data) or 消化資料(consuming data)的應用程式(applications)不會被要求(not required)要直接(directly)地實作(implement)串流介面(<code>stream</code> interfaces),並且通常(generally)沒有理由(have no reason)會需要呼叫(call)<code>require('stream')</code>語法</li> <li>想要實作(implement)新(new)的<code>streams</code>類型(types)的開發者(developers)們可以參考(refer to)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_api_for_stream_implementers>API for stream implementers</a>章節(section)</li> </ul> </li> <li> <blockquote> <p>可寫入串流 (Writable streams)</p> </blockquote> <ul> <li>可寫入串流(writable streams)是一個給資料(data)寫入(written)的抽象(abstraction)目的地(destination)</li> <li>以下是常見的可寫入串流(writable streams)的範例,包括了</li> <li><a href=https://nodejs.org/api/http.html#http_class_http_clientrequest>HTTP requests, on the client</a></li> <li><a href=https://nodejs.org/api/http.html#http_class_http_serverresponse>HTTP responses, on the server</a></li> <li><a href=https://nodejs.org/api/fs.html#fs_class_fs_writestream>fs write streams</a></li> <li><a href=https://nodejs.org/api/zlib.html>zlib streams</a></li> <li><a href=https://nodejs.org/api/crypto.html>crypto streams</a></li> <li><a href=https://nodejs.org/api/net.html#net_class_net_socket>TCP sockets</a></li> <li><a href=https://nodejs.org/api/child_process.html#child_process_subprocess_stdin>child process stdin</a></li> <li><a href=https://nodejs.org/api/process.html#process_process_stdout>process.stdout</a> &amp; <a href=https://nodejs.org/api/process.html#process_process_stderr>process.stderr</a></li> <li>以上範例中的其中一些實際(actually)上是<a href=https://nodejs.org/api/stream.html#stream_class_stream_duplex>雙向串流(Duplex streams)</a>來實現可寫入介面<a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>Writable interface</a>的</li> <li>所有的可寫入串流(<a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>Writable streams</a>)會實作(implement)由<a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>stream.writable</a>類別(class)所定義(defined)的介面(interface)</li> <li>然而(While)特定(specific)的可寫入串流(<a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>Writable streams</a>)實例(instances)會在不同方面下(various ways)有所不同(differ in),但是所有可寫入串流(<code>Writable streams</code>)都會都會遵從(follow)相同(same)的基礎(fundamental)用法(usage)模式(pattern),就如同以下的範例說明(illustrate) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-304-1><a id=__codelineno-304-1 name=__codelineno-304-1 href=#__codelineno-304-1></a><span class=kd>const</span><span class=w> </span><span class=nx>myStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getWritableStreamSomehow</span><span class=p>();</span>
</span><span id=__span-304-2><a id=__codelineno-304-2 name=__codelineno-304-2 href=#__codelineno-304-2></a><span class=nx>myStream</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;some data&#39;</span><span class=p>);</span>
</span><span id=__span-304-3><a id=__codelineno-304-3 name=__codelineno-304-3 href=#__codelineno-304-3></a><span class=nx>myStream</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;some more data&#39;</span><span class=p>);</span>
</span><span id=__span-304-4><a id=__codelineno-304-4 name=__codelineno-304-4 href=#__codelineno-304-4></a><span class=nx>myStream</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;done writing data&#39;</span><span class=p>);</span>
</span></code></pre></div></li> <li> <blockquote> <p>Class</p> </blockquote> </li> <li><a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>stream.Writable</a></li> <li> <blockquote> <p>Event</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/stream.html#stream_event_pipe>pipe</a></li> <li>args<ul> <li>src: <a href=https://nodejs.org/api/stream.html#stream_class_stream_readable>stream.Readable</a></li> <li>要傳遞(piping to)給此可寫入(writable)的源頭串流(source <code>stream</code>)</li> </ul> </li> <li><code>pipe</code>事件(event)會在可讀取串流(readable stream)呼叫(called)<a href=https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options>stream.pipe()</a>方法(method)時被發出(emitted),並可以將這個可寫入串流(writable stream)添加(adding)到其設定好(its set of)的目的地(destination)<ul> <li><code>js const writer = getWritableStreamSomehow(); const reader = getReadableStreamSomehow(); writer.on('pipe', (src) =&gt; { console.log('Something is piping into the writer.'); assert.equal(src, reader); }); reader.pipe(writer);</code></li> </ul> </li> </ul> </li> <li> <blockquote> <p>method</p> </blockquote> <ul> <li><a href=https://nodejs.org/api/stream.html#stream_writable_end_chunk_encoding_callback>writable.end([chunk[, encoding]][, callback])</a></li> <li>args<ul> <li>chunk: (string | <a href=https://nodejs.org/api/buffer.html#buffer_class_buffer>Buffer</a> | <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Unit8Array</a>) | <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types>any</a>)</li> <li>要寫入(write)的可選擇性(optional)資料(data)。對於那些"不是"在物件模式(object mode)下操作(operating)的<code>streams</code>(串流)來說,<code>chunk</code>參數值的型別必須為字串(string) or <code>Buffer</code>(緩存) or <code>Unit8Array</code>三者之一。而對於物件模式(object mode)的<code>streams</code>來說,<code>chunk</code>參數值的型別可以是任何Javascript中的任何型別(<code>any</code>) or <code>null</code></li> <li>encoding: (string)</li> <li>如果<code>chunk</code>參數的值是字串(string)型別的話,可以指定要使用的編碼格式(encoding)</li> <li>callback: (function)</li> <li>當<code>stream</code>(串流)結束(finished)時,要執行的回呼函式(callback)</li> <li>Returns: (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this>this</a>)</li> </ul> </li> <li>當呼叫(calling)此<code>writable.end()</code>方法(method)時,就是以信號發出(signals)已經沒有更多(no more)的資料(data)要寫入(written)到可寫入串流(<a href=https://nodejs.org/api/stream.html#stream_class_stream_writable>Writable</a>)中<ul> <li>而可選擇性(optional)輸入的<code>chunk</code> &amp; <code>encoding</code> 這2個參數(arguments)可允許(allow)在關閉(closing)<code>stream</code>(串流)之前,立即(immediately)寫入(written)最後一個(one final)額外(additional)的資料塊(chunk of data)</li> </ul> </li> <li>若在呼叫(calling)<a href=https://nodejs.org/api/stream.html#stream_writable_write_chunk_encoding_callback>stream.end()</a>方法(method)之後(after)才呼叫(calling)<a href=https://nodejs.org/api/stream.html#stream_writable_end_chunk_encoding_callback>stream.write()</a>方法(method)的話,會引發錯誤(raise an error) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-305-1><a id=__codelineno-305-1 name=__codelineno-305-1 href=#__codelineno-305-1></a><span class=c1>// Write &#39;hello, &#39; and then end with &#39;world!&#39;.</span>
</span><span id=__span-305-2><a id=__codelineno-305-2 name=__codelineno-305-2 href=#__codelineno-305-2></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span><span id=__span-305-3><a id=__codelineno-305-3 name=__codelineno-305-3 href=#__codelineno-305-3></a><span class=kd>const</span><span class=w> </span><span class=nx>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>createWriteStream</span><span class=p>(</span><span class=s1>&#39;example.txt&#39;</span><span class=p>);</span>
</span><span id=__span-305-4><a id=__codelineno-305-4 name=__codelineno-305-4 href=#__codelineno-305-4></a><span class=nx>file</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;hello, &#39;</span><span class=p>);</span>
</span><span id=__span-305-5><a id=__codelineno-305-5 name=__codelineno-305-5 href=#__codelineno-305-5></a><span class=nx>file</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;world!&#39;</span><span class=p>);</span>
</span><span id=__span-305-6><a id=__codelineno-305-6 name=__codelineno-305-6 href=#__codelineno-305-6></a><span class=c1>// Writing more now is not allowed!</span>
</span></code></pre></div></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback>writable.write(chunk[, encoding][, callback])</a></li> <li>args<ul> <li>chunk: (string | <a href=https://nodejs.org/api/buffer.html#buffer_class_buffer>Buffer</a> | <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array>Unit8Array</a>) | <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types>any</a>)</li> <li>要寫入(write)的可選擇性(optional)資料(data)。對於那些"不是"在物件模式(object mode)下操作(operating)的<code>streams</code>(串流)來說,<code>chunk</code>參數值的型別必須為字串(string) or <code>Buffer</code>(緩存) or <code>Unit8Array</code>三者之一。而對於物件模式(object mode)的<code>streams</code>來說,<code>chunk</code>參數值的型別可以是任何Javascript中的任何型別(<code>any</code>) or <code>null</code></li> <li>encoding: (string)</li> <li>如果<code>chunk</code>參數的值是字串(string)型別的話,可以指定要使用的編碼格式(encoding)</li> <li>預設值: <code>utf8</code></li> <li>callback: (function)</li> <li>可指定當刷新(flushed)此資料塊(chunk of data)的時候要呼叫的回呼函式(callback)</li> <li>Returns: (boolean)</li> <li>若<code>stream</code>(串流)希望(wishes)在繼續(continuing)寫入(write)額外(additional)的資料(data)之前,先等待(wait for)<code>drain</code>事件(event)被發出(emitted)後,再來呼叫(calling)程式碼(code),則該方法會回傳<code>false</code>; 否則(otherwise),就是<code>true</code></li> </ul> </li> <li>此方法(method)會寫入(writes)一些資料(data)到<code>stream</code>(串流)中,並在資料被完全處理(fully handled)後,才會呼叫我們所提供(supplied)的回呼函式(callback)<ul> <li>若有發生(occurs)錯誤(error)的話,則回呼函式(callback)可以選擇要不要以<code>errors</code>(錯誤)為第1個參數(argument)。為了可靠(reliably)地偵測(detect)到錯誤(errors),我們可以新增(add)一個事件監聽器(event listener)給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_error>error</a>(錯誤)事件(event),而回呼函式(callback)會在<code>error</code>事件被發出(emitted)之前(before),以非同步(asynchronously)的方式被呼叫(called)</li> </ul> </li> <li>若內部緩存(internal <code>buffer</code>)小於(less than)我們所配置(configured)的高水位線(<code>highWaterMark</code>),並且當<code>stream</code>串流被建立(created)時已經允許(admitted)<code>chunk</code>了的話,則此方法會回傳<code>true</code><ul> <li>若此方法回傳<code>false</code>,則應停止(stop)進一步(further)嘗試(attempts)要將資料(data)寫入(write)<code>stream</code>串流,直到<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_drain>drain</a>事件(event)被發出(emitted)後</li> </ul> </li> <li>當<code>stream</code>串流沒有耗盡(not draining)時,呼叫<code>writable.write()</code>方法(method)會緩存<code>chunk</code>,並且此方法會回傳<code>false</code>。當目前(currently)所有(all)的緩存資料塊(buffered chunks)都耗盡(drained)時(=&gt; 由作業系統(operating system)負責接受(accepted)傳遞(delivery)),<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_drain>drain</a>事件(event)就會被發出(emitted)<ul> <li>建議當此方法回傳(returns)<code>false</code>時,就不要再(no more)寫入任何的資料塊(chunks),直到<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_drain>drain</a>事件(event)被發出(emitted)後,才能繼續寫入資料塊</li> <li>然而,呼叫<code>write()</code>方法在一個還沒有耗盡(not draining)的<code>stream</code>串流上是可允許(allowed)的,Node會緩存(buffer)所有寫入(writter)的資料塊(chunks),直到到(until)達最大記憶體使用量(maximum memory usage)限制發生(occurs)為止,在這時將會無條件(unconditionally)地終止(abort)。即使(even)在終止(abort)之前(before),高記憶體使用率(high memory usage)會造成貧乏(poor)的垃圾回收效能(garbage collector performance)、RSS(一般來說不會被釋放(released back)回作業系統中(system),即使(even)在那些記憶體(memory)已經不再(no longer)被需要(required)後)。若遠端(remote)對等方(peer)不讀取(not read)資料(data)的話,則<code>TCP</code>插座(sockets)可能永遠不會耗盡(drain),因此寫入(writing)一個不會被耗盡(not draining)的插座(socket),可能會導致(lead to)遠端(remotely)可被利用(exploitable)的弱點(vulnerability)</li> </ul> </li> <li>當<code>stream</code>串流沒有被耗盡時,就寫入資料對<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_transform>Transform stream</a>來說是尤其有問題(particularly problematic)的,因為<code>Transform streams</code>在默認(default)情況下是會暫停(paused)的,直到(until)它們被透過管道傳遞(piped) or 一個<code>data</code> or <code>readable</code>事件處理器(event handler)被新增(added)後才會繼續開始</li> <li>如果要寫入(written)的資料(data)能夠按照需求(on demand)生成(generated) or 獲取(fetched),則建議(recommended)將邏輯(logic)封裝(encapsulate)進可讀取串流(<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>Readable</a>)中,並利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>stream.pipe()</a>方法(method)來完成<ul> <li>然而(However),若呼叫<code>writable.write()</code>方法是優先使用(preferred)的話,這是有可能(possible)的要尊重背壓(respect backpressure)且避免(avoid)記憶體問題(memory issues),並使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_drain>drain</a>事件(event) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-306-1><a id=__codelineno-306-1 name=__codelineno-306-1 href=#__codelineno-306-1></a><span class=kd>function</span><span class=w> </span><span class=nx>write</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-306-2><a id=__codelineno-306-2 name=__codelineno-306-2 href=#__codelineno-306-2></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>stream</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>data</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-306-3><a id=__codelineno-306-3 name=__codelineno-306-3 href=#__codelineno-306-3></a><span class=w>    </span><span class=nx>stream</span><span class=p>.</span><span class=nx>once</span><span class=p>(</span><span class=s1>&#39;drain&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>cb</span><span class=p>);</span>
</span><span id=__span-306-4><a id=__codelineno-306-4 name=__codelineno-306-4 href=#__codelineno-306-4></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-306-5><a id=__codelineno-306-5 name=__codelineno-306-5 href=#__codelineno-306-5></a><span class=w>    </span><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(</span><span class=nx>cb</span><span class=p>);</span>
</span><span id=__span-306-6><a id=__codelineno-306-6 name=__codelineno-306-6 href=#__codelineno-306-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-306-7><a id=__codelineno-306-7 name=__codelineno-306-7 href=#__codelineno-306-7></a><span class=p>}</span>
</span><span id=__span-306-8><a id=__codelineno-306-8 name=__codelineno-306-8 href=#__codelineno-306-8></a>
</span><span id=__span-306-9><a id=__codelineno-306-9 name=__codelineno-306-9 href=#__codelineno-306-9></a><span class=c1>// Wait for cb to be called before doing any other write.</span>
</span><span id=__span-306-10><a id=__codelineno-306-10 name=__codelineno-306-10 href=#__codelineno-306-10></a><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-306-11><a id=__codelineno-306-11 name=__codelineno-306-11 href=#__codelineno-306-11></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Write completed, do more writes now.&#39;</span><span class=p>);</span>
</span><span id=__span-306-12><a id=__codelineno-306-12 name=__codelineno-306-12 href=#__codelineno-306-12></a><span class=p>});</span>
</span></code></pre></div></li> </ul> </li> <li>補充: 一個物件模式(object mode)下的可寫入串流(Writable stream),將總是(always)會忽略(ignore)掉<code>encoding</code>這個參數(argument)</li> </ul> </li> <li> <blockquote> <p>properties</p> </blockquote> <ul> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_writable>writable.writable</a></li> <li>Returns: (boolean)</li> <li>如果此屬性(<code>writable.writable</code>)的值是<code>true</code>的話,那就能安全地呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback>writable.write()</a>方法(method)了,也就是代表該<code>stream</code>(串流)沒有被消滅(destroyed)掉 or 發生錯誤(errored) or 結束(ended)</li> </ul> </li> </ul> </li> <li> <blockquote> <p>可讀取串流 (Readable streams)</p> </blockquote> <ul> <li>可讀取串流(readable streams)是一個消耗(consumed)掉資料(data)的抽象(abstraction)來源(source)</li> <li>以下是常見的可讀取串流(readable streams)的範例,包括了</li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_class_http_incomingmessage>HTTP responses, on the client</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_class_http_incomingmessage>HTTP requests, on the server</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/fs.html#fs_class_fs_readstream>fs read streams</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/zlib.html>zlib streams</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/crypto.html>crypto streams</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/net.html#net_class_net_socket>TCP sockets</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/child_process.html#child_process_subprocess_stdout>child process stdout and stderr</a></li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/process.html#process_process_stdin>process.stdin</a></li> <li>所有的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>可讀取串流</a>(Readable streams)都是透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>stream.readable</a>類別(class)來實作(implement)介面(interface)的</li> <li> <blockquote> <p>2種可讀取串流的模式 (Two reading modes)</p> </blockquote> </li> <li>可讀取串流(readable streams)可以用以下2種有效率(effective)的模式(modes)之一來操作(operate)<ul> <li>流動模式(<code>flowing</code>)</li> <li>暫停模式(<code>paused</code>)</li> </ul> </li> <li>以上這2種模式都是從物件模式(object mode)下的串流中分離出來(separate from)的。一個可讀取串流(readable stream)可以是物件模式(object mode)也可以不是,不管它是在流動模式(<code>flowing</code> mode) or 暫停模式(<code>paused</code> mode)</li> <li>在流動模式(<code>flowing</code> mode)中,資料(data)是從底層系統(underlying system)讀取進來(read from)的,並使用事件(events)自動(automatically)且盡快(as quickly as possible)地透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_class_eventemitter>EventEmitter</a>介面(interface)來將資料提供(provided)給應用程式(application)</li> <li>在暫停模式(<code>paused</code> mode)中,<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size>stream.read()</a>方法(method)必須被明確(explicitly)地呼叫(called)來讀取(reads)<code>stream</code>(串流)中的資料塊(chunks of data)</li> <li>所有的可讀取串流(readable streams)都是從暫停模式(<code>paused</code> mode)開始(begin)的,但是都能透過以下的3種方式來切換(switched to)為流動模式(<code>flowing</code> mode)<ul> <li>新增(Adding)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>這個事件處理器(event handler)</li> <li>呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>stream.resume()</a>方法(method)</li> <li>呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>stream.pipe()</a>方法(method)</li> </ul> </li> <li>所有的可讀取串流(readable streams)也都能透過以下的2種方式來從流動模式(<code>flowing</code> mode)切換(switch back to)為暫停模式(<code>paused</code> mode)<ul> <li>若"沒有"管道(pipe)傳送的目的地(destinations)的話,則呼叫(calling)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pause>stream.pause()</a>方法(method)</li> <li>若有管道(pipe)傳送的目的地(destinations)的話,則要移除(removing)所有(all)的管道(pipe)傳送目的地(destination)</li> <li>多數的管道(pipe)傳送目的地(destinations)都可以透過呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_unpipe_destination>stream.umpipe()</a>方法(method)來移除(removing)掉</li> </ul> </li> <li>有一個要記住的重要觀念就是,在直到(until)可讀取串流(readable streams)提供一種消耗(consuming) or 忽略(ignoring)資料(data)的機制(mechanism)之前,都不會生成(generate)資料(data)。如果消耗機制是被禁用(disable)的 or 取消(taken away)的話,可讀取串流(readable streams)將嘗試(attempt to)停止(stop)生成(generating)資料(data)</li> <li>基於向後(backward)相容(compatibility)的原因(reasons),移除(removing)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>事件處理器(event handler)將 <strong>不會自動(autmatically)地暫停(pause)掉stream(串流)</strong><ul> <li>同樣地,如果有管道(piped)傳送的目的地(destinations)的話,則一旦(once)那些管道目的地耗盡(drain)並要求(ask)更多的資料(more data)時,這時再呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pause>stream.pause()</a>方法(method)將不能保證(guarantee)<code>stream</code>(串流)將會保持(remain)暫停(paused)的</li> </ul> </li> <li>如果將<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>可讀取串流</a>(readable streams)被切換為流動模式(<code>flowing</code> mode),則將不會有消費者(consumers)能夠(available)處理(handle)這些資料(data),而這些資料也就會遺失(lost)掉。舉例來說(for instance),當在沒有(without)附加(attached)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>事件(event) or 當事件處理器(event handler)已經從<code>stream</code>(串流)中移除(removed from)的情況下時,呼叫(called)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>readable.resume()</a>方法(method)的話,這樣的情況就會發生(oocur)</li> <li>新增一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>可讀取串流</a>(Readable)的事件處理器(event handler)會自動(automatically)地讓<code>stream</code>(串流)停止(stop)流動(<code>flowing</code>),並且資料會繼續透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size>readable.read()</a>方法(method)來消耗(consumed)掉<ul> <li>若<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_readable>readable</a>這個事件處理器(event handler)已經被移除(removed)掉,並且有<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>這個事件處理器(event handler)的話,那麼<code>stream</code>(串流)將會再(again)開始(start)流動(<code>flowing</code>)下去</li> </ul> </li> <li> <blockquote> <p>3種可讀取串流的狀態 (Three states)</p> </blockquote> </li> <li>可讀取串流(readable streams)的2種模式(tow modes)的操作(operation),其實是對於可讀取串流(readable streams)在實作(implementation)發生(happening)中的時候,其更複雜(more complicated)的內部(internal)狀態(state)管理(management)的一種簡易(simplified)抽象(abstraction)</li> <li>具體來說(Specifically),在任何(any)一個假定(given)的時間點(point in time),每一個可讀取串流(<code>Readable</code>)都會是以下3種可能(possible)的狀態(states)之一<ul> <li><code>readable.readableFlowing === null</code></li> <li><code>readable.readableFlowing === false</code></li> <li><code>readable.readableFlowing === true</code></li> <li>可參考<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_readableflowing>readable.readableFlowing#</a>章節的介紹</li> </ul> </li> <li>當<code>readable.readableFlowing</code>屬性的值是<code>null</code>的話,則將不會提供(provided)消耗(consuming)資料流(stream's data)的機制(mechanism)。因此(Therefore),<code>stream</code>(串流)將不會生成(generate)資料(data)。當在這個狀態(state)下時,附加(attaching)一個事件監聽器(listener)給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>這個事件(event),再呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>readable.pipe()</a>方法(method),或是呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>readable.resume()</a>方法(method),則會將<code>readable.readableFlowing</code>這個屬性的值切換(switch)為<code>true</code>,導致(causing)可讀取串流(Reable)會在資料(data)生成(generated)時,主動(actively)地發出(emitting)事件(events)</li> <li>呼叫(Calling)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pause>readable.pause()</a>方法(method) or <a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_unpipe_destination>readable.unpipe()</a>方法(method) or 接受(receiving)背壓(backpressure)將會導致(cause)<code>readable.readableFlowing</code>這個屬性的值被設定(set)為<code>false</code>,這將會暫時(temporarily)地終止(halting)接下來(following)的事件們(events),但是"不會"終止(halting)生成(generating)資料(data)。當處於這種狀態(state)時,附加(attaching)一個事件監聽器(listener)給<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>這個事件(event)的話,將不會把<code>readable.readableFlowing</code>這個屬性的值切換(switch)為<code>true</code> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-307-1><a id=__codelineno-307-1 name=__codelineno-307-1 href=#__codelineno-307-1></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>PassThrough</span><span class=p>,</span><span class=w> </span><span class=nx>Writable</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>);</span>
</span><span id=__span-307-2><a id=__codelineno-307-2 name=__codelineno-307-2 href=#__codelineno-307-2></a><span class=kd>const</span><span class=w> </span><span class=nx>pass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>PassThrough</span><span class=p>();</span>
</span><span id=__span-307-3><a id=__codelineno-307-3 name=__codelineno-307-3 href=#__codelineno-307-3></a><span class=kd>const</span><span class=w> </span><span class=nx>writable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Writable</span><span class=p>();</span>
</span><span id=__span-307-4><a id=__codelineno-307-4 name=__codelineno-307-4 href=#__codelineno-307-4></a>
</span><span id=__span-307-5><a id=__codelineno-307-5 name=__codelineno-307-5 href=#__codelineno-307-5></a><span class=nx>pass</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>writable</span><span class=p>);</span>
</span><span id=__span-307-6><a id=__codelineno-307-6 name=__codelineno-307-6 href=#__codelineno-307-6></a><span class=nx>pass</span><span class=p>.</span><span class=nx>unpipe</span><span class=p>(</span><span class=nx>writable</span><span class=p>);</span>
</span><span id=__span-307-7><a id=__codelineno-307-7 name=__codelineno-307-7 href=#__codelineno-307-7></a><span class=c1>// readableFlowing is now false.</span>
</span><span id=__span-307-8><a id=__codelineno-307-8 name=__codelineno-307-8 href=#__codelineno-307-8></a>
</span><span id=__span-307-9><a id=__codelineno-307-9 name=__codelineno-307-9 href=#__codelineno-307-9></a><span class=nx>pass</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>toString</span><span class=p>());</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-307-10><a id=__codelineno-307-10 name=__codelineno-307-10 href=#__codelineno-307-10></a><span class=nx>pass</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;ok&#39;</span><span class=p>);</span><span class=w>  </span><span class=c1>// Will not emit &#39;data&#39;.</span>
</span><span id=__span-307-11><a id=__codelineno-307-11 name=__codelineno-307-11 href=#__codelineno-307-11></a><span class=nx>pass</span><span class=p>.</span><span class=nx>resume</span><span class=p>();</span><span class=w>     </span><span class=c1>// Must be called to make stream emit &#39;data&#39;.</span>
</span></code></pre></div><ul> <li>當<code>readable.readableFlowing</code>這個屬性的值為<code>false</code>的話,資料(data)將可以(may)被累積(accumulating)在<code>stream</code>(串流)的內部緩存(internal buffer)之中(within)</li> </ul> </li> <li> <blockquote> <p>選擇一個API類型 (Choose one API style)</p> </blockquote> </li> <li>可讀取串流(Readable) API已經發展(evolved)成能跨(accross)多個(multiple)Node版本(versions)並提供(provides)多個(multiple)消耗(consuming)資料流(stream data)的方法(method)<ul> <li>通常來說(In general),開發者(developers)應該要選擇(choose)一個消耗(consuming)資料(data)的方法(method)並且應該永遠(never)不要在單一(single)個<code>stream</code>(串流中)使用(use)多個(multiple)方法(methods)來消耗(consume)資料(data)</li> <li>具體來說(Specifically),使用<code>on('data')</code> &amp; <code>on('readable')</code> &amp; <code>pipe()</code>的組合,或是非同步(asynchronous)的迭代器(iterators)可能會導致不直覺(unintuitive)的行為(behavior)</li> </ul> </li> <li>建議大多數的使用者可以利用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>readable.pipe()</a>方法(method),因為它能提供(provide)消耗(consuming)資料流(stream data)的最簡單(easiest)的實作(implemented)方式<ul> <li>開發者若要求(require)更細緻(fine-grained)地控制(control over)轉換(transform) &amp; 生成資料(generation of data)的話,能使用<a href=https://nodejs.org/dist/latest-v15.x/docs/api/events.html#events_class_eventemitter>EventEmitter</a>類別(class)以及<code>readable.on('readable')</code>/<code>readable.read()</code> or <code>readable.pause()/readable.resume()</code> APIs</li> </ul> </li> <li> <blockquote> <p>Class</p> </blockquote> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_class_stream_readable>stream.readable</a></li> <li> <blockquote> <p>Event</p> </blockquote> <ul> <li>data</li> <li>args<ul> <li>chunk (<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_buffer>Buffer</a>) | (String) | (any)</li> <li>資料塊(The chunk of data)。對於那些不是以物件模式(object mode)來操作(operating in)的<code>streams</code>(串流)來說,資料塊(chunk)將會是字串(string) or <code>Buffer</code>(緩存)這2種型別之一。而對於是以物件模式(object mode)來操作(operating in)的<code>streams</code>(串流)來說,資料塊(chunk)將能是除了<code>null</code>以外的Javascript中的任何值(any value)</li> </ul> </li> <li>每當(whenever)<code>stream</code>(串流)將資料塊(a chunk of data)的擁有權(ownership)轉移(relinquishing)給消費者(consumer)時,都會發出(emitted)<code>data</code>事件(event)</li> <li>每當(whenever)透過呼叫(calling)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pipe_destination_options>readable.pipe()</a>方法 or <a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>readable.resume()</a>方法 or 附加(attaching)一個事件監聽器(listener)的回呼函式(callback)在<code>data</code>這個事件(event)上時,來讓<code>stream</code>(串流)被切換(switched)為流動模式(<code>flowing</code> mode)的時候,都有可能(may)會發生(occur)發出(emitted)<code>data</code>這個事件(event)</li> <li>每當(whenever)呼叫(called)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size>readable.read()</a>方法(method)時,並且資料塊(a chunk of data)是能夠(available)被回傳(returned)的情況下時,也可能會發出(emitted)<code>data</code>這個事件(event)</li> <li>附加(Attaching)一個事件監聽器(listener)到那些還尚未(has not been)被明確(explicitly)地暫停(paused)的<code>stream</code>(串流)上時,將會把<code>stream</code>(串流)切換為流動模式(<code>flowing</code> mode)。這時,資料(data)將會在其能夠(available)使用時盡快(as soon as)地傳遞(passed)出去</li> <li>若該<code>stream</code>(串流)的預設(default)編碼格式(encoding)已經有透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_setencoding_encoding>readable.setEncoding()</a>方法(method)來指定(specified)過的話,事件監聽器(listener)回呼函式(callback)將會把資料塊(the chunk of data)以字串(string)型別的方式傳遞(passed)出去; 否則(otherwise),資料(data)將會以<code>Buffer</code>(緩存)型別的方式來傳遞(passed)出去 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-308-1><a id=__codelineno-308-1 name=__codelineno-308-1 href=#__codelineno-308-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getReadableStreamSomehow</span><span class=p>();</span>
</span><span id=__span-308-2><a id=__codelineno-308-2 name=__codelineno-308-2 href=#__codelineno-308-2></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-308-3><a id=__codelineno-308-3 name=__codelineno-308-3 href=#__codelineno-308-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Received </span><span class=si>${</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb> bytes of data.`</span><span class=p>);</span>
</span><span id=__span-308-4><a id=__codelineno-308-4 name=__codelineno-308-4 href=#__codelineno-308-4></a><span class=p>});</span>
</span></code></pre></div></li> <li>pause</li> <li>當呼叫(called)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pause>stream.pause()</a>方法(method)時,並且<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_readableflowing>readable.redableFlowing</a>的屬性值"不為"<code>false</code>的話,<code>pause</code>事件(event)就會被發出(emitted)</li> <li> <blockquote> <p>method</p> </blockquote> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_pause>readable.pause()</a><ul> <li>Returns: (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this>this</a>)</li> <li><code>readable.pause()</code>方法(method)會導致(cause)處於流動模式(<code>flowing</code> mode)的<code>stream</code>(串流)停止(stop)發出(emitting)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>這個事件(events),並從流動模式(<code>flowing</code> mode)中切換出來(switching out of)。任何(any)變成(becomes)可用(available)的資料(data)都將會保持(remain)在內部緩存(internal buffer)中 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-309-1><a id=__codelineno-309-1 name=__codelineno-309-1 href=#__codelineno-309-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getReadableStreamSomehow</span><span class=p>();</span>
</span><span id=__span-309-2><a id=__codelineno-309-2 name=__codelineno-309-2 href=#__codelineno-309-2></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-309-3><a id=__codelineno-309-3 name=__codelineno-309-3 href=#__codelineno-309-3></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Received </span><span class=si>${</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb> bytes of data.`</span><span class=p>);</span>
</span><span id=__span-309-4><a id=__codelineno-309-4 name=__codelineno-309-4 href=#__codelineno-309-4></a><span class=w>  </span><span class=nx>readable</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
</span><span id=__span-309-5><a id=__codelineno-309-5 name=__codelineno-309-5 href=#__codelineno-309-5></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;There will be no additional data for 1 second.&#39;</span><span class=p>);</span>
</span><span id=__span-309-6><a id=__codelineno-309-6 name=__codelineno-309-6 href=#__codelineno-309-6></a><span class=w>  </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-309-7><a id=__codelineno-309-7 name=__codelineno-309-7 href=#__codelineno-309-7></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Now data will start flowing again.&#39;</span><span class=p>);</span>
</span><span id=__span-309-8><a id=__codelineno-309-8 name=__codelineno-309-8 href=#__codelineno-309-8></a><span class=w>    </span><span class=nx>readable</span><span class=p>.</span><span class=nx>resume</span><span class=p>();</span>
</span><span id=__span-309-9><a id=__codelineno-309-9 name=__codelineno-309-9 href=#__codelineno-309-9></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
</span><span id=__span-309-10><a id=__codelineno-309-10 name=__codelineno-309-10 href=#__codelineno-309-10></a><span class=p>});</span>
</span></code></pre></div></li> <li>補充: 若有可讀取串流(readable stream)事件監聽器(event listener)的話,<code>readable.pause()</code>方法(method)將會 <strong>無效</strong> (no effect)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size>readable.read([size])</a><ul> <li>args</li> <li>size: (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#number_type>Number</a>)<ul> <li>這是一個可選擇性(optional)要不要給的參數(argument),是用來指定(specify)有多少數量的資料(data)要被讀取(read)</li> </ul> </li> <li>Returns: (string) | (<a href=https://nodejs.org/dist/latest-v15.x/docs/api/buffer.html#buffer_class_buffer>Buffer</a>) | (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#null_type>null</a>) | (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types>any</a>)</li> <li>此<code>readable.read()</code>方法(method)會從內部緩存區(internal buffers)拉出(pull)一些資料(data)並且回傳(returns)這些資料。若沒有資料能夠(available)讀取的話,就會回傳(returned)<code>null</code></li> <li>預設情況(default)下,回傳(returned)的資料會是<code>Buffer</code>(緩存)物件(object),除非(unless)我們有透過<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_setencoding_encoding>readable.setEncoding()</a>方法(method)來指定(specify)想要的編碼格式(encoding),或是<code>stream</code>(串流)是以物件模式(object mode)來運作(operating)的</li> <li>此方法(method)中的可選性(optional)填入的參數(argument)<code>size</code>可以用來指定(specifies)要讀取(read)多少特定(specific)數量(number)的位元組(bytes)。若<code>size</code>參數不是有效(available)的話,那麼就會回傳<code>null</code>,除非(unless)<code>stream</code>(串流)已經結束(ended)了的話,在這種情況下(in which case),就會將所有在內部緩存(internal buffer)中剩下(remaining)的資料(data)都回傳(returned)出來</li> <li>若此方法中的<code>size</code>參數沒有被指定(specified)的話,將回傳(returned)所有包含(contained)在內部緩存區(internal buffer)中的資料(data)</li> <li><code>size</code>參數的值必須小於 or 等於 1 <code>Gib</code></li> <li><code>readable.read()</code>方法(method)應只能在以暫停模式(<code>paused</code> mode)運作(operating)並在可讀取串流(Readable)中呼叫(called)此方法。在流動模式(<code>flowing</code> mode)中,直到(until)內部緩存(internal buffer)被完全耗盡(fully drained)時,就會自動地呼叫<code>readable.read()</code>方法 <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-310-1><a id=__codelineno-310-1 name=__codelineno-310-1 href=#__codelineno-310-1></a><span class=kd>const</span><span class=w> </span><span class=nx>readable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getReadableStreamSomehow</span><span class=p>();</span>
</span><span id=__span-310-2><a id=__codelineno-310-2 name=__codelineno-310-2 href=#__codelineno-310-2></a>
</span><span id=__span-310-3><a id=__codelineno-310-3 name=__codelineno-310-3 href=#__codelineno-310-3></a><span class=c1>// &#39;readable&#39; may be triggered multiple times as data is buffered in</span>
</span><span id=__span-310-4><a id=__codelineno-310-4 name=__codelineno-310-4 href=#__codelineno-310-4></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;readable&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-310-5><a id=__codelineno-310-5 name=__codelineno-310-5 href=#__codelineno-310-5></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>chunk</span><span class=p>;</span>
</span><span id=__span-310-6><a id=__codelineno-310-6 name=__codelineno-310-6 href=#__codelineno-310-6></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Stream is readable (new data received in buffer)&#39;</span><span class=p>);</span>
</span><span id=__span-310-7><a id=__codelineno-310-7 name=__codelineno-310-7 href=#__codelineno-310-7></a><span class=w>  </span><span class=c1>// Use a loop to make sure we read all currently available data</span>
</span><span id=__span-310-8><a id=__codelineno-310-8 name=__codelineno-310-8 href=#__codelineno-310-8></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>null</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readable</span><span class=p>.</span><span class=nx>read</span><span class=p>()))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-310-9><a id=__codelineno-310-9 name=__codelineno-310-9 href=#__codelineno-310-9></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Read </span><span class=si>${</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb> bytes of data...`</span><span class=p>);</span>
</span><span id=__span-310-10><a id=__codelineno-310-10 name=__codelineno-310-10 href=#__codelineno-310-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-310-11><a id=__codelineno-310-11 name=__codelineno-310-11 href=#__codelineno-310-11></a><span class=p>});</span>
</span><span id=__span-310-12><a id=__codelineno-310-12 name=__codelineno-310-12 href=#__codelineno-310-12></a>
</span><span id=__span-310-13><a id=__codelineno-310-13 name=__codelineno-310-13 href=#__codelineno-310-13></a><span class=c1>// &#39;end&#39; will be triggered once when there is no more data available</span>
</span><span id=__span-310-14><a id=__codelineno-310-14 name=__codelineno-310-14 href=#__codelineno-310-14></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-310-15><a id=__codelineno-310-15 name=__codelineno-310-15 href=#__codelineno-310-15></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Reached end of stream.&#39;</span><span class=p>);</span>
</span><span id=__span-310-16><a id=__codelineno-310-16 name=__codelineno-310-16 href=#__codelineno-310-16></a><span class=p>});</span>
</span></code></pre></div></li> <li>每一次(Each)呼叫(call)<code>readable.read()</code>方法都會回傳(returns)一個資料塊(a chunk of data), 或是<code>null</code>。而這些資料塊(chunks)並不是串連(concatenated)的</li> <li>在上面的範例程式碼中,<code>while</code>迴圈(loop)是必要(necessary)地用來消耗(consume)當前(currently)<code>buffer</code>(緩存)中的所有資料(data)</li> <li>當讀取(reading)一個比較大(large)的檔案(file)時,<code>readable.read()</code>方法將會回傳<code>null</code>,到目前為止(so far)已經消耗(consumed)掉所有的緩存(buffered)內容(content)了,但是仍然有更多資料尚未被緩存(buffered)。在這種情況下(In this case),當仍然有更多資料還在<code>buffer</code>(緩存)時,就會發出(emitted)一個新(new)的<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_readable>readable</a>事件(event)。最後(Finally),當沒有更多(no more)的資料(data)要傳來時,就會發出(emitted)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_end>end</a>事件(event)</li> <li><strong>因此(Therefore),若要從可讀取串流(<code>readable</code>)中讀取(read)一個檔案(file)的全部內容(whole contents)的話,跨多個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_readable>readable</a>事件(event)來收集(collect)資料塊(chunks)是必要(necessary)的</strong> <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-311-1><a id=__codelineno-311-1 name=__codelineno-311-1 href=#__codelineno-311-1></a><span class=kd>const</span><span class=w> </span><span class=nx>chunks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
</span><span id=__span-311-2><a id=__codelineno-311-2 name=__codelineno-311-2 href=#__codelineno-311-2></a>
</span><span id=__span-311-3><a id=__codelineno-311-3 name=__codelineno-311-3 href=#__codelineno-311-3></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;readable&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-311-4><a id=__codelineno-311-4 name=__codelineno-311-4 href=#__codelineno-311-4></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>chunk</span><span class=p>;</span>
</span><span id=__span-311-5><a id=__codelineno-311-5 name=__codelineno-311-5 href=#__codelineno-311-5></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>null</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=p>(</span><span class=nx>chunk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readable</span><span class=p>.</span><span class=nx>read</span><span class=p>()))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-311-6><a id=__codelineno-311-6 name=__codelineno-311-6 href=#__codelineno-311-6></a><span class=w>    </span><span class=nx>chunks</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>chunk</span><span class=p>);</span>
</span><span id=__span-311-7><a id=__codelineno-311-7 name=__codelineno-311-7 href=#__codelineno-311-7></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-311-8><a id=__codelineno-311-8 name=__codelineno-311-8 href=#__codelineno-311-8></a><span class=p>});</span>
</span><span id=__span-311-9><a id=__codelineno-311-9 name=__codelineno-311-9 href=#__codelineno-311-9></a>
</span><span id=__span-311-10><a id=__codelineno-311-10 name=__codelineno-311-10 href=#__codelineno-311-10></a><span class=nx>readable</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-311-11><a id=__codelineno-311-11 name=__codelineno-311-11 href=#__codelineno-311-11></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>chunks</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span><span id=__span-311-12><a id=__codelineno-311-12 name=__codelineno-311-12 href=#__codelineno-311-12></a><span class=p>});</span>
</span></code></pre></div></li> <li>在物件模式(object mode)中的可讀取串流(<code>Readable</code>)將總是在呼叫(call)<code>readable.read(size)</code>方法時,回傳(return)單一(single)個項目(item),而不管(regardless of)此方法中的<code>size</code>參數(argument)值是被指定為多少</li> <li>若<code>readable.read()</code>方法(method)回傳(returns)一個資料塊(a chunk of data),那麼就會發出(emitted)一個<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_data>data</a>事件(event)</li> <li>若在<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_event_end>end</a>事件(event)已被發出(emitted)之後才呼叫<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_read_size>stream.read(size)</a>方法(method)的話,將會回傳(return)<code>null</code>。這麼做並不會引發(raised)運行錯誤(<code>runtime error</code>)</li> </ul> </li> <li><a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>readable.resume()</a><ul> <li>Returns: (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this>this</a>)</li> <li><code>readable.resume()</code>方法(method)將會導致明確(explicitly)地顯示暫停(paused)的可讀取串流(readable stream)會 <strong>繼續</strong> (resume)發出(emitting)<a href=https://nodejs.org/dist/latest-v15.x/docs/api/stream.html#stream_readable_resume>data</a>事件(events),並將<code>stream</code>(串流)切換(switching)到流動模式(<code>flowing</code> mode)中</li> <li><code>readable.resume()</code>方法(method)可以被用來(used to)完全(fully)地消耗(consume)從<code>stream</code>(串流)傳遞過來的資料(data),而無需(without)實際(actually)地處理(processing)任何那樣的資料(any of that data) <div class="language-js highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-312-1><a id=__codelineno-312-1 name=__codelineno-312-1 href=#__codelineno-312-1></a><span class=nx>getReadableStreamSomehow</span><span class=p>()</span>
</span><span id=__span-312-2><a id=__codelineno-312-2 name=__codelineno-312-2 href=#__codelineno-312-2></a><span class=w>  </span><span class=p>.</span><span class=nx>resume</span><span class=p>()</span>
</span><span id=__span-312-3><a id=__codelineno-312-3 name=__codelineno-312-3 href=#__codelineno-312-3></a><span class=w>  </span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-312-4><a id=__codelineno-312-4 name=__codelineno-312-4 href=#__codelineno-312-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Reached the end, but did not read anything.&#39;</span><span class=p>);</span>
</span><span id=__span-312-5><a id=__codelineno-312-5 name=__codelineno-312-5 href=#__codelineno-312-5></a><span class=w>  </span><span class=p>});</span>
</span></code></pre></div></li> <li>補充: 若有可讀取串流(readable stream)事件監聽器(event listener)的話,<code>readable.resume()</code>方法(method)將會 <strong>無效</strong> (no effect)</li> </ul> </li> </ul> </li> </ul> </li> </ul> <hr> <h2 id=_2>參考資料來源<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <h3 id=_3>官方文件<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <ul> <li><a href=https://nodejs.org/en/ >Node.js</a></li> <li><a href=https://www.npmjs.com/ >Node Package Manager(NPM)</a></li> <li><a href=https://classic.yarnpkg.com/en/ >Yarn</a></li> <li><a href=https://github.com/nvm-sh/nvm>Node Version Manager(NVM)</a></li> <li><a href=https://expressjs.com/ >Express.js</a></li> </ul> <h3 id=_4>網路文章<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <ul> <li><a href=https://vagrantpi.github.io/2019/11/01/understanding-worker-threads-in-Node.js>Understanding Worker Threads in Node.js</a></li> <li><a href=https://medium.com/rytass/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-node-js-%E7%9A%84%E8%A8%AD%E8%A8%88%E9%8C%AF%E8%AA%A4-%E5%BE%9E-ryan-dahl-%E7%9A%84%E6%BC%94%E8%AC%9B%E4%B8%AD%E5%8F%8D%E6%80%9D-cedbf32cb188>深入理解 Node.js 的設計錯誤 — 從 Ryan Dahl 的演講中反思</a></li> <li><a href=https://noob.tw/open-source-licenses/ >常見的五個開源專案授權條款,使用軟體更自由</a></li> </ul> <h3 id=_5>網路影片<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <ul> <li><a href="https://www.youtube.com/watch?v=M3BM9TB-8yA&feature=emb_logo">10 Things I Regret About Node.js - Ryan Dahl - JSConf EU</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到頂端 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 ~ Hans Tsai </div> </div> <div class=md-social> <a href=https://github.com/hans-tsai target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.af256bd8.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../assets/javascripts/custom.a678ee80.min.js></script> </body> </html>